<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-java/JAVA-SpringCloud-Stack" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.0"><title data-rh=true>JAVA-SpringCloud技术栈 | 贺敏华的官方网站</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://mhuahe.github.io/mhuahe.com/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://mhuahe.github.io/mhuahe.com/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-SpringCloud-Stack><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="JAVA-SpringCloud技术栈 | 贺敏华的官方网站"><meta data-rh=true name=description content=cloud-eureka><meta data-rh=true property=og:description content=cloud-eureka><link data-rh=true rel=icon href=/mhuahe.com/img/m_two_logo.ico><link data-rh=true rel=canonical href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-SpringCloud-Stack><link data-rh=true rel=alternate href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-SpringCloud-Stack hreflang=zh-Hans><link data-rh=true rel=alternate href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-SpringCloud-Stack hreflang=x-default><link rel=alternate type=application/rss+xml href=/mhuahe.com/blog/rss.xml title="贺敏华的官方网站 RSS Feed"><link rel=alternate type=application/atom+xml href=/mhuahe.com/blog/atom.xml title="贺敏华的官方网站 Atom Feed"><link rel=stylesheet href=/mhuahe.com/assets/css/styles.06d361cb.css><script src=/mhuahe.com/assets/js/runtime~main.1b34b5c1.js defer></script><script src=/mhuahe.com/assets/js/main.6e839081.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><div class=announcementBar_mb4j role=banner><div class=announcementBarPlaceholder_vyr4></div><div class="content_knG7 announcementBarContent_xLdY">🎉️<b>本网站正在建设中，欢迎提出宝贵意见！<a target=_blank href=https://github.com/mhuahe/mhuahe.com>源码地址</a></b> 🥳️</div><button type=button aria-label=关闭 class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width=14 height=14><g stroke=currentColor stroke-width=3.1><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"/></g></svg></button></div><nav aria-label=主导航 class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/mhuahe.com/><div class=navbar__logo><img src=/mhuahe.com/img/m_two_logo.svg alt="mhuahe site logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height=32 width=32><img src=/mhuahe.com/img/m_two_logo.svg alt="mhuahe site logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height=32 width=32></div><b class="navbar__title text--truncate">贺敏华的官方网站</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/mhuahe.com/docs/java>Java</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/web>前端</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/c>C语言</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/linux>Linux</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/sql/MySQL>SQL</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/python>Python</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/tool>工具</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/project>项目</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/knowledge/什么是SaaS>知识</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/other/OTHER-Examination>其他</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/mhuahe.com/docs/example/EXAMPLE-Video>示例</a><a class="navbar__item navbar__link" href=/mhuahe.com/blog>Blog</a><a href=/mhuahe.com/pintree/index.html class="navbar__item navbar__link" target=_blank>书签</a><a href=https://github.com/mhuahe/mhuahe.com target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title=切换浅色/暗黑模式（当前为浅色模式） aria-label=切换浅色/暗黑模式（当前为浅色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=搜索 aria-label=Search class=navbar__search-input value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java><div> <!-- -->JAVA</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Algorithm><div> <!-- -->JAVA-算法</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Code-Generation><div> <!-- -->JAVA-代码生成</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Data-Structure><div> <!-- -->JAVA-数据结构</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Design-Pattern><div> <!-- -->JAVA-设计模式</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Elaticsearch><div> <!-- -->JAVA-ES</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Encryption><div> <!-- -->JAVA-加密方式</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Error-Record><div> <!-- -->JAVA-错误记录</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Hutool><div> <!-- -->JAVA-HuTool工具</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-JDK-Version><div> <!-- -->JAVA-JDK版本</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-JVM><div> <!-- -->JAVA-JVM</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Knowledge-Question><div> <!-- -->JAVA-知识题</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MQ><div> <!-- -->JAVA-消息队列</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Maven-Dependent><div> <!-- -->JAVA-Maven依赖</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Maven><div> <!-- -->JAVA-Maven</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MongoDB><div> <!-- -->JAVA-MongoDB</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MybatisPlus><div> <!-- -->JAVA-MybatisPlus</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-OAuth2-SourceCode><div> <!-- -->JAVA-oauth2源码解读</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-PDF><div> <!-- -->JAVA-PDF</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SQL-Interceptor><div> <!-- -->JAVA-SQL拦截器</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Servlet><div> <!-- -->JAVA-Servlet</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SpringBoot-Stack><div> <!-- -->JAVA-SpringBoot技术栈</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SpringBoot-Version><div> <!-- -->JAVA-SpringBoot版本</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/mhuahe.com/docs/java/JAVA-SpringCloud-Stack><div> <!-- -->JAVA-SpringCloud技术栈</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Thread><div> <!-- -->JAVA-多线程</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-WebSocket><div> <!-- -->JAVA-WebSocket</div></a></ul></nav><button type=button title=收起侧边栏 aria-label=收起侧边栏 class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/mhuahe.com/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>JAVA-SpringCloud技术栈</span><meta itemprop=position content=1></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>JAVA-SpringCloud技术栈</h1></header>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-eureka>cloud-eureka<a href=#cloud-eureka class=hash-link aria-label=cloud-eureka的直接链接 title=cloud-eureka的直接链接>​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=服务端>服务端<a href=#服务端 class=hash-link aria-label=服务端的直接链接 title=服务端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>&lt;!-- 依赖 --></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-server</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 加注解</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token variable" style=color:#36acaa>@EnableEurekaServer</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8001</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#指定运行端口</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server </span><span class="token comment" style=color:#999988;font-style:italic>#指定服务名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>instance</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>hostname</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost </span><span class="token comment" style=color:#999988;font-style:italic>#指定主机地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#指定是否要从注册中心获取服务（注册中心不需要开启）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#指定是否要注册到注册中心（注册中心不需要开启）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enable-self-preservation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#关闭保护模式</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 访问</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8001/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=客户端>客户端<a href=#客��户端 class=hash-link aria-label=客户端的直接链接 title=客户端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 加注解</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token variable" style=color:#36acaa>@EnableDiscoveryClient</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8101</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#运行端口号</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client </span><span class="token comment" style=color:#999988;font-style:italic>#服务名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#注册到Eureka的注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#获取注册实例列表</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/ </span><span class="token comment" style=color:#999988;font-style:italic>#配置注册中心地址</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 访问</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8001/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=集群>集群<a href=#集群 class=hash-link aria-label=集群的直接链接 title=集群的直接链接>​</a></h5>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 给eureka-sever添加配置文件application-replica1.yml配置第一个注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8002</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>instance</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>hostname</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> replica1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>serviceUrl</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//replica2</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8003/eureka/ </span><span class="token comment" style=color:#999988;font-style:italic>#注册到另一个Eureka注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 给eureka-sever添加配置文件application-replica2.yml配置第二个注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8003</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>instance</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>hostname</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> replica2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>serviceUrl</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//replica1</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8002/eureka/ </span><span class="token comment" style=color:#999988;font-style:italic>#注册到另一个Eureka注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 这里我们通过两个注册中心互相注册，搭建了注册中心的双节点集群，由于defaultZone使用了域名，所以还需在本机的host文件中配置一下</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 修改本地host文件</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>127.0</span><span class="token number" style=color:#36acaa>.0</span><span class="token number" style=color:#36acaa>.1</span><span class="token plain"> replica1</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>127.0</span><span class="token number" style=color:#36acaa>.0</span><span class="token number" style=color:#36acaa>.1</span><span class="token plain"> replica2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 运行Eureka注册中心集群</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 在IDEA中我们可以通过使用不同的配置文件来启动同一个SpringBoot应用</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 添加两个配置，分别以application-replica1.yml和application-replica2.yml来启动eureka-server</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">在Active profiles ：配置 replica1或replica2</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 修改Eureka-client，让其连接到集群</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 添加eureka-client的配置文件application-replica.yml，让其同时注册到两个注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8102</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//replica1</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8002/eureka/</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//replica2</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8003/eureka/ </span><span class="token comment" style=color:#999988;font-style:italic>#同时注册到两个注册中心</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=添加认证>添加认证<a href=#添加认证 class=hash-link aria-label=添加认证的直接链接 title=添加认证的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-server</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 主要是配置了登录注册中心的用户名和密码</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8004</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">security</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>security</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置SpringSecurity登录用户名和密码</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>user</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>123456</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>instance</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>hostname</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">// 添加Java配置WebSecurityConfig</span><br></span><span class=token-line style=color:#393A34><span class="token plain">// 默认情况下添加SpringSecurity依赖的应用每个请求都需要添加CSRF token才能访问，Eureka客户端注册时并不会添加，所以需要配置/eureka/**路径不需要CSRF token</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableWebSecurity</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class WebSecurityConfig extends WebSecurityConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    protected void configure(HttpSecurity http) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        http.csrf().ignoringAntMatchers("/eureka/**");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        super.configure(http);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- eureka-client注册到有登录认证的注册中心</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 配置文件中需要修改注册中心地址格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//${username}:${password}@${hostname}:${port}/eureka/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8103</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> eureka</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//macro</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">123456@localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8004/eureka/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=eureka的常用配置>Eureka的常用配置<a href=#eureka的常用配置 class=hash-link aria-label=Eureka的常用配置的直接链接 title=Eureka的常用配置的直接链接>​</a></h5>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#eureka客户端配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否将自己注册到eureka服务端上去</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否获取eureka服务端上注册的服务列表</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/ </span><span class="token comment" style=color:#999988;font-style:italic># 指定注册中心地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 启用eureka客户端</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>registry-fetch-interval-seconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>30</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#定义去eureka服务端获取服务列表的时间间隔</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>instance</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#eureka客户端实例配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>lease-renewal-interval-in-seconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>30</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#定义服务多久去注册中心续约</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>lease-expiration-duration-in-seconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>90</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#定义服务多久不去续约认为服务失效</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>metadata-map</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>zone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> jiangsu </span><span class="token comment" style=color:#999988;font-style:italic>#所在区域</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>hostname</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost </span><span class="token comment" style=color:#999988;font-style:italic>#服务主机名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>prefer-ip-address</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否优先使用ip来作为主机名</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#eureka服务端配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enable-self-preservation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#关闭eureka服务端的保护机制</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-ribbon>cloud-ribbon<a href=#cloud-ribbon class=hash-link aria-label=cloud-ribbon的直接链接 title=cloud-ribbon的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Ribbon 是Spring Cloud Netflix 子项目的核心组件之一，主要给服务间调用及API网关转发提供负载均衡的功能</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 在微服务架构中，很多服务都会部署多个，其他服务去调用该服务的时候，如何保证负载均衡是个不得不去考虑的问题。负载均衡可以增加系统的可用性和扩展性，当我们使用RestTemplate来调用其他服务时，Ribbon可以很方便的实现负载均衡功能</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- RestTemplate是SpringMVC携带的工具</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=客户端1>客户端1<a href=#客户端1 class=hash-link aria-label=客户端1的直接链接 title=客户端1的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8201</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=ribbon负载客户端>ribbon负载客户端<a href=#ribbon负载客户端 class=hash-link aria-label=ribbon负载客户端的直接链接 title=ribbon负载客户端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-ribbon</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8301</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> ribbon</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>user-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=负载配置>负载配置<a href=#负载配置 class=hash-link aria-label=负载配置的直接链接 title=负载配置的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RibbonClient(name = "user-service")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class RibbonConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @LoadBalanced</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public RestTemplate restTemplate(){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new RestTemplate();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public IRule ribbonRule(){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new RandomRule();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=调用客户端>调用客户端<a href=#调用客户端 class=hash-link aria-label=调用客户端的直接链接 title=调用客户端的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/user")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserRibbonController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Value("${service-url.user-service}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private String userServiceUrl;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/create")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void create() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println(restTemplate.getForObject(userServiceUrl + "/user/create",String.class));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=演示>演示<a href=#演示 class=hash-link aria-label=演示的直接链接 title=演示的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token number" style=color:#36acaa>1.</span><span class="token plain"> 启动eureka</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">server于</span><span class="token number" style=color:#36acaa>8001</span><span class="token plain">端口</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">服务端</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2.</span><span class="token plain"> 启动</span><span class="token keyword" style=color:#00009f>user</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service于</span><span class="token number" style=color:#36acaa>8201</span><span class="token plain">端口（客户端</span><span class="token number" style=color:#36acaa>1</span><span class="token plain">）</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3.</span><span class="token plain"> 启动另一个</span><span class="token keyword" style=color:#00009f>user</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service于</span><span class="token number" style=color:#36acaa>8202</span><span class="token plain">端口，可以通过Override Param重写server</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">port配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>4.</span><span class="token plain"> 启动ribbon</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service，调用接口，会随机调用</span><span class="token keyword" style=color:#00009f>user</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service其中一个</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=ribbon常用配置>ribbon常用配置<a href=#ribbon常用配置 class=hash-link aria-label=ribbon常用配置的直接链接 title=ribbon常用配置的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Ribbon的常用配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">ribbon:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ConnectTimeout: </span><span class="token number" style=color:#36acaa>1000</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#服务请求连接超时时间（毫秒）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ReadTimeout: </span><span class="token number" style=color:#36acaa>3000</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#服务请求处理超时时间（毫秒）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  OkToRetryOnAllOperations: </span><span class="token boolean" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#对超时请求启用重试机制</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  MaxAutoRetriesNextServer: </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#切换重试实例的最大个数</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  MaxAutoRetries: </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 切换实例后重试最大次数</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  NFLoadBalancerRuleClassName: com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">RandomRule </span><span class="token comment" style=color:#999988;font-style:italic>#修改负载均衡算法</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Ribbon的负载均衡策略</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">RandomRule：从提供服务的实例中以随机的方式；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">RoundRobinRule：以线性轮询的方式，就是维护一个计数器，从提供服务的实例中按顺序选取，第一次选第一个，第二次选第二个，以此类推，到最后一个以后再从头来过；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">RetryRule：在RoundRobinRule的基础上添加重试机制，即在指定的重试时间内，反复使用线性轮询策略来选择可用实例；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">WeightedResponseTimeRule：对RoundRobinRule的扩展，响应速度越快的实例选择权重越大，越容易被选择；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">BestAvailableRule：选择并发较小的实例；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">AvailabilityFilteringRule：先过滤掉故障实例，再选择并发较小的实例；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">com</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">netflix</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">loadbalancer</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ZoneAwareLoadBalancer：采用双重过滤，同时过滤不是同一区域的实例和故障实例，选择并发较小的实例</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-hystrix>cloud-hystrix<a href=#cloud-hystrix class=hash-link aria-label=cloud-hystrix的直接链接 title=cloud-hystrix的直接链接>​</a></h4>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-hystrix</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8401</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> hystrix</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>user-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@EnableCircuitBreaker</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableDiscoveryClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class HystrixServiceApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(HystrixServiceApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=服务降级>服务降级<a href=#服务降级 class=hash-link aria-label=服务降级的直接链接 title=服务降级的直接链接>​</a></h5>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 测试效果：如果服务停止，则会调用getDefaultUser方法进行降级操作</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@HystrixCommand(fallbackMethod = "getDefaultUser")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public CommonResult getUser(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">public CommonResult getDefaultUser(@PathVariable Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    User defaultUser = new User(-1L, "defaultUser", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return new CommonResult&lt;>(defaultUser);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=hystrixcommand常用参数>@HystrixCommand常用参数<a href=#hystrixcommand常用参数 class=hash-link aria-label=@HystrixCommand常用参数的直接链接 title=@HystrixCommand常用参数的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">fallbackMethod：指定服务降级处理方法；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">ignoreExceptions：忽略某些异常，不发生服务降级；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">commandKey：命令名称，用于区分不同的命令；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">groupKey：分组名称，Hystrix会根据不同的分组来统计命令的告警及仪表盘信息；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">threadPoolKey：线程池名称，用于划分线程池</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=请求缓存>请求缓存<a href=#请求缓存 class=hash-link aria-label=请求缓存的直接链接 title=请求缓存的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=相关注解>相关注解<a href=#相关注解 class=hash-link aria-label=相关注解的直接链接 title=相关注解的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token variable" style=color:#36acaa>@CacheResult</span><span class="token plain">：开启缓存，默认所有参数作为缓存的</span><span class="token keyword" style=color:#00009f>key</span><span class="token plain">，cacheKeyMethod可以通过返回String类型的方法指定</span><span class="token keyword" style=color:#00009f>key</span><span class="token plain">；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token variable" style=color:#36acaa>@CacheKey</span><span class="token plain">：指定缓存的</span><span class="token keyword" style=color:#00009f>key</span><span class="token plain">，可以指定参数或指定参数中的属性值为缓存</span><span class="token keyword" style=color:#00009f>key</span><span class="token plain">，cacheKeyMethod还可以通过返回String类型的方法指定；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token variable" style=color:#36acaa>@CacheRemove</span><span class="token plain">：移除缓存，需要指定commandKey。</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 测试效果：第一次发送请求并缓存，第二次获取缓存，第三次获取缓存</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@CacheResult(cacheKeyMethod = "getCacheKey")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@HystrixCommand(fallbackMethod = "getDefaultUser", commandKey = "getUserCache")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult getUserCache(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    LOGGER.info("getUserCache id:{}", id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 为缓存生成key</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public String getCacheKey(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return String.valueOf(id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 测试效果：第一次发送请求并缓存，第二次移除缓存，第三次重新发送请求并缓存</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * commandKey要跟开启缓存的commandKey对应</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@CacheRemove(commandKey = "getUserCache", cacheKeyMethod = "getCacheKey")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@HystrixCommand</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public CommonResult removeCache(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    LOGGER.info("removeCache id:{}", id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return restTemplate.postForObject(userServiceUrl + "/user/delete/{1}", null, CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 在缓存使用过程中，我们需要在每次使用缓存的请求前后对HystrixRequestContext进行初始化和关闭</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 这里我们通过使用过滤器，在每个请求前后初始化和关闭HystrixRequestContext来解决该问题</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Component</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@WebFilter(urlPatterns = "/*",asyncSupported = true)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class HystrixRequestContextFilter implements Filter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        HystrixRequestContext context = HystrixRequestContext.initializeContext();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            filterChain.doFilter(servletRequest, servletResponse);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } finally {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            context.close();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=请求合并>请求合并<a href=#请求合并 class=hash-link aria-label=请求合并的直接链接 title=请求合并的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=hystrixcollapser的常用属性>@HystrixCollapser的常用属性<a href=#hystrixcollapser的常用属性 class=hash-link aria-label=@HystrixCollapser的常用属性的直接链接 title=@HystrixCollapser的常用属性的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">batchMethod：用于设置请求合并的方法；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">collapserProperties：请求合并属性，用于控制实例属性，有很多；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">timerDelayInMilliseconds：collapserProperties中的属性，用于控制每隔多少时间合并一次请求</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 对getUserFuture的的多次调用都会转化为对getUserByIds的单次调用</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 测试效果：100毫秒调用2次，2次合并成一次批量请求（类似byId 和 byIds）</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 100毫秒后调用第三次，不合并</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@HystrixCollapser(batchMethod = "getUserByIds",collapserProperties = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @HystrixProperty(name = "timerDelayInMilliseconds", value = "100")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">})</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public Future&lt;User> getUserFuture(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return new AsyncResult&lt;User>(){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public User invoke() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Map data = (Map) commonResult.getData();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User user = BeanUtil.mapToBean(data,User.class,true);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        LOGGER.info("getUserById username:{}", user.getUsername());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return user;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    };</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">@HystrixCommand</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public List&lt;User> getUserByIds(List&lt;Long> ids) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    LOGGER.info("getUserByIds:{}", ids);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/getUserByIds?ids={1}", CommonResult.class, CollUtil.join(ids,","));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return (List&lt;User>) commonResult.getData();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=hystrix的常用配置>Hystrix的常用配置<a href=#hystrix的常用配置 class=hash-link aria-label=Hystrix的常用配置的直接链接 title=Hystrix的常用配置的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=全局配置>全局配置<a href=#全局配置 class=hash-link aria-label=全局配置的直接链接 title=全局配置的直接链接>​</a></h6>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>hystrix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>command</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制HystrixCommand的行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>default</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>execution</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>isolation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>strategy</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> THREAD </span><span class="token comment" style=color:#999988;font-style:italic>#控制HystrixCommand的隔离策略，THREAD->线程池隔离策略(默认)，SEMAPHORE->信号量隔离策略</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>thread</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>timeoutInMilliseconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置HystrixCommand执行的超时时间，执行超过该时间会进行服务降级处理</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>interruptOnTimeout</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置HystrixCommand执行超时的时候是否要中断</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>interruptOnCancel</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置HystrixCommand执行被取消的时候是否要中断</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>timeout</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置HystrixCommand的执行是否启用超时时间</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>semaphore</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token key atrule" style=color:#00a4db>maxConcurrentRequests</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#当使用信号量隔离策略时，用来控制并发量的大小，超过该并发量的请求会被拒绝</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>fallback</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制是否启用服务降级</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>circuitBreaker</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制HystrixCircuitBreaker的行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制断路器是否跟踪健康状况以及熔断请求</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>requestVolumeThreshold</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>20</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#超过该请求数的请求会被拒绝</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>forceOpen</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#强制打开断路器，拒绝所有请求</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>forceClosed</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#强制关闭断路器，接收所有请求</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>requestCache</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制是否开启请求缓存</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>collapser</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制HystrixCollapser的执行行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>default</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>maxRequestsInBatch</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#控制一次合并请求合并的最大请求数</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>timerDelayinMilliseconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#控制多少毫秒内的请求会被合并成一个</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>requestCache</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#控制合并请求是否开启缓存</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>threadpool</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制HystrixCommand执行所在线程池的行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>default</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>coreSize</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#线程池的核心线程数</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>maximumSize</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#线程池的最大线程数，超过该线程数的请求会被拒绝</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>maxQueueSize</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>-1</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于设置线程池的最大队列大小，-1采用SynchronousQueue，其他正数采用LinkedBlockingQueue</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>queueSizeRejectionThreshold</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于设置线程池队列的拒绝阀值，由于LinkedBlockingQueue不能动态改版大小，使用时需要用该参数来控制线程数</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=实例配置>实例配置<a href=#实例配置 class=hash-link aria-label=实例配置的直接链接 title=实例配置的直接链接>​</a></h6>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 配置文件中相关key的说明</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># HystrixComandKey对应@HystrixCommand中的commandKey属性；</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># HystrixCollapserKey对应@HystrixCollapser注解中的collapserKey属性；</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># HystrixThreadPoolKey对应@HystrixCommand中的threadPoolKey属性</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>hystrix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>command</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>HystrixComandKey</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#将default换成HystrixComrnandKey</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>execution</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>isolation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>strategy</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> THREAD</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>collapser</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>HystrixCollapserKey</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#将default换成HystrixCollapserKey</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>maxRequestsInBatch</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>threadpool</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>HystrixThreadPoolKey</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#将default换成HystrixThreadPoolKey</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>coreSize</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>10</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-feign>cloud-feign<a href=#cloud-feign class=hash-link aria-label=cloud-feign的直接链接 title=cloud-feign的直接链接>​</a></h4>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8701</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> feign</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>feign</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>hystrix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#在Feign中开启Hystrix</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>compression</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>request</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否对请求进行GZIP压缩</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>mime-types</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> text/xml</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">application/xml</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">application/json </span><span class="token comment" style=color:#999988;font-style:italic>#指定压缩的请求数据类型</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>min-request-size</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2048</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#超过该大小的请求会被压缩</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>response</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否对响应进行GZIP压缩</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>logging</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>level</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#修改日志级别</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>com.hmh.feign.feign.UserService</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> debug</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@EnableFeignClients</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableDiscoveryClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class FeignServiceApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(FeignServiceApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=feign接口>feign接口<a href=#feign接口 class=hash-link aria-label=feign接口的直接链接 title=feign接口的直接链接>​</a></h5>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//value：调用的服务。fallback：服务降级处理类（实现UserService）</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@FeignClient(value = "user-service",fallback = UserFallbackService.class)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public interface UserService {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/user/create")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    void create();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=日志打印>日志打印<a href=#日志打印 class=hash-link aria-label=日志打印的直接链接 title=日志打印的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 日志级别</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">NONE：默认的，不显示任何日志；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">BASIC：仅记录请求方法、URL、响应状态码及执行时间；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">HEADERS：除了BASIC中定义的信息之外，还有请求和响应的头信息；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>FULL</span><span class="token plain">：除了HEADERS中定义的信息之外，还有请求和响应的正文及元数据</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 通过java配置来使Feign打印最详细的Http请求日志信息</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class FeignConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Logger.Level feignLoggerLevel() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return Logger.Level.FULL;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-zuul>cloud-zuul<a href=#cloud-zuul class=hash-link aria-label=cloud-zuul的直接链接 title=cloud-zuul的直接链接>​</a></h4>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-zuul</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8801</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> zuul</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">proxy</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>register-with-eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>fetch-registry</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>zuul</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>prefix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> /proxy </span><span class="token comment" style=color:#999988;font-style:italic>#给网关路由添加前缀</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>routes</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#给服务配置路由</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>user-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 默认为/user-service/**</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>path</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> /userService/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>feign-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 默认为/feign-service/**</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>path</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> /feignService/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># ignored-services: user-service,feign-service #关闭默认路由配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>add-host-header</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#设置为true重定向是会添加host请求头</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>sensitive-headers</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> Cookie</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">Set</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">Cookie</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">Authorization </span><span class="token comment" style=color:#999988;font-style:italic>#配置过滤敏感的请求头信息，设置为空就不会过滤</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 禁用过滤器</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>PreLogFilter</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>pre</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>disable</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'routes'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># 服务降级</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>hystrix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>command</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#用于控制HystrixCommand的行为</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>default</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>execution</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>isolation</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>thread</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>timeoutInMilliseconds</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1000</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置HystrixCommand执行的超时时间，执行超过该时间会进行服务降级处理</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableEurekaClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableZuulProxy</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ZuulProxyApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(ZuulProxyApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=请求路由>请求路由<a href=#请求路由 class=hash-link aria-label=请求路由的直接链接 title=请求路由的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">zuul:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  routes: </span><span class="token comment" style=color:#999988;font-style:italic>#给服务配置路由</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>user</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      path: </span><span class="token operator" style=color:#393A34>/</span><span class="token plain">userService</span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>*</span><span class="token operator" style=color:#393A34>*</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    feign</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      path: </span><span class="token operator" style=color:#393A34>/</span><span class="token plain">feignService</span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>*</span><span class="token operator" style=color:#393A34>*</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><br></span><span class=token-line style=color:#393A34><span class="token plain">访问http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/userService/user/1可以发现请求路由到了user-service上了；</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">访问http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/feignService/user/1可以发现请求路由到了feign-service上了</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>--默认配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">访问http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/user-service/user/1同样可以路由到了user-service上了；</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">访问http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/feign-service/user/1同样可以路由到了feign-service上了</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=查看路由信息>查看路由信息<a href=#查看路由信息 class=hash-link aria-label=查看路由信息的直接链接 title=查看路由信息的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'routes'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 查看简单路由信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/actuator/routes</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 查看详细路由信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8801/actuator/routes/details</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=过滤器>过滤器<a href=#过滤器 class=hash-link aria-label=过滤器的直接链接 title=过滤器的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 过滤器类型</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">pre：在请求被路由到目标服务前执行，比如权限校验、打印日志等功能；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">routing：在请求被路由到目标服务时执行，这是使用Apache HttpClient或Netflix Ribbon构建和发送原始HTTP请求的地方；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">post：在请求被路由到目标服务后执行，比如给目标服务的响应添加头信息，收集统计数据等功能；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">error：请求在其他阶段发生错误时执行</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">服务A </span><span class="token comment" style=color:#999988;font-style:italic>---> pre ---> routing ---> 服务B </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token operator" style=color:#393A34>^</span><span class="token plain">                                </span><span class="token operator" style=color:#393A34>|</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token operator" style=color:#393A34>|</span><span class="token plain">   </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token comment" style=color:#999988;font-style:italic>--- post &lt;--- routing &lt;---                        </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 自定义过滤器</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Component</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class PreLogFilter extends ZuulFilter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private Logger LOGGER = LoggerFactory.getLogger(this.getClass());</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 过滤器类型，有pre、routing、post、error四种。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public String filterType() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return "pre";</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 过滤器执行顺序，数值越小优先级越高。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public int filterOrder() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return 1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 是否进行过滤，返回true会执行过滤。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public boolean shouldFilter() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return true;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 自定义的过滤器逻辑，当shouldFilter()返回true时会执行。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Object run() throws ZuulException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        RequestContext requestContext = RequestContext.getCurrentContext();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        HttpServletRequest request = requestContext.getRequest();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String host = request.getRemoteHost();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String method = request.getMethod();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String uri = request.getRequestURI();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        LOGGER.info("Remote host:{},method:{},uri:{}", host, method, uri);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return null;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-config>cloud-config<a href=#cloud-config class=hash-link aria-label=cloud-config的直接链接 title=cloud-config的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Config 需要一个存储配置信息的Git仓库</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">如：https:</span><span class="token comment" style=color:#999988;font-style:italic>//gitee.com/macrozheng/springcloud-config</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=服务端-1>服务端<a href=#服务端-1 class=hash-link aria-label=服务端的直接链接 title=服务端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-config-server</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8901</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>git</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置存储配置信息的Git仓库</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> https</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//gitee.com/dahua_0429/cloud</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config.git</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 1075335917@qq.com</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> h2050401938</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>clone-on-start</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#开启启动时直接从git获取配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>search-paths</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'{application}'</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 优先子文件夹</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@EnableConfigServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableDiscoveryClient</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ConfigServerApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(ConfigServerApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 获取配置文件信息的访问格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 获取配置信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>/</span><span class="token plain">{label}</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">{application}</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">{profile}</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 获取配置文件信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>/</span><span class="token plain">{label}</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">{application}</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">{profile}</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml</span><br></span><span class=token-line style=color:#393A34><span class="token plain">如：http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8901/master/config-dev.yml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">application：代表应用名称，默认为配置文件中的spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">name，如果配置了spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">name，则为该名称；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">label：代表分支名称，对应配置文件中的spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">label；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">profile：代表环境名称，对应配置文件中的spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">profile</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=客户端-1>客户端<a href=#客户端-1 class=hash-link aria-label=客户端的直接链接 title=客户端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-config</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 配置文件为bootstrap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9001</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#Config客户端配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>profile</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#启用配置后缀名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>label</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#分支名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8901</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置中心地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config </span><span class="token comment" style=color:#999988;font-style:italic>#配置文件名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'refresh'</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 刷新配置</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 测试配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ConfigClientController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Value("${config.info}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private String configInfo;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/configInfo")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public String getConfigInfo() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return configInfo;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=刷新配置>刷新配置<a href=#刷新配置 class=hash-link aria-label=刷新配置的直接链接 title=刷新配置的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'refresh'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 添加@RefreshScope注解刷新配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RefreshScope</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ConfigClientController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Value("${config.info}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private String configInfo;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/configInfo")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public String getConfigInfo() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return configInfo;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 刷新配置接口</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">POST http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9001/actuator/refresh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=安全认证>安全认证<a href=#安全认证 class=hash-link aria-label=安全认证的直接链接 title=安全认证的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-config-server</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8905</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">security</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>git</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> https</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//gitee.com/macrozheng/springcloud</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config.git</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>123456</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>clone-on-start</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#开启启动时直接从git获取配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>security</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置用户名和密码</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>user</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>123456</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableConfigServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ConfigSecurityServerApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(ConfigSecurityServerApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 客户端修改配置，添加认证账号密码</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9002</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>profile</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#启用配置后缀名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>label</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#分支名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8905</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置中心地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config </span><span class="token comment" style=color:#999988;font-style:italic>#配置文件名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>123456</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=集群搭建>集群搭建<a href=#集群搭建 class=hash-link aria-label=集群搭建的直接链接 title=集群搭建的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 启动多个服务端，连接同一个注册中心</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 客户端配置：添加了从注册中心获取配置中心地址的配置并去除了配置中心uri的配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9003</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>profile</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#启用环境名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>label</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#分支名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config </span><span class="token comment" style=color:#999988;font-style:italic>#配置文件名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-id</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-bus>cloud-bus<a href=#cloud-bus class=hash-link aria-label=cloud-bus的直接链接 title=cloud-bus的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Bus 使用轻量级的消息代理来连接微服务架构中的各个服务，可以将其用于广播状态更改（例如配置中心配置更改）或其他管理指令</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Bus 配合 Spring Cloud Config 使用可以实现配置的动态刷新</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 启动rabbitMQ</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=动态刷新配置>动态刷新配置<a href=#动态刷新配置 class=hash-link aria-label=动态刷新配置的直接链接 title=动态刷新配置的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=服务端-2>服务端<a href=#服务端-2 class=hash-link aria-label=服务端的直接链接 title=服务端的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-bus-amqp</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># 主要是添加了RabbitMQ的配置及暴露了刷新配置的Actuator端点</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8904</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>git</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> https</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//gitee.com/macrozheng/springcloud</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config.git</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>123456</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>clone-on-start</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 开启启动时直接从git获取配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>rabbitmq</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#rabbitmq相关配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>host</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5672</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> guest</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> guest</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#暴露bus刷新配置的端点</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'bus-refresh'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=客户端-2>客户端<a href=#客户端-2 class=hash-link aria-label=客户端的直接链接 title=客户端的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-bus-amqp</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9004</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>profile</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#启用环境名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>label</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev </span><span class="token comment" style=color:#999988;font-style:italic>#分支名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config </span><span class="token comment" style=color:#999988;font-style:italic>#配置文件名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>service-id</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>rabbitmq</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#rabbitmq相关配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>host</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>5672</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> guest</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> guest</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>eureka</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>defaultZone</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">8001/eureka/</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'refresh'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=演示-1>演示<a href=#演示-1 class=hash-link aria-label=演示的直接链接 title=演示的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token number" style=color:#36acaa>1.</span><span class="token plain"> 启动eureka</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2.</span><span class="token plain"> 启动config</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3.</span><span class="token plain"> 启动两个不同端口的config</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">登录RabbitMQ的控制台可以发现Spring Cloud Bus创建了一个叫springCloudBus的交换机及三个以 springCloudBus</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">anonymous开头的队列</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>4.</span><span class="token plain"> 调用注册中心的接口刷新所有配置</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">两个客户端</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8904/actuator/bus-refresh</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=配合webhooks使用>配合WebHooks使用<a href=#配合webhooks使用 class=hash-link aria-label=配合WebHooks使用的直接链接 title=配合WebHooks使用的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">WebHooks相当于是一个钩子函数，我们可以配置当向Git仓库push代码时触发这个钩子函数，这里以Gitee为例来介绍下其使用方式，这里当我们向配置仓库push代码时就会自动刷新服务配置了</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">git管理 </span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>--> WebHooks </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>--> 填写URl：http://localhost:8904/actuator/bus-refresh </span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>--> 勾选PUSH添加</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-sleuth>cloud-sleuth<a href=#cloud-sleuth class=hash-link aria-label=cloud-sleuth的直接链接 title=cloud-sleuth的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 需要链路追踪的服务都要配置下面信息</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-zipkin</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>zipkin</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>base-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>9411</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>sleuth</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>sampler</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>probability</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#设置Sleuth的抽样收集概率0-1</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=zipkin日志>zipkin日志<a href=#zipkin日志 class=hash-link aria-label=zipkin日志的直接链接 title=zipkin日志的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Zipkin是Twitter的一个开源项目，可以用来获取和分析Spring Cloud Sleuth 中产生的请求链路跟踪日志，它提供了Web界面来帮助我们直观地查看请求链路跟踪信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 下载zipkin-server</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">https:</span><span class="token comment" style=color:#999988;font-style:italic>//repo1.maven.org/maven2/io/zipkin/java/zipkin-server/2.12.9/zipkin-server-2.12.9-exec.jar</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 运行</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">java </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">jar zipkin</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">server</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>2.12</span><span class="token number" style=color:#36acaa>.9</span><span class="token operator" style=color:#393A34>-</span><span class="token keyword" style=color:#00009f>exec</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Zipkin页面访问地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9411</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=elasticsearch存储日志>Elasticsearch存储日志<a href=#elasticsearch存储日志 class=hash-link aria-label=Elasticsearch存储日志的直接链接 title=Elasticsearch存储日志的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- zipkin-server启动命令</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># STORAGE_TYPE存储类型 ES_HOSTS访问地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">java </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">jar zipkin</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">server</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>2.12</span><span class="token number" style=color:#36acaa>.9</span><span class="token operator" style=color:#393A34>-</span><span class="token keyword" style=color:#00009f>exec</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar </span><span class="token comment" style=color:#999988;font-style:italic>--STORAGE_TYPE=elasticsearch --ES_HOSTS=localhost:9200 </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-consul>cloud-consul<a href=#cloud-consul class=hash-link aria-label=cloud-consul的直接链接 title=cloud-consul的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Consul 具有特性：</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持服务治理：Consul作为注册中心</span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持客户端负责均衡：包括Ribbon和Spring Cloud LoadBalancer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持Zuul：当Zuul作为网关时，可以从Consul中注册和发现应用；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持分布式配置管理：Consul作为配置中心</span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持控制总线：可以在整个微服务系统中通过Control Bus分发事件消息</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">动态刷新配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 下载地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">https:</span><span class="token comment" style=color:#999988;font-style:italic>//www.consul.io/downloads.html</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 查看版本号</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">consul </span><span class="token comment" style=color:#999988;font-style:italic>--version</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 使用开发模式启动</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">consul agent </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">dev </span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 访问</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:8500</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=注册中心>注册中心<a href=#注册中心 class=hash-link aria-label=注册中心的直接链接 title=注册中心的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=客户端负载>客户端负载<a href=#客户端负载 class=hash-link aria-label=客户端负载的直接链接 title=客户端负载的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-consul-discovery</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>&lt;!--负载--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-netflix-ribbon</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8308</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> consul</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">ribbon</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>consul</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>host</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8500</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>service-name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>consul-user-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//consul</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=配置中心>配置中心<a href=#配置中心 class=hash-link aria-label=配置中心的直接链接 title=配置中心的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-consul-config</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-consul-discovery</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># application.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>profiles</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>active</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># bootstrap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9101</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> consul</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>consul</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>host</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8500</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>serviceName</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> consul</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#是否启用配置中心功能</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>format</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> yaml </span><span class="token comment" style=color:#999988;font-style:italic>#设置配置值的格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>prefix</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> config </span><span class="token comment" style=color:#999988;font-style:italic>#设置配置所在目录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>profile-separator</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>':'</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#设置配置的分隔符</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>data-key</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> data </span><span class="token comment" style=color:#999988;font-style:italic>#配置key的名字，由于Consul是K/V存储，配置存储在对应K的V中</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- consul添加配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- key</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">config</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">consul</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">config</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">client:dev</span><span class="token operator" style=color:#393A34>/</span><span class="token keyword" style=color:#00009f>data</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- value</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">config:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  info: </span><span class="token string" style=color:#e3116c>"config info for dev"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-gateway>cloud-gateway<a href=#cloud-gateway class=hash-link aria-label=cloud-gateway的直接链接 title=cloud-gateway的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Spring Cloud Gateway 特性</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">基于Spring Framework </span><span class="token number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> Project Reactor 和 Spring Boot </span><span class="token number" style=color:#36acaa>2.0</span><span class="token plain"> 进行构建；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">动态路由：能够匹配任何请求属性；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">可以对路由指定 Predicate（断言）和 Filter（过滤器）；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">集成Hystrix的断路器功能；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">集成 Spring Cloud 服务发现功能；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">易于编写的 Predicate（断言）和 Filter（过滤器）；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">请求限流功能；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">支持路径重写</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Route（路由）：路由是构建网关的基本模块，它由ID，目标URI，一系列的断言和过滤器组成，如果断言为</span><span class="token boolean" style=color:#36acaa>true</span><span class="token plain">则匹配该路由；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Predicate（断言）：指的是Java </span><span class="token number" style=color:#36acaa>8</span><span class="token plain"> 的 </span><span class="token keyword" style=color:#00009f>Function</span><span class="token plain"> Predicate。 输入类型是Spring框架中的ServerWebExchange。 这使开发人员可以匹配HTTP请求中的所有内容，例如请求头或请求参数。如果请求与断言相匹配，则进行路由；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Filter（过滤器）：指的是Spring框架中GatewayFilter的实例，使用过滤器，可以在请求被路由前后对请求进行修改</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-gateway</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># yaml配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9201</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>service-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>user-service</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8201</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>gateway</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>routes</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>id</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> path_route </span><span class="token comment" style=color:#999988;font-style:italic>#路由的ID</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">service</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">url.user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain">/user/</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#匹配后路由地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token key atrule" style=color:#00a4db>predicates</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 断言，路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> Path=/user/</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">id</span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Java Bean 配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class GatewayConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return builder.routes()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .route("path_route2", r -> r.path("/user/getByUsername")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        .uri("http://localhost:8201/user/getByUsername"))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .build();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=过滤器-1>过滤器<a href=#过滤器-1 class=hash-link aria-label=过滤器的直接链接 title=过滤器的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 在一个高的角度来看，Global filters会被应用到所有的路由上，而Gateway filter将应用到单个路由上或者一个分组的路由上</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 当请求进入（并与路由匹配）时，筛选Web Handler会将GlobalFilter的所有实例和所有的GatewayFilter路由特定实例添加到 filter chain。filter组合的排序由org.springframework.core.Ordered接口决定，可以通过实现getOrde()方法或使用@Order注释来设置</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Order(-1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public GlobalFilter a() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return (exchange, chain) -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        log.info("first pre filter");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return chain.filter(exchange).then(Mono.fromRunnable(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            log.info("third post filter");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    };</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Component</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class MyGlobalFilter implements GlobalFilter, Ordered {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Mono&lt;Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return chain.filter(exchange).then(Mono.fromRunnable(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            log.info("third post filter");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public int getOrder() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=监控请求>监控请求<a href=#监控请求 class=hash-link aria-label=监控请求的直接链接 title=监控请求的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>endpoint</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>gateway</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> gateway</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># /actuator/gateway/globalfilters 检索所有global filter</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /actuator/gateway/routefilters 检索所有GatewayFilter factories</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /actuator/gateway/refresh 清理路由缓存</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /actuator/gateway/routes 检索网关中定义的路由</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /actuator/gateway/routes/{id} 获取单个路由的信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /gateway/routes/{id_route_to_create} 创建一个路由</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic># /gateway/routes/{id_route_to_delete} 删除一个路由</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-gateway监控请求-51ae483555fef3070a4c0723398b6f08.png alt=SpringCloud-gateway监控请��求 width=50%>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=工作原理>工作原理<a href=#工作原理 class=hash-link aria-label=工作原理的直接链接 title=工作原理的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">客户端向Spring Cloud Gateway发出请求。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">如果Gateway </span><span class="token keyword" style=color:#00009f>Handler</span><span class="token plain"> Mapping确定请求与路由匹配，则将其发送到Gateway Web </span><span class="token keyword" style=color:#00009f>Handler</span><span class="token plain">。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">此</span><span class="token keyword" style=color:#00009f>handler</span><span class="token plain">通过特定于该请求的过滤器链处理请求。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">图中filters被虚线划分的原因是filters可以在发送代理请求之前或之后执行逻辑。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">先执行所有“pre filter”逻辑，然后进行请求代理。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">在请求代理执行完后，执行“post filter”逻辑</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-gateway工作原理-f320f1f4ef1d119744852a8125afb8c7.png alt=SpringCloud-gateway工作原理 width=50%>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-nacos>cloud-nacos<a href=#cloud-nacos class=hash-link aria-label=cloud-nacos的直接链接 title=cloud-nacos的直接链接>​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=注册中心-1>注册中心<a href=#注册中心-1 class=hash-link aria-label=注册中心的直接链接 title=注册中心的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>&lt;!-- </span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>	如果要使用Spring Cloud Alibaba 的组件都需要在pom.xml中添加如下的配置 </span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>	nacos需要web依赖</span><br></span><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependencyManagement</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-alibaba-dependencies</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.1.0.RELEASE</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">pom</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">import</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependencyManagement</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.1.7.RELEASE</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8206</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> nacos</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">user</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8848</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置Nacos地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'*'</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=配置中心-1>配置中心<a href=#配置中心-1 class=hash-link aria-label=配置中心的直接链接 title=配置中心的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-nacos-config</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># application.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>profiles</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>active</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> dev</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic># bootstrap.yaml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9101</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> nacos</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8848</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#Nacos地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>config</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8848</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#Nacos地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>file-extension</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> yaml </span><span class="token comment" style=color:#999988;font-style:italic>#这里我们获取的yaml格式的配置</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=配置文件加载顺序>配置文件加载顺序<a href=#配置文件加载顺序 class=hash-link aria-label=配置文件加载顺序的直接链接 title=配置文件加载顺序的直接链接>​</a></h6>
<p>优先级</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">a </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> b1 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> b2 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> c1 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> c2 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> d1 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> d2 </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> e </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> f</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 各级别描述</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">a：application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">properties</span><br></span><span class=token-line style=color:#393A34><span class="token plain">b1：bootstrap</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">properties</span><br></span><span class=token-line style=color:#393A34><span class="token plain">b2：bootstrap</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">{profile}</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">properties </span><br></span><span class=token-line style=color:#393A34><span class="token plain">c1：通过 spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">nacos</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">shared</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token keyword" style=color:#00009f>data</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">id 支持多个共享 </span><span class="token keyword" style=color:#00009f>Data</span><span class="token plain"> Id 的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">c2：通过 spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">nacos</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">shared</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">n</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token keyword" style=color:#00009f>data</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">id 支持多个共享 </span><span class="token keyword" style=color:#00009f>Data</span><span class="token plain"> Id 的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">d1：通过 spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">nacos</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">extension</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token keyword" style=color:#00009f>data</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">id 支持多个扩展 </span><span class="token keyword" style=color:#00009f>Data</span><span class="token plain"> Id 的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">d2：通过 spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">cloud</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">nacos</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">config</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">extension</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">n</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token keyword" style=color:#00009f>data</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">id 支持多个扩展 </span><span class="token keyword" style=color:#00009f>Data</span><span class="token plain"> Id 的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">e：通过内部相关规则</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">应用名、应用名</span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> Profile </span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">自动生成相关的 </span><span class="token keyword" style=color:#00009f>Data</span><span class="token plain"> Id 配置 </span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">如 scrm</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">base</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">service</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">properties</span><br></span><span class=token-line style=color:#393A34><span class="token plain">f：VM </span><span class="token keyword" style=color:#00009f>option</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>nacos三级配置优先级</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- nacos三级配置优先级</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">三级配置的优先级如下：主配置 </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> 扩展配置 </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> 共享配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 三级配置描述</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 主配置（默认${spring.application.name}.properties）（不会被同名属性覆盖）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">${prefix}</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">${spring</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">profiles</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">active}</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">${</span><span class="token keyword" style=color:#00009f>file</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">extension}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">首先会去指定namespace和</span><span class="token keyword" style=color:#00009f>group</span><span class="token plain">下加载指定dataId</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">带后缀</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">，如果加载不到，会继续加载dataId</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">不带后缀</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 共享配置和扩展配置区别</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">nacos对配置的默认理念</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">namespace区分环境，</span><span class="token keyword" style=color:#00009f>group</span><span class="token plain">区分不同应用</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>1.</span><span class="token plain">主配置是应用专有的配置</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">因此，主配置应当在dataId上要区分，同时最好还要有 </span><span class="token keyword" style=color:#00009f>group</span><span class="token plain"> 的区分</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2.</span><span class="token plain">要在各应用之间共享一个配置，请使用上面的 shared</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3.</span><span class="token plain">如果要在特定范围内（比如某个应用上）覆盖某个共享dataId上的特定属性，请使用 extension</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">configs</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>bootstrap和application</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 详细描述(bootstrap和application)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">bootstrap</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml用于ApplicationContext引导阶段。由父Spring ApplicationContext加载。定义系统级别的参数配置，这些参数一般不会变动。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml 用来定义应用级别的参数配置。搭配 spring</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">cloud</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">config 使用时application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml定义的参数可以实现动态替换。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml 会覆盖 bootstrap</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml 的参数配置。</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- applicaiton加载（默认会从4个路径去找application配置）</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">假设当前运行目录为</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">： </span><span class="token operator" style=color:#393A34>/</span><span class="token plain">config </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> classpath:</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">config </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> classpath:</span><span class="token operator" style=color:#393A34>/</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>自己测试优先级</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token number" style=color:#36acaa>1.</span><span class="token plain"> nacos配置中心主配置 覆盖 springboot加载的application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yaml</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2.</span><span class="token plain"> application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml 覆盖 bootstrap</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml 的参数配置。</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-sentinel>cloud-sentinel<a href=#cloud-sentinel class=hash-link aria-label=cloud-sentinel的直接链接 title=cloud-sentinel的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Sentinel特性</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">熔断降级</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 下载地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">https:</span><span class="token comment" style=color:#999988;font-style:italic>//github.com/alibaba/Sentinel/releases</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 启动jar，默认8080</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">java </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">jar sentinel</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">dashboard</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1.6</span><span class="token number" style=color:#36acaa>.3</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar</span><br></span><span class=token-line style=color:#393A34><span class="token plain">java </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Dserver</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">port</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>9999</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Dcsp</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">sentinel</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">dashboard</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">server</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">localhost:</span><span class="token number" style=color:#36acaa>8080</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Dproject</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">name</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">sentinel</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">dashboard </span><span class="token operator" style=color:#393A34>-</span><span class="token plain">jar sentinel</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">dashboard</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>1.8</span><span class="token number" style=color:#36acaa>.6</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 访问，账号密码sentinel</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9000</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Sentinel采用的懒加载规则，需要我们先访问下接口，Sentinel控制台中才会有对应服务信息</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">取消懒加载 ：sentinel</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">eager: </span><span class="token boolean" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- nacos存储参数解释</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">resource：资源名称；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">limitApp：来源应用；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">grade：阈值类型，</span><span class="token number" style=color:#36acaa>0</span><span class="token plain">表示线程数，</span><span class="token number" style=color:#36acaa>1</span><span class="token plain">表示QPS；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">count：单机阈值；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">strategy：流控模式，</span><span class="token number" style=color:#36acaa>0</span><span class="token plain">表示直接，</span><span class="token number" style=color:#36acaa>1</span><span class="token plain">表示关联，</span><span class="token number" style=color:#36acaa>2</span><span class="token plain">表示链路；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">controlBehavior：流控效果，</span><span class="token number" style=color:#36acaa>0</span><span class="token plain">表示快速失败，</span><span class="token number" style=color:#36acaa>1</span><span class="token plain">表示Warm Up，</span><span class="token number" style=color:#36acaa>2</span><span class="token plain">表示排队等待；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">clusterMode：是否集群</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>&lt;!--sentinel 限流熔点降级--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-alibaba-sentinel-gateway</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-sentinel</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>&lt;!-- sentinel集成nacos作为数据源 --></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.csp</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">sentinel-datasource-nacos</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#Sentinel配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>sentinel</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>transport</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>dashboard</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>9000</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic># 支持链路限流</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>web-context-unify</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic># Sentinel 网关流控默认的粒度是 route 维度以及自定义 API 分组维度，默认不支持 URL 粒度</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>filter</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token comment" style=color:#999988;font-style:italic># Sentinel控制台懒加载-开启饥饿</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>eager</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>datasource</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#流控规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>flow</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic># 指定数据源名称</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token comment" style=color:#999988;font-style:italic># 指定nacos数据源</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic># 指定配置文件</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">flow</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic># 指定分组</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic># 指定配置文件规则类型</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> flow</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic># 指定配置文件数据格式</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#降级规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>degrade</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">degrade</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> degrade</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#系统规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>system</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">system</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> system</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#授权规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>authority</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">authority</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> authority</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#热点参数</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>param-flow</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">param</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">flow</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> param</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">flow</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#网关流控规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>gw-flow</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">flow</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> gw</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">flow</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>#API流控规则</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>gw-api-group</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">hmh.nacos.server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">addr</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dataId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">spring.application.name</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">api</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">rules</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>groupId</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> SENTINEL_GROUP</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>rule-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> gw</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">api</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">group</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>data-type</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> json</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=限流>限流<a href=#限流 class=hash-link aria-label=限流的直接链接 title=限流的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- Sentinel Starter 默认为所有的 HTTP 服务提供了限流埋点，我们也可以通过使用@SentinelResource来自定义一些限流行为</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 限流功能</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 用于测试熔断和限流功能.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/rateLimit")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class RateLimitController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 按资源名称限流，需要指定限流处理逻辑</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/byResource")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @SentinelResource(value = "byResource",blockHandler = "handleException")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult byResource() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult("按资源名称限流", 200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 按URL限流，有默认的限流处理逻辑</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/byUrl")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @SentinelResource(value = "byUrl",blockHandler = "handleException")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult byUrl() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult("按url限流", 200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult handleException(BlockException exception){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult(exception.getClass().getCanonicalName(),200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=根据资源名称限流>根据资源名称限流<a href=#根据资源名称限流 class=hash-link aria-label=根据资源名称限流的直接链接 title=根据资源名称限流的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 在Sentinel控制台配置流控规则，根据@SentinelResource注解的value值，如：</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"resource"</span><span class="token plain">: </span><span class="token string" style=color:#e3116c>"byResource"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"limitApp"</span><span class="token plain">: </span><span class="token string" style=color:#e3116c>"default"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"grade"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"count"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"strategy"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"controlBehavior"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"clusterMode"</span><span class="token plain">: </span><span class="token boolean" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=根据url限流>根据URL限流<a href=#根据url限流 class=hash-link aria-label=根据URL限流的直接链接 title=根据URL限流的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 在Sentinel控制台配置流控规则，使用访问的URL，如：</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"resource"</span><span class="token plain">: </span><span class="token string" style=color:#e3116c>"/rateLimit/byUrl"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"limitApp"</span><span class="token plain">: </span><span class="token string" style=color:#e3116c>"default"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"grade"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"count"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"strategy"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"controlBehavior"</span><span class="token plain">: </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token string" style=color:#e3116c>"clusterMode"</span><span class="token plain">: </span><span class="token boolean" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=熔断功能>熔断功能<a href=#熔断功能 class=hash-link aria-label=熔断功能的直接链接 title=熔断功能的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=resttemplate调用方式>RestTemplate调用方式<a href=#resttemplate调用方式 class=hash-link aria-label=RestTemplate调用方式的直接链接 title=RestTemplate调用方式的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/8/29.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class RibbonConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @SentinelRestTemplate</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public RestTemplate restTemplate(){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new RestTemplate();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 熔断功能</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/11/7.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/breaker")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class CircleBreakerController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private Logger LOGGER = LoggerFactory.getLogger(CircleBreakerController.class);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Value("${service-url.user-service}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private String userServiceUrl;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @RequestMapping("/fallback/{id}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @SentinelResource(value = "fallback",fallback = "handleFallback")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult fallback(@PathVariable Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    //忽略空指针异常</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @RequestMapping("/fallbackException/{id}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @SentinelResource(value = "fallbackException",fallback = "handleFallback2", exceptionsToIgnore = {NullPointerException.class})</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult fallbackException(@PathVariable Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        if (id == 1) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            throw new IndexOutOfBoundsException();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } else if (id == 2) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            throw new NullPointerException();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult handleFallback(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User defaultUser = new User(-1L, "defaultUser", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult&lt;>(defaultUser,"服务降级返回",200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult handleFallback2(@PathVariable Long id, Throwable e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        LOGGER.error("handleFallback2 id:{},throwable class:{}", id, e.getClass());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User defaultUser = new User(-2L, "defaultUser2", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult&lt;>(defaultUser,"服务降级返回",200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=feign调用方式>feign调用方式<a href=#feign调用方式 class=hash-link aria-label=feign调用方式的直接链接 title=feign调用方式的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>&lt;!-- 在启动类加Enable注解--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>feign</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>sentinel</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>enabled</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>true</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#打开sentinel对feign的支持</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * feign接口</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@FeignClient(value = "nacos-user-service",fallback = UserFallbackService.class)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public interface UserService {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @PostMapping("/user/create")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult create(@RequestBody User user);</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/user/{id}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult&lt;User> getUser(@PathVariable Long id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/user/getByUsername")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult&lt;User> getByUsername(@RequestParam String username);</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @PostMapping("/user/update")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult update(@RequestBody User user);</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @PostMapping("/user/delete/{id}")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    CommonResult delete(@PathVariable Long id);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 降级操作</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Component</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserFallbackService implements UserService {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult create(User user) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User defaultUser = new User(-1L, "defaultUser", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult&lt;>(defaultUser,"服务降级返回",200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult&lt;User> getUser(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User defaultUser = new User(-1L, "defaultUser", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult&lt;>(defaultUser,"服务降级返回",200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult&lt;User> getByUsername(String username) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        User defaultUser = new User(-1L, "defaultUser", "123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult&lt;>(defaultUser,"服务降级返回",200);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult update(User user) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult("调用失败，服务被降级",500);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public CommonResult delete(Long id) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new CommonResult("调用失败，服务被降级",500);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-seata>cloud-seata<a href=#cloud-seata class=hash-link aria-label=cloud-seata的直接链接 title=cloud-seata的直接链接>​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 在微服务架构中由于全局数据一致性没法保证产生的问题就是分布式事务问题。简单来说，一次业务操作需要操作多个数据源或需要进行远程调用，就会产生分布式事务问题</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。Seata 将为用户提供了 AT、TCC、SAGA 和 XA 事务模式，为用户打造一站式的分布式解决方案</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 三个组件</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Transaction</span><span class="token plain"> Coordinator </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">TC</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">： 事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Transaction</span><span class="token plain"> Manager </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">TM</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">： 控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Resource Manager </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">RM</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">： 控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 简单过程</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>1</span><span class="token plain">、TM 向 TC 申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2</span><span class="token plain">、XID 在微服务调用链路的上下文中传播；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3</span><span class="token plain">、RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>4</span><span class="token plain">、TM 向 TC 发起针对 XID 的全局提交或回滚决议；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>5</span><span class="token plain">、TC 调度 XID 下管辖的全部分支事务完成提交或回滚请求。</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=搭建seata服务端>搭建seata服务端<a href=#搭建seata服务端 class=hash-link aria-label=搭建seata服务端的直接链接 title=搭建seata服务端的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 下载地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">https:</span><span class="token comment" style=color:#999988;font-style:italic>//github.com/seata/seata/releases</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 使用nacos作为注册中心</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">## file.config</span><br></span><span class=token-line style=color:#393A34><span class="token plain">## transaction log store</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> only used in seata-server</span><br></span><span class=token-line style=color:#393A34><span class="token plain">store </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ## store mode</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> file、db、redis</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  mode = </span><span class="token string" style=color:#e3116c>"db"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ## rsa decryption public key</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  publicKey = </span><span class="token string" style=color:#e3116c>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ## database store property</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  db </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ## the implement of javax.sql.DataSource</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    datasource = </span><span class="token string" style=color:#e3116c>"dbcp"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ## mysql/oracle/postgresql/h2/oceanbase etc.</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    dbType = </span><span class="token string" style=color:#e3116c>"mysql"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    driverClassName = </span><span class="token string" style=color:#e3116c>"com.mysql.jdbc.Driver"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ## if using mysql to store the data</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> recommend add rewriteBatchedStatements=</span><span class="token boolean" style=color:#36acaa>true</span><span class="token plain"> in jdbc connection param</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    url = </span><span class="token string" style=color:#e3116c>"jdbc:mysql://127.0.0.1:3306/seata-server?rewriteBatchedStatements=true"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    user = </span><span class="token string" style=color:#e3116c>"root"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    password = </span><span class="token string" style=color:#e3116c>"root"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    minConn = </span><span class="token number" style=color:#36acaa>5</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    maxConn = </span><span class="token number" style=color:#36acaa>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    globalTable = </span><span class="token string" style=color:#e3116c>"global_table"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    branchTable = </span><span class="token string" style=color:#e3116c>"branch_table"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    lockTable = </span><span class="token string" style=color:#e3116c>"lock_table"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    queryLimit = </span><span class="token number" style=color:#36acaa>100</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    maxWait = </span><span class="token number" style=color:#36acaa>5000</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># registry.conf</span><br></span><span class=token-line style=color:#393A34><span class="token plain">registry </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  type = </span><span class="token string" style=color:#e3116c>"nacos"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  nacos </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    application = </span><span class="token string" style=color:#e3116c>"seata-server"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    serverAddr = </span><span class="token string" style=color:#e3116c>"127.0.0.1:8848"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    group = </span><span class="token string" style=color:#e3116c>"DEFAULT_GROUP"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    namespace = </span><span class="token string" style=color:#e3116c>""</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    cluster = </span><span class="token string" style=color:#e3116c>"default"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    username = </span><span class="token string" style=color:#e3116c>"nacos"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    password = </span><span class="token string" style=color:#e3116c>"nacos"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">config </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  # file、nacos 、apollo、zk、consul、etcd3</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  type = </span><span class="token string" style=color:#e3116c>"file"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  file </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    name = </span><span class="token string" style=color:#e3116c>"file.conf"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=客户端-3>客户端<a href=#客户端-3 class=hash-link aria-label=客户端的直接链接 title=客户端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>properties</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>java.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">1.8</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>java.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>spring-cloud-alibaba.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.2.7.RELEASE</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>spring-cloud-alibaba.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>springboot.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.2.12.RELEASE</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>springboot.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>lombok.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">1.18.8</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>lombok.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>project.build.sourceEncoding</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">UTF-8</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>project.build.sourceEncoding</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>sikpTests</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">true</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>sikpTests</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>maven-source-plugin.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">3.0.1</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>maven-source-plugin.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>maven-surefire-plugin.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.22.1</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>maven-surefire-plugin.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>seata.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">1.4.2</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>seata.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>mybatis-plus-boot-starter.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">3.3.0</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>mybatis-plus-boot-starter.version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>properties</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>&lt;!--nacos--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>&lt;!--seata--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-alibaba-seata</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">${spring-cloud-alibaba.version}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">io.seata</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">seata-spring-boot-starter</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">1.4.2</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>&lt;!-- mybatis --></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.baomidou</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">mybatis-plus-boot-starter</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">${mybatis-plus-boot-starter.version}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">mysql</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>&lt;!--feign--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">2.2.6.RELEASE</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependencyManagement</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-dependencies</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">${springboot.version}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">pom</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">import</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>&lt;!--Spring Cloud Alibaba--></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-alibaba-dependencies</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">${spring-cloud-alibaba.version}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">pom</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>type</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">import</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>scope</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">lombok</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">${lombok.version}</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">mysql</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">8.0.28</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">com.alibaba.spring</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-context-support</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">1.0.11</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependencies</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependencyManagement</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>8182</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> seata</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">account</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">service</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>cloud</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>nacos</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>discovery</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>server-addr</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>8848</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>datasource</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>driverClassName</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>password</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> root</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> jdbc</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">mysql</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">3306/seat</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">account</span><span class="token punctuation" style=color:#393A34>?</span><span class="token plain">allowMultiQueries=true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>username</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> root</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>logging</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>level</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>io</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">   </span><span class="token key atrule" style=color:#00a4db>seata</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> info</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>mybatis</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>mapperLocations</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> classpath</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>seata</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>tx-service-group</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> my_test_tx_group</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 注解使用</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token variable" style=color:#36acaa>@GlobalTransactional</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">name </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"fsp-create-order"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">rollbackFor </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> Exception</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">class</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-oauth2>cloud-oauth2<a href=#cloud-oauth2 class=hash-link aria-label=cloud-oauth2的直接链接 title=cloud-oauth2的直接链接>​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=oauth2相关名词>OAuth2相关名词<a href=#oauth2相关名词 class=hash-link aria-label=OAuth2相关名词的直接链接 title=OAuth2相关名词的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- OAuth2相关名词解释</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Resource owner（资源拥有者）：拥有该资源的最终用户，他有访问资源的账号密码；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Resource server（资源服务器）：服务提供商存放用户生成的资源的服务器。与认证服务器是不同的逻辑节点，但是在物理上，双方是可以在一起的。拥有受保护资源的服务器，如果请求包含正确的访问令牌，可以访问资源；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Client（客户端）：访问资源的客户端，会使用访问令牌去获取资源服务器的资源，可以是浏览器、移动设备或者服务器；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain"> server（认证服务器）：服务提供商专门用来处理认证的服务器。用于认证用户的服务器，如果客户端认证通过，发放访问资源服务器的令牌。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Http Service：服务提供商，也就是持有Resource Server的存在方。可以理解为类似微信，钉钉这样具备用户信息的服务者。</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>User</span><span class="token plain"> Agent：用户代理，一般就是指的浏览器。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">客户端凭证：Client Id和密码用于认证用户。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">访问令牌：授权服务提供者在接收到用户请求后</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">颁发的访问令牌。</span><br></span><span class=token-line style=color:#393A34><span class="token plain">刷新令牌（Refresh Token）：用于获取一个新的令牌。由于令牌的有效期比较短，一旦失效，用户需要再获取令牌的流程是比较繁琐的。为了提升用户体验，可以使用reflesh_token来获取新的令牌。</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Client Credentials（客户端模式）：客户端直接通过客户端认证（比如client_id和client_secret）从认证服务器获取访问令牌。</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=四种授权模式>四种授权模式<a href=#四种授权模式 class=hash-link aria-label=四种授权模式的直接链接 title=四种授权模式的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=authorization-code授权码模式>Authorization Code（授权码模式）<a href=#authorization-code授权码模式 class=hash-link aria-label="Authorization Code（授权码模式）的直接链接" title="Authorization Code（授权码模式）的直接链接">​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token number" style=color:#36acaa>1</span><span class="token plain">、用户登录应用系统，请求跳转到认证服务器，并</span><span class="token number" style=color:#36acaa>302</span><span class="token plain">返回登录认证页面；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2</span><span class="token plain">、用户输入账户</span><span class="token operator" style=color:#393A34>+</span><span class="token plain">密码进行认证，认证服务器认证通过返回code给应用系统；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3</span><span class="token plain">、应用系统携带code向认证服务器换取访问令牌，认证服务器验证Client ID，code等信息，给应用系统发送访问令牌；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>4</span><span class="token plain">、应用系统携带访问令牌查询用户登录信息，认证服务器返回用户信息，如用户名；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>5</span><span class="token plain">、应用系统验证用户名正确，创建会话，并跳转到redirect url</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-授权码模式-4f4f7cb41a956dfaf4a1f091acd1a51a.png alt=SpringCloud-授权码模式 width=50%>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=implicit简化模式>Implicit（简化模式）<a href=#implicit简化模式 class=hash-link aria-label=Implicit（简化模式）的直接链接 title=Implicit（简化模式）的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">省略掉了颁发授权码（</span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain"> Code）给客户端的过程，直接返回访问令牌和可选的刷新令牌。其适用于没有Server服务器来接受处理</span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain"> Code的第三方应用。适用于公开的浏览器单页应用</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-简化模式-fbcda78ec5d7a3388c3ffa5c59f52543.png alt=SpringCloud-简化模式 width=50%>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=密码模式>密码模式<a href=#密码模式 class=hash-link aria-label=密码模式的直接链接 title=密码模式的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">这种模式再一步简化，和Authorzation Code类型下重要的区分就是省略了</span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain"> Request和</span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain"> Response。而是Client直接使用Resource owner提供的username和password来直接请求access_token（直接发起Access Token Request然后返回Access Token Response信息）。这种模式一般适用于Resource server高度信任第三方Client的情况下 </span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-密码模式-7ac61ca9add35c3d4d9571656b4c339e.png alt=SpringCloud-密码模式 width=50%>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=client-credentials客户端模式>Client Credentials（客户端模式）<a href=#client-credentials客户端模式 class=hash-link aria-label="Client Credentials（客户端模式）的直接链接" title="Client Credentials（客户端模式）的直接链接">​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Client直接以自己的名义而不是Resource owner的名义去要求访问Resource server的一些受保护资源 </span><br></span><span class=token-line style=color:#393A34><span class="token plain">适用于服务器间通信场景，直接根据client的ID和密钥即可获取token，无需用户参与</span><br></span><span class=token-line style=color:#393A34><span class="token plain">这种模式比较合适消费api的后端服务，比如拉取一组用户信息等</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-客户端模式-c0022086b2acd6291120177d2ade568d.png alt=SpringCloud-客户端模式 width=50%>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=刷新令牌>刷新令牌<a href=#刷新令牌 class=hash-link aria-label=刷新令牌的直接链接 title=刷新令牌的直接链接>​</a></h6>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">以便在访问令牌过期失效的时候可以由客户端自动获取新的访问令牌，而不是让用户再次登录授权</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-刷新令牌-f09d9993bbd08eef329947f221dc4c6c.png alt=SpringCloud-刷新令牌 width=50%>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=入门使用>入门使用<a href=#入门使用 class=hash-link aria-label=入门使用的直接链接 title=入门使用的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-oauth2</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-security</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//加载用户信息</span><br></span><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Service</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserService implements UserDetailsService {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private List&lt;User> userList;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private PasswordEncoder passwordEncoder;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @PostConstruct</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void initData() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String password = passwordEncoder.encode("123456");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        userList = new ArrayList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        userList.add(new User("macro", password, AuthorityUtils.commaSeparatedStringToAuthorityList("admin")));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        userList.add(new User("andy", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        userList.add(new User("mark", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        List&lt;User> findUserList = userList.stream().filter(user -> user.getUsername().equals(username)).collect(Collectors.toList());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        if (!CollectionUtils.isEmpty(findUserList)) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            return findUserList.get(0);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } else {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            throw new UsernameNotFoundException("用户名或密码错误");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//认证服务器配置，并开启认证</span><br></span><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 认证服务器配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private PasswordEncoder passwordEncoder;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private AuthenticationManager authenticationManager;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private UserService userService;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 使用密码模式需要配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        endpoints.authenticationManager(authenticationManager)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .userDetailsService(userService);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        clients.inMemory()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置client_id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .withClient("admin")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置client_secret</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .secret(passwordEncoder.encode("admin123456"))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置访问token的有效期</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .accessTokenValiditySeconds(3600)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置刷新token的有效期</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .refreshTokenValiditySeconds(864000)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置redirect_uri，用于授权成功后跳转</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .redirectUris("http://www.baidu.com")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置申请的权限范围</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .scopes("all")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                //配置grant_type，表示授权类型</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authorizedGrantTypes("authorization_code","password");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//资源服务器配置，并开启</span><br></span><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 资源服务器配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableResourceServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class ResourceServerConfig extends ResourceServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(HttpSecurity http) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        http.authorizeRequests()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .anyRequest()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authenticated()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .and()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .requestMatchers()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            	//配置需要保护的资源路径</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .antMatchers("/user/**");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//security配置，允许认证相关路径的访问及表单登录，并开启</span><br></span><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * SpringSecurity配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/10/8.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableWebSecurity</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class SecurityConfig extends WebSecurityConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public PasswordEncoder passwordEncoder() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new BCryptPasswordEncoder();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public AuthenticationManager authenticationManagerBean() throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return super.authenticationManagerBean();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(HttpSecurity http) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        http.csrf()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .disable()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authorizeRequests()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .antMatchers("/oauth/**", "/login/**", "/logout/**")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .permitAll()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .anyRequest()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authenticated()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .and()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .formLogin()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .permitAll();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//测试接口</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/user")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/getCurrentUser")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Object getCurrentUser(Authentication authentication) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return authentication.getPrincipal();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 授权码登录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>1</span><span class="token plain">、进行登录授权</span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9401/oauth/authorize?response_type=code&client_id=admin&redirect_uri=http://www.baidu.com&scope=all&state=normal</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>2</span><span class="token plain">、进行授权操作</span><br></span><span class=token-line style=color:#393A34><span class="token plain">选择Approve，会得到一个授权码code</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>3</span><span class="token plain">、获取访问令牌</span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9401/oauth/token</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain">：Basic Auth  input username </span><span class="token operator" style=color:#393A34>and</span><span class="token plain"> password</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Formdata: </span><br></span><span class=token-line style=color:#393A34><span class="token plain">code:授权码</span><br></span><span class=token-line style=color:#393A34><span class="token plain">grant_type:authorization_code</span><br></span><span class=token-line style=color:#393A34><span class="token plain">client_id:admin</span><br></span><span class=token-line style=color:#393A34><span class="token plain">redirect_uri:http:</span><span class="token comment" style=color:#999988;font-style:italic>//www.baidu.com</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">scope:</span><span class="token keyword" style=color:#00009f>all</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 密码模式登录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token number" style=color:#36acaa>1</span><span class="token plain">、使用密码请求该地址获取访问令牌</span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9401/oauth/token</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain">：Basic Auth  input username </span><span class="token operator" style=color:#393A34>and</span><span class="token plain"> password</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Formdata: </span><br></span><span class=token-line style=color:#393A34><span class="token plain">grant_type:password</span><br></span><span class=token-line style=color:#393A34><span class="token plain">scope:</span><span class="token keyword" style=color:#00009f>all</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">username:macro</span><br></span><span class=token-line style=color:#393A34><span class="token plain">password:</span><span class="token number" style=color:#36acaa>123456</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 测试接口</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9401/user/getCurrentUser</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>Authorization</span><span class="token plain">：bearer 访问令牌</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=存储令牌>存储令牌<a href=#存储令牌 class=hash-link aria-label=存储令牌的直接链接 title=存储令牌的直接链接>​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=使用redis存储令牌>使用Redis存储令牌<a href=#使�用redis存储令牌 class=hash-link aria-label=使用Redis存储令牌的直接链接 title=使用Redis存储令牌的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-data-redis</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 使用redis存储token的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/10/8.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class RedisTokenStoreConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private RedisConnectionFactory redisConnectionFactory;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public TokenStore redisTokenStore (){</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new RedisTokenStore(redisConnectionFactory);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//认证配置指定存储策略为redis</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private PasswordEncoder passwordEncoder;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private AuthenticationManager authenticationManager;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private UserService userService;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Qualifier("redisTokenStore")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private TokenStore tokenStore;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 使用密码模式需要配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        endpoints.authenticationManager(authenticationManager)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .userDetailsService(userService)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .tokenStore(tokenStore);//配置令牌存储策略</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 测试</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">使用password方式获取令牌，访问http:</span><span class="token comment" style=color:#999988;font-style:italic>//localhost:9401/oauth/token</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=使用jwt存储令牌>使用jwt存储令牌<a href=#使用jwt存储令牌 class=hash-link aria-label=使用jwt存储令牌的直接链接 title=使用jwt存储令牌的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 使用Jwt存储token的配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/10/8.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class JwtTokenStoreConfig {</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public TokenStore jwtTokenStore() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new JwtTokenStore(jwtAccessTokenConverter());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public JwtAccessTokenConverter jwtAccessTokenConverter() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        JwtAccessTokenConverter accessTokenConverter = new JwtAccessTokenConverter();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        accessTokenConverter.setSigningKey("test_key");//配置JWT使用的秘钥</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return accessTokenConverter;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//认证配置指定存储策略为jwt</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private PasswordEncoder passwordEncoder;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private AuthenticationManager authenticationManager;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private UserService userService;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Qualifier("jwtTokenStore")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private TokenStore tokenStore;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private JwtAccessTokenConverter jwtAccessTokenConverter;</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 使用密码模式需要配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        endpoints.authenticationManager(authenticationManager)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .userDetailsService(userService)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .tokenStore(tokenStore)//配置令牌存储策略</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .accessTokenConverter(jwtAccessTokenConverter);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=扩展jwt存储内容>扩展jwt存储内容<a href=#扩展jwt存储内容 class=hash-link aria-label=扩展jwt存储内容的直接链接 title=扩展jwt存储内容的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Jwt内容增强器</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/10/8.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class JwtTokenEnhancer implements TokenEnhancer {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public OAuth2AccessToken enhance(OAuth2AccessToken accessToken, OAuth2Authentication authentication) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        //扩展存储的信息</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Map&lt;String, Object> info = new HashMap&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        info.put("enhance", "enhance info");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ((DefaultOAuth2AccessToken) accessToken).setAdditionalInformation(info);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return accessToken;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Bean</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public JwtTokenEnhancer jwtTokenEnhancer() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return new JwtTokenEnhancer();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 认证服务器配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Autowired</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private JwtTokenEnhancer jwtTokenEnhancer;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    /**</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     * 使用密码模式需要配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">     */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        TokenEnhancerChain enhancerChain = new TokenEnhancerChain();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        List&lt;TokenEnhancer> delegates = new ArrayList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        delegates.add(jwtTokenEnhancer); //配置JWT的内容增强器</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        delegates.add(jwtAccessTokenConverter);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        enhancerChain.setTokenEnhancers(delegates);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        endpoints.authenticationManager(authenticationManager)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .userDetailsService(userService)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .tokenStore(tokenStore) //配置令牌存储策略</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .accessTokenConverter(jwtAccessTokenConverter)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .tokenEnhancer(enhancerChain);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=解析jwt>解析jwt<a href=#解析jwt class=hash-link aria-label=解析jwt的直接链接 title=解析jwt的直接链接>​</a></h6>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">io.jsonwebtoken</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">jjwt</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">0.9.0</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/user")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/getCurrentUser")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Object getCurrentUser(Authentication authentication, HttpServletRequest request) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String header = request.getHeader("Authorization");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        String token = StrUtil.subAfter(header, "bearer ", false);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return Jwts.parser()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .setSigningKey("test_key".getBytes(StandardCharsets.UTF_8))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .parseClaimsJws(token)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .getBody();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=刷新令牌-1>刷新令牌<a href=#刷新令牌-1 class=hash-link aria-label=刷新令牌的直接链接 title=刷新令牌的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 认证服务器配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        clients.inMemory()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .withClient("admin")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .secret(passwordEncoder.encode("admin123456"))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .accessTokenValiditySeconds(3600)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .refreshTokenValiditySeconds(864000)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .redirectUris("http://www.baidu.com")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .autoApprove(true) //自动授权配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .scopes("all")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authorizedGrantTypes("authorization_code","password","refresh_token"); //添加授权模式</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 用刷新令牌模式来获取新的令牌</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">携带参数grant_type</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">refresh_token </span><span class="token operator" style=color:#393A34>&</span><span class="token plain"> refresh_token</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">{}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=单点登录>单点登录<a href=#单点登录 class=hash-link aria-label=单点登录的直接链接 title=单点登录的直接链接>​</a></h5>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 单点登录（Single Sign On）指的是当有多个系统需要登录时，用户只需登录一个系统，就可以访问其他需要登录的系统而无需登录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 当我们在oauth2-jwt-server服务上登录以后，就可以直接访问oauth2-client需要登录的接口</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-oauth2</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-cloud-starter-security</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">io.jsonwebtoken</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">jjwt</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">0.9.0</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>version</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9501</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>servlet</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>session</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>cookie</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> OAUTH2</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">CLIENT</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">SESSIONID </span><span class="token comment" style=color:#999988;font-style:italic>#防止Cookie冲突，冲突会导致登录验证不通过</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>oauth2-server-url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>9401</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> oauth2</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>security</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>oauth2</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#与oauth2-server对应的配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>client-id</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> admin</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>client-secret</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> admin123456</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>user-authorization-uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">oauth2</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain">/oauth/authorize</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>access-token-uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">oauth2</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain">/oauth/token</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>resource</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>jwt</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>key-uri</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> $</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">oauth2</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain">/oauth/token_key</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@EnableOAuth2Sso</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class Oauth2ClientApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(Oauth2ClientApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 认证服务器配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableAuthorizationServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        clients.inMemory()</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .withClient("admin")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .secret(passwordEncoder.encode("admin123456"))</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .accessTokenValiditySeconds(3600)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .refreshTokenValiditySeconds(864000)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            	//单点登录时配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .redirectUris("http://localhost:9501/login") </span><br></span><span class=token-line style=color:#393A34><span class="token plain">            	//自动授权配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            	.autoApprove(true) </span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .scopes("all")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                .authorizedGrantTypes("authorization_code","password","refresh_token");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void configure(AuthorizationServerSecurityConfigurer security) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        // 获取密钥需要身份认证，使用单点登录时必须配置</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        security.tokenKeyAccess("isAuthenticated()"); </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id=权限认证>权限认证<a href=#权限认证 class=hash-link aria-label=权限认证的直接链接 title=权限认证的直接链接>​</a></h6>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * 在接口上配置权限时使用</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/10/11.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Configuration</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@Order(101)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class SecurityConfig extends WebSecurityConfigurerAdapter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">/**</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> * Created by macro on 2019/9/30.</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> */</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RestController</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@RequestMapping("/user")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class UserController {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @PreAuthorize("hasAuthority('admin')")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @GetMapping("/auth/admin")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Object adminAuth() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return "Has admin auth!";</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cloud-admin>cloud-admin<a href=#cloud-admin class=hash-link aria-label=cloud-admin的直接链接 title=cloud-admin的直接链接>​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=服务端-3>服务端<a href=#服务端-3 class=hash-link aria-label=服务端的直接链接 title=服务端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">de.codecentric</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-admin-starter-server</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> admin</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">server</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9301</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@EnableAdminServer</span><br></span><span class=token-line style=color:#393A34><span class="token plain">@SpringBootApplication</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class AdminServerApplication {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        SpringApplication.run(AdminServerApplication.class, args);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=客户端-4>客户端<a href=#客户端-4 class=hash-link aria-label=客户端的直接链接 title=客户端的直接链接>​</a></h5>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">de.codecentric</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>groupId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">spring-boot-admin-starter-client</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>artifactId</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>dependency</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token key atrule" style=color:#00a4db>spring</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>application</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> admin</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>boot</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>admin</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>client</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>url</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> http</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain">//localhost</span><span class="token punctuation" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>9301</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>#配置admin-server地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>server</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>port</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>9305</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>management</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoints</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>web</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>exposure</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>include</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'*'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>endpoint</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>health</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>show-details</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> always</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>logging</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>file</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> admin</span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain">client.log </span><span class="token comment" style=color:#999988;font-style:italic>#添加开启admin的日志监控</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=skywalking链路追踪>SkyWalking链路追踪<a href=#skywalking链路追踪 class=hash-link aria-label=SkyWalking链路追踪的直接链接 title=SkyWalking链路追踪的直接链接>​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>-- 部署学习地址</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">https:</span><span class="token comment" style=color:#999988;font-style:italic>//www.iocoder.cn/SkyWalking/install/</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 业务机制</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">SpringCloud：分布式系统中的服务，启动时配置代理即可；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Agent：以探针的方式进行请求链路的数据采集，并向管理服务上报；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">OAP</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Service：接收数据，完成数据的存储和展示；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Storage：数据的存储层，支持ElasticSearch、Mysql、H2多种方式；</span><br></span><span class=token-line style=color:#393A34><span class="token plain">UI界面：数据的可视化展示界面；</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 工作流程</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">springboot启动，配置agent地址，并设置agent连接的OAP地址，OAP配置存储地址</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">如elastic</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">服务通过探针的方式接入数据采集的功能，之后请求链路的相关处理行为会上报到OAP服务中，进行数据的聚合管理和分析，并存储在持久层，然后可以通过UI界面进行可视化呈现</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 安装部署</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">skywalking在之前的旧版本中，apm与agent是在一个包中的，在</span><span class="token number" style=color:#36acaa>9.0</span><span class="token plain">的版本中是需要分开下载的；agent包下载解压之后，也将其放到apm包下面维护</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 配置存储方式</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">config</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">application</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">yml</span><br></span><span class=token-line style=color:#393A34><span class="token plain">storage:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  selector: ${SW_STORAGE:elasticsearch}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  elasticsearch:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    namespace: ${SW_NAMESPACE:</span><span class="token string" style=color:#e3116c>""</span><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:</span><span class="token number" style=color:#36acaa>175.178</span><span class="token number" style=color:#36acaa>.164</span><span class="token number" style=color:#36acaa>.134</span><span class="token plain">:</span><span class="token number" style=color:#36acaa>9200</span><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 启动</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Windows 直接点击bin</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">startup</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">bat</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 涉及网关</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">将optional</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">plugins目录下面的apm</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">spring</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">cloud</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">gateway</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>3.</span><span class="token plain">x</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">plugin</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>8.12</span><span class="token number" style=color:#36acaa>.0</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar 和apm</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">spring</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">webflux</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>5.</span><span class="token plain">x</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">plugin</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>8.12</span><span class="token number" style=color:#36acaa>.0</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar两个包拷贝到plugins目录下面去</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>-- 服务添加配置</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">在服务启动类中添加agent配置，如果在生产环境中，通常会统一在脚本中设置，由于在本地环境演示，基于IDEA工具进行管理</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>-</span><span class="token plain">javaagent:D:\hayes\software</span><span class="token operator" style=color:#393A34>-</span><span class="token number" style=color:#36acaa>0329</span><span class="token plain">\apache</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">skywalking</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">apm</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">bin\agent\skywalking</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">agent</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">jar</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Dskywalking</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">agent</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">service_name</span><span class="token operator" style=color:#393A34>=</span><span class="token plain">hmh</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">cloud</span><span class="token operator" style=color:#393A34>-</span><span class="token plain">gateway</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token operator" style=color:#393A34>-</span><span class="token plain">Dskywalking</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">collector</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">backend_service</span><span class="token operator" style=color:#393A34>=</span><span class="token number" style=color:#36acaa>127.0</span><span class="token number" style=color:#36acaa>.0</span><span class="token number" style=color:#36acaa>.1</span><span class="token plain">:</span><span class="token number" style=color:#36acaa>11800</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<!-- -->
<img src=/mhuahe.com/assets/images/SpringCloud-SkyWalking链路追踪-4e7a5997824e0752b76c3446ca615372.png alt=SpringCloud-SkyWalking链路追踪 width=50%></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.dev/mhuahe/mhuahe.com/blob/master-ts/docs/java/JAVA-SpringCloud-Stack.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最后<!-- -->由 <b>heminhua</b> <!-- -->于 <b><time datetime=2024-10-16T16:04:02.000Z itemprop=dateModified>2024年10月16日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/mhuahe.com/docs/java/JAVA-SpringBoot-Version><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>JAVA-SpringBoot版本</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/mhuahe.com/docs/java/JAVA-Thread><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>JAVA-多线程</div></a></nav><div id=disqus_thread></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#cloud-eureka class="table-of-contents__link toc-highlight">cloud-eureka</a><ul><li><a href=#服务端 class="table-of-contents__link toc-highlight">服务端</a><li><a href=#客户端 class="table-of-contents__link toc-highlight">客户端</a><li><a href=#集群 class="table-of-contents__link toc-highlight">集群</a><li><a href=#添加认证 class="table-of-contents__link toc-highlight">添加认证</a><li><a href=#eureka的常用配置 class="table-of-contents__link toc-highlight">Eureka的常用配置</a></ul><li><a href=#cloud-ribbon class="table-of-contents__link toc-highlight">cloud-ribbon</a><ul><li><a href=#客户端1 class="table-of-contents__link toc-highlight">客户端1</a><li><a href=#ribbon负载客户端 class="table-of-contents__link toc-highlight">ribbon负载客户端</a><ul><li><a href=#负载配置 class="table-of-contents__link toc-highlight">负载配置</a><li><a href=#调用客户端 class="table-of-contents__link toc-highlight">调用客户端</a></ul><li><a href=#演示 class="table-of-contents__link toc-highlight">演示</a><li><a href=#ribbon常用配置 class="table-of-contents__link toc-highlight">ribbon常用配置</a></ul><li><a href=#cloud-hystrix class="table-of-contents__link toc-highlight">cloud-hystrix</a><ul><li><a href=#服务降级 class="table-of-contents__link toc-highlight">服务降级</a><ul><li><a href=#hystrixcommand常用参数 class="table-of-contents__link toc-highlight">@HystrixCommand常用参数</a></ul><li><a href=#请求缓存 class="table-of-contents__link toc-highlight">请求缓存</a><ul><li><a href=#相关注解 class="table-of-contents__link toc-highlight">相关注解</a></ul><li><a href=#请求合并 class="table-of-contents__link toc-highlight">请求合并</a><ul><li><a href=#hystrixcollapser的常用属性 class="table-of-contents__link toc-highlight">@HystrixCollapser的常用属性</a></ul><li><a href=#hystrix的常用配置 class="table-of-contents__link toc-highlight">Hystrix的常用配置</a><ul><li><a href=#全局配置 class="table-of-contents__link toc-highlight">全局配置</a><li><a href=#实例配置 class="table-of-contents__link toc-highlight">实例配置</a></ul></ul><li><a href=#cloud-feign class="table-of-contents__link toc-highlight">cloud-feign</a><ul><li><a href=#feign接口 class="table-of-contents__link toc-highlight">feign接口</a><li><a href=#日志打印 class="table-of-contents__link toc-highlight">日志打印</a></ul><li><a href=#cloud-zuul class="table-of-contents__link toc-highlight">cloud-zuul</a><ul><li><a href=#请求路由 class="table-of-contents__link toc-highlight">请求路由</a><li><a href=#查看路由信息 class="table-of-contents__link toc-highlight">查看路由信息</a><li><a href=#过滤器 class="table-of-contents__link toc-highlight">过滤器</a></ul><li><a href=#cloud-config class="table-of-contents__link toc-highlight">cloud-config</a><ul><li><a href=#服务端-1 class="table-of-contents__link toc-highlight">服务端</a><li><a href=#客户端-1 class="table-of-contents__link toc-highlight">客户端</a><li><a href=#刷新配置 class="table-of-contents__link toc-highlight">刷新配置</a><li><a href=#安全认证 class="table-of-contents__link toc-highlight">安全认证</a><li><a href=#集群搭建 class="table-of-contents__link toc-highlight">集群搭建</a></ul><li><a href=#cloud-bus class="table-of-contents__link toc-highlight">cloud-bus</a><ul><li><a href=#动态刷新配置 class="table-of-contents__link toc-highlight">动态刷新配置</a><ul><li><a href=#服务端-2 class="table-of-contents__link toc-highlight">服务端</a><li><a href=#客户端-2 class="table-of-contents__link toc-highlight">客户端</a><li><a href=#演示-1 class="table-of-contents__link toc-highlight">演示</a><li><a href=#配合webhooks使用 class="table-of-contents__link toc-highlight">配合WebHooks使用</a></ul></ul><li><a href=#cloud-sleuth class="table-of-contents__link toc-highlight">cloud-sleuth</a><ul><li><a href=#zipkin日志 class="table-of-contents__link toc-highlight">zipkin日志</a><li><a href=#elasticsearch存储日志 class="table-of-contents__link toc-highlight">Elasticsearch存储日志</a></ul><li><a href=#cloud-consul class="table-of-contents__link toc-highlight">cloud-consul</a><ul><li><a href=#注册中心 class="table-of-contents__link toc-highlight">注册中心</a><ul><li><a href=#客户端负载 class="table-of-contents__link toc-highlight">客户端负载</a></ul><li><a href=#配置中心 class="table-of-contents__link toc-highlight">配置中心</a></ul><li><a href=#cloud-gateway class="table-of-contents__link toc-highlight">cloud-gateway</a><ul><li><a href=#过滤器-1 class="table-of-contents__link toc-highlight">过滤器</a><li><a href=#监控请求 class="table-of-contents__link toc-highlight">监控请求</a><li><a href=#工作原理 class="table-of-contents__link toc-highlight">工作原理</a></ul><li><a href=#cloud-nacos class="table-of-contents__link toc-highlight">cloud-nacos</a><ul><li><a href=#注册中心-1 class="table-of-contents__link toc-highlight">注册中心</a><li><a href=#配置中心-1 class="table-of-contents__link toc-highlight">配置中心</a><ul><li><a href=#配置文件加载顺序 class="table-of-contents__link toc-highlight">配置文件加载顺序</a></ul></ul><li><a href=#cloud-sentinel class="table-of-contents__link toc-highlight">cloud-sentinel</a><ul><li><a href=#限流 class="table-of-contents__link toc-highlight">限流</a><ul><li><a href=#根据资源名称限流 class="table-of-contents__link toc-highlight">根据资源名称限流</a><li><a href=#根据url限流 class="table-of-contents__link toc-highlight">根据URL限流</a></ul><li><a href=#熔断功能 class="table-of-contents__link toc-highlight">熔断功能</a><ul><li><a href=#resttemplate调用方式 class="table-of-contents__link toc-highlight">RestTemplate调用方式</a><li><a href=#feign调用方式 class="table-of-contents__link toc-highlight">feign调用方式</a></ul></ul><li><a href=#cloud-seata class="table-of-contents__link toc-highlight">cloud-seata</a><ul><li><a href=#搭建seata服务端 class="table-of-contents__link toc-highlight">搭建seata服务端</a><li><a href=#客户端-3 class="table-of-contents__link toc-highlight">客户端</a></ul><li><a href=#cloud-oauth2 class="table-of-contents__link toc-highlight">cloud-oauth2</a><ul><li><a href=#oauth2相关名词 class="table-of-contents__link toc-highlight">OAuth2相关名词</a><li><a href=#四种授权模式 class="table-of-contents__link toc-highlight">四种授权模式</a><ul><li><a href=#authorization-code授权码模式 class="table-of-contents__link toc-highlight">Authorization Code（授权码模式）</a><li><a href=#implicit简化模式 class="table-of-contents__link toc-highlight">Implicit（简化模式）</a><li><a href=#密码模式 class="table-of-contents__link toc-highlight">密码模式</a><li><a href=#client-credentials客户端模式 class="table-of-contents__link toc-highlight">Client Credentials（客户端模式）</a><li><a href=#刷新令牌 class="table-of-contents__link toc-highlight">刷新令牌</a></ul><li><a href=#入门使用 class="table-of-contents__link toc-highlight">入门使用</a><li><a href=#存储令牌 class="table-of-contents__link toc-highlight">存储令牌</a><ul><li><a href=#使用redis存储令牌 class="table-of-contents__link toc-highlight">使用Redis存储令牌</a><li><a href=#使用jwt存储令牌 class="table-of-contents__link toc-highlight">使用jwt存储令牌</a><li><a href=#扩展jwt存储内容 class="table-of-contents__link toc-highlight">扩展jwt存储内容</a><li><a href=#解析jwt class="table-of-contents__link toc-highlight">解析jwt</a><li><a href=#刷新令牌-1 class="table-of-contents__link toc-highlight">刷新令牌</a></ul><li><a href=#单点登录 class="table-of-contents__link toc-highlight">单点登录</a><ul><li><a href=#权限认证 class="table-of-contents__link toc-highlight">权限认证</a></ul></ul><li><a href=#cloud-admin class="table-of-contents__link toc-highlight">cloud-admin</a><ul><li><a href=#服务端-3 class="table-of-contents__link toc-highlight">服务端</a><li><a href=#客户端-4 class="table-of-contents__link toc-highlight">客户端</a></ul><li><a href=#skywalking链路追踪 class="table-of-contents__link toc-highlight">SkyWalking链路追踪</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>© 2024 mhuahe. Built with Docusaurus.</div></div></div></footer></div>