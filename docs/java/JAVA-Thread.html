<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-java/JAVA-Thread" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.0"><title data-rh=true>JAVA-å¤šçº¿ç¨‹ | è´ºæ•åçš„å®˜æ–¹ç½‘ç«™</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://mhuahe.github.io/mhuahe.com/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://mhuahe.github.io/mhuahe.com/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-Thread><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="JAVA-å¤šçº¿ç¨‹ | è´ºæ•åçš„å®˜æ–¹ç½‘ç«™"><meta data-rh=true name=description content=å¤šçº¿ç¨‹åŸºç¡€><meta data-rh=true property=og:description content=å¤šçº¿ç¨‹åŸºç¡€><link data-rh=true rel=icon href=/mhuahe.com/img/m_two_logo.ico><link data-rh=true rel=canonical href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-Thread><link data-rh=true rel=alternate href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-Thread hreflang=zh-Hans><link data-rh=true rel=alternate href=https://mhuahe.github.io/mhuahe.com/docs/java/JAVA-Thread hreflang=x-default><link data-rh=true rel=preconnect href=https://I1N20F00TC-dsn.algolia.net crossorigin><link rel=alternate type=application/rss+xml href=/mhuahe.com/blog/rss.xml title="è´ºæ•åçš„å®˜æ–¹ç½‘ç«™ RSS Feed"><link rel=alternate type=application/atom+xml href=/mhuahe.com/blog/atom.xml title="è´ºæ•åçš„å®˜æ–¹ç½‘ç«™ Atom Feed"><link rel=search type=application/opensearchdescription+xml title=è´ºæ•åçš„å®˜æ–¹ç½‘ç«™ href=/mhuahe.com/opensearch.xml><link rel=stylesheet href=/mhuahe.com/assets/css/styles.efbb0483.css><script src=/mhuahe.com/assets/js/runtime~main.5d4ea756.js defer></script><script src=/mhuahe.com/assets/js/main.5ae8685f.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id=__docusaurus><div role=region aria-label=è·³åˆ°ä¸»è¦å†…å®¹><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class=announcementBar_mb4j role=banner><div class=announcementBarPlaceholder_vyr4></div><div class="content_knG7 announcementBarContent_xLdY">ğŸ‰ï¸<b>æœ¬ç½‘ç«™æ­£åœ¨å»ºè®¾ä¸­ï¼Œæ¬¢è¿æå‡ºå®è´µæ„è§ï¼<a target=_blank href=https://github.com/mhuahe/mhuahe.com>æºç åœ°å€</a></b> ğŸ¥³ï¸</div><button type=button aria-label=å…³é—­ class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width=14 height=14><g stroke=currentColor stroke-width=3.1><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"/></g></svg></button></div><nav aria-label=ä¸»å¯¼èˆª class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label=åˆ‡æ¢å¯¼èˆªæ  aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/mhuahe.com/><div class=navbar__logo><img src=/mhuahe.com/img/m_two_logo.svg alt="mhuahe site logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height=32 width=32><img src=/mhuahe.com/img/m_two_logo.svg alt="mhuahe site logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height=32 width=32></div><b class="navbar__title text--truncate">è´ºæ•åçš„å®˜æ–¹ç½‘ç«™</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/mhuahe.com/docs/java>Java</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/web>å‰ç«¯</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/c>Cè¯­è¨€</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/linux>Linux</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/sql/MySQL>SQL</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/python>Python</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/tool>å·¥å…·</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/project>é¡¹ç›®</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/knowledge/ä»€ä¹ˆæ˜¯SaaS>çŸ¥è¯†</a><a class="navbar__item navbar__link" href=/mhuahe.com/docs/other/OTHER-Examination>å…¶ä»–</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/mhuahe.com/docs/example/EXAMPLE-Video>ç¤ºä¾‹</a><a class="navbar__item navbar__link" href=/mhuahe.com/blog>Blog</a><a href=/mhuahe.com/pintree/index.html class="navbar__item navbar__link" target=_blank>ä¹¦ç­¾</a><a href=https://github.com/mhuahe/mhuahe.com target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title=åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰ aria-label=åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰ aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label=æœç´¢><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>æœç´¢</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=å›åˆ°é¡¶éƒ¨ class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=æ–‡æ¡£ä¾§è¾¹æ  class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java><div> <!-- -->JAVA</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Algorithm><div> <!-- -->JAVA-ç®—æ³•</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Code-Generation><div> <!-- -->JAVA-ä»£ç ç”Ÿæˆ</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Data-Structure><div> <!-- -->JAVA-æ•°æ®ç»“æ„</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Design-Pattern><div> <!-- -->JAVA-è®¾è®¡æ¨¡å¼</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Elaticsearch><div> <!-- -->JAVA-ES</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Encryption><div> <!-- -->JAVA-åŠ å¯†æ–¹å¼</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Error-Record><div> <!-- -->JAVA-é”™è¯¯è®°å½•</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Hutool><div> <!-- -->JAVA-HuToolå·¥å…·</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-JDK-Version><div> <!-- -->JAVA-JDKç‰ˆæœ¬</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-JVM><div> <!-- -->JAVA-JVM</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Knowledge-Question><div> <!-- -->JAVA-çŸ¥è¯†é¢˜</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MQ><div> <!-- -->JAVA-æ¶ˆæ¯é˜Ÿåˆ—</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Maven-Dependent><div> <!-- -->JAVA-Mavenä¾èµ–</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Maven><div> <!-- -->JAVA-Maven</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MongoDB><div> <!-- -->JAVA-MongoDB</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-MybatisPlus><div> <!-- -->JAVA-MybatisPlus</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-OAuth2-SourceCode><div> <!-- -->JAVA-oauth2æºç è§£è¯»</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-PDF><div> <!-- -->JAVA-PDF</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SQL-Interceptor><div> <!-- -->JAVA-SQLæ‹¦æˆªå™¨</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-Servlet><div> <!-- -->JAVA-Servlet</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SpringBoot-Stack><div> <!-- -->JAVA-SpringBootæŠ€æœ¯æ ˆ</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SpringBoot-Version><div> <!-- -->JAVA-SpringBootç‰ˆæœ¬</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-SpringCloud-Stack><div> <!-- -->JAVA-SpringCloudæŠ€æœ¯æ ˆ</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current=page href=/mhuahe.com/docs/java/JAVA-Thread><div> <!-- -->JAVA-å¤šçº¿ç¨‹</div></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/mhuahe.com/docs/java/JAVA-WebSocket><div> <!-- -->JAVA-WebSocket</div></a></ul></nav><button type=button title=æ”¶èµ·ä¾§è¾¹æ  aria-label=æ”¶èµ·ä¾§è¾¹æ  class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=é¡µé¢è·¯å¾„><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=ä¸»é¡µé¢ class=breadcrumbs__link href=/mhuahe.com/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>JAVA-å¤šçº¿ç¨‹</span><meta itemprop=position content=1></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>JAVA-å¤šçº¿ç¨‹</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=å¤šçº¿ç¨‹åŸºç¡€>å¤šçº¿ç¨‹åŸºç¡€<a href=#å¤šçº¿ç¨‹åŸºç¡€ class=hash-link aria-label=å¤šçº¿ç¨‹åŸºç¡€çš„ç›´æ¥é“¾æ¥ title=å¤šçº¿ç¨‹åŸºç¡€çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<p>Javaè¯­è¨€å†…ç½®äº†å¤šçº¿ç¨‹æ”¯æŒï¼šä¸€ä¸ªJavaç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼ŒJVMè¿›ç¨‹ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥æ‰§è¡Œ<code>main()</code>æ–¹æ³•ï¼Œåœ¨<code>main()</code>æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬åˆå¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚æ­¤å¤–ï¼ŒJVMè¿˜æœ‰è´Ÿè´£åƒåœ¾å›æ”¶çš„å…¶ä»–å·¥ä½œçº¿ç¨‹ç­‰ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºå¤§å¤šæ•°Javaç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬è¯´å¤šä»»åŠ¡ï¼Œå®é™…ä¸Šæ˜¯è¯´å¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹å®ç°å¤šä»»åŠ¡ã€‚</p>
<p>å’Œå•çº¿ç¨‹ç›¸æ¯”ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹åœ¨äºï¼šå¤šçº¿ç¨‹ç»å¸¸éœ€è¦è¯»å†™å…±äº«æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œæ’­æ”¾ç”µå½±æ—¶ï¼Œå°±å¿…é¡»ç”±ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾è§†é¢‘ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾éŸ³é¢‘ï¼Œä¸¤ä¸ªçº¿ç¨‹éœ€è¦åè°ƒè¿è¡Œï¼Œå¦åˆ™ç”»é¢å’Œå£°éŸ³å°±ä¸åŒæ­¥ã€‚å› æ­¤ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•æ›´å›°éš¾ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=åˆ›å»ºæ–°çº¿ç¨‹>åˆ›å»ºæ–°çº¿ç¨‹<a href=#åˆ›å»ºæ–°çº¿ç¨‹ class=hash-link aria-label=åˆ›å»ºæ–°çº¿ç¨‹çš„ç›´æ¥é“¾æ¥ title=åˆ›å»ºæ–°çº¿ç¨‹çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<p>è¦åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹éå¸¸å®¹æ˜“ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª<code>Thread</code>å®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„<code>start()</code>æ–¹æ³•ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Thread t = new Thread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.start(); // å¯åŠ¨æ–°çº¿ç¨‹</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä½†æ˜¯è¿™ä¸ªçº¿ç¨‹å¯åŠ¨åå®é™…ä¸Šä»€ä¹ˆä¹Ÿä¸åšå°±ç«‹åˆ»ç»“æŸäº†ã€‚æˆ‘ä»¬å¸Œæœ›æ–°çº¿ç¨‹èƒ½æ‰§è¡ŒæŒ‡å®šçš„ä»£ç ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<p>æ–¹æ³•ä¸€ï¼šä»<code>Thread</code>æ´¾ç”Ÿä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œç„¶åè¦†å†™<code>run()</code>æ–¹æ³•ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">// å¤šçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class Main {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread t = new MyThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        t.start(); // å¯åŠ¨æ–°çº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class MyThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println("start new thread!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ–¹æ³•äºŒï¼šåˆ›å»º<code>Thread</code>å®ä¾‹æ—¶ï¼Œä¼ å…¥ä¸€ä¸ª<code>Runnable</code>å®ä¾‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">// å¤šçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class Main {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread t = new Thread(new MyRunnable());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        t.start(); // å¯åŠ¨æ–°çº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class MyRunnable implements Runnable {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println("start new thread!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">//æˆ–è€…ç”¨Java 8å¼•å…¥çš„lambdaè¯­æ³•è¿›ä¸€æ­¥ç®€å†™ä¸ºï¼š</span><br></span><span class=token-line style=color:#393A34><span class="token plain">Thread t = new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    System.out.println("start new thread!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">});</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.start(); // å¯åŠ¨æ–°çº¿ç¨‹</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ–¹æ³•ä¸‰ï¼šé€šè¿‡ Callable å’Œ Future åˆ›å»ºçº¿ç¨‹ï¼š</p>
<p>å®ç°äº†Runnableæ¥å£çš„FutureTaskä½œä¸ºè½¬æ¢å™¨ï¼Œåœ¨run()æ–¹æ³•ä¸­è°ƒç”¨Callableçš„call()æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯å®ç°Runnableæ¥å£ã€‚</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public class CallableThreadTest implements Callable&lt;Integer> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        CallableThreadTest ctt = new CallableThreadTest();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        FutureTask&lt;Integer> ft = new FutureTask&lt;>(ctt);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i = 0; i &lt; 100; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(Thread.currentThread().getName() + " çš„å¾ªç¯å˜é‡içš„å€¼" + i);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            if (i == 20) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                new Thread(ft, "æœ‰è¿”å›å€¼çš„çº¿ç¨‹").start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println("å­çº¿ç¨‹çš„è¿”å›å€¼ï¼š" + ft.get());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            e.printStackTrace();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } catch (ExecutionException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            e.printStackTrace();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public Integer call() throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        int i = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (; i &lt; 100; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(Thread.currentThread().getName() + " " + i);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return i;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ³¨æ„ï¼šç›´æ¥è°ƒç”¨<code>Thread</code>å®ä¾‹çš„<code>run()</code>æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼š</p>
<p>ç›´æ¥è°ƒç”¨<code>run()</code>æ–¹æ³•ï¼Œç›¸å½“äºè°ƒç”¨äº†ä¸€ä¸ªæ™®é€šçš„Javaæ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œä¹Ÿä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚ä¸Šè¿°ä»£ç å®é™…ä¸Šæ˜¯åœ¨<code>main()</code>æ–¹æ³•å†…éƒ¨åˆè°ƒç”¨äº†<code>run()</code>æ–¹æ³•ï¼Œæ‰“å°<code>hello</code>è¯­å¥æ˜¯åœ¨<code>main</code>çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œæ²¡æœ‰ä»»ä½•æ–°çº¿ç¨‹è¢«åˆ›å»ºã€‚</p>
<p>å¿…é¡»è°ƒç”¨<code>Thread</code>å®ä¾‹çš„<code>start()</code>æ–¹æ³•æ‰èƒ½å¯åŠ¨æ–°çº¿ç¨‹ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹<code>Thread</code>ç±»çš„æºä»£ç ï¼Œä¼šçœ‹åˆ°<code>start()</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†ä¸€ä¸ª<code>private native void start0()</code>æ–¹æ³•ï¼Œ<code>native</code>ä¿®é¥°ç¬¦è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ˜¯ç”±JVMè™šæ‹Ÿæœºå†…éƒ¨çš„Cä»£ç å®ç°çš„ï¼Œä¸æ˜¯ç”±Javaä»£ç å®ç°çš„ã€‚</p>
<p>çº¿ç¨‹çš„ä¼˜å…ˆçº§</p>
<p>å¯ä»¥å¯¹çº¿ç¨‹è®¾å®šä¼˜å…ˆçº§ï¼Œè®¾å®šä¼˜å…ˆçº§çš„æ–¹æ³•æ˜¯ï¼š</p>
<p><code>Thread.setPriority(int n) // 1~10, é»˜è®¤å€¼5</code></p>
<p>JVMè‡ªåŠ¨æŠŠ1ï¼ˆä½ï¼‰~10ï¼ˆé«˜ï¼‰çš„ä¼˜å…ˆçº§æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿå®é™…ä¼˜å…ˆçº§ä¸Šï¼ˆä¸åŒæ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„ä¼˜å…ˆçº§æ•°é‡ï¼‰ã€‚ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œæ“ä½œç³»ç»Ÿå¯¹é«˜ä¼˜å…ˆçº§çº¿ç¨‹å¯èƒ½è°ƒåº¦æ›´é¢‘ç¹ï¼Œä½†æˆ‘ä»¬å†³ä¸èƒ½é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§æ¥ç¡®ä¿é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸€å®šä¼šå…ˆæ‰§è¡Œã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=çº¿ç¨‹çŠ¶æ€>çº¿ç¨‹çŠ¶æ€<a href=#çº¿ç¨‹çŠ¶æ€ class=hash-link aria-label=çº¿ç¨‹çŠ¶æ€çš„ç›´æ¥é“¾æ¥ title=çº¿ç¨‹çŠ¶æ€çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<p>åœ¨Javaç¨‹åºä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åªèƒ½è°ƒç”¨ä¸€æ¬¡<code>start()</code>æ–¹æ³•å¯åŠ¨æ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œ<code>run()</code>æ–¹æ³•ã€‚ä¸€æ—¦<code>run()</code>æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹å°±ç»“æŸäº†ã€‚å› æ­¤ï¼ŒJavaçº¿ç¨‹çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>Newï¼šæ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œå°šæœªæ‰§è¡Œï¼›</li>
<li>Runnableï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ­£åœ¨æ‰§è¡Œ<code>run()</code>æ–¹æ³•çš„Javaä»£ç ï¼›</li>
<li>Blockedï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œè¢«é˜»å¡è€ŒæŒ‚èµ·ï¼›</li>
<li>Waitingï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œåœ¨ç­‰å¾…ä¸­ï¼›</li>
<li>Timed Waitingï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæ‰§è¡Œ<code>sleep()</code>æ–¹æ³•æ­£åœ¨è®¡æ—¶ç­‰å¾…ï¼›</li>
<li>Terminatedï¼šçº¿ç¨‹å·²ç»ˆæ­¢ï¼Œå› ä¸º<code>run()</code>æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚</li>
</ul>
<p>å½“çº¿ç¨‹å¯åŠ¨åï¼Œå®ƒå¯ä»¥åœ¨<code>Runnable</code>ã€<code>Blocked</code>ã€<code>Waiting</code>å’Œ<code>Timed Waiting</code>è¿™å‡ ä¸ªçŠ¶æ€ä¹‹é—´åˆ‡æ¢ï¼Œç›´åˆ°æœ€åå˜æˆ<code>Terminated</code>çŠ¶æ€ï¼Œçº¿ç¨‹ç»ˆæ­¢ã€‚</p>
<p>çº¿ç¨‹ç»ˆæ­¢çš„åŸå› æœ‰ï¼š</p>
<ul>
<li>çº¿ç¨‹æ­£å¸¸ç»ˆæ­¢ï¼š<code>run()</code>æ–¹æ³•æ‰§è¡Œåˆ°<code>return</code>è¯­å¥è¿”å›ï¼›</li>
<li>çº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼š<code>run()</code>æ–¹æ³•å› ä¸ºæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼›</li>
<li>å¯¹æŸä¸ªçº¿ç¨‹çš„<code>Thread</code>å®ä¾‹è°ƒç”¨<code>stop()</code>æ–¹æ³•å¼ºåˆ¶ç»ˆæ­¢ï¼ˆå¼ºçƒˆä¸æ¨èä½¿ç”¨ï¼‰ã€‚</li>
</ul>
<p>ä¸€ä¸ªçº¿ç¨‹è¿˜å¯ä»¥ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›´åˆ°å…¶è¿è¡Œç»“æŸã€‚ä¾‹å¦‚ï¼Œ<code>main</code>çº¿ç¨‹åœ¨å¯åŠ¨<code>t</code>çº¿ç¨‹åï¼Œå¯ä»¥é€šè¿‡<code>t.join()</code>ç­‰å¾…<code>t</code>çº¿ç¨‹ç»“æŸåå†ç»§ç»­è¿è¡Œï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">// å¤šçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public class Main {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread t = new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println("hello");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        });</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println("start");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        t.start(); // å¯åŠ¨tçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        t.join(); // æ­¤å¤„mainçº¿ç¨‹ä¼šç­‰å¾…tç»“æŸ</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println("end");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœ<code>t</code>çº¿ç¨‹å·²ç»ç»“æŸï¼Œå¯¹å®ä¾‹<code>t</code>è°ƒç”¨<code>join()</code>ä¼šç«‹åˆ»è¿”å›ã€‚æ­¤å¤–ï¼Œ<code>join(long)</code>çš„é‡è½½æ–¹æ³•ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡ç­‰å¾…æ—¶é—´åå°±ä¸å†ç»§ç»­ç­‰å¾…ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ä¸­æ–­çº¿ç¨‹>ä¸­æ–­çº¿ç¨‹<a href=#ä¸­æ–­çº¿ç¨‹ class=hash-link aria-label=ä¸­æ–­çº¿ç¨‹çš„ç›´æ¥é“¾æ¥ title=ä¸­æ–­çº¿ç¨‹çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<p>å¦‚æœçº¿ç¨‹éœ€è¦æ‰§è¡Œä¸€ä¸ªé•¿æ—¶é—´ä»»åŠ¡ï¼Œå°±å¯èƒ½éœ€è¦èƒ½ä¸­æ–­çº¿ç¨‹ã€‚ä¸­æ–­çº¿ç¨‹å°±æ˜¯å…¶ä»–çº¿ç¨‹ç»™è¯¥çº¿ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œè¯¥çº¿ç¨‹æ”¶åˆ°ä¿¡å·åç»“æŸæ‰§è¡Œ<code>run()</code>æ–¹æ³•ï¼Œä½¿å¾—è‡ªèº«çº¿ç¨‹èƒ½ç«‹åˆ»ç»“æŸè¿è¡Œã€‚</p>
<p>æˆ‘ä»¬ä¸¾ä¸ªæ —å­ï¼šå‡è®¾ä»ç½‘ç»œä¸‹è½½ä¸€ä¸ª100Mçš„æ–‡ä»¶ï¼Œå¦‚æœç½‘é€Ÿå¾ˆæ…¢ï¼Œç”¨æˆ·ç­‰å¾—ä¸è€çƒ¦ï¼Œå°±å¯èƒ½åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­ç‚¹â€œå–æ¶ˆâ€ï¼Œè¿™æ—¶ï¼Œç¨‹åºå°±éœ€è¦ä¸­æ–­ä¸‹è½½çº¿ç¨‹çš„æ‰§è¡Œã€‚</p>
<p>ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å…¶ä»–çº¿ç¨‹ä¸­å¯¹ç›®æ ‡çº¿ç¨‹è°ƒç”¨<code>interrupt()</code>æ–¹æ³•ï¼Œç›®æ ‡çº¿ç¨‹éœ€è¦åå¤æ£€æµ‹è‡ªèº«çŠ¶æ€æ˜¯å¦æ˜¯interruptedçŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç«‹åˆ»ç»“æŸè¿è¡Œã€‚</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void interruptThread() throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Thread t = new MyThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Thread.sleep(1); // æš‚åœ1æ¯«ç§’</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.interrupt(); // ä¸­æ–­tçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.join(); // ç­‰å¾…tçº¿ç¨‹ç»“æŸ</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    System.out.println("end");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">static class MyThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        int n = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (!isInterrupted()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            n++;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(n + " hello!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä»”ç»†çœ‹ä¸Šè¿°ä»£ç ï¼Œ<code>main</code>çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>t.interrupt()</code>æ–¹æ³•ä¸­æ–­<code>t</code>çº¿ç¨‹ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œ<code>interrupt()</code>æ–¹æ³•ä»…ä»…å‘<code>t</code>çº¿ç¨‹å‘å‡ºäº†â€œä¸­æ–­è¯·æ±‚â€ï¼Œè‡³äº<code>t</code>çº¿ç¨‹æ˜¯å¦èƒ½ç«‹åˆ»å“åº”ï¼Œè¦çœ‹å…·ä½“ä»£ç ã€‚è€Œ<code>t</code>çº¿ç¨‹çš„<code>while</code>å¾ªç¯ä¼šæ£€æµ‹<code>isInterrupted()</code>ï¼Œæ‰€ä»¥ä¸Šè¿°ä»£ç èƒ½æ­£ç¡®å“åº”<code>interrupt()</code>è¯·æ±‚ï¼Œä½¿å¾—è‡ªèº«ç«‹åˆ»ç»“æŸè¿è¡Œ<code>run()</code>æ–¹æ³•ã€‚</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">important@Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void interruptThread2() throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Thread t = new MyThread2();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Thread.sleep(1000);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.interrupt(); // ä¸­æ–­tçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.join(); // ç­‰å¾…tçº¿ç¨‹ç»“æŸ</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    System.out.println("end");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">static class MyThread2 extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread hello = new HelloThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        hello.start(); // å¯åŠ¨helloçº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            hello.join(); // ç­‰å¾…helloçº¿ç¨‹ç»“æŸ</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println("MyThread2 interrupted!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        hello.interrupt();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">static class HelloThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        int n = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (!isInterrupted()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            n++;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(n + " hello!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Thread.sleep(100);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                System.out.println("HelloThread interrupted!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                break;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<blockquote>
<p>[!tip]</p>
<p><strong>HelloTheadç±»é‡Œä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ï¼Ÿå¦‚æœå»æ‰HelloTheadç±»é‡Œçš„breakä¼šæ­»å¾ªç¯ï¼Ÿ</strong></p>
<p>MyThreadä¸­è°ƒç”¨ hello.interrupt() åï¼ŒHelloThreadä¸­çš„ isInterrupted() å·²ç»å˜æˆäº†trueï¼Œå¦‚æœæ­¤æ—¶HelloThreadæ²¡æœ‰åœ¨sleepçŠ¶æ€ï¼Œwhileåˆ¤æ–­ !isInterrupted() ä¸ºfalseä¼šç›´æ¥ç»“æŸçº¿ç¨‹ï¼›å¦‚æœæ­¤æ—¶HelloThreadåœ¨sleepçŠ¶æ€ï¼Œä¼šç›´æ¥æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œå¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€ï¼Œå³isInterrupted() ä¼šè¿”å›falseï¼Œå¦‚æœæ²¡æœ‰breakçš„è¯ï¼Œwhileä¼šæ¡ä»¶ä¼šä¸€ç›´è¿”å›trueï¼Œå°±æ­»å¾ªç¯äº†ï¼›ç»¼ä¸Šï¼Œæ²¡æœ‰breakå¤§æ¦‚ç‡ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œä½†ä¸æ˜¯ä¸€å®šä¼šæ­»å¾ªç¯ï¼ŒåŠ breakæ˜¯ä¸ºäº†ä¿è¯ä»£ç çš„å¥å£®ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¿…é¡»è¦åŠ çš„ã€‚</p>
<p>åªæœ‰sleep/waitçŠ¶æ€çš„çº¿ç¨‹ä¼šå“åº”interruptï¼Œä¸­æ–­çº¿ç¨‹ã€‚</p>
</blockquote>
<p><code>main</code>çº¿ç¨‹é€šè¿‡è°ƒç”¨<code>t.interrupt()</code>ä»è€Œé€šçŸ¥<code>t</code>çº¿ç¨‹ä¸­æ–­ï¼Œè€Œæ­¤æ—¶<code>t</code>çº¿ç¨‹æ­£ä½äº<code>hello.join()</code>çš„ç­‰å¾…ä¸­ï¼Œæ­¤æ–¹æ³•ä¼šç«‹åˆ»ç»“æŸç­‰å¾…å¹¶æŠ›å‡º<code>InterruptedException</code>ã€‚ç”±äºæˆ‘ä»¬åœ¨<code>t</code>çº¿ç¨‹ä¸­æ•è·äº†<code>InterruptedException</code>ï¼Œå› æ­¤ï¼Œå°±å¯ä»¥å‡†å¤‡ç»“æŸè¯¥çº¿ç¨‹ã€‚åœ¨<code>t</code>çº¿ç¨‹ç»“æŸå‰ï¼Œå¯¹<code>hello</code>çº¿ç¨‹ä¹Ÿè¿›è¡Œäº†<code>interrupt()</code>è°ƒç”¨é€šçŸ¥å…¶ä¸­æ–­ã€‚å¦‚æœå»æ‰è¿™ä¸€è¡Œä»£ç ï¼Œå¯ä»¥å‘ç°<code>hello</code>çº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œä¸”JVMä¸ä¼šé€€å‡ºã€‚</p>
<p>å¦ä¸€ä¸ªå¸¸ç”¨çš„ä¸­æ–­çº¿ç¨‹çš„æ–¹æ³•æ˜¯è®¾ç½®æ ‡å¿—ä½ã€‚æˆ‘ä»¬é€šå¸¸ä¼šç”¨ä¸€ä¸ª<code>running</code>æ ‡å¿—ä½æ¥æ ‡è¯†çº¿ç¨‹æ˜¯å¦åº”è¯¥ç»§ç»­è¿è¡Œï¼Œåœ¨å¤–éƒ¨çº¿ç¨‹ä¸­ï¼Œé€šè¿‡æŠŠ<code>HelloThread.running</code>ç½®ä¸º<code>false</code>ï¼Œå°±å¯ä»¥è®©çº¿ç¨‹ç»“æŸï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">@Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void interruptThread3() throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    HelloThread2 t = new HelloThread2();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Thread.sleep(1);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    t.running = false; // æ ‡å¿—ä½ç½®ä¸ºfalse</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">static class HelloThread2 extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public volatile boolean running = true;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        int n = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (running) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            n++;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(n + " hello!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println("end!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ³¨æ„åˆ°<code>HelloThread</code>çš„æ ‡å¿—ä½<code>boolean running</code>æ˜¯ä¸€ä¸ªçº¿ç¨‹é—´å…±äº«çš„å˜é‡ã€‚çº¿ç¨‹é—´å…±äº«å˜é‡éœ€è¦ä½¿ç”¨<code>volatile</code>å…³é”®å­—æ ‡è®°ï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°æ›´æ–°åçš„å˜é‡å€¼ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦å¯¹çº¿ç¨‹é—´å…±äº«çš„å˜é‡ç”¨å…³é”®å­—<code>volatile</code>å£°æ˜ï¼Ÿè¿™æ¶‰åŠåˆ°Javaçš„å†…å­˜æ¨¡å‹ã€‚åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå˜é‡çš„å€¼ä¿å­˜åœ¨ä¸»å†…å­˜ä¸­ï¼Œä½†æ˜¯ï¼Œå½“çº¿ç¨‹è®¿é—®å˜é‡æ—¶ï¼Œå®ƒä¼šå…ˆè·å–ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¿å­˜åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ã€‚å¦‚æœçº¿ç¨‹ä¿®æ”¹äº†å˜é‡çš„å€¼ï¼Œè™šæ‹Ÿæœºä¼šåœ¨æŸä¸ªæ—¶åˆ»æŠŠä¿®æ”¹åçš„å€¼å›å†™åˆ°ä¸»å†…å­˜ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼</p>
<p>è¿™ä¼šå¯¼è‡´å¦‚æœä¸€ä¸ªçº¿ç¨‹æ›´æ–°äº†æŸä¸ªå˜é‡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è¯»å–çš„å€¼å¯èƒ½è¿˜æ˜¯æ›´æ–°å‰çš„ã€‚</p>
<p>å› æ­¤ï¼Œ<code>volatile</code>å…³é”®å­—çš„ç›®çš„æ˜¯å‘Šè¯‰è™šæ‹Ÿæœºï¼š</p>
<ul>
<li>æ¯æ¬¡è®¿é—®å˜é‡æ—¶ï¼Œæ€»æ˜¯è·å–ä¸»å†…å­˜çš„æœ€æ–°å€¼ï¼›</li>
<li>æ¯æ¬¡ä¿®æ”¹å˜é‡åï¼Œç«‹åˆ»å›å†™åˆ°ä¸»å†…å­˜ã€‚</li>
</ul>
<p><code>volatile</code>å…³é”®å­—è§£å†³çš„æ˜¯å¯è§æ€§é—®é¢˜ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ä¿®æ”¹åçš„å€¼ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å»æ‰<code>volatile</code>å…³é”®å­—ï¼Œè¿è¡Œä¸Šè¿°ç¨‹åºï¼Œå‘ç°æ•ˆæœå’Œå¸¦<code>volatile</code>å·®ä¸å¤šï¼Œè¿™æ˜¯å› ä¸ºåœ¨x86çš„æ¶æ„ä¸‹ï¼ŒJVMå›å†™ä¸»å†…å­˜çš„é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ï¼Œæ¢æˆARMçš„æ¶æ„ï¼Œå°±ä¼šæœ‰æ˜¾è‘—çš„å»¶è¿Ÿã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=å®ˆæŠ¤çº¿ç¨‹>å®ˆæŠ¤çº¿ç¨‹<a href=#å®ˆæŠ¤çº¿ç¨‹ class=hash-link aria-label=å®ˆæŠ¤çº¿ç¨‹çš„ç›´æ¥é“¾æ¥ title=å®ˆæŠ¤çº¿ç¨‹çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<p>Javaç¨‹åºå…¥å£å°±æ˜¯ç”±JVMå¯åŠ¨<code>main</code>çº¿ç¨‹ï¼Œ<code>main</code>çº¿ç¨‹åˆå¯ä»¥å¯åŠ¨å…¶ä»–çº¿ç¨‹ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸæ—¶ï¼ŒJVMé€€å‡ºï¼Œè¿›ç¨‹ç»“æŸã€‚</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰é€€å‡ºï¼ŒJVMè¿›ç¨‹å°±ä¸ä¼šé€€å‡ºã€‚æ‰€ä»¥ï¼Œå¿…é¡»ä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½åŠæ—¶ç»“æŸã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€ç§çº¿ç¨‹çš„ç›®çš„å°±æ˜¯æ— é™å¾ªç¯ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå®šæ—¶è§¦å‘ä»»åŠ¡çš„çº¿ç¨‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class TimerThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @Override</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (true) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(LocalTime.now());</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Thread.sleep(1000);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                break;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœè¿™ä¸ªçº¿ç¨‹ä¸ç»“æŸï¼ŒJVMè¿›ç¨‹å°±æ— æ³•ç»“æŸã€‚é—®é¢˜æ˜¯ï¼Œç”±è°è´Ÿè´£ç»“æŸè¿™ä¸ªçº¿ç¨‹ï¼Ÿ</p>
<p>ç„¶è€Œè¿™ç±»çº¿ç¨‹ç»å¸¸æ²¡æœ‰è´Ÿè´£äººæ¥è´Ÿè´£ç»“æŸå®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå½“å…¶ä»–çº¿ç¨‹ç»“æŸæ—¶ï¼ŒJVMè¿›ç¨‹åˆå¿…é¡»è¦ç»“æŸï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰ã€‚</p>
<p>å®ˆæŠ¤çº¿ç¨‹æ˜¯æŒ‡ä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹ã€‚åœ¨JVMä¸­ï¼Œæ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ— è®ºæœ‰æ²¡æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šè‡ªåŠ¨é€€å‡ºã€‚</p>
<p>å› æ­¤ï¼ŒJVMé€€å‡ºæ—¶ï¼Œä¸å¿…å…³å¿ƒå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦å·²ç»“æŸã€‚</p>
<p>å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹å‘¢ï¼Ÿæ–¹æ³•å’Œæ™®é€šçº¿ç¨‹ä¸€æ ·ï¼Œåªæ˜¯åœ¨è°ƒç”¨<code>start()</code>æ–¹æ³•å‰ï¼Œè°ƒç”¨<code>setDaemon(true)</code>æŠŠè¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Thread t = new MyThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.setDaemon(true);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.start();</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>åœ¨Javaä¸­ï¼Œ<code>main</code> æ–¹æ³•æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚å½“ <code>main</code> æ–¹æ³•ç»“æŸæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ï¼ˆé-daemon threadsï¼‰å¦‚æœè¿˜åœ¨è¿è¡Œï¼ŒJVM ä¼šç»§ç»­è¿è¡Œç›´åˆ°è¿™äº›éå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨ç»“æŸã€‚å®ˆæŠ¤çº¿ç¨‹ï¼ˆdaemon threadsï¼‰åˆ™ä¼šåœ¨ <code>main</code> æ–¹æ³•ç»“æŸåè¢«ç»ˆæ­¢ã€‚</p>
<p>å…³äº <code>main</code> æ–¹æ³•å’Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</p>
<ol>
<li><strong><code>main</code> æ–¹æ³•ç»“æŸ</strong>ï¼š<!-- -->
<ul>
<li>å½“ <code>main</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–éå®ˆæŠ¤çº¿ç¨‹åœ¨è¿è¡Œï¼ŒJVM ä¼šé€€å‡ºã€‚</li>
<li>å¦‚æœæœ‰å…¶ä»–éå®ˆæŠ¤çº¿ç¨‹åœ¨è¿è¡Œï¼ŒJVM ä¼šç»§ç»­è¿è¡Œç›´åˆ°è¿™äº›çº¿ç¨‹ç»“æŸã€‚</li>
</ul>
</li>
<li><strong>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadsï¼‰</strong>ï¼š<!-- -->
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸ºäº†æœåŠ¡å…¶ä»–çº¿ç¨‹è€Œå­˜åœ¨çš„ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>å½“ <code>main</code> æ–¹æ³•ç»“æŸæ—¶ï¼Œæ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹å¦‚æœå·²ç»ç»“æŸï¼ŒJVM ä¼šè‡ªåŠ¨ç»ˆæ­¢æ‰€æœ‰çš„å®ˆæŠ¤çº¿ç¨‹å¹¶é€€å‡ºã€‚</li>
</ul>
</li>
<li><strong>éå®ˆæŠ¤çº¿ç¨‹ï¼ˆNon-Daemon Threadsï¼‰</strong>ï¼š<!-- -->
<ul>
<li>éå®ˆæŠ¤çº¿ç¨‹æ˜¯ç”¨æˆ·åˆ›å»ºçš„çº¿ç¨‹ï¼Œå®ƒä»¬æ˜¯ç¨‹åºçš„ä¸»è¦å·¥ä½œçº¿ç¨‹ã€‚</li>
<li>å¦‚æœåœ¨ <code>main</code> æ–¹æ³•ä¸­åˆ›å»ºäº†éå®ˆæŠ¤çº¿ç¨‹ï¼Œå¹¶ä¸”è¿™äº›çº¿ç¨‹ä»åœ¨è¿è¡Œï¼ŒJVM ä¸ä¼šç«‹å³é€€å‡ºï¼Œè€Œæ˜¯ç­‰å¾…è¿™äº›çº¿ç¨‹è¿è¡Œç»“æŸã€‚</li>
</ul>
</li>
</ol>
<blockquote>
<p>[!warning]</p>
<p>åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­ï¼Œç¼–å†™ä»£ç è¦æ³¨æ„ï¼šå®ˆæŠ¤çº¿ç¨‹ä¸èƒ½æŒæœ‰ä»»ä½•éœ€è¦å…³é—­çš„èµ„æºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ç­‰ï¼Œå› ä¸ºè™šæ‹Ÿæœºé€€å‡ºæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å…³é—­æ–‡ä»¶ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=çº¿ç¨‹åŒæ­¥>çº¿ç¨‹åŒæ­¥<a href=#çº¿ç¨‹åŒæ­¥ class=hash-link aria-label=çº¿ç¨‹åŒæ­¥çš„ç›´æ¥é“¾æ¥ title=çº¿ç¨‹åŒæ­¥çš„ç›´æ¥é“¾æ¥>â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=åŒæ­¥æ¦‚å¿µ>åŒæ­¥æ¦‚å¿µ<a href=#åŒæ­¥æ¦‚å¿µ class=hash-link aria-label=åŒæ­¥æ¦‚å¿µçš„ç›´æ¥é“¾æ¥ title=åŒæ­¥æ¦‚å¿µçš„ç›´æ¥é“¾æ¥>â€‹</a></h3>
<p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼Œçº¿ç¨‹çš„è°ƒåº¦ç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œç¨‹åºæœ¬èº«æ— æ³•å†³å®šã€‚å› æ­¤ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å¯èƒ½åœ¨ä»»ä½•æŒ‡ä»¤å¤„è¢«æ“ä½œç³»ç»Ÿæš‚åœï¼Œç„¶ååœ¨æŸä¸ªæ—¶é—´æ®µåç»§ç»­æ‰§è¡Œã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæœ‰ä¸ªå•çº¿ç¨‹æ¨¡å‹ä¸‹ä¸å­˜åœ¨çš„é—®é¢˜å°±æ¥äº†ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™å…±äº«å˜é‡ï¼Œä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public static void main(String[] args) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    var add = new AddThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    var dec = new DecThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    dec.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add.join();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    dec.join();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    System.out.println(Counter.count);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class Counter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static int count = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class AddThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i=0; i&lt;10000; i++) { Counter.count += 1; }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class DecThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i=0; i&lt;10000; i++) { Counter.count -= 1; }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä¸Šé¢çš„ä»£ç å¾ˆç®€å•ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ª<code>int</code>å˜é‡è¿›è¡Œæ“ä½œï¼Œä¸€ä¸ªåŠ 10000æ¬¡ï¼Œä¸€ä¸ªå‡10000æ¬¡ï¼Œæœ€åç»“æœåº”è¯¥æ˜¯0ï¼Œä½†æ˜¯ï¼Œæ¯æ¬¡è¿è¡Œï¼Œç»“æœå®é™…ä¸Šéƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºå¯¹å˜é‡è¿›è¡Œè¯»å–å’Œå†™å…¥æ—¶ï¼Œç»“æœè¦æ­£ç¡®ï¼Œå¿…é¡»ä¿è¯æ˜¯åŸå­æ“ä½œã€‚åŸå­æ“ä½œæ˜¯æŒ‡ä¸èƒ½è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºè¯­å¥ï¼š<code>n = n + 1;</code></p>
<p>çœ‹ä¸Šå»æ˜¯ä¸€è¡Œè¯­å¥ï¼Œå®é™…ä¸Šå¯¹åº”äº†3æ¡æŒ‡ä»¤ï¼š<code>ILOADã€IADDã€ISTORE</code></p>
<p>æˆ‘ä»¬å‡è®¾<code>n</code>çš„å€¼æ˜¯<code>100</code>ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ<code>n = n + 1</code>ï¼Œå¾—åˆ°çš„ç»“æœå¾ˆå¯èƒ½ä¸æ˜¯<code>102</code>ï¼Œè€Œæ˜¯<code>101</code>ï¼ŒåŸå› åœ¨äºï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">â”‚Thread1â”‚     â”‚Thread2â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚ILOAD (100)  â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚ILOAD (100)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚IADD</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚ISTORE (101)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚IADD         â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚ISTORE (101) â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â–¼             â–¼</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœçº¿ç¨‹1åœ¨æ‰§è¡Œ<code>ILOAD</code>åè¢«æ“ä½œç³»ç»Ÿä¸­æ–­ï¼Œæ­¤åˆ»å¦‚æœçº¿ç¨‹2è¢«è°ƒåº¦æ‰§è¡Œï¼Œå®ƒæ‰§è¡Œ<code>ILOAD</code>åè·å–çš„å€¼ä»ç„¶æ˜¯<code>100</code>ï¼Œæœ€ç»ˆç»“æœè¢«ä¸¤ä¸ªçº¿ç¨‹çš„<code>ISTORE</code>å†™å…¥åå˜æˆäº†<code>101</code>ï¼Œè€Œä¸æ˜¯æœŸå¾…çš„<code>102</code>ã€‚</p>
<p>è¿™è¯´æ˜å¤šçº¿ç¨‹æ¨¡å‹ä¸‹ï¼Œè¦ä¿è¯é€»è¾‘æ­£ç¡®ï¼Œå¯¹å…±äº«å˜é‡è¿›è¡Œè¯»å†™æ—¶ï¼Œå¿…é¡»ä¿è¯ä¸€ç»„æŒ‡ä»¤ä»¥åŸå­æ–¹å¼æ‰§è¡Œï¼šå³æŸä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">â”‚Thread1â”‚     â”‚Thread2â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚-- lock --   â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚ILOAD (100)  â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚IADD         â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚ISTORE (101) â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚-- unlock -- â”‚</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚-- lock --</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚ILOAD (101)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚IADD</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚ISTORE (102)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â”‚             â”‚-- unlock --</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    â–¼             â–¼</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>é€šè¿‡åŠ é”å’Œè§£é”çš„æ“ä½œï¼Œå°±èƒ½ä¿è¯3æ¡æŒ‡ä»¤æ€»æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæœŸé—´ï¼Œä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹ä¼šè¿›å…¥æ­¤æŒ‡ä»¤åŒºé—´ã€‚å³ä½¿åœ¨æ‰§è¡ŒæœŸçº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿä¸­æ–­æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šå› ä¸ºæ— æ³•è·å¾—é”å¯¼è‡´æ— æ³•è¿›å…¥æ­¤æŒ‡ä»¤åŒºé—´ã€‚åªæœ‰æ‰§è¡Œçº¿ç¨‹å°†é”é‡Šæ”¾åï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å¾—é”å¹¶æ‰§è¡Œã€‚è¿™ç§åŠ é”å’Œè§£é”ä¹‹é—´çš„ä»£ç å—æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰ï¼Œä»»ä½•æ—¶å€™ä¸´ç•ŒåŒºæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œã€‚</p>
<p>å¯è§ï¼Œä¿è¯ä¸€æ®µä»£ç çš„åŸå­æ€§å°±æ˜¯é€šè¿‡åŠ é”å’Œè§£é”å®ç°çš„ã€‚Javaç¨‹åºä½¿ç”¨<code>synchronized</code>å…³é”®å­—å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”; <code>synchronized</code>ä¿è¯äº†ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç ç”¨<code>synchronized</code>æ”¹å†™å¦‚ä¸‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public static void main(String[] args) throws Exception {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    var add = new AddThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    var dec = new DecThread();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    dec.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    add.join();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    dec.join();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    System.out.println(Counter.count);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class Counter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static final Object lock = new Object();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static int count = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class AddThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i=0; i&lt;10000; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            synchronized(Counter.lock) { //è·å–é”ï¼šç›¸åŒä¸šåŠ¡éœ€è¦ä½¿ç”¨åŒä¸€æŠŠé”ï¼›</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Counter.count += 1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            } //æ— è®ºæœ‰æ— å¼‚å¸¸ï¼Œéƒ½ä¼šåœ¨æ­¤é‡Šæ”¾é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class DecThread extends Thread {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void run() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i=0; i&lt;10000; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            synchronized(Counter.lock) { //è·å–é”ï¼šç›¸åŒä¸šåŠ¡éœ€è¦ä½¿ç”¨åŒä¸€æŠŠé”ï¼›</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                Counter.count -= 1;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            } //æ— è®ºæœ‰æ— å¼‚å¸¸ï¼Œéƒ½ä¼šåœ¨æ­¤é‡Šæ”¾é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä½¿ç”¨<code>synchronized</code>è§£å†³äº†å¤šçº¿ç¨‹åŒæ­¥è®¿é—®å…±äº«å˜é‡çš„æ­£ç¡®æ€§é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯å¸¦æ¥äº†æ€§èƒ½ä¸‹é™ã€‚å› ä¸º<code>synchronized</code>ä»£ç å—æ— æ³•å¹¶å‘æ‰§è¡Œã€‚æ­¤å¤–ï¼ŒåŠ é”å’Œè§£é”éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥ï¼Œ<code>synchronized</code>ä¼šé™ä½ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<p>æ¦‚æ‹¬ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨<code>synchronized</code>ï¼š</p>
<ol>
<li>æ‰¾å‡ºä¿®æ”¹å…±äº«å˜é‡çš„çº¿ç¨‹ä»£ç å—ï¼›</li>
<li>é€‰æ‹©ä¸€ä¸ªå…±äº«å®ä¾‹ä½œä¸ºé”ï¼›</li>
<li>ä½¿ç”¨<code>synchronized(lockObject) { ... }</code>ã€‚</li>
</ol>
<p><strong>ä¸éœ€è¦synchronizedçš„æ“ä½œ</strong></p>
<p>JVMè§„èŒƒå®šä¹‰äº†å‡ ç§åŸå­æ“ä½œï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼ˆ<code>long</code>å’Œ<code>double</code>é™¤å¤–ï¼‰èµ‹å€¼ï¼Œä¾‹å¦‚ï¼š<code>int n = m</code>ï¼›</li>
<li>å¼•ç”¨ç±»å‹èµ‹å€¼ï¼Œä¾‹å¦‚ï¼š<code>List&lt;String> list = anotherList</code>ã€‚</li>
</ul>
<p><code>long</code>å’Œ<code>double</code>æ˜¯64ä½æ•°æ®ï¼ŒJVMæ²¡æœ‰æ˜ç¡®è§„å®š64ä½èµ‹å€¼æ“ä½œæ˜¯ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä¸è¿‡åœ¨x64å¹³å°çš„JVMæ˜¯æŠŠ<code>long</code>å’Œ<code>double</code>çš„èµ‹å€¼ä½œä¸ºåŸå­æ“ä½œå®ç°çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å¤šè¡Œèµ‹å€¼è¯­å¥ï¼Œå°±å¿…é¡»ä¿è¯æ˜¯åŒæ­¥æ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">int x,y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void set(int x, int y) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(this) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.x = x;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.y = y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä¸ä½†å†™éœ€è¦åŒæ­¥ï¼Œè¯»ä¹Ÿéœ€è¦åŒæ­¥ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">int x,y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void set(int x, int y) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(this) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.x = x;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.y = y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public int[] get() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    int[] copy = new int[2];</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    copy[0] = x;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    copy[1] = y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å‡å®šå½“å‰åæ ‡æ˜¯<code>(100, 200)</code>ï¼Œé‚£ä¹ˆå½“è®¾ç½®æ–°åæ ‡ä¸º<code>(110, 220)</code>æ—¶ï¼Œä¸Šè¿°æœªåŒæ­¥çš„å¤šçº¿ç¨‹è¯»åˆ°çš„å€¼å¯èƒ½æœ‰ï¼š</p>
<ul>
<li>(100, 200)ï¼šxï¼Œyæ›´æ–°å‰ï¼›</li>
<li>(110, 200)ï¼šxæ›´æ–°åï¼Œyæ›´æ–°å‰ï¼›</li>
<li>(110, 220)ï¼šxï¼Œyæ›´æ–°åã€‚</li>
</ul>
<p>å¦‚æœè¯»å–åˆ°<code>(110, 200)</code>ï¼Œå³è¯»åˆ°äº†æ›´æ–°åçš„xï¼Œæ›´æ–°å‰çš„yï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆç¨‹åºçš„é€»è¾‘é”™è¯¯ï¼Œæ— æ³•ä¿è¯è¯»å–çš„å¤šä¸ªå˜é‡çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œé€šè¿‡ä¸€äº›å·§å¦™çš„è½¬æ¢ï¼Œå¯ä»¥æŠŠéåŸå­æ“ä½œå˜ä¸ºåŸå­æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°ä»£ç å¦‚æœæ”¹é€ æˆï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">int[] ps;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void set(int x, int y) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    int[] ps = new int[] { x, y };</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    this.ps = ps;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å°±ä¸å†éœ€è¦å†™åŒæ­¥ï¼Œå› ä¸º<code>this.ps = ps</code>æ˜¯å¼•ç”¨èµ‹å€¼çš„åŸå­æ“ä½œã€‚è€Œè¯­å¥ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">int[] ps = new int[] { x, y };</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>è¿™é‡Œçš„<code>ps</code>æ˜¯æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰å„è‡ªçš„å±€éƒ¨å˜é‡ï¼Œäº’ä¸å½±å“ï¼Œå¹¶ä¸”äº’ä¸å¯è§ï¼Œå¹¶ä¸éœ€è¦åŒæ­¥ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„ï¼Œè¯»æ–¹æ³•åœ¨å¤åˆ¶<code>int[]</code>æ•°ç»„çš„è¿‡ç¨‹ä¸­ä»ç„¶éœ€è¦åŒæ­¥ã€‚</p>
<p><strong>ä¸å¯å˜å¯¹è±¡æ— éœ€åŒæ­¥</strong></p>
<p>å¦‚æœå¤šçº¿ç¨‹è¯»å†™çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼Œé‚£ä¹ˆæ— éœ€åŒæ­¥ï¼Œå› ä¸ºä¸ä¼šä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Data {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    List&lt;String> names;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    void set(String[] names) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.names = List.of(names);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    List&lt;String> get() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return this.names;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ³¨æ„åˆ°<code>set()</code>æ–¹æ³•å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªä¸å¯å˜<code>List</code>ï¼Œè¿™ä¸ª<code>List</code>åŒ…å«çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜å¯¹è±¡<code>String</code>ï¼Œå› æ­¤ï¼Œæ•´ä¸ª<code>List&lt;String></code>å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤è¯»å†™å‡æ— éœ€åŒæ­¥ã€‚</p>
<p>åˆ†æå˜é‡æ˜¯å¦èƒ½è¢«å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œé¦–å…ˆè¦ç†æ¸…æ¦‚å¿µï¼Œ<strong>å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„æ˜¯æ–¹æ³•</strong>ã€‚å¯¹äºä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Status {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    List&lt;String> names;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    int x,y;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    void set(String[] names, int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        List&lt;String> ns = List.of(names);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.names = ns;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        int step = n * 10;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.x += step;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.y += step;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    StatusRecord get() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return new StatusRecord(this.names, this.x, this.y);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœæœ‰Aã€Bä¸¤ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ‰§è¡Œæ˜¯æŒ‡ï¼š</p>
<ul>
<li>å¯èƒ½åŒæ—¶æ‰§è¡Œset()ï¼›</li>
<li>å¯èƒ½åŒæ—¶æ‰§è¡Œget()ï¼›</li>
<li>å¯èƒ½Aæ‰§è¡Œset()ï¼ŒåŒæ—¶Bæ‰§è¡Œget()ã€‚</li>
</ul>
<p>ç±»çš„æˆå‘˜å˜é‡<code>names</code>ã€<code>x</code>ã€<code>y</code>æ˜¾ç„¶èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è¯»å†™ï¼Œä½†å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬æ–¹æ³•å‚æ•°ï¼‰å¦‚æœæ²¡æœ‰â€œé€ƒé€¸â€ï¼Œé‚£ä¹ˆåªæœ‰å½“å‰çº¿ç¨‹å¯è§ã€‚å±€éƒ¨å˜é‡<code>step</code>ä»…åœ¨<code>set()</code>æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œsetæ—¶éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„stepå­˜å‚¨åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œäº’ä¸å½±å“ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡<code>ns</code>è™½ç„¶æ¯ä¸ªçº¿ç¨‹ä¹Ÿå„æœ‰ä¸€ä»½ï¼Œä½†åç»­èµ‹å€¼åå¯¹å…¶ä»–çº¿ç¨‹å°±å˜æˆå¯è§äº†ã€‚å¯¹<code>set()</code>æ–¹æ³•åŒæ­¥æ—¶ï¼Œå¦‚æœè¦æœ€å°åŒ–<code>synchronized</code>ä»£ç å—ï¼Œå¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">void set(String[] names, int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    // å±€éƒ¨å˜é‡å…¶ä»–çº¿ç¨‹ä¸å¯è§:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    List&lt;String> ns = List.of(names);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    int step = n * 10;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(this) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.names = ns;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.x += step;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.y += step;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å› æ­¤ï¼Œæ·±å…¥ç†è§£å¤šçº¿ç¨‹è¿˜éœ€ç†è§£å˜é‡åœ¨æ ˆä¸Šçš„å­˜å‚¨æ–¹å¼ï¼ŒåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å­˜å‚¨æ–¹å¼ä¹Ÿä¸åŒã€‚</p>
<blockquote>
<p>[!tip]</p>
<ul>
<li>volatileåªä¿è¯æ¯ä¸ªçº¿ç¨‹è¯»åˆ°çš„æ•°æ®æ˜¯æœ€æ–°å€¼ï¼Œä½†ä¸èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡çš„æ“ä½œçš„åŸå­çš„ã€‚</li>
<li>synchronizedå¹¶ä¸æ¶‰åŠæ•°æ®çš„åˆå§‹å€¼ï¼Œå®ƒåªä¿è¯åŒæ­¥ä»£ç å—å†…çš„ä»£ç åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</li>
<li>synchronizedèƒ½ä¿è¯å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ï¼Œæ¯æ¬¡è¿›å…¥synchronizedä¿æŠ¤çš„ä¸´ç•ŒåŒºæ—¶éƒ½ä¼šåˆ·æ–°å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œé€€å‡ºsynchronizedä¼šå°†å˜åŒ–åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚</li>
<li>å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„æ˜¯æ–¹æ³•ã€‚</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=åŒæ­¥æ–¹æ³•>åŒæ­¥æ–¹æ³•<a href=#åŒæ­¥æ–¹æ³• class=hash-link aria-label=åŒæ­¥æ–¹æ³•çš„ç›´æ¥é“¾æ¥ title=åŒæ­¥æ–¹æ³•çš„ç›´æ¥é“¾æ¥>â€‹</a></h3>
<p>æˆ‘ä»¬çŸ¥é“Javaç¨‹åºä¾é <code>synchronized</code>å¯¹çº¿ç¨‹è¿›è¡ŒåŒæ­¥ï¼Œä½¿ç”¨<code>synchronized</code>çš„æ—¶å€™ï¼Œé”ä½çš„æ˜¯å“ªä¸ªå¯¹è±¡éå¸¸é‡è¦ã€‚</p>
<p>è®©çº¿ç¨‹è‡ªå·±é€‰æ‹©é”å¯¹è±¡å¾€å¾€ä¼šä½¿å¾—ä»£ç é€»è¾‘æ··ä¹±ï¼Œä¹Ÿä¸åˆ©äºå°è£…ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æŠŠ<code>synchronized</code>é€»è¾‘å°è£…èµ·æ¥ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public class Counter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private int count = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void add(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(this) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            count += n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public void dec(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(this) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            count -= n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public int get() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return count;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>è¿™æ ·ä¸€æ¥ï¼Œçº¿ç¨‹è°ƒç”¨<code>add()</code>ã€<code>dec()</code>æ–¹æ³•æ—¶ï¼Œå®ƒä¸å¿…å…³å¿ƒåŒæ­¥é€»è¾‘ï¼Œå› ä¸º<code>synchronized</code>ä»£ç å—åœ¨<code>add()</code>ã€<code>dec()</code>æ–¹æ³•å†…éƒ¨ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ<code>synchronized</code>é”ä½çš„å¯¹è±¡æ˜¯<code>this</code>ï¼Œå³å½“å‰å®ä¾‹ï¼Œè¿™åˆä½¿å¾—åˆ›å»ºå¤šä¸ª<code>Counter</code>å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">var c1 = Counter();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">var c2 = Counter();</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">// å¯¹c1è¿›è¡Œæ“ä½œçš„çº¿ç¨‹:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    c1.add();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}).start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    c1.dec();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}).start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">// å¯¹c2è¿›è¡Œæ“ä½œçš„çº¿ç¨‹:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    c2.add();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}).start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    c2.dec();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}).start();</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœä¸€ä¸ªç±»è¢«è®¾è®¡ä¸ºå…è®¸å¤šçº¿ç¨‹æ­£ç¡®è®¿é—®ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªç±»å°±æ˜¯â€œçº¿ç¨‹å®‰å…¨â€çš„ï¼ˆthread-safeï¼‰ï¼Œä¸Šé¢çš„<code>Counter</code>ç±»å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚Javaæ ‡å‡†åº“çš„<code>java.lang.StringBuffer</code>ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›ä¸å˜ç±»ï¼Œä¾‹å¦‚<code>String</code>ï¼Œ<code>Integer</code>ï¼Œ<code>LocalDate</code>ï¼Œå®ƒä»¬çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯<code>final</code>ï¼Œå¤šçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼Œè¿™äº›ä¸å˜ç±»ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>æœ€åï¼Œç±»ä¼¼<code>Math</code>è¿™äº›åªæä¾›é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰æˆå‘˜å˜é‡çš„ç±»ï¼Œä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>é™¤äº†ä¸Šè¿°å‡ ç§å°‘æ•°æƒ…å†µï¼Œå¤§éƒ¨åˆ†ç±»ï¼Œä¾‹å¦‚<code>ArrayList</code>ï¼Œéƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸­ä¿®æ”¹å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åªè¯»å–ï¼Œä¸å†™å…¥ï¼Œé‚£ä¹ˆ<code>ArrayList</code>æ˜¯å¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´å…±äº«çš„ã€‚</p>
<p>å½“æˆ‘ä»¬é”ä½çš„æ˜¯<code>this</code>å®ä¾‹æ—¶ï¼Œå®é™…ä¸Šå¯ä»¥ç”¨<code>synchronized</code>ä¿®é¥°è¿™ä¸ªæ–¹æ³•ã€‚ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">//å†™æ³•ä¸€ï¼š</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void add(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(this) { // é”ä½this</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        count += n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    } // è§£é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">//å†™æ³•äºŒï¼š</span><br></span><span class=token-line style=color:#393A34><span class="token plain">public synchronized void add(int n) { // é”ä½this</span><br></span><span class=token-line style=color:#393A34><span class="token plain">	count += n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">} // è§£é”</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å› æ­¤ï¼Œç”¨<code>synchronized</code>ä¿®é¥°çš„æ–¹æ³•å°±æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå®ƒè¡¨ç¤ºæ•´ä¸ªæ–¹æ³•éƒ½å¿…é¡»ç”¨<code>this</code>å®ä¾‹åŠ é”ã€‚</p>
<p>æˆ‘ä»¬å†æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœå¯¹ä¸€ä¸ªé™æ€æ–¹æ³•æ·»åŠ <code>synchronized</code>ä¿®é¥°ç¬¦ï¼Œå®ƒé”ä½çš„æ˜¯å“ªä¸ªå¯¹è±¡ï¼Ÿ</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public synchronized static void test(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¯¹äº<code>static</code>æ–¹æ³•ï¼Œæ˜¯æ²¡æœ‰<code>this</code>å®ä¾‹çš„ï¼Œå› ä¸º<code>static</code>æ–¹æ³•æ˜¯é’ˆå¯¹ç±»è€Œä¸æ˜¯å®ä¾‹ã€‚ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ä»»ä½•ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªç”±JVMè‡ªåŠ¨åˆ›å»ºçš„<code>Class</code>å®ä¾‹ï¼Œå› æ­¤ï¼Œå¯¹<code>static</code>æ–¹æ³•æ·»åŠ <code>synchronized</code>ï¼Œé”ä½çš„æ˜¯è¯¥ç±»çš„<code>Class</code>å®ä¾‹ã€‚ä¸Šè¿°<code>synchronized static</code>æ–¹æ³•å®é™…ä¸Šç›¸å½“äºï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public class Counter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void test(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(Counter.class) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=æ­»é”>æ­»é”<a href=#æ­»é” class=hash-link aria-label=æ­»é”çš„ç›´æ¥é“¾æ¥ title=æ­»é”çš„ç›´æ¥é“¾æ¥>â€‹</a></h3>
<p><strong>å¯é‡å…¥é”</strong></p>
<p>Javaçš„çº¿ç¨‹é”æ˜¯å¯é‡å…¥çš„é”ã€‚ä»€ä¹ˆæ˜¯å¯é‡å…¥çš„é”ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¾‹å­ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public class Counter {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private int count = 0;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized void add(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        if (n &lt; 0) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            dec(-n);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } else {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            count += n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized void dec(int n) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        count += n;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>è§‚å¯Ÿ<code>synchronized</code>ä¿®é¥°çš„<code>add()</code>æ–¹æ³•ï¼Œä¸€æ—¦çº¿ç¨‹æ‰§è¡Œåˆ°<code>add()</code>æ–¹æ³•å†…éƒ¨ï¼Œè¯´æ˜å®ƒå·²ç»è·å–äº†å½“å‰å®ä¾‹çš„<code>this</code>é”ã€‚å¦‚æœä¼ å…¥çš„<code>n &lt; 0</code>ï¼Œå°†åœ¨<code>add()</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨<code>dec()</code>æ–¹æ³•ã€‚ç”±äº<code>dec()</code>æ–¹æ³•ä¹Ÿéœ€è¦è·å–<code>this</code>é”ï¼Œç°åœ¨é—®é¢˜æ¥äº†ï¼š</p>
<p>å¯¹åŒä¸€ä¸ªçº¿ç¨‹ï¼Œèƒ½å¦åœ¨è·å–åˆ°é”ä»¥åç»§ç»­è·å–åŒä¸€ä¸ªé”ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚JVMå…è®¸åŒä¸€ä¸ªçº¿ç¨‹é‡å¤è·å–åŒä¸€ä¸ªé”ï¼Œè¿™ç§èƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹åå¤è·å–çš„é”ï¼Œå°±å«åš<strong>å¯é‡å…¥é”</strong>ã€‚</p>
<p>ç”±äºJavaçš„çº¿ç¨‹é”æ˜¯å¯é‡å…¥é”ï¼Œæ‰€ä»¥ï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¸ä½†è¦åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è·å–ï¼Œè¿˜è¦è®°å½•è¿™æ˜¯ç¬¬å‡ æ¬¡è·å–ã€‚æ¯è·å–ä¸€æ¬¡é”ï¼Œè®°å½•+1ï¼Œæ¯é€€å‡º<code>synchronized</code>å—ï¼Œè®°å½•-1ï¼Œå‡åˆ°0çš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚</p>
<p><strong>æ­»é”</strong></p>
<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–ä¸€ä¸ªé”åï¼Œå†ç»§ç»­è·å–å¦ä¸€ä¸ªé”ã€‚ä¾‹å¦‚ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public void add(int m) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(lockA) { // è·å¾—lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.value += m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(lockB) { // è·å¾—lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            this.another += m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } // é‡Šæ”¾lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    } // é‡Šæ”¾lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">public void dec(int m) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(lockB) { // è·å¾—lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.another -= m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(lockA) { // è·å¾—lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            this.value -= m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } // é‡Šæ”¾lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    } // é‡Šæ”¾lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>åœ¨è·å–å¤šä¸ªé”çš„æ—¶å€™ï¼Œä¸åŒçº¿ç¨‹è·å–å¤šä¸ªä¸åŒå¯¹è±¡çš„é”å¯èƒ½å¯¼è‡´æ­»é”ã€‚å¯¹äºä¸Šè¿°ä»£ç ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2å¦‚æœåˆ†åˆ«æ‰§è¡Œ<code>add()</code>å’Œ<code>dec()</code>æ–¹æ³•æ—¶ï¼š</p>
<ul>
<li>çº¿ç¨‹1ï¼šè¿›å…¥<code>add()</code>ï¼Œè·å¾—<code>lockA</code>ï¼›</li>
<li>çº¿ç¨‹2ï¼šè¿›å…¥<code>dec()</code>ï¼Œè·å¾—<code>lockB</code>ã€‚</li>
</ul>
<p>éšåï¼š</p>
<ul>
<li>çº¿ç¨‹1ï¼šå‡†å¤‡è·å¾—<code>lockB</code>ï¼Œå¤±è´¥ï¼Œç­‰å¾…ä¸­ï¼›</li>
<li>çº¿ç¨‹2ï¼šå‡†å¤‡è·å¾—<code>lockA</code>ï¼Œå¤±è´¥ï¼Œç­‰å¾…ä¸­ã€‚</li>
</ul>
<p>æ­¤æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹å„è‡ªæŒæœ‰ä¸åŒçš„é”ï¼Œç„¶åå„è‡ªè¯•å›¾è·å–å¯¹æ–¹æ‰‹é‡Œçš„é”ï¼Œé€ æˆäº†åŒæ–¹æ— é™ç­‰å¾…ä¸‹å»ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚</p>
<p>æ­»é”å‘ç”Ÿåï¼Œæ²¡æœ‰ä»»ä½•æœºåˆ¶èƒ½è§£é™¤æ­»é”ï¼Œåªèƒ½å¼ºåˆ¶ç»“æŸJVMè¿›ç¨‹ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ç¼–å†™å¤šçº¿ç¨‹åº”ç”¨æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„é˜²æ­¢æ­»é”ã€‚å› ä¸ºæ­»é”ä¸€æ—¦å½¢æˆï¼Œå°±åªèƒ½å¼ºåˆ¶ç»“æŸè¿›ç¨‹ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•é¿å…æ­»é”å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šçº¿ç¨‹è·å–é”çš„é¡ºåºè¦ä¸€è‡´ã€‚å³ä¸¥æ ¼æŒ‰ç…§å…ˆè·å–<code>lockA</code>ï¼Œå†è·å–<code>lockB</code>çš„é¡ºåºï¼Œæ”¹å†™<code>dec()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public void dec(int m) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    synchronized(lockA) { // è·å¾—lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.value -= m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        synchronized(lockB) { // è·å¾—lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            this.another -= m;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        } // é‡Šæ”¾lockBçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    } // é‡Šæ”¾lockAçš„é”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=ä½¿ç”¨waitå’Œnotify>ä½¿ç”¨waitå’Œnotify<a href=#ä½¿ç”¨waitå’Œnotify class=hash-link aria-label=ä½¿ç”¨waitå’Œnotifyçš„ç›´æ¥é“¾æ¥ title=ä½¿ç”¨waitå’Œnotifyçš„ç›´æ¥é“¾æ¥>â€‹</a></h3>
<p>åœ¨Javaç¨‹åºä¸­ï¼Œ<code>synchronized</code>è§£å†³äº†å¤šçº¿ç¨‹ç«äº‰çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¯ä»¥ç”¨<code>synchronized</code>åŠ é”ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class TaskQueue {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Queue&lt;String> queue = new LinkedList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized void addTask(String s) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.queue.add(s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä½†æ˜¯<code>synchronized</code>å¹¶æ²¡æœ‰è§£å†³å¤šçº¿ç¨‹åè°ƒçš„é—®é¢˜ã€‚</p>
<p>ä»ç„¶ä»¥ä¸Šé¢çš„<code>TaskQueue</code>ä¸ºä¾‹ï¼Œæˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ª<code>getTask()</code>æ–¹æ³•å–å‡ºé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class TaskQueue {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Queue&lt;String> queue = new LinkedList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized void addTask(String s) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.queue.add(s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized String getTask() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (queue.isEmpty()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return queue.remove();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä¸Šè¿°ä»£ç çœ‹ä¸Šå»æ²¡æœ‰é—®é¢˜ï¼š<code>getTask()</code>å†…éƒ¨å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œå°±å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œ<code>while()</code>å¾ªç¯é€€å‡ºï¼Œå°±å¯ä»¥è¿”å›é˜Ÿåˆ—çš„å…ƒç´ äº†ã€‚</p>
<p>ä½†å®é™…ä¸Š<code>while()</code>å¾ªç¯æ°¸è¿œä¸ä¼šé€€å‡ºã€‚å› ä¸ºçº¿ç¨‹åœ¨æ‰§è¡Œ<code>while()</code>å¾ªç¯æ—¶ï¼Œå·²ç»åœ¨<code>getTask()</code>å…¥å£è·å–äº†<code>this</code>é”ï¼Œå…¶ä»–çº¿ç¨‹æ ¹æœ¬æ— æ³•è°ƒç”¨<code>addTask()</code>ï¼Œå› ä¸º<code>addTask()</code>æ‰§è¡Œæ¡ä»¶ä¹Ÿæ˜¯è·å–<code>this</code>é”ã€‚å› æ­¤ï¼Œæ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œçº¿ç¨‹ä¼šåœ¨<code>getTask()</code>ä¸­å› ä¸ºæ­»å¾ªç¯è€Œ100%å ç”¨CPUèµ„æºã€‚</p>
<p>å¦‚æœæ·±å…¥æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ‰§è¡Œæ•ˆæœæ˜¯ï¼š</p>
<ul>
<li>çº¿ç¨‹1å¯ä»¥è°ƒç”¨<code>addTask()</code>ä¸æ–­å¾€é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼›</li>
<li>çº¿ç¨‹2å¯ä»¥è°ƒç”¨<code>getTask()</code>ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™<code>getTask()</code>åº”è¯¥ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä»»åŠ¡æ—¶å†è¿”å›ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå¤šçº¿ç¨‹åè°ƒè¿è¡Œçš„åŸåˆ™å°±æ˜¯ï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>å¯¹äºä¸Šè¿°<code>TaskQueue</code>ï¼Œæˆ‘ä»¬å…ˆæ”¹é€ <code>getTask()</code>æ–¹æ³•ï¼Œåœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public synchronized String getTask() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    while (queue.isEmpty()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.wait();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return queue.remove();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°<code>getTask()</code>æ–¹æ³•å†…éƒ¨çš„<code>while</code>å¾ªç¯æ—¶ï¼Œå®ƒå¿…å®šå·²ç»è·å–åˆ°äº†<code>this</code>é”ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œ<code>while</code>æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œçº¿ç¨‹å°†æ‰§è¡Œ<code>this.wait()</code>ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼š<code>wait()</code>æ–¹æ³•å¿…é¡»åœ¨å½“å‰è·å–çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œè¿™é‡Œè·å–çš„æ˜¯<code>this</code>é”ï¼Œå› æ­¤è°ƒç”¨<code>this.wait()</code>ã€‚</p>
<p>è°ƒç”¨<code>wait()</code>æ–¹æ³•åï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ<code>wait()</code>æ–¹æ³•ä¸ä¼šè¿”å›ï¼Œç›´åˆ°å°†æ¥æŸä¸ªæ—¶åˆ»ï¼Œçº¿ç¨‹ä»ç­‰å¾…çŠ¶æ€è¢«å…¶ä»–çº¿ç¨‹å”¤é†’åï¼Œ<code>wait()</code>æ–¹æ³•æ‰ä¼šè¿”å›ï¼Œ<strong>ç„¶åï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥</strong>ã€‚</p>
<p>æœ‰äº›ä»”ç»†çš„ç«¥é‹ä¼šæŒ‡å‡ºï¼šå³ä½¿çº¿ç¨‹åœ¨<code>getTask()</code>å†…éƒ¨ç­‰å¾…ï¼Œå…¶ä»–çº¿ç¨‹å¦‚æœæ‹¿ä¸åˆ°<code>this</code>é”ï¼Œç…§æ ·æ— æ³•æ‰§è¡Œ<code>addTask()</code>ï¼Œè‚¿ä¹ˆåŠï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜çš„å…³é”®å°±åœ¨äº<code>wait()</code>æ–¹æ³•çš„æ‰§è¡Œæœºåˆ¶éå¸¸å¤æ‚ã€‚é¦–å…ˆï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaæ–¹æ³•ï¼Œè€Œæ˜¯å®šä¹‰åœ¨<code>Object</code>ç±»çš„ä¸€ä¸ª<code>native</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”±JVMçš„Cä»£ç å®ç°çš„ã€‚å…¶æ¬¡ï¼Œå¿…é¡»åœ¨<code>synchronized</code>å—ä¸­æ‰èƒ½è°ƒç”¨<code>wait()</code>æ–¹æ³•ï¼Œå› ä¸º<code>wait()</code>æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼š<em>é‡Šæ”¾</em>çº¿ç¨‹è·å¾—çš„é”ï¼Œ<code>wait()</code>æ–¹æ³•è¿”å›æ—¶ï¼Œçº¿ç¨‹åˆä¼šé‡æ–°è¯•å›¾è·å¾—é”ã€‚</p>
<p>å› æ­¤ï¼Œåªèƒ½åœ¨é”å¯¹è±¡ä¸Šè°ƒç”¨<code>wait()</code>æ–¹æ³•ã€‚å› ä¸ºåœ¨<code>getTask()</code>ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº†<code>this</code>é”ï¼Œå› æ­¤ï¼Œåªèƒ½åœ¨<code>this</code>å¯¹è±¡ä¸Šè°ƒç”¨<code>wait()</code>æ–¹æ³•ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public synchronized String getTask() {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    while (queue.isEmpty()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        // é‡Šæ”¾thisé”:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.wait();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        // é‡æ–°è·å–thisé”</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return queue.remove();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å½“ä¸€ä¸ªçº¿ç¨‹åœ¨<code>this.wait()</code>ç­‰å¾…æ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾<code>this</code>é”ï¼Œä»è€Œä½¿å¾—å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿåœ¨<code>addTask()</code>æ–¹æ³•è·å¾—<code>this</code>é”ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬é¢ä¸´ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•è®©ç­‰å¾…çš„çº¿ç¨‹è¢«é‡æ–°å”¤é†’ï¼Œç„¶åä»<code>wait()</code>æ–¹æ³•è¿”å›ï¼Ÿç­”æ¡ˆæ˜¯åœ¨ç›¸åŒçš„é”å¯¹è±¡ä¸Šè°ƒç”¨<code>notify()</code>æ–¹æ³•ã€‚æˆ‘ä»¬ä¿®æ”¹<code>addTask()</code>å¦‚ä¸‹ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public synchronized void addTask(String s) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    this.queue.add(s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    this.notify(); // å”¤é†’åœ¨thisé”ç­‰å¾…çš„çº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æ³¨æ„åˆ°åœ¨å¾€é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä»»åŠ¡åï¼Œçº¿ç¨‹ç«‹åˆ»å¯¹<code>this</code>é”å¯¹è±¡è°ƒç”¨<code>notify()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå”¤é†’ä¸€ä¸ªæ­£åœ¨<code>this</code>é”ç­‰å¾…çš„çº¿ç¨‹ï¼ˆå°±æ˜¯åœ¨<code>getTask()</code>ä¸­ä½äº<code>this.wait()</code>çš„çº¿ç¨‹ï¼‰ï¼Œä»è€Œä½¿å¾—ç­‰å¾…çº¿ç¨‹ä»<code>this.wait()</code>æ–¹æ³•è¿”å›ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public class WaitNotifyTest {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public static void main(String[] args) throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        TaskQueue q = new TaskQueue();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        List&lt;Thread> ts = new ArrayList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (int i = 0; i &lt; 5; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            Thread t = new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                // æ‰§è¡Œtask:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                while (true) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        String s = q.getTask();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        System.out.println("execute task: " + s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        System.out.println("interrupt thread!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                        return;</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            });</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            t.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            ts.add(t);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread add = new Thread(() -> {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            for (int i = 0; i &lt; 10; i++) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                // æ”¾å…¥task:</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                String s = "t-i" + i + "-" + new Random().nextInt(100);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                System.out.println("add task: " + s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                q.addTask(s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                try {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    Thread.sleep(100);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                } catch (InterruptedException e) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                    System.out.println("e = " + e);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        });</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        add.start();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        add.join();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        Thread.sleep(100);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        for (Thread t : ts) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            t.interrupt(); //ä¸­æ–­æ­£åœ¨waitçš„çº¿ç¨‹</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class TaskQueue {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    Queue&lt;String> queue = new LinkedList&lt;>();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized void addTask(String s) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.queue.add(s);</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.notifyAll();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public synchronized String getTask() throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        while (queue.isEmpty()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            System.out.println(Thread.currentThread().getName() + " queue continue wait!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            this.wait();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        System.out.println(Thread.currentThread().getName() + " queue is notify!");</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        return queue.remove();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨<code>addTask()</code>æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨äº†<code>this.notifyAll()</code>è€Œä¸æ˜¯<code>this.notify()</code>ï¼Œä½¿ç”¨<code>notifyAll()</code>å°†å”¤é†’æ‰€æœ‰å½“å‰æ­£åœ¨<code>this</code>é”ç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œ<code>notify()</code>åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªï¼ˆå…·ä½“å“ªä¸ªä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸€å®šçš„éšæœºæ€§ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨<code>getTask()</code>æ–¹æ³•å†…éƒ¨çš„<code>wait()</code>ä¸­ç­‰å¾…ï¼Œä½¿ç”¨<code>notifyAll()</code>å°†ä¸€æ¬¡æ€§å…¨éƒ¨å”¤é†’ã€‚é€šå¸¸æ¥è¯´ï¼Œ<code>notifyAll()</code>æ›´å®‰å…¨ã€‚æœ‰äº›æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç é€»è¾‘è€ƒè™‘ä¸å‘¨ï¼Œç”¨<code>notify()</code>ä¼šå¯¼è‡´åªå”¤é†’äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹å¯èƒ½æ°¸è¿œç­‰å¾…ä¸‹å»é†’ä¸è¿‡æ¥äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ³¨æ„åˆ°<code>wait()</code>æ–¹æ³•è¿”å›æ—¶éœ€è¦<em>é‡æ–°</em>è·å¾—<code>this</code>é”ã€‚å‡è®¾å½“å‰æœ‰3ä¸ªçº¿ç¨‹è¢«å”¤é†’ï¼Œå”¤é†’åï¼Œé¦–å…ˆè¦ç­‰å¾…æ‰§è¡Œ<code>addTask()</code>çš„çº¿ç¨‹ç»“æŸæ­¤æ–¹æ³•åï¼Œæ‰èƒ½é‡Šæ”¾<code>this</code>é”ï¼Œéšåï¼Œè¿™3ä¸ªçº¿ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªè·å–åˆ°<code>this</code>é”ï¼Œå‰©ä¸‹ä¸¤ä¸ªå°†ç»§ç»­ç­‰å¾…ã€‚</p>
<p>å†æ³¨æ„åˆ°æˆ‘ä»¬åœ¨<code>while()</code>å¾ªç¯ä¸­è°ƒç”¨<code>wait()</code>ï¼Œè€Œä¸æ˜¯<code>if</code>è¯­å¥ï¼š</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-java codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">public synchronized String getTask() throws InterruptedException {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    if (queue.isEmpty()) {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        this.wait();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    return queue.remove();</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ title=å¤åˆ¶ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¦‚æœæ˜¯ç”¨whileä½œåˆ¤æ–­ï¼Œæ¯æ¬¡waitè¢«notifyå”¤é†’åï¼Œä¼šç»§ç»­å¾ªç¯ï¼Œåˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œè€Œifåšåˆ¤æ–­æ—¶ï¼Œå¦‚æœwaitè¢«å”¤é†’ï¼Œæ­¤æ—¶ifå·²ç»è¢«åˆ¤æ–­è¿‡äº†ï¼Œå°±ä¼šç›´æ¥ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œè·å–é˜Ÿåˆ—å…ƒç´ ï¼Œæ­¤æ—¶å¦‚æœé˜Ÿåˆ—å…ƒç´ ä¸ºç©ºï¼ˆå› ä¸ºæ˜¯ä¸€å£æ°”å”¤é†’æ‰€æœ‰è¿›ç¨‹ï¼Œä½ æ— æ³•ä¿è¯ç°åœ¨è¿™ä¸ªè¿›ç¨‹æ‰§è¡Œçš„æ—¶å€™ï¼Œé˜Ÿåˆ—è¿˜æœ‰æ²¡æœ‰ä¸œè¥¿ï¼‰ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±æŠ¥nosuchelement exceptionã€‚</p>
<blockquote>
<p>[!tip]</p>
<ul>
<li>å·²å”¤é†’çš„çº¿ç¨‹è¿˜éœ€è¦é‡æ–°è·å¾—é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œ</li>
</ul>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=ä½¿ç”¨reentrantlock>ä½¿ç”¨ReentrantLock<a href=#ä½¿ç”¨reentrantlock class=hash-link aria-label=ä½¿ç”¨ReentrantLockçš„ç›´æ¥é“¾æ¥ title=ä½¿ç”¨ReentrantLockçš„ç›´æ¥é“¾æ¥>â€‹</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.dev/mhuahe/mhuahe.com/blob/master-ts/docs/java/JAVA-Thread.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>æœ€å<!-- -->ç”± <b>heminhua</b> <!-- -->äº <b><time datetime=2024-09-03T17:00:06.000Z itemprop=dateModified>2024å¹´9æœˆ3æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=æ–‡ä»¶é€‰é¡¹å¡><a class="pagination-nav__link pagination-nav__link--prev" href=/mhuahe.com/docs/java/JAVA-SpringCloud-Stack><div class=pagination-nav__sublabel>ä¸Šä¸€é¡µ</div><div class=pagination-nav__label>JAVA-SpringCloudæŠ€æœ¯æ ˆ</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/mhuahe.com/docs/java/JAVA-WebSocket><div class=pagination-nav__sublabel>ä¸‹ä¸€é¡µ</div><div class=pagination-nav__label>JAVA-WebSocket</div></a></nav><div id=disqus_thread></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#å¤šçº¿ç¨‹åŸºç¡€ class="table-of-contents__link toc-highlight">å¤šçº¿ç¨‹åŸºç¡€</a><li><a href=#åˆ›å»ºæ–°çº¿ç¨‹ class="table-of-contents__link toc-highlight">åˆ›å»ºæ–°çº¿ç¨‹</a><li><a href=#çº¿ç¨‹çŠ¶æ€ class="table-of-contents__link toc-highlight">çº¿ç¨‹çŠ¶æ€</a><li><a href=#ä¸­æ–­çº¿ç¨‹ class="table-of-contents__link toc-highlight">ä¸­æ–­çº¿ç¨‹</a><li><a href=#å®ˆæŠ¤çº¿ç¨‹ class="table-of-contents__link toc-highlight">å®ˆæŠ¤çº¿ç¨‹</a><li><a href=#çº¿ç¨‹åŒæ­¥ class="table-of-contents__link toc-highlight">çº¿ç¨‹åŒæ­¥</a><ul><li><a href=#åŒæ­¥æ¦‚å¿µ class="table-of-contents__link toc-highlight">åŒæ­¥æ¦‚å¿µ</a><li><a href=#åŒæ­¥æ–¹æ³• class="table-of-contents__link toc-highlight">åŒæ­¥æ–¹æ³•</a><li><a href=#æ­»é” class="table-of-contents__link toc-highlight">æ­»é”</a><li><a href=#ä½¿ç”¨waitå’Œnotify class="table-of-contents__link toc-highlight">ä½¿ç”¨waitå’Œnotify</a></ul><li><a href=#ä½¿ç”¨reentrantlock class="table-of-contents__link toc-highlight">ä½¿ç”¨ReentrantLock</a></ul></div></div></div></div></main></div></div></div><footer class=footer><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Â© 2024 mhuahe. Built with <a href=https://docusaurus.io/ target=_blank>Docusaurus</a>.</div></div></div></footer></div>