"use strict";(self.webpackChunkmhuahe_com=self.webpackChunkmhuahe_com||[]).push([[9049],{9486:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var a=n(4848),i=n(8453);const t={},s="JAVA-SpringCloud\u6280\u672f\u6808",l={id:"java/JAVA-SpringCloud-Stack",title:"JAVA-SpringCloud\u6280\u672f\u6808",description:"cloud-eureka",source:"@site/docs/java/JAVA-SpringCloud-Stack.md",sourceDirName:"java",slug:"/java/JAVA-SpringCloud-Stack",permalink:"/mhuahe.com/docs/java/JAVA-SpringCloud-Stack",draft:!1,unlisted:!1,editUrl:"https://github.com/mhuahe/mhuahe.com/tree/master/docs/java/JAVA-SpringCloud-Stack.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"JAVA-SpringBoot\u7248\u672c",permalink:"/mhuahe.com/docs/java/JAVA-SpringBoot-Version"},next:{title:"JAVA-\u591a\u7ebf\u7a0b",permalink:"/mhuahe.com/docs/java/JAVA-Thread"}},o={},c=[{value:"cloud-eureka",id:"cloud-eureka",level:4},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:5},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef",level:5},{value:"\u96c6\u7fa4",id:"\u96c6\u7fa4",level:5},{value:"\u6dfb\u52a0\u8ba4\u8bc1",id:"\u6dfb\u52a0\u8ba4\u8bc1",level:5},{value:"Eureka\u7684\u5e38\u7528\u914d\u7f6e",id:"eureka\u7684\u5e38\u7528\u914d\u7f6e",level:5},{value:"cloud-ribbon",id:"cloud-ribbon",level:4},{value:"\u5ba2\u6237\u7aef1",id:"\u5ba2\u6237\u7aef1",level:5},{value:"ribbon\u8d1f\u8f7d\u5ba2\u6237\u7aef",id:"ribbon\u8d1f\u8f7d\u5ba2\u6237\u7aef",level:5},{value:"\u8d1f\u8f7d\u914d\u7f6e",id:"\u8d1f\u8f7d\u914d\u7f6e",level:6},{value:"\u8c03\u7528\u5ba2\u6237\u7aef",id:"\u8c03\u7528\u5ba2\u6237\u7aef",level:6},{value:"\u6f14\u793a",id:"\u6f14\u793a",level:5},{value:"ribbon\u5e38\u7528\u914d\u7f6e",id:"ribbon\u5e38\u7528\u914d\u7f6e",level:5},{value:"cloud-hystrix",id:"cloud-hystrix",level:4},{value:"\u670d\u52a1\u964d\u7ea7",id:"\u670d\u52a1\u964d\u7ea7",level:5},{value:"@HystrixCommand\u5e38\u7528\u53c2\u6570",id:"hystrixcommand\u5e38\u7528\u53c2\u6570",level:6},{value:"\u8bf7\u6c42\u7f13\u5b58",id:"\u8bf7\u6c42\u7f13\u5b58",level:5},{value:"\u76f8\u5173\u6ce8\u89e3",id:"\u76f8\u5173\u6ce8\u89e3",level:6},{value:"\u8bf7\u6c42\u5408\u5e76",id:"\u8bf7\u6c42\u5408\u5e76",level:5},{value:"@HystrixCollapser\u7684\u5e38\u7528\u5c5e\u6027",id:"hystrixcollapser\u7684\u5e38\u7528\u5c5e\u6027",level:6},{value:"Hystrix\u7684\u5e38\u7528\u914d\u7f6e",id:"hystrix\u7684\u5e38\u7528\u914d\u7f6e",level:5},{value:"\u5168\u5c40\u914d\u7f6e",id:"\u5168\u5c40\u914d\u7f6e",level:6},{value:"\u5b9e\u4f8b\u914d\u7f6e",id:"\u5b9e\u4f8b\u914d\u7f6e",level:6},{value:"cloud-feign",id:"cloud-feign",level:4},{value:"feign\u63a5\u53e3",id:"feign\u63a5\u53e3",level:5},{value:"\u65e5\u5fd7\u6253\u5370",id:"\u65e5\u5fd7\u6253\u5370",level:5},{value:"cloud-zuul",id:"cloud-zuul",level:4},{value:"\u8bf7\u6c42\u8def\u7531",id:"\u8bf7\u6c42\u8def\u7531",level:5},{value:"\u67e5\u770b\u8def\u7531\u4fe1\u606f",id:"\u67e5\u770b\u8def\u7531\u4fe1\u606f",level:5},{value:"\u8fc7\u6ee4\u5668",id:"\u8fc7\u6ee4\u5668",level:5},{value:"cloud-config",id:"cloud-config",level:4},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-1",level:5},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-1",level:5},{value:"\u5237\u65b0\u914d\u7f6e",id:"\u5237\u65b0\u914d\u7f6e",level:5},{value:"\u5b89\u5168\u8ba4\u8bc1",id:"\u5b89\u5168\u8ba4\u8bc1",level:5},{value:"\u96c6\u7fa4\u642d\u5efa",id:"\u96c6\u7fa4\u642d\u5efa",level:5},{value:"cloud-bus",id:"cloud-bus",level:4},{value:"\u52a8\u6001\u5237\u65b0\u914d\u7f6e",id:"\u52a8\u6001\u5237\u65b0\u914d\u7f6e",level:5},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-2",level:6},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-2",level:6},{value:"\u6f14\u793a",id:"\u6f14\u793a-1",level:6},{value:"\u914d\u5408WebHooks\u4f7f\u7528",id:"\u914d\u5408webhooks\u4f7f\u7528",level:6},{value:"cloud-sleuth",id:"cloud-sleuth",level:4},{value:"zipkin\u65e5\u5fd7",id:"zipkin\u65e5\u5fd7",level:5},{value:"Elasticsearch\u5b58\u50a8\u65e5\u5fd7",id:"elasticsearch\u5b58\u50a8\u65e5\u5fd7",level:5},{value:"cloud-consul",id:"cloud-consul",level:4},{value:"\u6ce8\u518c\u4e2d\u5fc3",id:"\u6ce8\u518c\u4e2d\u5fc3",level:5},{value:"\u5ba2\u6237\u7aef\u8d1f\u8f7d",id:"\u5ba2\u6237\u7aef\u8d1f\u8f7d",level:6},{value:"\u914d\u7f6e\u4e2d\u5fc3",id:"\u914d\u7f6e\u4e2d\u5fc3",level:5},{value:"cloud-gateway",id:"cloud-gateway",level:4},{value:"\u8fc7\u6ee4\u5668",id:"\u8fc7\u6ee4\u5668-1",level:5},{value:"\u76d1\u63a7\u8bf7\u6c42",id:"\u76d1\u63a7\u8bf7\u6c42",level:5},{value:"\u5de5\u4f5c\u539f\u7406",id:"\u5de5\u4f5c\u539f\u7406",level:5},{value:"cloud-nacos",id:"cloud-nacos",level:4},{value:"\u6ce8\u518c\u4e2d\u5fc3",id:"\u6ce8\u518c\u4e2d\u5fc3-1",level:5},{value:"\u914d\u7f6e\u4e2d\u5fc3",id:"\u914d\u7f6e\u4e2d\u5fc3-1",level:5},{value:"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u987a\u5e8f",id:"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u987a\u5e8f",level:6},{value:"cloud-sentinel",id:"cloud-sentinel",level:4},{value:"\u9650\u6d41",id:"\u9650\u6d41",level:5},{value:"\u6839\u636e\u8d44\u6e90\u540d\u79f0\u9650\u6d41",id:"\u6839\u636e\u8d44\u6e90\u540d\u79f0\u9650\u6d41",level:6},{value:"\u6839\u636eURL\u9650\u6d41",id:"\u6839\u636eurl\u9650\u6d41",level:6},{value:"\u7194\u65ad\u529f\u80fd",id:"\u7194\u65ad\u529f\u80fd",level:5},{value:"RestTemplate\u8c03\u7528\u65b9\u5f0f",id:"resttemplate\u8c03\u7528\u65b9\u5f0f",level:6},{value:"feign\u8c03\u7528\u65b9\u5f0f",id:"feign\u8c03\u7528\u65b9\u5f0f",level:6},{value:"cloud-seata",id:"cloud-seata",level:4},{value:"\u642d\u5efaseata\u670d\u52a1\u7aef",id:"\u642d\u5efaseata\u670d\u52a1\u7aef",level:5},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-3",level:5},{value:"cloud-oauth2",id:"cloud-oauth2",level:4},{value:"OAuth2\u76f8\u5173\u540d\u8bcd",id:"oauth2\u76f8\u5173\u540d\u8bcd",level:5},{value:"\u56db\u79cd\u6388\u6743\u6a21\u5f0f",id:"\u56db\u79cd\u6388\u6743\u6a21\u5f0f",level:5},{value:"Authorization Code\uff08\u6388\u6743\u7801\u6a21\u5f0f\uff09",id:"authorization-code\u6388\u6743\u7801\u6a21\u5f0f",level:6},{value:"Implicit\uff08\u7b80\u5316\u6a21\u5f0f\uff09",id:"implicit\u7b80\u5316\u6a21\u5f0f",level:6},{value:"\u5bc6\u7801\u6a21\u5f0f",id:"\u5bc6\u7801\u6a21\u5f0f",level:6},{value:"Client Credentials\uff08\u5ba2\u6237\u7aef\u6a21\u5f0f\uff09",id:"client-credentials\u5ba2\u6237\u7aef\u6a21\u5f0f",level:6},{value:"\u5237\u65b0\u4ee4\u724c",id:"\u5237\u65b0\u4ee4\u724c",level:6},{value:"\u5165\u95e8\u4f7f\u7528",id:"\u5165\u95e8\u4f7f\u7528",level:5},{value:"\u5b58\u50a8\u4ee4\u724c",id:"\u5b58\u50a8\u4ee4\u724c",level:5},{value:"\u4f7f\u7528Redis\u5b58\u50a8\u4ee4\u724c",id:"\u4f7f\u7528redis\u5b58\u50a8\u4ee4\u724c",level:6},{value:"\u4f7f\u7528jwt\u5b58\u50a8\u4ee4\u724c",id:"\u4f7f\u7528jwt\u5b58\u50a8\u4ee4\u724c",level:6},{value:"\u6269\u5c55jwt\u5b58\u50a8\u5185\u5bb9",id:"\u6269\u5c55jwt\u5b58\u50a8\u5185\u5bb9",level:6},{value:"\u89e3\u6790jwt",id:"\u89e3\u6790jwt",level:6},{value:"\u5237\u65b0\u4ee4\u724c",id:"\u5237\u65b0\u4ee4\u724c-1",level:6},{value:"\u5355\u70b9\u767b\u5f55",id:"\u5355\u70b9\u767b\u5f55",level:5},{value:"\u6743\u9650\u8ba4\u8bc1",id:"\u6743\u9650\u8ba4\u8bc1",level:6},{value:"cloud-admin",id:"cloud-admin",level:4},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-3",level:5},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-4",level:5},{value:"SkyWalking\u94fe\u8def\u8ffd\u8e2a",id:"skywalking\u94fe\u8def\u8ffd\u8e2a",level:3}];function d(r){const e={code:"code",h1:"h1",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",p:"p",pre:"pre",...(0,i.R)(),...r.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"java-springcloud\u6280\u672f\u6808",children:"JAVA-SpringCloud\u6280\u672f\u6808"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-eureka",children:"cloud-eureka"}),"\n",(0,a.jsx)(e.h5,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\x3c!-- \u4f9d\u8d56 --\x3e\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u6ce8\u89e3\r\n@EnableEurekaServer\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8001 #\u6307\u5b9a\u8fd0\u884c\u7aef\u53e3\r\nspring:\r\n  application:\r\n    name: eureka-server #\u6307\u5b9a\u670d\u52a1\u540d\u79f0\r\neureka:\r\n  instance:\r\n    hostname: localhost #\u6307\u5b9a\u4e3b\u673a\u5730\u5740\r\n  client:\r\n    fetch-registry: false #\u6307\u5b9a\u662f\u5426\u8981\u4ece\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u670d\u52a1\uff08\u6ce8\u518c\u4e2d\u5fc3\u4e0d\u9700\u8981\u5f00\u542f\uff09\r\n    register-with-eureka: false #\u6307\u5b9a\u662f\u5426\u8981\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\uff08\u6ce8\u518c\u4e2d\u5fc3\u4e0d\u9700\u8981\u5f00\u542f\uff09\r\n  server:\r\n    enable-self-preservation: false #\u5173\u95ed\u4fdd\u62a4\u6a21\u5f0f\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8bbf\u95ee\r\nhttp://localhost:8001/\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5ba2\u6237\u7aef",children:"\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u6ce8\u89e3\r\n@EnableDiscoveryClient\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8101 #\u8fd0\u884c\u7aef\u53e3\u53f7\r\nspring:\r\n  application:\r\n    name: eureka-client #\u670d\u52a1\u540d\u79f0\r\neureka:\r\n  client:\r\n    register-with-eureka: true #\u6ce8\u518c\u5230Eureka\u7684\u6ce8\u518c\u4e2d\u5fc3\r\n    fetch-registry: true #\u83b7\u53d6\u6ce8\u518c\u5b9e\u4f8b\u5217\u8868\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/ #\u914d\u7f6e\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8bbf\u95ee\r\nhttp://localhost:8001/\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u96c6\u7fa4",children:"\u96c6\u7fa4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u7ed9eureka-sever\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6application-replica1.yml\u914d\u7f6e\u7b2c\u4e00\u4e2a\u6ce8\u518c\u4e2d\u5fc3\r\nserver:\r\n  port: 8002\r\nspring:\r\n  application:\r\n    name: eureka-server\r\neureka:\r\n  instance:\r\n    hostname: replica1\r\n  client:\r\n    serviceUrl:\r\n      defaultZone: http://replica2:8003/eureka/ #\u6ce8\u518c\u5230\u53e6\u4e00\u4e2aEureka\u6ce8\u518c\u4e2d\u5fc3\r\n    fetch-registry: true\r\n    register-with-eureka: true\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u7ed9eureka-sever\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6application-replica2.yml\u914d\u7f6e\u7b2c\u4e8c\u4e2a\u6ce8\u518c\u4e2d\u5fc3\r\nserver:\r\n  port: 8003\r\nspring:\r\n  application:\r\n    name: eureka-server\r\neureka:\r\n  instance:\r\n    hostname: replica2\r\n  client:\r\n    serviceUrl:\r\n      defaultZone: http://replica1:8002/eureka/ #\u6ce8\u518c\u5230\u53e6\u4e00\u4e2aEureka\u6ce8\u518c\u4e2d\u5fc3\r\n    fetch-registry: true\r\n    register-with-eureka: true\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u4e24\u4e2a\u6ce8\u518c\u4e2d\u5fc3\u4e92\u76f8\u6ce8\u518c\uff0c\u642d\u5efa\u4e86\u6ce8\u518c\u4e2d\u5fc3\u7684\u53cc\u8282\u70b9\u96c6\u7fa4\uff0c\u7531\u4e8edefaultZone\u4f7f\u7528\u4e86\u57df\u540d\uff0c\u6240\u4ee5\u8fd8\u9700\u5728\u672c\u673a\u7684host\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e00\u4e0b\r\n-- \u4fee\u6539\u672c\u5730host\u6587\u4ef6\r\n127.0.0.1 replica1\r\n127.0.0.1 replica2\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8fd0\u884cEureka\u6ce8\u518c\u4e2d\u5fc3\u96c6\u7fa4\r\n-- \u5728IDEA\u4e2d\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u6765\u542f\u52a8\u540c\u4e00\u4e2aSpringBoot\u5e94\u7528\r\n-- \u6dfb\u52a0\u4e24\u4e2a\u914d\u7f6e\uff0c\u5206\u522b\u4ee5application-replica1.yml\u548capplication-replica2.yml\u6765\u542f\u52a8eureka-server\r\n\u5728Active profiles \uff1a\u914d\u7f6e replica1\u6216replica2\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u4fee\u6539Eureka-client\uff0c\u8ba9\u5176\u8fde\u63a5\u5230\u96c6\u7fa4\r\n# \u6dfb\u52a0eureka-client\u7684\u914d\u7f6e\u6587\u4ef6application-replica.yml\uff0c\u8ba9\u5176\u540c\u65f6\u6ce8\u518c\u5230\u4e24\u4e2a\u6ce8\u518c\u4e2d\u5fc3\r\nserver:\r\n  port: 8102\r\nspring:\r\n  application:\r\n    name: eureka-client\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://replica1:8002/eureka/,http://replica2:8003/eureka/ #\u540c\u65f6\u6ce8\u518c\u5230\u4e24\u4e2a\u6ce8\u518c\u4e2d\u5fc3\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u6dfb\u52a0\u8ba4\u8bc1",children:"\u6dfb\u52a0\u8ba4\u8bc1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u4e3b\u8981\u662f\u914d\u7f6e\u4e86\u767b\u5f55\u6ce8\u518c\u4e2d\u5fc3\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\r\nserver:\r\n  port: 8004\r\nspring:\r\n  application:\r\n    name: eureka-security-server\r\n  security: #\u914d\u7f6eSpringSecurity\u767b\u5f55\u7528\u6237\u540d\u548c\u5bc6\u7801\r\n    user:\r\n      name: macro\r\n      password: 123456\r\neureka:\r\n  instance:\r\n    hostname: localhost\r\n  client:\r\n    fetch-registry: false\r\n    register-with-eureka: false\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// \u6dfb\u52a0Java\u914d\u7f6eWebSecurityConfig\r\n// \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6dfb\u52a0SpringSecurity\u4f9d\u8d56\u7684\u5e94\u7528\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u9700\u8981\u6dfb\u52a0CSRF token\u624d\u80fd\u8bbf\u95ee\uff0cEureka\u5ba2\u6237\u7aef\u6ce8\u518c\u65f6\u5e76\u4e0d\u4f1a\u6dfb\u52a0\uff0c\u6240\u4ee5\u9700\u8981\u914d\u7f6e/eureka/**\u8def\u5f84\u4e0d\u9700\u8981CSRF token\r\n@EnableWebSecurity\r\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n    @Override\r\n    protected void configure(HttpSecurity http) throws Exception {\r\n        http.csrf().ignoringAntMatchers("/eureka/**");\r\n        super.configure(http);\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- eureka-client\u6ce8\u518c\u5230\u6709\u767b\u5f55\u8ba4\u8bc1\u7684\u6ce8\u518c\u4e2d\u5fc3\r\n-- \u914d\u7f6e\u6587\u4ef6\u4e2d\u9700\u8981\u4fee\u6539\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740\u683c\u5f0f\r\nhttp://${username}:${password}@${hostname}:${port}/eureka/\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8103\r\nspring:\r\n  application:\r\n    name: eureka-client\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://macro:123456@localhost:8004/eureka/\n"})}),"\n",(0,a.jsx)(e.h5,{id:"eureka\u7684\u5e38\u7528\u914d\u7f6e",children:"Eureka\u7684\u5e38\u7528\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"eureka:\r\n  client: #eureka\u5ba2\u6237\u7aef\u914d\u7f6e\r\n    register-with-eureka: true #\u662f\u5426\u5c06\u81ea\u5df1\u6ce8\u518c\u5230eureka\u670d\u52a1\u7aef\u4e0a\u53bb\r\n    fetch-registry: true #\u662f\u5426\u83b7\u53d6eureka\u670d\u52a1\u7aef\u4e0a\u6ce8\u518c\u7684\u670d\u52a1\u5217\u8868\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/ # \u6307\u5b9a\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740\r\n    enabled: true # \u542f\u7528eureka\u5ba2\u6237\u7aef\r\n    registry-fetch-interval-seconds: 30 #\u5b9a\u4e49\u53bbeureka\u670d\u52a1\u7aef\u83b7\u53d6\u670d\u52a1\u5217\u8868\u7684\u65f6\u95f4\u95f4\u9694\r\n  instance: #eureka\u5ba2\u6237\u7aef\u5b9e\u4f8b\u914d\u7f6e\r\n    lease-renewal-interval-in-seconds: 30 #\u5b9a\u4e49\u670d\u52a1\u591a\u4e45\u53bb\u6ce8\u518c\u4e2d\u5fc3\u7eed\u7ea6\r\n    lease-expiration-duration-in-seconds: 90 #\u5b9a\u4e49\u670d\u52a1\u591a\u4e45\u4e0d\u53bb\u7eed\u7ea6\u8ba4\u4e3a\u670d\u52a1\u5931\u6548\r\n    metadata-map:\r\n      zone: jiangsu #\u6240\u5728\u533a\u57df\r\n    hostname: localhost #\u670d\u52a1\u4e3b\u673a\u540d\u79f0\r\n    prefer-ip-address: false #\u662f\u5426\u4f18\u5148\u4f7f\u7528ip\u6765\u4f5c\u4e3a\u4e3b\u673a\u540d\r\n  server: #eureka\u670d\u52a1\u7aef\u914d\u7f6e\r\n    enable-self-preservation: false #\u5173\u95edeureka\u670d\u52a1\u7aef\u7684\u4fdd\u62a4\u673a\u5236\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-ribbon",children:"cloud-ribbon"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Ribbon \u662fSpring Cloud Netflix \u5b50\u9879\u76ee\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u4e3b\u8981\u7ed9\u670d\u52a1\u95f4\u8c03\u7528\u53caAPI\u7f51\u5173\u8f6c\u53d1\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd\r\n-- \u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5f88\u591a\u670d\u52a1\u90fd\u4f1a\u90e8\u7f72\u591a\u4e2a\uff0c\u5176\u4ed6\u670d\u52a1\u53bb\u8c03\u7528\u8be5\u670d\u52a1\u7684\u65f6\u5019\uff0c\u5982\u4f55\u4fdd\u8bc1\u8d1f\u8f7d\u5747\u8861\u662f\u4e2a\u4e0d\u5f97\u4e0d\u53bb\u8003\u8651\u7684\u95ee\u9898\u3002\u8d1f\u8f7d\u5747\u8861\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u548c\u6269\u5c55\u6027\uff0c\u5f53\u6211\u4eec\u4f7f\u7528RestTemplate\u6765\u8c03\u7528\u5176\u4ed6\u670d\u52a1\u65f6\uff0cRibbon\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\r\n-- RestTemplate\u662fSpringMVC\u643a\u5e26\u7684\u5de5\u5177\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5ba2\u6237\u7aef1",children:"\u5ba2\u6237\u7aef1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8201\r\nspring:\r\n  application:\r\n    name: user-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,a.jsx)(e.h5,{id:"ribbon\u8d1f\u8f7d\u5ba2\u6237\u7aef",children:"ribbon\u8d1f\u8f7d\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8301\r\nspring:\r\n  application:\r\n    name: ribbon-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nservice-url:\r\n  user-service: http://user-service\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u8d1f\u8f7d\u914d\u7f6e",children:"\u8d1f\u8f7d\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@Configuration\r\n@RibbonClient(name = "user-service")\r\npublic class RibbonConfig {\r\n\r\n    @Bean\r\n    @LoadBalanced\r\n    public RestTemplate restTemplate(){\r\n        return new RestTemplate();\r\n    }\r\n\r\n    @Bean\r\n    public IRule ribbonRule(){\r\n        return new RandomRule();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u8c03\u7528\u5ba2\u6237\u7aef",children:"\u8c03\u7528\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("/user")\r\npublic class UserRibbonController {\r\n    @Autowired\r\n    private RestTemplate restTemplate;\r\n    @Value("${service-url.user-service}")\r\n    private String userServiceUrl;\r\n\r\n    @GetMapping("/create")\r\n    public void create() {\r\n        System.out.println(restTemplate.getForObject(userServiceUrl + "/user/create",String.class));\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u6f14\u793a",children:"\u6f14\u793a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"1. \u542f\u52a8eureka-server\u4e8e8001\u7aef\u53e3(\u670d\u52a1\u7aef)\r\n2. \u542f\u52a8user-service\u4e8e8201\u7aef\u53e3\uff08\u5ba2\u6237\u7aef1\uff09\r\n3. \u542f\u52a8\u53e6\u4e00\u4e2auser-service\u4e8e8202\u7aef\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7Override Param\u91cd\u5199server.port\u914d\u7f6e\r\n4. \u542f\u52a8ribbon-service\uff0c\u8c03\u7528\u63a5\u53e3\uff0c\u4f1a\u968f\u673a\u8c03\u7528user-service\u5176\u4e2d\u4e00\u4e2a\n"})}),"\n",(0,a.jsx)(e.h5,{id:"ribbon\u5e38\u7528\u914d\u7f6e",children:"ribbon\u5e38\u7528\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Ribbon\u7684\u5e38\u7528\u914d\u7f6e\r\nribbon:\r\n  ConnectTimeout: 1000 #\u670d\u52a1\u8bf7\u6c42\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\r\n  ReadTimeout: 3000 #\u670d\u52a1\u8bf7\u6c42\u5904\u7406\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\r\n  OkToRetryOnAllOperations: true #\u5bf9\u8d85\u65f6\u8bf7\u6c42\u542f\u7528\u91cd\u8bd5\u673a\u5236\r\n  MaxAutoRetriesNextServer: 1 #\u5207\u6362\u91cd\u8bd5\u5b9e\u4f8b\u7684\u6700\u5927\u4e2a\u6570\r\n  MaxAutoRetries: 1 # \u5207\u6362\u5b9e\u4f8b\u540e\u91cd\u8bd5\u6700\u5927\u6b21\u6570\r\n  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule #\u4fee\u6539\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\r\n\r\n-- Ribbon\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\r\ncom.netflix.loadbalancer.RandomRule\uff1a\u4ece\u63d0\u4f9b\u670d\u52a1\u7684\u5b9e\u4f8b\u4e2d\u4ee5\u968f\u673a\u7684\u65b9\u5f0f\uff1b\r\ncom.netflix.loadbalancer.RoundRobinRule\uff1a\u4ee5\u7ebf\u6027\u8f6e\u8be2\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u4ece\u63d0\u4f9b\u670d\u52a1\u7684\u5b9e\u4f8b\u4e2d\u6309\u987a\u5e8f\u9009\u53d6\uff0c\u7b2c\u4e00\u6b21\u9009\u7b2c\u4e00\u4e2a\uff0c\u7b2c\u4e8c\u6b21\u9009\u7b2c\u4e8c\u4e2a\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5230\u6700\u540e\u4e00\u4e2a\u4ee5\u540e\u518d\u4ece\u5934\u6765\u8fc7\uff1b\r\ncom.netflix.loadbalancer.RetryRule\uff1a\u5728RoundRobinRule\u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u91cd\u8bd5\u673a\u5236\uff0c\u5373\u5728\u6307\u5b9a\u7684\u91cd\u8bd5\u65f6\u95f4\u5185\uff0c\u53cd\u590d\u4f7f\u7528\u7ebf\u6027\u8f6e\u8be2\u7b56\u7565\u6765\u9009\u62e9\u53ef\u7528\u5b9e\u4f8b\uff1b\r\ncom.netflix.loadbalancer.WeightedResponseTimeRule\uff1a\u5bf9RoundRobinRule\u7684\u6269\u5c55\uff0c\u54cd\u5e94\u901f\u5ea6\u8d8a\u5feb\u7684\u5b9e\u4f8b\u9009\u62e9\u6743\u91cd\u8d8a\u5927\uff0c\u8d8a\u5bb9\u6613\u88ab\u9009\u62e9\uff1b\r\ncom.netflix.loadbalancer.BestAvailableRule\uff1a\u9009\u62e9\u5e76\u53d1\u8f83\u5c0f\u7684\u5b9e\u4f8b\uff1b\r\ncom.netflix.loadbalancer.AvailabilityFilteringRule\uff1a\u5148\u8fc7\u6ee4\u6389\u6545\u969c\u5b9e\u4f8b\uff0c\u518d\u9009\u62e9\u5e76\u53d1\u8f83\u5c0f\u7684\u5b9e\u4f8b\uff1b\r\ncom.netflix.loadbalancer.ZoneAwareLoadBalancer\uff1a\u91c7\u7528\u53cc\u91cd\u8fc7\u6ee4\uff0c\u540c\u65f6\u8fc7\u6ee4\u4e0d\u662f\u540c\u4e00\u533a\u57df\u7684\u5b9e\u4f8b\u548c\u6545\u969c\u5b9e\u4f8b\uff0c\u9009\u62e9\u5e76\u53d1\u8f83\u5c0f\u7684\u5b9e\u4f8b\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-hystrix",children:"cloud-hystrix"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8401\r\nspring:\r\n  application:\r\n    name: hystrix-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nservice-url:\r\n  user-service: http://user-service\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@EnableCircuitBreaker\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class HystrixServiceApplication {\r\n\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(HystrixServiceApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u670d\u52a1\u964d\u7ea7",children:"\u670d\u52a1\u964d\u7ea7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6d4b\u8bd5\u6548\u679c\uff1a\u5982\u679c\u670d\u52a1\u505c\u6b62\uff0c\u5219\u4f1a\u8c03\u7528getDefaultUser\u65b9\u6cd5\u8fdb\u884c\u964d\u7ea7\u64cd\u4f5c\r\n */\r\n@HystrixCommand(fallbackMethod = "getDefaultUser")\r\npublic CommonResult getUser(Long id) {\r\n    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n}\r\n\r\npublic CommonResult getDefaultUser(@PathVariable Long id) {\r\n    User defaultUser = new User(-1L, "defaultUser", "123456");\r\n    return new CommonResult<>(defaultUser);\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"hystrixcommand\u5e38\u7528\u53c2\u6570",children:"@HystrixCommand\u5e38\u7528\u53c2\u6570"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"fallbackMethod\uff1a\u6307\u5b9a\u670d\u52a1\u964d\u7ea7\u5904\u7406\u65b9\u6cd5\uff1b\r\nignoreExceptions\uff1a\u5ffd\u7565\u67d0\u4e9b\u5f02\u5e38\uff0c\u4e0d\u53d1\u751f\u670d\u52a1\u964d\u7ea7\uff1b\r\ncommandKey\uff1a\u547d\u4ee4\u540d\u79f0\uff0c\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u547d\u4ee4\uff1b\r\ngroupKey\uff1a\u5206\u7ec4\u540d\u79f0\uff0cHystrix\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u5206\u7ec4\u6765\u7edf\u8ba1\u547d\u4ee4\u7684\u544a\u8b66\u53ca\u4eea\u8868\u76d8\u4fe1\u606f\uff1b\r\nthreadPoolKey\uff1a\u7ebf\u7a0b\u6c60\u540d\u79f0\uff0c\u7528\u4e8e\u5212\u5206\u7ebf\u7a0b\u6c60\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u8bf7\u6c42\u7f13\u5b58",children:"\u8bf7\u6c42\u7f13\u5b58"}),"\n",(0,a.jsx)(e.h6,{id:"\u76f8\u5173\u6ce8\u89e3",children:"\u76f8\u5173\u6ce8\u89e3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"@CacheResult\uff1a\u5f00\u542f\u7f13\u5b58\uff0c\u9ed8\u8ba4\u6240\u6709\u53c2\u6570\u4f5c\u4e3a\u7f13\u5b58\u7684key\uff0ccacheKeyMethod\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56deString\u7c7b\u578b\u7684\u65b9\u6cd5\u6307\u5b9akey\uff1b\r\n@CacheKey\uff1a\u6307\u5b9a\u7f13\u5b58\u7684key\uff0c\u53ef\u4ee5\u6307\u5b9a\u53c2\u6570\u6216\u6307\u5b9a\u53c2\u6570\u4e2d\u7684\u5c5e\u6027\u503c\u4e3a\u7f13\u5b58key\uff0ccacheKeyMethod\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56deString\u7c7b\u578b\u7684\u65b9\u6cd5\u6307\u5b9a\uff1b\r\n@CacheRemove\uff1a\u79fb\u9664\u7f13\u5b58\uff0c\u9700\u8981\u6307\u5b9acommandKey\u3002\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6d4b\u8bd5\u6548\u679c\uff1a\u7b2c\u4e00\u6b21\u53d1\u9001\u8bf7\u6c42\u5e76\u7f13\u5b58\uff0c\u7b2c\u4e8c\u6b21\u83b7\u53d6\u7f13\u5b58\uff0c\u7b2c\u4e09\u6b21\u83b7\u53d6\u7f13\u5b58\r\n */\r\n@CacheResult(cacheKeyMethod = "getCacheKey")\r\n@HystrixCommand(fallbackMethod = "getDefaultUser", commandKey = "getUserCache")\r\n    public CommonResult getUserCache(Long id) {\r\n    LOGGER.info("getUserCache id:{}", id);\r\n    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n}\r\n\r\n/**\r\n * \u4e3a\u7f13\u5b58\u751f\u6210key\r\n */\r\npublic String getCacheKey(Long id) {\r\n    return String.valueOf(id);\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6d4b\u8bd5\u6548\u679c\uff1a\u7b2c\u4e00\u6b21\u53d1\u9001\u8bf7\u6c42\u5e76\u7f13\u5b58\uff0c\u7b2c\u4e8c\u6b21\u79fb\u9664\u7f13\u5b58\uff0c\u7b2c\u4e09\u6b21\u91cd\u65b0\u53d1\u9001\u8bf7\u6c42\u5e76\u7f13\u5b58\r\n * commandKey\u8981\u8ddf\u5f00\u542f\u7f13\u5b58\u7684commandKey\u5bf9\u5e94\r\n */\r\n@CacheRemove(commandKey = "getUserCache", cacheKeyMethod = "getCacheKey")\r\n@HystrixCommand\r\npublic CommonResult removeCache(Long id) {\r\n    LOGGER.info("removeCache id:{}", id);\r\n    return restTemplate.postForObject(userServiceUrl + "/user/delete/{1}", null, CommonResult.class, id);\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u5728\u7f13\u5b58\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5728\u6bcf\u6b21\u4f7f\u7528\u7f13\u5b58\u7684\u8bf7\u6c42\u524d\u540e\u5bf9HystrixRequestContext\u8fdb\u884c\u521d\u59cb\u5316\u548c\u5173\u95ed\r\n * \u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u5728\u6bcf\u4e2a\u8bf7\u6c42\u524d\u540e\u521d\u59cb\u5316\u548c\u5173\u95edHystrixRequestContext\u6765\u89e3\u51b3\u8be5\u95ee\u9898\r\n */\r\n@Component\r\n@WebFilter(urlPatterns = "/*",asyncSupported = true)\r\npublic class HystrixRequestContextFilter implements Filter {\r\n    @Override\r\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\r\n        HystrixRequestContext context = HystrixRequestContext.initializeContext();\r\n        try {\r\n            filterChain.doFilter(servletRequest, servletResponse);\r\n        } finally {\r\n            context.close();\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u8bf7\u6c42\u5408\u5e76",children:"\u8bf7\u6c42\u5408\u5e76"}),"\n",(0,a.jsx)(e.h6,{id:"hystrixcollapser\u7684\u5e38\u7528\u5c5e\u6027",children:"@HystrixCollapser\u7684\u5e38\u7528\u5c5e\u6027"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"batchMethod\uff1a\u7528\u4e8e\u8bbe\u7f6e\u8bf7\u6c42\u5408\u5e76\u7684\u65b9\u6cd5\uff1b\r\ncollapserProperties\uff1a\u8bf7\u6c42\u5408\u5e76\u5c5e\u6027\uff0c\u7528\u4e8e\u63a7\u5236\u5b9e\u4f8b\u5c5e\u6027\uff0c\u6709\u5f88\u591a\uff1b\r\ntimerDelayInMilliseconds\uff1acollapserProperties\u4e2d\u7684\u5c5e\u6027\uff0c\u7528\u4e8e\u63a7\u5236\u6bcf\u9694\u591a\u5c11\u65f6\u95f4\u5408\u5e76\u4e00\u6b21\u8bf7\u6c42;\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u5bf9getUserFuture\u7684\u7684\u591a\u6b21\u8c03\u7528\u90fd\u4f1a\u8f6c\u5316\u4e3a\u5bf9getUserByIds\u7684\u5355\u6b21\u8c03\u7528\r\n * \u6d4b\u8bd5\u6548\u679c\uff1a100\u6beb\u79d2\u8c03\u75282\u6b21\uff0c2\u6b21\u5408\u5e76\u6210\u4e00\u6b21\u6279\u91cf\u8bf7\u6c42\uff08\u7c7b\u4f3cbyId \u548c byIds\uff09\r\n * 100\u6beb\u79d2\u540e\u8c03\u7528\u7b2c\u4e09\u6b21\uff0c\u4e0d\u5408\u5e76\r\n */\r\n@HystrixCollapser(batchMethod = "getUserByIds",collapserProperties = {\r\n    @HystrixProperty(name = "timerDelayInMilliseconds", value = "100")\r\n})\r\npublic Future<User> getUserFuture(Long id) {\r\n    return new AsyncResult<User>(){\r\n    @Override\r\n    public User invoke() {\r\n        CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n        Map data = (Map) commonResult.getData();\r\n        User user = BeanUtil.mapToBean(data,User.class,true);\r\n        LOGGER.info("getUserById username:{}", user.getUsername());\r\n        return user;\r\n        }\r\n    };\r\n}\r\n\r\n@HystrixCommand\r\npublic List<User> getUserByIds(List<Long> ids) {\r\n    LOGGER.info("getUserByIds:{}", ids);\r\n    CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/getUserByIds?ids={1}", CommonResult.class, CollUtil.join(ids,","));\r\n    return (List<User>) commonResult.getData();\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"hystrix\u7684\u5e38\u7528\u914d\u7f6e",children:"Hystrix\u7684\u5e38\u7528\u914d\u7f6e"}),"\n",(0,a.jsx)(e.h6,{id:"\u5168\u5c40\u914d\u7f6e",children:"\u5168\u5c40\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"hystrix:\r\n  command: #\u7528\u4e8e\u63a7\u5236HystrixCommand\u7684\u884c\u4e3a\r\n    default:\r\n      execution:\r\n        isolation:\r\n          strategy: THREAD #\u63a7\u5236HystrixCommand\u7684\u9694\u79bb\u7b56\u7565\uff0cTHREAD->\u7ebf\u7a0b\u6c60\u9694\u79bb\u7b56\u7565(\u9ed8\u8ba4)\uff0cSEMAPHORE->\u4fe1\u53f7\u91cf\u9694\u79bb\u7b56\u7565\r\n          thread:\r\n            timeoutInMilliseconds: 1000 #\u914d\u7f6eHystrixCommand\u6267\u884c\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u6267\u884c\u8d85\u8fc7\u8be5\u65f6\u95f4\u4f1a\u8fdb\u884c\u670d\u52a1\u964d\u7ea7\u5904\u7406\r\n            interruptOnTimeout: true #\u914d\u7f6eHystrixCommand\u6267\u884c\u8d85\u65f6\u7684\u65f6\u5019\u662f\u5426\u8981\u4e2d\u65ad\r\n            interruptOnCancel: true #\u914d\u7f6eHystrixCommand\u6267\u884c\u88ab\u53d6\u6d88\u7684\u65f6\u5019\u662f\u5426\u8981\u4e2d\u65ad\r\n          timeout:\r\n            enabled: true #\u914d\u7f6eHystrixCommand\u7684\u6267\u884c\u662f\u5426\u542f\u7528\u8d85\u65f6\u65f6\u95f4\r\n          semaphore:\r\n            maxConcurrentRequests: 10 #\u5f53\u4f7f\u7528\u4fe1\u53f7\u91cf\u9694\u79bb\u7b56\u7565\u65f6\uff0c\u7528\u6765\u63a7\u5236\u5e76\u53d1\u91cf\u7684\u5927\u5c0f\uff0c\u8d85\u8fc7\u8be5\u5e76\u53d1\u91cf\u7684\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\r\n      fallback:\r\n        enabled: true #\u7528\u4e8e\u63a7\u5236\u662f\u5426\u542f\u7528\u670d\u52a1\u964d\u7ea7\r\n      circuitBreaker: #\u7528\u4e8e\u63a7\u5236HystrixCircuitBreaker\u7684\u884c\u4e3a\r\n        enabled: true #\u7528\u4e8e\u63a7\u5236\u65ad\u8def\u5668\u662f\u5426\u8ddf\u8e2a\u5065\u5eb7\u72b6\u51b5\u4ee5\u53ca\u7194\u65ad\u8bf7\u6c42\r\n        requestVolumeThreshold: 20 #\u8d85\u8fc7\u8be5\u8bf7\u6c42\u6570\u7684\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\r\n        forceOpen: false #\u5f3a\u5236\u6253\u5f00\u65ad\u8def\u5668\uff0c\u62d2\u7edd\u6240\u6709\u8bf7\u6c42\r\n        forceClosed: false #\u5f3a\u5236\u5173\u95ed\u65ad\u8def\u5668\uff0c\u63a5\u6536\u6240\u6709\u8bf7\u6c42\r\n      requestCache:\r\n        enabled: true #\u7528\u4e8e\u63a7\u5236\u662f\u5426\u5f00\u542f\u8bf7\u6c42\u7f13\u5b58\r\n  collapser: #\u7528\u4e8e\u63a7\u5236HystrixCollapser\u7684\u6267\u884c\u884c\u4e3a\r\n    default:\r\n      maxRequestsInBatch: 100 #\u63a7\u5236\u4e00\u6b21\u5408\u5e76\u8bf7\u6c42\u5408\u5e76\u7684\u6700\u5927\u8bf7\u6c42\u6570\r\n      timerDelayinMilliseconds: 10 #\u63a7\u5236\u591a\u5c11\u6beb\u79d2\u5185\u7684\u8bf7\u6c42\u4f1a\u88ab\u5408\u5e76\u6210\u4e00\u4e2a\r\n      requestCache:\r\n        enabled: true #\u63a7\u5236\u5408\u5e76\u8bf7\u6c42\u662f\u5426\u5f00\u542f\u7f13\u5b58\r\n  threadpool: #\u7528\u4e8e\u63a7\u5236HystrixCommand\u6267\u884c\u6240\u5728\u7ebf\u7a0b\u6c60\u7684\u884c\u4e3a\r\n    default:\r\n      coreSize: 10 #\u7ebf\u7a0b\u6c60\u7684\u6838\u5fc3\u7ebf\u7a0b\u6570\r\n      maximumSize: 10 #\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u8d85\u8fc7\u8be5\u7ebf\u7a0b\u6570\u7684\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\r\n      maxQueueSize: -1 #\u7528\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u961f\u5217\u5927\u5c0f\uff0c-1\u91c7\u7528SynchronousQueue\uff0c\u5176\u4ed6\u6b63\u6570\u91c7\u7528LinkedBlockingQueue\r\n      queueSizeRejectionThreshold: 5 #\u7528\u4e8e\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u961f\u5217\u7684\u62d2\u7edd\u9600\u503c\uff0c\u7531\u4e8eLinkedBlockingQueue\u4e0d\u80fd\u52a8\u6001\u6539\u7248\u5927\u5c0f\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u7528\u8be5\u53c2\u6570\u6765\u63a7\u5236\u7ebf\u7a0b\u6570\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u5b9e\u4f8b\u914d\u7f6e",children:"\u5b9e\u4f8b\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u914d\u7f6e\u6587\u4ef6\u4e2d\u76f8\u5173key\u7684\u8bf4\u660e\r\n# HystrixComandKey\u5bf9\u5e94@HystrixCommand\u4e2d\u7684commandKey\u5c5e\u6027\uff1b\r\n# HystrixCollapserKey\u5bf9\u5e94@HystrixCollapser\u6ce8\u89e3\u4e2d\u7684collapserKey\u5c5e\u6027\uff1b\r\n# HystrixThreadPoolKey\u5bf9\u5e94@HystrixCommand\u4e2d\u7684threadPoolKey\u5c5e\u6027\r\nhystrix:\r\n  command:\r\n    HystrixComandKey: #\u5c06default\u6362\u6210HystrixComrnandKey\r\n      execution:\r\n        isolation:\r\n          strategy: THREAD\r\n  collapser:\r\n    HystrixCollapserKey: #\u5c06default\u6362\u6210HystrixCollapserKey\r\n      maxRequestsInBatch: 100\r\n  threadpool:\r\n    HystrixThreadPoolKey: #\u5c06default\u6362\u6210HystrixThreadPoolKey\r\n      coreSize: 10\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-feign",children:"cloud-feign"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8701\r\nspring:\r\n application:\r\n  name: feign-service\r\neureka:\r\n client:\r\n  register-with-eureka: true\r\n  fetch-registry: true\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nfeign:\r\n hystrix:\r\n  enabled: true #\u5728Feign\u4e2d\u5f00\u542fHystrix\r\n compression:\r\n  request:\r\n   enabled: false #\u662f\u5426\u5bf9\u8bf7\u6c42\u8fdb\u884cGZIP\u538b\u7f29\r\n   mime-types: text/xml,application/xml,application/json #\u6307\u5b9a\u538b\u7f29\u7684\u8bf7\u6c42\u6570\u636e\u7c7b\u578b\r\n   min-request-size: 2048 #\u8d85\u8fc7\u8be5\u5927\u5c0f\u7684\u8bf7\u6c42\u4f1a\u88ab\u538b\u7f29\r\n  response:\r\n   enabled: false #\u662f\u5426\u5bf9\u54cd\u5e94\u8fdb\u884cGZIP\u538b\u7f29\r\nlogging:\r\n level: #\u4fee\u6539\u65e5\u5fd7\u7ea7\u522b\r\n  com.hmh.feign.feign.UserService: debug\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@EnableFeignClients\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class FeignServiceApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(FeignServiceApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h5,{id:"feign\u63a5\u53e3",children:"feign\u63a5\u53e3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//value\uff1a\u8c03\u7528\u7684\u670d\u52a1\u3002fallback\uff1a\u670d\u52a1\u964d\u7ea7\u5904\u7406\u7c7b\uff08\u5b9e\u73b0UserService\uff09\r\n@FeignClient(value = "user-service",fallback = UserFallbackService.class)\r\npublic interface UserService {\r\n    @GetMapping("/user/create")\r\n    void create();\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u65e5\u5fd7\u6253\u5370",children:"\u65e5\u5fd7\u6253\u5370"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u65e5\u5fd7\u7ea7\u522b\r\nNONE\uff1a\u9ed8\u8ba4\u7684\uff0c\u4e0d\u663e\u793a\u4efb\u4f55\u65e5\u5fd7\uff1b\r\nBASIC\uff1a\u4ec5\u8bb0\u5f55\u8bf7\u6c42\u65b9\u6cd5\u3001URL\u3001\u54cd\u5e94\u72b6\u6001\u7801\u53ca\u6267\u884c\u65f6\u95f4\uff1b\r\nHEADERS\uff1a\u9664\u4e86BASIC\u4e2d\u5b9a\u4e49\u7684\u4fe1\u606f\u4e4b\u5916\uff0c\u8fd8\u6709\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5934\u4fe1\u606f\uff1b\r\nFULL\uff1a\u9664\u4e86HEADERS\u4e2d\u5b9a\u4e49\u7684\u4fe1\u606f\u4e4b\u5916\uff0c\u8fd8\u6709\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u6b63\u6587\u53ca\u5143\u6570\u636e\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u901a\u8fc7java\u914d\u7f6e\u6765\u4f7fFeign\u6253\u5370\u6700\u8be6\u7ec6\u7684Http\u8bf7\u6c42\u65e5\u5fd7\u4fe1\u606f\r\n */\r\n@Configuration\r\npublic class FeignConfig {\r\n    @Bean\r\n    Logger.Level feignLoggerLevel() {\r\n        return Logger.Level.FULL;\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-zuul",children:"cloud-zuul"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-zuul</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8801\r\nspring:\r\n application:\r\n  name: zuul-proxy\r\neureka:\r\n client:\r\n  register-with-eureka: true\r\n  fetch-registry: true\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nzuul:\r\n prefix: /proxy #\u7ed9\u7f51\u5173\u8def\u7531\u6dfb\u52a0\u524d\u7f00\r\n routes: #\u7ed9\u670d\u52a1\u914d\u7f6e\u8def\u7531\r\n  user-service: # \u9ed8\u8ba4\u4e3a/user-service/**\r\n   path: /userService/**\r\n  feign-service: # \u9ed8\u8ba4\u4e3a/feign-service/**\r\n   path: /feignService/**\r\n# ignored-services: user-service,feign-service #\u5173\u95ed\u9ed8\u8ba4\u8def\u7531\u914d\u7f6e\r\n add-host-header: true #\u8bbe\u7f6e\u4e3atrue\u91cd\u5b9a\u5411\u662f\u4f1a\u6dfb\u52a0host\u8bf7\u6c42\u5934\r\n sensitive-headers: Cookie,Set-Cookie,Authorization #\u914d\u7f6e\u8fc7\u6ee4\u654f\u611f\u7684\u8bf7\u6c42\u5934\u4fe1\u606f\uff0c\u8bbe\u7f6e\u4e3a\u7a7a\u5c31\u4e0d\u4f1a\u8fc7\u6ee4\r\n # \u7981\u7528\u8fc7\u6ee4\u5668\r\n PreLogFilter:\r\n  pre:\r\n   disable: false\r\n\r\nmanagement:\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: 'routes'\r\n# \u670d\u52a1\u964d\u7ea7\r\nhystrix:\r\n command: #\u7528\u4e8e\u63a7\u5236HystrixCommand\u7684\u884c\u4e3a\r\n  default:\r\n   execution:\r\n    isolation:\r\n     thread:\r\n      timeoutInMilliseconds: 1000 #\u914d\u7f6eHystrixCommand\u6267\u884c\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u6267\u884c\u8d85\u8fc7\u8be5\u65f6\u95f4\u4f1a\u8fdb\u884c\u670d\u52a1\u964d\u7ea7\u5904\u7406\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@SpringBootApplication\r\n@EnableEurekaClient\r\n@EnableZuulProxy\r\npublic class ZuulProxyApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ZuulProxyApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u8bf7\u6c42\u8def\u7531",children:"\u8bf7\u6c42\u8def\u7531"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"zuul:\r\n  routes: #\u7ed9\u670d\u52a1\u914d\u7f6e\u8def\u7531\r\n    user-service:\r\n      path: /userService/**\r\n    feign-service:\r\n      path: /feignService/**\r\n      \r\n\u8bbf\u95eehttp://localhost:8801/userService/user/1\u53ef\u4ee5\u53d1\u73b0\u8bf7\u6c42\u8def\u7531\u5230\u4e86user-service\u4e0a\u4e86\uff1b\r\n\r\n\u8bbf\u95eehttp://localhost:8801/feignService/user/1\u53ef\u4ee5\u53d1\u73b0\u8bf7\u6c42\u8def\u7531\u5230\u4e86feign-service\u4e0a\u4e86\r\n\r\n--\u9ed8\u8ba4\u914d\u7f6e\r\n\r\n\u8bbf\u95eehttp://localhost:8801/user-service/user/1\u540c\u6837\u53ef\u4ee5\u8def\u7531\u5230\u4e86user-service\u4e0a\u4e86\uff1b\r\n\r\n\u8bbf\u95eehttp://localhost:8801/feign-service/user/1\u540c\u6837\u53ef\u4ee5\u8def\u7531\u5230\u4e86feign-service\u4e0a\u4e86\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u67e5\u770b\u8def\u7531\u4fe1\u606f",children:"\u67e5\u770b\u8def\u7531\u4fe1\u606f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"management:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'routes'\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u7b80\u5355\u8def\u7531\u4fe1\u606f\r\nhttp://localhost:8801/actuator/routes\r\n-- \u67e5\u770b\u8be6\u7ec6\u8def\u7531\u4fe1\u606f\r\nhttp://localhost:8801/actuator/routes/details\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u8fc7\u6ee4\u5668",children:"\u8fc7\u6ee4\u5668"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8fc7\u6ee4\u5668\u7c7b\u578b\r\npre\uff1a\u5728\u8bf7\u6c42\u88ab\u8def\u7531\u5230\u76ee\u6807\u670d\u52a1\u524d\u6267\u884c\uff0c\u6bd4\u5982\u6743\u9650\u6821\u9a8c\u3001\u6253\u5370\u65e5\u5fd7\u7b49\u529f\u80fd\uff1b\r\nrouting\uff1a\u5728\u8bf7\u6c42\u88ab\u8def\u7531\u5230\u76ee\u6807\u670d\u52a1\u65f6\u6267\u884c\uff0c\u8fd9\u662f\u4f7f\u7528Apache HttpClient\u6216Netflix Ribbon\u6784\u5efa\u548c\u53d1\u9001\u539f\u59cbHTTP\u8bf7\u6c42\u7684\u5730\u65b9\uff1b\r\npost\uff1a\u5728\u8bf7\u6c42\u88ab\u8def\u7531\u5230\u76ee\u6807\u670d\u52a1\u540e\u6267\u884c\uff0c\u6bd4\u5982\u7ed9\u76ee\u6807\u670d\u52a1\u7684\u54cd\u5e94\u6dfb\u52a0\u5934\u4fe1\u606f\uff0c\u6536\u96c6\u7edf\u8ba1\u6570\u636e\u7b49\u529f\u80fd\uff1b\r\nerror\uff1a\u8bf7\u6c42\u5728\u5176\u4ed6\u9636\u6bb5\u53d1\u751f\u9519\u8bef\u65f6\u6267\u884c\r\n\r\n\u670d\u52a1A ---\x3e pre ---\x3e routing ---\x3e \u670d\u52a1B \r\n  ^                                |\r\n  |   <--- post <--- routing <---                        \n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\r\n */\r\n@Component\r\npublic class PreLogFilter extends ZuulFilter {\r\n    private Logger LOGGER = LoggerFactory.getLogger(this.getClass());\r\n\r\n    /**\r\n     * \u8fc7\u6ee4\u5668\u7c7b\u578b\uff0c\u6709pre\u3001routing\u3001post\u3001error\u56db\u79cd\u3002\r\n     */\r\n    @Override\r\n    public String filterType() {\r\n        return "pre";\r\n    }\r\n\r\n    /**\r\n     * \u8fc7\u6ee4\u5668\u6267\u884c\u987a\u5e8f\uff0c\u6570\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002\r\n     */\r\n    @Override\r\n    public int filterOrder() {\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * \u662f\u5426\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd4\u56detrue\u4f1a\u6267\u884c\u8fc7\u6ee4\u3002\r\n     */\r\n    @Override\r\n    public boolean shouldFilter() {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u81ea\u5b9a\u4e49\u7684\u8fc7\u6ee4\u5668\u903b\u8f91\uff0c\u5f53shouldFilter()\u8fd4\u56detrue\u65f6\u4f1a\u6267\u884c\u3002\r\n     */\r\n    @Override\r\n    public Object run() throws ZuulException {\r\n        RequestContext requestContext = RequestContext.getCurrentContext();\r\n        HttpServletRequest request = requestContext.getRequest();\r\n        String host = request.getRemoteHost();\r\n        String method = request.getMethod();\r\n        String uri = request.getRequestURI();\r\n        LOGGER.info("Remote host:{},method:{},uri:{}", host, method, uri);\r\n        return null;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-config",children:"cloud-config"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Config \u9700\u8981\u4e00\u4e2a\u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\u7684Git\u4ed3\u5e93\r\n\u5982\uff1ahttps://gitee.com/macrozheng/springcloud-config\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u670d\u52a1\u7aef-1",children:"\u670d\u52a1\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-config-server</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8901\r\nspring:\r\n application:\r\n  name: config-server\r\n cloud:\r\n  config:\r\n   server:\r\n    git: #\u914d\u7f6e\u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\u7684Git\u4ed3\u5e93\r\n     uri: https://gitee.com/dahua_0429/cloud-config.git\r\n     username: 1075335917@qq.com\r\n     password: h2050401938\r\n     clone-on-start: true #\u5f00\u542f\u542f\u52a8\u65f6\u76f4\u63a5\u4ecegit\u83b7\u53d6\u914d\u7f6e\r\n     search-paths: '{application}' # \u4f18\u5148\u5b50\u6587\u4ef6\u5939\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@EnableConfigServer\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class ConfigServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ConfigServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\u4fe1\u606f\u7684\u8bbf\u95ee\u683c\u5f0f\r\n-- \u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\r\n/{label}/{application}-{profile}\r\n-- \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\u4fe1\u606f\r\n/{label}/{application}-{profile}.yml\r\n\u5982\uff1ahttp://localhost:8901/master/config-dev.yml\r\n\r\napplication\uff1a\u4ee3\u8868\u5e94\u7528\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684spring.application.name\uff0c\u5982\u679c\u914d\u7f6e\u4e86spring.cloud.config.name\uff0c\u5219\u4e3a\u8be5\u540d\u79f0\uff1b\r\nlabel\uff1a\u4ee3\u8868\u5206\u652f\u540d\u79f0\uff0c\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684spring.cloud.config.label\uff1b\r\nprofile\uff1a\u4ee3\u8868\u73af\u5883\u540d\u79f0\uff0c\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684spring.cloud.config.profile\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5ba2\u6237\u7aef-1",children:"\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u914d\u7f6e\u6587\u4ef6\u4e3abootstrap.yaml\r\nserver:\r\n port: 9001\r\nspring:\r\n application:\r\n  name: config-client\r\n cloud:\r\n  config: #Config\u5ba2\u6237\u7aef\u914d\u7f6e\r\n   profile: dev #\u542f\u7528\u914d\u7f6e\u540e\u7f00\u540d\u79f0\r\n   label: dev #\u5206\u652f\u540d\u79f0\r\n   uri: http://localhost:8901 #\u914d\u7f6e\u4e2d\u5fc3\u5730\u5740\r\n   name: config #\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: 'refresh' # \u5237\u65b0\u914d\u7f6e\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6d4b\u8bd5\u914d\u7f6e\r\n */\r\n@RestController\r\npublic class ConfigClientController {\r\n\r\n    @Value("${config.info}")\r\n    private String configInfo;\r\n\r\n    @GetMapping("/configInfo")\r\n    public String getConfigInfo() {\r\n        return configInfo;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u5237\u65b0\u914d\u7f6e",children:"\u5237\u65b0\u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n   <groupId>org.springframework.boot</groupId>\r\n   <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"management:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'refresh'\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6dfb\u52a0@RefreshScope\u6ce8\u89e3\u5237\u65b0\u914d\u7f6e\r\n */\r\n@RestController\r\n@RefreshScope\r\npublic class ConfigClientController {\r\n\r\n    @Value("${config.info}")\r\n    private String configInfo;\r\n\r\n    @GetMapping("/configInfo")\r\n    public String getConfigInfo() {\r\n        return configInfo;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5237\u65b0\u914d\u7f6e\u63a5\u53e3\r\nPOST http://localhost:9001/actuator/refresh\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5b89\u5168\u8ba4\u8bc1",children:"\u5b89\u5168\u8ba4\u8bc1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-config-server</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8905\r\nspring:\r\n  application:\r\n    name: config-security-server\r\n  cloud:\r\n    config:\r\n      server:\r\n        git:\r\n          uri: https://gitee.com/macrozheng/springcloud-config.git\r\n          username: macro\r\n          password: 123456\r\n          clone-on-start: true #\u5f00\u542f\u542f\u52a8\u65f6\u76f4\u63a5\u4ecegit\u83b7\u53d6\u914d\u7f6e\r\n  security: #\u914d\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\r\n    user:\r\n      name: macro\r\n      password: 123456\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@SpringBootApplication\r\n@EnableConfigServer\r\npublic class ConfigSecurityServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ConfigSecurityServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u5ba2\u6237\u7aef\u4fee\u6539\u914d\u7f6e\uff0c\u6dfb\u52a0\u8ba4\u8bc1\u8d26\u53f7\u5bc6\u7801\r\nserver:\r\n  port: 9002\r\nspring:\r\n  application:\r\n    name: config-client\r\n  cloud:\r\n    config:\r\n      profile: dev #\u542f\u7528\u914d\u7f6e\u540e\u7f00\u540d\u79f0\r\n      label: dev #\u5206\u652f\u540d\u79f0\r\n      uri: http://localhost:8905 #\u914d\u7f6e\u4e2d\u5fc3\u5730\u5740\r\n      name: config #\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\r\n      username: macro\r\n      password: 123456\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u96c6\u7fa4\u642d\u5efa",children:"\u96c6\u7fa4\u642d\u5efa"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u542f\u52a8\u591a\u4e2a\u670d\u52a1\u7aef\uff0c\u8fde\u63a5\u540c\u4e00\u4e2a\u6ce8\u518c\u4e2d\u5fc3\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u5ba2\u6237\u7aef\u914d\u7f6e\uff1a\u6dfb\u52a0\u4e86\u4ece\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u914d\u7f6e\u4e2d\u5fc3\u5730\u5740\u7684\u914d\u7f6e\u5e76\u53bb\u9664\u4e86\u914d\u7f6e\u4e2d\u5fc3uri\u7684\u914d\u7f6e\r\nserver:\r\n port: 9003\r\nspring:\r\n application:\r\n  name: config-client\r\n cloud:\r\n  config:\r\n   profile: dev #\u542f\u7528\u73af\u5883\u540d\u79f0\r\n   label: dev #\u5206\u652f\u540d\u79f0\r\n   name: config #\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\r\n   discovery:\r\n    enabled: true\r\n    service-id: config-server\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-bus",children:"cloud-bus"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Bus \u4f7f\u7528\u8f7b\u91cf\u7ea7\u7684\u6d88\u606f\u4ee3\u7406\u6765\u8fde\u63a5\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u5404\u4e2a\u670d\u52a1\uff0c\u53ef\u4ee5\u5c06\u5176\u7528\u4e8e\u5e7f\u64ad\u72b6\u6001\u66f4\u6539\uff08\u4f8b\u5982\u914d\u7f6e\u4e2d\u5fc3\u914d\u7f6e\u66f4\u6539\uff09\u6216\u5176\u4ed6\u7ba1\u7406\u6307\u4ee4\r\n\r\n-- Spring Cloud Bus \u914d\u5408 Spring Cloud Config \u4f7f\u7528\u53ef\u4ee5\u5b9e\u73b0\u914d\u7f6e\u7684\u52a8\u6001\u5237\u65b0\r\n\r\n-- \u542f\u52a8rabbitMQ\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u52a8\u6001\u5237\u65b0\u914d\u7f6e",children:"\u52a8\u6001\u5237\u65b0\u914d\u7f6e"}),"\n",(0,a.jsx)(e.h6,{id:"\u670d\u52a1\u7aef-2",children:"\u670d\u52a1\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-bus-amqp</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# \u4e3b\u8981\u662f\u6dfb\u52a0\u4e86RabbitMQ\u7684\u914d\u7f6e\u53ca\u66b4\u9732\u4e86\u5237\u65b0\u914d\u7f6e\u7684Actuator\u7aef\u70b9\r\nserver:\r\n  port: 8904\r\nspring:\r\n  application:\r\n    name: config-server\r\n  cloud:\r\n    config:\r\n      server:\r\n        git:\r\n          uri: https://gitee.com/macrozheng/springcloud-config.git\r\n          username: macro\r\n          password: 123456\r\n          clone-on-start: true # \u5f00\u542f\u542f\u52a8\u65f6\u76f4\u63a5\u4ecegit\u83b7\u53d6\u914d\u7f6e\r\n  rabbitmq: #rabbitmq\u76f8\u5173\u914d\u7f6e\r\n    host: localhost\r\n    port: 5672\r\n    username: guest\r\n    password: guest\r\neureka:\r\n  client:\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n  endpoints: #\u66b4\u9732bus\u5237\u65b0\u914d\u7f6e\u7684\u7aef\u70b9\r\n    web:\r\n      exposure:\r\n        include: 'bus-refresh'\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u5ba2\u6237\u7aef-2",children:"\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-bus-amqp</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 9004\r\nspring:\r\n  application:\r\n    name: config-client\r\n  cloud:\r\n    config:\r\n      profile: dev #\u542f\u7528\u73af\u5883\u540d\u79f0\r\n      label: dev #\u5206\u652f\u540d\u79f0\r\n      name: config #\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\r\n      discovery:\r\n        enabled: true\r\n        service-id: config-server\r\n  rabbitmq: #rabbitmq\u76f8\u5173\u914d\u7f6e\r\n    host: localhost\r\n    port: 5672\r\n    username: guest\r\n    password: guest\r\neureka:\r\n  client:\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'refresh'\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u6f14\u793a-1",children:"\u6f14\u793a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"1. \u542f\u52a8eureka-server\r\n2. \u542f\u52a8config-server\r\n3. \u542f\u52a8\u4e24\u4e2a\u4e0d\u540c\u7aef\u53e3\u7684config-client\r\n\r\n\u767b\u5f55RabbitMQ\u7684\u63a7\u5236\u53f0\u53ef\u4ee5\u53d1\u73b0Spring Cloud Bus\u521b\u5efa\u4e86\u4e00\u4e2a\u53ebspringCloudBus\u7684\u4ea4\u6362\u673a\u53ca\u4e09\u4e2a\u4ee5 springCloudBus.anonymous\u5f00\u5934\u7684\u961f\u5217\r\n\r\n4. \u8c03\u7528\u6ce8\u518c\u4e2d\u5fc3\u7684\u63a5\u53e3\u5237\u65b0\u6240\u6709\u914d\u7f6e(\u4e24\u4e2a\u5ba2\u6237\u7aef)\r\nhttp://localhost:8904/actuator/bus-refresh\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u914d\u5408webhooks\u4f7f\u7528",children:"\u914d\u5408WebHooks\u4f7f\u7528"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"WebHooks\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u94a9\u5b50\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u5f53\u5411Git\u4ed3\u5e93push\u4ee3\u7801\u65f6\u89e6\u53d1\u8fd9\u4e2a\u94a9\u5b50\u51fd\u6570\uff0c\u8fd9\u91cc\u4ee5Gitee\u4e3a\u4f8b\u6765\u4ecb\u7ecd\u4e0b\u5176\u4f7f\u7528\u65b9\u5f0f\uff0c\u8fd9\u91cc\u5f53\u6211\u4eec\u5411\u914d\u7f6e\u4ed3\u5e93push\u4ee3\u7801\u65f6\u5c31\u4f1a\u81ea\u52a8\u5237\u65b0\u670d\u52a1\u914d\u7f6e\u4e86\r\n\r\ngit\u7ba1\u7406 \r\n--\x3e WebHooks \r\n--\x3e \u586b\u5199URl\uff1ahttp://localhost:8904/actuator/bus-refresh \r\n--\x3e \u52fe\u9009PUSH\u6dfb\u52a0\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-sleuth",children:"cloud-sleuth"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u9700\u8981\u94fe\u8def\u8ffd\u8e2a\u7684\u670d\u52a1\u90fd\u8981\u914d\u7f6e\u4e0b\u9762\u4fe1\u606f\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-zipkin</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  zipkin:\r\n    base-url: http://localhost:9411\r\n  sleuth:\r\n    sampler:\r\n      probability: 1 #\u8bbe\u7f6eSleuth\u7684\u62bd\u6837\u6536\u96c6\u6982\u73870-1\n"})}),"\n",(0,a.jsx)(e.h5,{id:"zipkin\u65e5\u5fd7",children:"zipkin\u65e5\u5fd7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Zipkin\u662fTwitter\u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u53ef\u4ee5\u7528\u6765\u83b7\u53d6\u548c\u5206\u6790Spring Cloud Sleuth \u4e2d\u4ea7\u751f\u7684\u8bf7\u6c42\u94fe\u8def\u8ddf\u8e2a\u65e5\u5fd7\uff0c\u5b83\u63d0\u4f9b\u4e86Web\u754c\u9762\u6765\u5e2e\u52a9\u6211\u4eec\u76f4\u89c2\u5730\u67e5\u770b\u8bf7\u6c42\u94fe\u8def\u8ddf\u8e2a\u4fe1\u606f\r\n\r\n-- \u4e0b\u8f7dzipkin-server\r\nhttps://repo1.maven.org/maven2/io/zipkin/java/zipkin-server/2.12.9/zipkin-server-2.12.9-exec.jar\r\n\r\n-- \u8fd0\u884c\r\njava -jar zipkin-server-2.12.9-exec.jar\r\n\r\n-- Zipkin\u9875\u9762\u8bbf\u95ee\u5730\u5740\r\nhttp://localhost:9411\n"})}),"\n",(0,a.jsx)(e.h5,{id:"elasticsearch\u5b58\u50a8\u65e5\u5fd7",children:"Elasticsearch\u5b58\u50a8\u65e5\u5fd7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- zipkin-server\u542f\u52a8\u547d\u4ee4\r\n# STORAGE_TYPE\u5b58\u50a8\u7c7b\u578b ES_HOSTS\u8bbf\u95ee\u5730\u5740\r\njava -jar zipkin-server-2.12.9-exec.jar --STORAGE_TYPE=elasticsearch --ES_HOSTS=localhost:9200 \n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-consul",children:"cloud-consul"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Consul \u5177\u6709\u7279\u6027\uff1a\r\n\u652f\u6301\u670d\u52a1\u6cbb\u7406\uff1aConsul\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\r\n\u652f\u6301\u5ba2\u6237\u7aef\u8d1f\u8d23\u5747\u8861\uff1a\u5305\u62ecRibbon\u548cSpring Cloud LoadBalancer\r\n\u652f\u6301Zuul\uff1a\u5f53Zuul\u4f5c\u4e3a\u7f51\u5173\u65f6\uff0c\u53ef\u4ee5\u4eceConsul\u4e2d\u6ce8\u518c\u548c\u53d1\u73b0\u5e94\u7528\uff1b\r\n\u652f\u6301\u5206\u5e03\u5f0f\u914d\u7f6e\u7ba1\u7406\uff1aConsul\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\r\n\u652f\u6301\u63a7\u5236\u603b\u7ebf\uff1a\u53ef\u4ee5\u5728\u6574\u4e2a\u5fae\u670d\u52a1\u7cfb\u7edf\u4e2d\u901a\u8fc7Control Bus\u5206\u53d1\u4e8b\u4ef6\u6d88\u606f,\u52a8\u6001\u5237\u65b0\u914d\u7f6e\r\n\r\n-- \u4e0b\u8f7d\u5730\u5740\r\nhttps://www.consul.io/downloads.html\r\n-- \u67e5\u770b\u7248\u672c\u53f7\r\nconsul --version\r\n-- \u4f7f\u7528\u5f00\u53d1\u6a21\u5f0f\u542f\u52a8\r\nconsul agent -dev \r\n-- \u8bbf\u95ee\r\nhttp://localhost:8500\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u6ce8\u518c\u4e2d\u5fc3",children:"\u6ce8\u518c\u4e2d\u5fc3"}),"\n",(0,a.jsx)(e.h6,{id:"\u5ba2\u6237\u7aef\u8d1f\u8f7d",children:"\u5ba2\u6237\u7aef\u8d1f\u8f7d"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-discovery</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\r\n\x3c!--\u8d1f\u8f7d--\x3e\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8308\r\nspring:\r\n application:\r\n  name: consul-ribbon-service\r\n cloud:\r\n  consul:\r\n   host: localhost\r\n   port: 8500\r\n   discovery:\r\n    service-name: ${spring.application.name}\r\nservice-url:\r\n consul-user-service: http://consul-user-service\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u914d\u7f6e\u4e2d\u5fc3",children:"\u914d\u7f6e\u4e2d\u5fc3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-discovery</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# application.yaml\r\nspring:\r\n  profiles:\r\n    active: dev\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# bootstrap.yaml\r\nserver:\r\n  port: 9101\r\nspring:\r\n  application:\r\n    name: consul-config-client\r\n  cloud:\r\n    consul:\r\n      host: localhost\r\n      port: 8500\r\n      discovery:\r\n        serviceName: consul-config-client\r\n      config:\r\n        enabled: true #\u662f\u5426\u542f\u7528\u914d\u7f6e\u4e2d\u5fc3\u529f\u80fd\r\n        format: yaml #\u8bbe\u7f6e\u914d\u7f6e\u503c\u7684\u683c\u5f0f\r\n        prefix: config #\u8bbe\u7f6e\u914d\u7f6e\u6240\u5728\u76ee\u5f55\r\n        profile-separator: ':' #\u8bbe\u7f6e\u914d\u7f6e\u7684\u5206\u9694\u7b26\r\n        data-key: data #\u914d\u7f6ekey\u7684\u540d\u5b57\uff0c\u7531\u4e8eConsul\u662fK/V\u5b58\u50a8\uff0c\u914d\u7f6e\u5b58\u50a8\u5728\u5bf9\u5e94K\u7684V\u4e2d\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- consul\u6dfb\u52a0\u914d\u7f6e\r\n-- key\r\nconfig/consul-config-client:dev/data\r\n-- value\r\nconfig:\r\n  info: "config info for dev"\n'})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-gateway",children:"cloud-gateway"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Gateway \u7279\u6027\r\n\u57fa\u4e8eSpring Framework 5, Project Reactor \u548c Spring Boot 2.0 \u8fdb\u884c\u6784\u5efa\uff1b\r\n\u52a8\u6001\u8def\u7531\uff1a\u80fd\u591f\u5339\u914d\u4efb\u4f55\u8bf7\u6c42\u5c5e\u6027\uff1b\r\n\u53ef\u4ee5\u5bf9\u8def\u7531\u6307\u5b9a Predicate\uff08\u65ad\u8a00\uff09\u548c Filter\uff08\u8fc7\u6ee4\u5668\uff09\uff1b\r\n\u96c6\u6210Hystrix\u7684\u65ad\u8def\u5668\u529f\u80fd\uff1b\r\n\u96c6\u6210 Spring Cloud \u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff1b\r\n\u6613\u4e8e\u7f16\u5199\u7684 Predicate\uff08\u65ad\u8a00\uff09\u548c Filter\uff08\u8fc7\u6ee4\u5668\uff09\uff1b\r\n\u8bf7\u6c42\u9650\u6d41\u529f\u80fd\uff1b\r\n\u652f\u6301\u8def\u5f84\u91cd\u5199;\r\n\r\nRoute\uff08\u8def\u7531\uff09\uff1a\u8def\u7531\u662f\u6784\u5efa\u7f51\u5173\u7684\u57fa\u672c\u6a21\u5757\uff0c\u5b83\u7531ID\uff0c\u76ee\u6807URI\uff0c\u4e00\u7cfb\u5217\u7684\u65ad\u8a00\u548c\u8fc7\u6ee4\u5668\u7ec4\u6210\uff0c\u5982\u679c\u65ad\u8a00\u4e3atrue\u5219\u5339\u914d\u8be5\u8def\u7531\uff1b\r\nPredicate\uff08\u65ad\u8a00\uff09\uff1a\u6307\u7684\u662fJava 8 \u7684 Function Predicate\u3002 \u8f93\u5165\u7c7b\u578b\u662fSpring\u6846\u67b6\u4e2d\u7684ServerWebExchange\u3002 \u8fd9\u4f7f\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5339\u914dHTTP\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u5185\u5bb9\uff0c\u4f8b\u5982\u8bf7\u6c42\u5934\u6216\u8bf7\u6c42\u53c2\u6570\u3002\u5982\u679c\u8bf7\u6c42\u4e0e\u65ad\u8a00\u76f8\u5339\u914d\uff0c\u5219\u8fdb\u884c\u8def\u7531\uff1b\r\nFilter\uff08\u8fc7\u6ee4\u5668\uff09\uff1a\u6307\u7684\u662fSpring\u6846\u67b6\u4e2dGatewayFilter\u7684\u5b9e\u4f8b\uff0c\u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u53ef\u4ee5\u5728\u8bf7\u6c42\u88ab\u8def\u7531\u524d\u540e\u5bf9\u8bf7\u6c42\u8fdb\u884c\u4fee\u6539\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-gateway</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# yaml\u914d\u7f6e\r\nserver:\r\n  port: 9201\r\nservice-url:\r\n  user-service: http://localhost:8201\r\nspring:\r\n  cloud:\r\n    gateway:\r\n      routes:\r\n        - id: path_route #\u8def\u7531\u7684ID\r\n          uri: ${service-url.user-service}/user/{id} #\u5339\u914d\u540e\u8def\u7531\u5730\u5740\r\n          predicates: # \u65ad\u8a00\uff0c\u8def\u5f84\u76f8\u5339\u914d\u7684\u8fdb\u884c\u8def\u7531\r\n            - Path=/user/{id}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * Java Bean \u914d\u7f6e\r\n */\r\n@Configuration\r\npublic class GatewayConfig {\r\n\r\n    @Bean\r\n    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {\r\n        return builder.routes()\r\n                .route("path_route2", r -> r.path("/user/getByUsername")\r\n                        .uri("http://localhost:8201/user/getByUsername"))\r\n                .build();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u8fc7\u6ee4\u5668-1",children:"\u8fc7\u6ee4\u5668"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5728\u4e00\u4e2a\u9ad8\u7684\u89d2\u5ea6\u6765\u770b\uff0cGlobal filters\u4f1a\u88ab\u5e94\u7528\u5230\u6240\u6709\u7684\u8def\u7531\u4e0a\uff0c\u800cGateway filter\u5c06\u5e94\u7528\u5230\u5355\u4e2a\u8def\u7531\u4e0a\u6216\u8005\u4e00\u4e2a\u5206\u7ec4\u7684\u8def\u7531\u4e0a\r\n\r\n-- \u5f53\u8bf7\u6c42\u8fdb\u5165\uff08\u5e76\u4e0e\u8def\u7531\u5339\u914d\uff09\u65f6\uff0c\u7b5b\u9009Web Handler\u4f1a\u5c06GlobalFilter\u7684\u6240\u6709\u5b9e\u4f8b\u548c\u6240\u6709\u7684GatewayFilter\u8def\u7531\u7279\u5b9a\u5b9e\u4f8b\u6dfb\u52a0\u5230 filter chain\u3002filter\u7ec4\u5408\u7684\u6392\u5e8f\u7531org.springframework.core.Ordered\u63a5\u53e3\u51b3\u5b9a\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0getOrde()\u65b9\u6cd5\u6216\u4f7f\u7528@Order\u6ce8\u91ca\u6765\u8bbe\u7f6e\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@Bean\r\n@Order(-1)\r\npublic GlobalFilter a() {\r\n    return (exchange, chain) -> {\r\n        log.info("first pre filter");\r\n        return chain.filter(exchange).then(Mono.fromRunnable(() -> {\r\n            log.info("third post filter");\r\n        }));\r\n    };\r\n}\r\n\r\n@Component\r\npublic class MyGlobalFilter implements GlobalFilter, Ordered {\r\n\r\n    @Override\r\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\r\n        return chain.filter(exchange).then(Mono.fromRunnable(() -> {\r\n            log.info("third post filter");\r\n        }));\r\n    }\r\n\r\n    @Override\r\n    public int getOrder() {\r\n        return 0;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u76d1\u63a7\u8bf7\u6c42",children:"\u76d1\u63a7\u8bf7\u6c42"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"management:\r\n endpoint:\r\n  gateway:\r\n   enabled: true\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: gateway\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# /actuator/gateway/globalfilters \u68c0\u7d22\u6240\u6709global filter\r\n# /actuator/gateway/routefilters \u68c0\u7d22\u6240\u6709GatewayFilter factories\r\n# /actuator/gateway/refresh \u6e05\u7406\u8def\u7531\u7f13\u5b58\r\n# /actuator/gateway/routes \u68c0\u7d22\u7f51\u5173\u4e2d\u5b9a\u4e49\u7684\u8def\u7531\r\n# /actuator/gateway/routes/{id} \u83b7\u53d6\u5355\u4e2a\u8def\u7531\u7684\u4fe1\u606f\r\n# /gateway/routes/{id_route_to_create} \u521b\u5efa\u4e00\u4e2a\u8def\u7531\r\n# /gateway/routes/{id_route_to_delete} \u5220\u9664\u4e00\u4e2a\u8def\u7531\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/gateway-endpoints%E7%9B%91%E6%8E%A7%E8%AF%B7%E6%B1%82.png",width:"50%"}),"\n",(0,a.jsx)(e.h5,{id:"\u5de5\u4f5c\u539f\u7406",children:"\u5de5\u4f5c\u539f\u7406"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"\u5ba2\u6237\u7aef\u5411Spring Cloud Gateway\u53d1\u51fa\u8bf7\u6c42\u3002\r\n\u5982\u679cGateway Handler Mapping\u786e\u5b9a\u8bf7\u6c42\u4e0e\u8def\u7531\u5339\u914d\uff0c\u5219\u5c06\u5176\u53d1\u9001\u5230Gateway Web Handler\u3002\r\n\u6b64handler\u901a\u8fc7\u7279\u5b9a\u4e8e\u8be5\u8bf7\u6c42\u7684\u8fc7\u6ee4\u5668\u94fe\u5904\u7406\u8bf7\u6c42\u3002\r\n\u56fe\u4e2dfilters\u88ab\u865a\u7ebf\u5212\u5206\u7684\u539f\u56e0\u662ffilters\u53ef\u4ee5\u5728\u53d1\u9001\u4ee3\u7406\u8bf7\u6c42\u4e4b\u524d\u6216\u4e4b\u540e\u6267\u884c\u903b\u8f91\u3002\r\n\u5148\u6267\u884c\u6240\u6709\u201cpre filter\u201d\u903b\u8f91\uff0c\u7136\u540e\u8fdb\u884c\u8bf7\u6c42\u4ee3\u7406\u3002\r\n\u5728\u8bf7\u6c42\u4ee3\u7406\u6267\u884c\u5b8c\u540e\uff0c\u6267\u884c\u201cpost filter\u201d\u903b\u8f91\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/gateway%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png",width:"50%"}),"\n",(0,a.jsx)(e.h4,{id:"cloud-nacos",children:"cloud-nacos"}),"\n",(0,a.jsx)(e.h5,{id:"\u6ce8\u518c\u4e2d\u5fc3-1",children:"\u6ce8\u518c\u4e2d\u5fc3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\x3c!-- \r\n\t\u5982\u679c\u8981\u4f7f\u7528Spring Cloud Alibaba \u7684\u7ec4\u4ef6\u90fd\u9700\u8981\u5728pom.xml\u4e2d\u6dfb\u52a0\u5982\u4e0b\u7684\u914d\u7f6e \r\n\tnacos\u9700\u8981web\u4f9d\u8d56\r\n--\x3e\r\n<dependencyManagement>\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>com.alibaba.cloud</groupId>\r\n            <artifactId>spring-cloud-alibaba-dependencies</artifactId>\r\n            <version>2.1.0.RELEASE</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n    </dependencies>\r\n</dependencyManagement>\r\n\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n    <version>2.1.7.RELEASE</version>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8206\r\nspring:\r\n  application:\r\n    name: nacos-user-service\r\n  cloud:\r\n    nacos:\r\n      discovery:\r\n        server-addr: localhost:8848 #\u914d\u7f6eNacos\u5730\u5740\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: '*'\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u914d\u7f6e\u4e2d\u5fc3-1",children:"\u914d\u7f6e\u4e2d\u5fc3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# application.yaml\r\nspring:\r\n  profiles:\r\n    active: dev\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"# bootstrap.yaml\r\nserver:\r\n  port: 9101\r\nspring:\r\n  application:\r\n    name: nacos-config-client\r\n  cloud:\r\n    nacos:\r\n      discovery:\r\n        server-addr: localhost:8848 #Nacos\u5730\u5740\r\n      config:\r\n        server-addr: localhost:8848 #Nacos\u5730\u5740\r\n        file-extension: yaml #\u8fd9\u91cc\u6211\u4eec\u83b7\u53d6\u7684yaml\u683c\u5f0f\u7684\u914d\u7f6e\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u987a\u5e8f",children:"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u987a\u5e8f"}),"\n",(0,a.jsx)(e.p,{children:"\u4f18\u5148\u7ea7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u4f18\u5148\u7ea7\r\na < b1 < b2 < c1 < c2 < d1 < d2 < e < f\r\n-- \u5404\u7ea7\u522b\u63cf\u8ff0\r\na\uff1aapplication.properties\r\nb1\uff1abootstrap.properties\r\nb2\uff1abootstrap-{profile}.properties \r\nc1\uff1a\u901a\u8fc7 spring.cloud.nacos.config.shared-configs[1].data-id \u652f\u6301\u591a\u4e2a\u5171\u4eab Data Id \u7684\u914d\u7f6e\r\nc2\uff1a\u901a\u8fc7 spring.cloud.nacos.config.shared-configs[n].data-id \u652f\u6301\u591a\u4e2a\u5171\u4eab Data Id \u7684\u914d\u7f6e\r\nd1\uff1a\u901a\u8fc7 spring.cloud.nacos.config.extension-configs[0].data-id \u652f\u6301\u591a\u4e2a\u6269\u5c55 Data Id \u7684\u914d\u7f6e\r\nd2\uff1a\u901a\u8fc7 spring.cloud.nacos.config.extension-configs[n].data-id \u652f\u6301\u591a\u4e2a\u6269\u5c55 Data Id \u7684\u914d\u7f6e\r\ne\uff1a\u901a\u8fc7\u5185\u90e8\u76f8\u5173\u89c4\u5219(\u5e94\u7528\u540d\u3001\u5e94\u7528\u540d+ Profile )\u81ea\u52a8\u751f\u6210\u76f8\u5173\u7684 Data Id \u914d\u7f6e ,\u5982 scrm-base-service.properties\r\nf\uff1aVM option\n"})}),"\n",(0,a.jsx)(e.p,{children:"nacos\u4e09\u7ea7\u914d\u7f6e\u4f18\u5148\u7ea7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- nacos\u4e09\u7ea7\u914d\u7f6e\u4f18\u5148\u7ea7\r\n\u4e09\u7ea7\u914d\u7f6e\u7684\u4f18\u5148\u7ea7\u5982\u4e0b\uff1a\u4e3b\u914d\u7f6e > \u6269\u5c55\u914d\u7f6e > \u5171\u4eab\u914d\u7f6e\r\n-- \u4e09\u7ea7\u914d\u7f6e\u63cf\u8ff0\r\n-- \u4e3b\u914d\u7f6e\uff08\u9ed8\u8ba4${spring.application.name}.properties\uff09\uff08\u4e0d\u4f1a\u88ab\u540c\u540d\u5c5e\u6027\u8986\u76d6\uff09\r\n${prefix}-${spring.profiles.active}.${file-extension}\r\n\u9996\u5148\u4f1a\u53bb\u6307\u5b9anamespace\u548cgroup\u4e0b\u52a0\u8f7d\u6307\u5b9adataId(\u5e26\u540e\u7f00)\uff0c\u5982\u679c\u52a0\u8f7d\u4e0d\u5230\uff0c\u4f1a\u7ee7\u7eed\u52a0\u8f7ddataId(\u4e0d\u5e26\u540e\u7f00)\r\n-- \u5171\u4eab\u914d\u7f6e\u548c\u6269\u5c55\u914d\u7f6e\u533a\u522b\r\nnacos\u5bf9\u914d\u7f6e\u7684\u9ed8\u8ba4\u7406\u5ff5(namespace\u533a\u5206\u73af\u5883\uff0cgroup\u533a\u5206\u4e0d\u540c\u5e94\u7528)\r\n1.\u4e3b\u914d\u7f6e\u662f\u5e94\u7528\u4e13\u6709\u7684\u914d\u7f6e(\u56e0\u6b64\uff0c\u4e3b\u914d\u7f6e\u5e94\u5f53\u5728dataId\u4e0a\u8981\u533a\u5206\uff0c\u540c\u65f6\u6700\u597d\u8fd8\u8981\u6709 group \u7684\u533a\u5206)\r\n2.\u8981\u5728\u5404\u5e94\u7528\u4e4b\u95f4\u5171\u4eab\u4e00\u4e2a\u914d\u7f6e\uff0c\u8bf7\u4f7f\u7528\u4e0a\u9762\u7684 shared-configs\r\n3.\u5982\u679c\u8981\u5728\u7279\u5b9a\u8303\u56f4\u5185\uff08\u6bd4\u5982\u67d0\u4e2a\u5e94\u7528\u4e0a\uff09\u8986\u76d6\u67d0\u4e2a\u5171\u4eabdataId\u4e0a\u7684\u7279\u5b9a\u5c5e\u6027\uff0c\u8bf7\u4f7f\u7528 extension-configs\n"})}),"\n",(0,a.jsx)(e.p,{children:"bootstrap\u548capplication"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u8be6\u7ec6\u63cf\u8ff0(bootstrap\u548capplication)\r\nbootstrap.yml\u7528\u4e8eApplicationContext\u5f15\u5bfc\u9636\u6bb5\u3002\u7531\u7236Spring ApplicationContext\u52a0\u8f7d\u3002\u5b9a\u4e49\u7cfb\u7edf\u7ea7\u522b\u7684\u53c2\u6570\u914d\u7f6e\uff0c\u8fd9\u4e9b\u53c2\u6570\u4e00\u822c\u4e0d\u4f1a\u53d8\u52a8\u3002\r\napplication.yml \u7528\u6765\u5b9a\u4e49\u5e94\u7528\u7ea7\u522b\u7684\u53c2\u6570\u914d\u7f6e\u3002\u642d\u914d spring-cloud-config \u4f7f\u7528\u65f6application.yml\u5b9a\u4e49\u7684\u53c2\u6570\u53ef\u4ee5\u5b9e\u73b0\u52a8\u6001\u66ff\u6362\u3002\r\napplication.yml \u4f1a\u8986\u76d6 bootstrap.yml \u7684\u53c2\u6570\u914d\u7f6e\u3002\r\n-- applicaiton\u52a0\u8f7d\uff08\u9ed8\u8ba4\u4f1a\u4ece4\u4e2a\u8def\u5f84\u53bb\u627eapplication\u914d\u7f6e\uff09\r\n\u5047\u8bbe\u5f53\u524d\u8fd0\u884c\u76ee\u5f55\u4e3a/\uff1a /config > / > classpath:/config > classpath:/\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u81ea\u5df1\u6d4b\u8bd5\u4f18\u5148\u7ea7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"1. nacos\u914d\u7f6e\u4e2d\u5fc3\u4e3b\u914d\u7f6e \u8986\u76d6 springboot\u52a0\u8f7d\u7684application.yaml\r\n2. application.yml \u8986\u76d6 bootstrap.yml \u7684\u53c2\u6570\u914d\u7f6e\u3002\n"})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-sentinel",children:"cloud-sentinel"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Sentinel\u7279\u6027\r\n\u7194\u65ad\u964d\u7ea7\r\n\r\n-- \u4e0b\u8f7d\u5730\u5740\r\nhttps://github.com/alibaba/Sentinel/releases\r\n\r\n-- \u542f\u52a8jar\uff0c\u9ed8\u8ba48080\r\njava -jar sentinel-dashboard-1.6.3.jar\r\njava -Dserver.port=9999 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.6.jar\r\n\r\n-- \u8bbf\u95ee\uff0c\u8d26\u53f7\u5bc6\u7801sentinel\r\nhttp://localhost:9000\r\n\r\n-- Sentinel\u91c7\u7528\u7684\u61d2\u52a0\u8f7d\u89c4\u5219\uff0c\u9700\u8981\u6211\u4eec\u5148\u8bbf\u95ee\u4e0b\u63a5\u53e3\uff0cSentinel\u63a7\u5236\u53f0\u4e2d\u624d\u4f1a\u6709\u5bf9\u5e94\u670d\u52a1\u4fe1\u606f\r\n\u53d6\u6d88\u61d2\u52a0\u8f7d \uff1asentinel.eager: true\r\n\r\n-- nacos\u5b58\u50a8\u53c2\u6570\u89e3\u91ca\r\nresource\uff1a\u8d44\u6e90\u540d\u79f0\uff1b\r\nlimitApp\uff1a\u6765\u6e90\u5e94\u7528\uff1b\r\ngrade\uff1a\u9608\u503c\u7c7b\u578b\uff0c0\u8868\u793a\u7ebf\u7a0b\u6570\uff0c1\u8868\u793aQPS\uff1b\r\ncount\uff1a\u5355\u673a\u9608\u503c\uff1b\r\nstrategy\uff1a\u6d41\u63a7\u6a21\u5f0f\uff0c0\u8868\u793a\u76f4\u63a5\uff0c1\u8868\u793a\u5173\u8054\uff0c2\u8868\u793a\u94fe\u8def\uff1b\r\ncontrolBehavior\uff1a\u6d41\u63a7\u6548\u679c\uff0c0\u8868\u793a\u5feb\u901f\u5931\u8d25\uff0c1\u8868\u793aWarm Up\uff0c2\u8868\u793a\u6392\u961f\u7b49\u5f85\uff1b\r\nclusterMode\uff1a\u662f\u5426\u96c6\u7fa4;\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\x3c!--sentinel \u9650\u6d41\u7194\u70b9\u964d\u7ea7--\x3e\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-alibaba-sentinel-gateway</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\r\n</dependency>\r\n\x3c!-- sentinel\u96c6\u6210nacos\u4f5c\u4e3a\u6570\u636e\u6e90 --\x3e\r\n<dependency>\r\n    <groupId>com.alibaba.csp</groupId>\r\n    <artifactId>sentinel-datasource-nacos</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n cloud:\r\n #Sentinel\u914d\u7f6e\r\n  sentinel:\r\n   transport:\r\n    dashboard: localhost:9000\r\n   # \u652f\u6301\u94fe\u8def\u9650\u6d41\r\n   web-context-unify: false\r\n   # Sentinel \u7f51\u5173\u6d41\u63a7\u9ed8\u8ba4\u7684\u7c92\u5ea6\u662f route \u7ef4\u5ea6\u4ee5\u53ca\u81ea\u5b9a\u4e49 API \u5206\u7ec4\u7ef4\u5ea6\uff0c\u9ed8\u8ba4\u4e0d\u652f\u6301 URL \u7c92\u5ea6\r\n   filter:\r\n    enabled: false\r\n   # Sentinel\u63a7\u5236\u53f0\u61d2\u52a0\u8f7d-\u5f00\u542f\u9965\u997f\r\n   eager: true\r\n   datasource:\r\n    #\u6d41\u63a7\u89c4\u5219\r\n    flow: # \u6307\u5b9a\u6570\u636e\u6e90\u540d\u79f0\r\n     # \u6307\u5b9anacos\u6570\u636e\u6e90\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      # \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\r\n      dataId: ${spring.application.name}-flow-rules\r\n      # \u6307\u5b9a\u5206\u7ec4\r\n      groupId: SENTINEL_GROUP\r\n      # \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u89c4\u5219\u7c7b\u578b\r\n      rule-type: flow\r\n      # \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u6570\u636e\u683c\u5f0f\r\n      data-type: json\r\n    #\u964d\u7ea7\u89c4\u5219\r\n    degrade:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-degrade-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: degrade\r\n      data-type: json\r\n    #\u7cfb\u7edf\u89c4\u5219\r\n    system:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-system-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: system\r\n      data-type: json\r\n    #\u6388\u6743\u89c4\u5219\r\n    authority:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-authority-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: authority\r\n      data-type: json\r\n    #\u70ed\u70b9\u53c2\u6570\r\n    param-flow:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-param-flow-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: param-flow\r\n      data-type: json\r\n    #\u7f51\u5173\u6d41\u63a7\u89c4\u5219\r\n    gw-flow:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-flow-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: gw-flow\r\n      data-type: json\r\n    #API\u6d41\u63a7\u89c4\u5219\r\n    gw-api-group:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-api-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: gw-api-group\r\n      data-type: json\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u9650\u6d41",children:"\u9650\u6d41"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- Sentinel Starter \u9ed8\u8ba4\u4e3a\u6240\u6709\u7684 HTTP \u670d\u52a1\u63d0\u4f9b\u4e86\u9650\u6d41\u57cb\u70b9\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528@SentinelResource\u6765\u81ea\u5b9a\u4e49\u4e00\u4e9b\u9650\u6d41\u884c\u4e3a\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u9650\u6d41\u529f\u80fd\r\n * \u7528\u4e8e\u6d4b\u8bd5\u7194\u65ad\u548c\u9650\u6d41\u529f\u80fd.\r\n */\r\n@RestController\r\n@RequestMapping("/rateLimit")\r\npublic class RateLimitController {\r\n\r\n    /**\r\n     * \u6309\u8d44\u6e90\u540d\u79f0\u9650\u6d41\uff0c\u9700\u8981\u6307\u5b9a\u9650\u6d41\u5904\u7406\u903b\u8f91\r\n     */\r\n    @GetMapping("/byResource")\r\n    @SentinelResource(value = "byResource",blockHandler = "handleException")\r\n    public CommonResult byResource() {\r\n        return new CommonResult("\u6309\u8d44\u6e90\u540d\u79f0\u9650\u6d41", 200);\r\n    }\r\n\r\n    /**\r\n     * \u6309URL\u9650\u6d41\uff0c\u6709\u9ed8\u8ba4\u7684\u9650\u6d41\u5904\u7406\u903b\u8f91\r\n     */\r\n    @GetMapping("/byUrl")\r\n    @SentinelResource(value = "byUrl",blockHandler = "handleException")\r\n    public CommonResult byUrl() {\r\n        return new CommonResult("\u6309url\u9650\u6d41", 200);\r\n    }\r\n\r\n    public CommonResult handleException(BlockException exception){\r\n        return new CommonResult(exception.getClass().getCanonicalName(),200);\r\n    }\r\n\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u6839\u636e\u8d44\u6e90\u540d\u79f0\u9650\u6d41",children:"\u6839\u636e\u8d44\u6e90\u540d\u79f0\u9650\u6d41"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- \u5728Sentinel\u63a7\u5236\u53f0\u914d\u7f6e\u6d41\u63a7\u89c4\u5219\uff0c\u6839\u636e@SentinelResource\u6ce8\u89e3\u7684value\u503c\uff0c\u5982\uff1a\r\n[\r\n    {\r\n        "resource": "byResource",\r\n        "limitApp": "default",\r\n        "grade": 1,\r\n        "count": 1,\r\n        "strategy": 0,\r\n        "controlBehavior": 0,\r\n        "clusterMode": false\r\n    }\r\n]\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u6839\u636eurl\u9650\u6d41",children:"\u6839\u636eURL\u9650\u6d41"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- \u5728Sentinel\u63a7\u5236\u53f0\u914d\u7f6e\u6d41\u63a7\u89c4\u5219\uff0c\u4f7f\u7528\u8bbf\u95ee\u7684URL\uff0c\u5982\uff1a\r\n[\r\n    {\r\n        "resource": "/rateLimit/byUrl",\r\n        "limitApp": "default",\r\n        "grade": 1,\r\n        "count": 1,\r\n        "strategy": 0,\r\n        "controlBehavior": 0,\r\n        "clusterMode": false\r\n    }\r\n]\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u7194\u65ad\u529f\u80fd",children:"\u7194\u65ad\u529f\u80fd"}),"\n",(0,a.jsx)(e.h6,{id:"resttemplate\u8c03\u7528\u65b9\u5f0f",children:"RestTemplate\u8c03\u7528\u65b9\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * Created by macro on 2019/8/29.\r\n */\r\n@Configuration\r\npublic class RibbonConfig {\r\n\r\n    @Bean\r\n    @SentinelRestTemplate\r\n    public RestTemplate restTemplate(){\r\n        return new RestTemplate();\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7194\u65ad\u529f\u80fd\r\n * Created by macro on 2019/11/7.\r\n */\r\n@RestController\r\n@RequestMapping("/breaker")\r\npublic class CircleBreakerController {\r\n\r\n    private Logger LOGGER = LoggerFactory.getLogger(CircleBreakerController.class);\r\n    @Autowired\r\n    private RestTemplate restTemplate;\r\n    @Value("${service-url.user-service}")\r\n    private String userServiceUrl;\r\n\r\n    @RequestMapping("/fallback/{id}")\r\n    @SentinelResource(value = "fallback",fallback = "handleFallback")\r\n    public CommonResult fallback(@PathVariable Long id) {\r\n        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n    }\r\n\r\n    //\u5ffd\u7565\u7a7a\u6307\u9488\u5f02\u5e38\r\n    @RequestMapping("/fallbackException/{id}")\r\n    @SentinelResource(value = "fallbackException",fallback = "handleFallback2", exceptionsToIgnore = {NullPointerException.class})\r\n    public CommonResult fallbackException(@PathVariable Long id) {\r\n        if (id == 1) {\r\n            throw new IndexOutOfBoundsException();\r\n        } else if (id == 2) {\r\n            throw new NullPointerException();\r\n        }\r\n        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n    }\r\n\r\n    public CommonResult handleFallback(Long id) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670d\u52a1\u964d\u7ea7\u8fd4\u56de",200);\r\n    }\r\n\r\n    public CommonResult handleFallback2(@PathVariable Long id, Throwable e) {\r\n        LOGGER.error("handleFallback2 id:{},throwable class:{}", id, e.getClass());\r\n        User defaultUser = new User(-2L, "defaultUser2", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670d\u52a1\u964d\u7ea7\u8fd4\u56de",200);\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"feign\u8c03\u7528\u65b9\u5f0f",children:"feign\u8c03\u7528\u65b9\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\x3c!-- \u5728\u542f\u52a8\u7c7b\u52a0Enable\u6ce8\u89e3--\x3e\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"feign:\r\n  sentinel:\r\n    enabled: true #\u6253\u5f00sentinel\u5bf9feign\u7684\u652f\u6301\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * feign\u63a5\u53e3\r\n */\r\n@FeignClient(value = "nacos-user-service",fallback = UserFallbackService.class)\r\npublic interface UserService {\r\n    @PostMapping("/user/create")\r\n    CommonResult create(@RequestBody User user);\r\n\r\n    @GetMapping("/user/{id}")\r\n    CommonResult<User> getUser(@PathVariable Long id);\r\n\r\n    @GetMapping("/user/getByUsername")\r\n    CommonResult<User> getByUsername(@RequestParam String username);\r\n\r\n    @PostMapping("/user/update")\r\n    CommonResult update(@RequestBody User user);\r\n\r\n    @PostMapping("/user/delete/{id}")\r\n    CommonResult delete(@PathVariable Long id);\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u964d\u7ea7\u64cd\u4f5c\r\n */\r\n@Component\r\npublic class UserFallbackService implements UserService {\r\n    @Override\r\n    public CommonResult create(User user) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670d\u52a1\u964d\u7ea7\u8fd4\u56de",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult<User> getUser(Long id) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670d\u52a1\u964d\u7ea7\u8fd4\u56de",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult<User> getByUsername(String username) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670d\u52a1\u964d\u7ea7\u8fd4\u56de",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult update(User user) {\r\n        return new CommonResult("\u8c03\u7528\u5931\u8d25\uff0c\u670d\u52a1\u88ab\u964d\u7ea7",500);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult delete(Long id) {\r\n        return new CommonResult("\u8c03\u7528\u5931\u8d25\uff0c\u670d\u52a1\u88ab\u964d\u7ea7",500);\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-seata",children:"cloud-seata"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7531\u4e8e\u5168\u5c40\u6570\u636e\u4e00\u81f4\u6027\u6ca1\u6cd5\u4fdd\u8bc1\u4ea7\u751f\u7684\u95ee\u9898\u5c31\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u4e00\u6b21\u4e1a\u52a1\u64cd\u4f5c\u9700\u8981\u64cd\u4f5c\u591a\u4e2a\u6570\u636e\u6e90\u6216\u9700\u8981\u8fdb\u884c\u8fdc\u7a0b\u8c03\u7528\uff0c\u5c31\u4f1a\u4ea7\u751f\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\r\n\r\n-- Seata \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u81f4\u529b\u4e8e\u63d0\u4f9b\u9ad8\u6027\u80fd\u548c\u7b80\u5355\u6613\u7528\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u670d\u52a1\u3002Seata \u5c06\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86 AT\u3001TCC\u3001SAGA \u548c XA \u4e8b\u52a1\u6a21\u5f0f\uff0c\u4e3a\u7528\u6237\u6253\u9020\u4e00\u7ad9\u5f0f\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\r\n\r\n-- \u4e09\u4e2a\u7ec4\u4ef6\r\nTransaction Coordinator (TC)\uff1a \u4e8b\u52a1\u534f\u8c03\u5668\uff0c\u7ef4\u62a4\u5168\u5c40\u4e8b\u52a1\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u8d1f\u8d23\u534f\u8c03\u5e76\u9a71\u52a8\u5168\u5c40\u4e8b\u52a1\u7684\u63d0\u4ea4\u6216\u56de\u6eda\uff1b\r\nTransaction Manager (TM)\uff1a \u63a7\u5236\u5168\u5c40\u4e8b\u52a1\u7684\u8fb9\u754c\uff0c\u8d1f\u8d23\u5f00\u542f\u4e00\u4e2a\u5168\u5c40\u4e8b\u52a1\uff0c\u5e76\u6700\u7ec8\u53d1\u8d77\u5168\u5c40\u63d0\u4ea4\u6216\u5168\u5c40\u56de\u6eda\u7684\u51b3\u8bae\uff1b\r\nResource Manager (RM)\uff1a \u63a7\u5236\u5206\u652f\u4e8b\u52a1\uff0c\u8d1f\u8d23\u5206\u652f\u6ce8\u518c\u3001\u72b6\u6001\u6c47\u62a5\uff0c\u5e76\u63a5\u6536\u4e8b\u52a1\u534f\u8c03\u5668\u7684\u6307\u4ee4\uff0c\u9a71\u52a8\u5206\u652f\uff08\u672c\u5730\uff09\u4e8b\u52a1\u7684\u63d0\u4ea4\u548c\u56de\u6eda\r\n\r\n-- \u7b80\u5355\u8fc7\u7a0b\r\n1\u3001TM \u5411 TC \u7533\u8bf7\u5f00\u542f\u4e00\u4e2a\u5168\u5c40\u4e8b\u52a1\uff0c\u5168\u5c40\u4e8b\u52a1\u521b\u5efa\u6210\u529f\u5e76\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 XID\uff1b\r\n2\u3001XID \u5728\u5fae\u670d\u52a1\u8c03\u7528\u94fe\u8def\u7684\u4e0a\u4e0b\u6587\u4e2d\u4f20\u64ad\uff1b\r\n3\u3001RM \u5411 TC \u6ce8\u518c\u5206\u652f\u4e8b\u52a1\uff0c\u5c06\u5176\u7eb3\u5165 XID \u5bf9\u5e94\u5168\u5c40\u4e8b\u52a1\u7684\u7ba1\u8f96\uff1b\r\n4\u3001TM \u5411 TC \u53d1\u8d77\u9488\u5bf9 XID \u7684\u5168\u5c40\u63d0\u4ea4\u6216\u56de\u6eda\u51b3\u8bae\uff1b\r\n5\u3001TC \u8c03\u5ea6 XID \u4e0b\u7ba1\u8f96\u7684\u5168\u90e8\u5206\u652f\u4e8b\u52a1\u5b8c\u6210\u63d0\u4ea4\u6216\u56de\u6eda\u8bf7\u6c42\u3002\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u642d\u5efaseata\u670d\u52a1\u7aef",children:"\u642d\u5efaseata\u670d\u52a1\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u4e0b\u8f7d\u5730\u5740\r\nhttps://github.com/seata/seata/releases\r\n\r\n-- \u4f7f\u7528nacos\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'## file.config\r\n## transaction log store, only used in seata-server\r\nstore {\r\n  ## store mode: file\u3001db\u3001redis\r\n  mode = "db"\r\n  ## rsa decryption public key\r\n  publicKey = ""\r\n  ## database store property\r\n  db {\r\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.\r\n    datasource = "dbcp"\r\n    ## mysql/oracle/postgresql/h2/oceanbase etc.\r\n    dbType = "mysql"\r\n    driverClassName = "com.mysql.jdbc.Driver"\r\n    ## if using mysql to store the data, recommend add rewriteBatchedStatements=true in jdbc connection param\r\n    url = "jdbc:mysql://127.0.0.1:3306/seata-server?rewriteBatchedStatements=true"\r\n    user = "root"\r\n    password = "root"\r\n    minConn = 5\r\n    maxConn = 100\r\n    globalTable = "global_table"\r\n    branchTable = "branch_table"\r\n    lockTable = "lock_table"\r\n    queryLimit = 100\r\n    maxWait = 5000\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'# registry.conf\r\nregistry {\r\n  # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\r\n  type = "nacos"\r\n  nacos {\r\n    application = "seata-server"\r\n    serverAddr = "127.0.0.1:8848"\r\n    group = "DEFAULT_GROUP"\r\n    namespace = ""\r\n    cluster = "default"\r\n    username = "nacos"\r\n    password = "nacos"\r\n  }\r\n}\r\nconfig {\r\n  # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\r\n  type = "file"\r\n  file {\r\n    name = "file.conf"\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(e.h5,{id:"\u5ba2\u6237\u7aef-3",children:"\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<properties>\r\n    <java.version>1.8</java.version>\r\n    <spring-cloud-alibaba.version>2.2.7.RELEASE</spring-cloud-alibaba.version>\r\n    <springboot.version>2.2.12.RELEASE</springboot.version>\r\n    <lombok.version>1.18.8</lombok.version>\r\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n    <sikpTests>true</sikpTests>\r\n    <maven-source-plugin.version>3.0.1</maven-source-plugin.version>\r\n    <maven-surefire-plugin.version>2.22.1</maven-surefire-plugin.version>\r\n    <seata.version>1.4.2</seata.version>\r\n    <mybatis-plus-boot-starter.version>3.3.0</mybatis-plus-boot-starter.version>\r\n</properties>\r\n<dependencies>\r\n    \x3c!--nacos--\x3e\r\n    <dependency>\r\n        <groupId>com.alibaba.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n    </dependency>\r\n    \x3c!--seata--\x3e\r\n    <dependency>\r\n        <groupId>com.alibaba.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\r\n        <version>${spring-cloud-alibaba.version}</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>io.seata</groupId>\r\n        <artifactId>seata-spring-boot-starter</artifactId>\r\n        <version>1.4.2</version>\r\n    </dependency>\r\n    \x3c!-- mybatis --\x3e\r\n    <dependency>\r\n        <groupId>com.baomidou</groupId>\r\n        <artifactId>mybatis-plus-boot-starter</artifactId>\r\n        <version>${mybatis-plus-boot-starter.version}</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>mysql</groupId>\r\n        <artifactId>mysql-connector-java</artifactId>\r\n    </dependency>\r\n    \x3c!--feign--\x3e\r\n    <dependency>\r\n        <groupId>org.springframework.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n        <version>2.2.6.RELEASE</version>\r\n    </dependency>\r\n</dependencies>\r\n<dependencyManagement>\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-dependencies</artifactId>\r\n            <version>${springboot.version}</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n        \x3c!--Spring Cloud Alibaba--\x3e\r\n        <dependency>\r\n            <groupId>com.alibaba.cloud</groupId>\r\n            <artifactId>spring-cloud-alibaba-dependencies</artifactId>\r\n            <version>${spring-cloud-alibaba.version}</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.projectlombok</groupId>\r\n            <artifactId>lombok</artifactId>\r\n            <version>${lombok.version}</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>mysql</groupId>\r\n            <artifactId>mysql-connector-java</artifactId>\r\n            <version>8.0.28</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.alibaba.spring</groupId>\r\n            <artifactId>spring-context-support</artifactId>\r\n            <version>1.0.11</version>\r\n        </dependency>\r\n    </dependencies>\r\n</dependencyManagement>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8182\r\nspring:\r\n application:\r\n  name: seata-account-service\r\n cloud:\r\n  nacos:\r\n   discovery:\r\n    server-addr: 127.0.0.1:8848\r\n datasource:\r\n  driverClassName: com.mysql.jdbc.Driver\r\n  password: root\r\n  url: jdbc:mysql://localhost:3306/seat-account?allowMultiQueries=true\r\n  username: root\r\nlogging:\r\n level:\r\n  io:\r\n   seata: info\r\nmybatis:\r\n mapperLocations: classpath:mapper/*.xml\r\nseata:\r\n tx-service-group: my_test_tx_group\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- \u6ce8\u89e3\u4f7f\u7528\r\n@GlobalTransactional(name = "fsp-create-order",rollbackFor = Exception.class)\n'})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-oauth2",children:"cloud-oauth2"}),"\n",(0,a.jsx)(e.h5,{id:"oauth2\u76f8\u5173\u540d\u8bcd",children:"OAuth2\u76f8\u5173\u540d\u8bcd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- OAuth2\u76f8\u5173\u540d\u8bcd\u89e3\u91ca\r\nResource owner\uff08\u8d44\u6e90\u62e5\u6709\u8005\uff09\uff1a\u62e5\u6709\u8be5\u8d44\u6e90\u7684\u6700\u7ec8\u7528\u6237\uff0c\u4ed6\u6709\u8bbf\u95ee\u8d44\u6e90\u7684\u8d26\u53f7\u5bc6\u7801\uff1b\r\nResource server\uff08\u8d44\u6e90\u670d\u52a1\u5668\uff09\uff1a\u670d\u52a1\u63d0\u4f9b\u5546\u5b58\u653e\u7528\u6237\u751f\u6210\u7684\u8d44\u6e90\u7684\u670d\u52a1\u5668\u3002\u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u662f\u4e0d\u540c\u7684\u903b\u8f91\u8282\u70b9\uff0c\u4f46\u662f\u5728\u7269\u7406\u4e0a\uff0c\u53cc\u65b9\u662f\u53ef\u4ee5\u5728\u4e00\u8d77\u7684\u3002\u62e5\u6709\u53d7\u4fdd\u62a4\u8d44\u6e90\u7684\u670d\u52a1\u5668\uff0c\u5982\u679c\u8bf7\u6c42\u5305\u542b\u6b63\u786e\u7684\u8bbf\u95ee\u4ee4\u724c\uff0c\u53ef\u4ee5\u8bbf\u95ee\u8d44\u6e90\uff1b\r\nClient\uff08\u5ba2\u6237\u7aef\uff09\uff1a\u8bbf\u95ee\u8d44\u6e90\u7684\u5ba2\u6237\u7aef\uff0c\u4f1a\u4f7f\u7528\u8bbf\u95ee\u4ee4\u724c\u53bb\u83b7\u53d6\u8d44\u6e90\u670d\u52a1\u5668\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u662f\u6d4f\u89c8\u5668\u3001\u79fb\u52a8\u8bbe\u5907\u6216\u8005\u670d\u52a1\u5668\uff1b\r\nAuthorization server\uff08\u8ba4\u8bc1\u670d\u52a1\u5668\uff09\uff1a\u670d\u52a1\u63d0\u4f9b\u5546\u4e13\u95e8\u7528\u6765\u5904\u7406\u8ba4\u8bc1\u7684\u670d\u52a1\u5668\u3002\u7528\u4e8e\u8ba4\u8bc1\u7528\u6237\u7684\u670d\u52a1\u5668\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8ba4\u8bc1\u901a\u8fc7\uff0c\u53d1\u653e\u8bbf\u95ee\u8d44\u6e90\u670d\u52a1\u5668\u7684\u4ee4\u724c\u3002\r\nHttp Service\uff1a\u670d\u52a1\u63d0\u4f9b\u5546\uff0c\u4e5f\u5c31\u662f\u6301\u6709Resource Server\u7684\u5b58\u5728\u65b9\u3002\u53ef\u4ee5\u7406\u89e3\u4e3a\u7c7b\u4f3c\u5fae\u4fe1\uff0c\u9489\u9489\u8fd9\u6837\u5177\u5907\u7528\u6237\u4fe1\u606f\u7684\u670d\u52a1\u8005\u3002\r\nUser Agent\uff1a\u7528\u6237\u4ee3\u7406\uff0c\u4e00\u822c\u5c31\u662f\u6307\u7684\u6d4f\u89c8\u5668\u3002\r\n\u5ba2\u6237\u7aef\u51ed\u8bc1\uff1aClient Id\u548c\u5bc6\u7801\u7528\u4e8e\u8ba4\u8bc1\u7528\u6237\u3002\r\n\u8bbf\u95ee\u4ee4\u724c\uff1a\u6388\u6743\u670d\u52a1\u63d0\u4f9b\u8005\u5728\u63a5\u6536\u5230\u7528\u6237\u8bf7\u6c42\u540e,\u9881\u53d1\u7684\u8bbf\u95ee\u4ee4\u724c\u3002\r\n\u5237\u65b0\u4ee4\u724c\uff08Refresh Token\uff09\uff1a\u7528\u4e8e\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684\u4ee4\u724c\u3002\u7531\u4e8e\u4ee4\u724c\u7684\u6709\u6548\u671f\u6bd4\u8f83\u77ed\uff0c\u4e00\u65e6\u5931\u6548\uff0c\u7528\u6237\u9700\u8981\u518d\u83b7\u53d6\u4ee4\u724c\u7684\u6d41\u7a0b\u662f\u6bd4\u8f83\u7e41\u7410\u7684\u3002\u4e3a\u4e86\u63d0\u5347\u7528\u6237\u4f53\u9a8c\uff0c\u53ef\u4ee5\u4f7f\u7528reflesh_token\u6765\u83b7\u53d6\u65b0\u7684\u4ee4\u724c\u3002\r\n\r\n\r\nClient Credentials\uff08\u5ba2\u6237\u7aef\u6a21\u5f0f\uff09\uff1a\u5ba2\u6237\u7aef\u76f4\u63a5\u901a\u8fc7\u5ba2\u6237\u7aef\u8ba4\u8bc1\uff08\u6bd4\u5982client_id\u548cclient_secret\uff09\u4ece\u8ba4\u8bc1\u670d\u52a1\u5668\u83b7\u53d6\u8bbf\u95ee\u4ee4\u724c\u3002\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u56db\u79cd\u6388\u6743\u6a21\u5f0f",children:"\u56db\u79cd\u6388\u6743\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.h6,{id:"authorization-code\u6388\u6743\u7801\u6a21\u5f0f",children:"Authorization Code\uff08\u6388\u6743\u7801\u6a21\u5f0f\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"1\u3001\u7528\u6237\u767b\u5f55\u5e94\u7528\u7cfb\u7edf\uff0c\u8bf7\u6c42\u8df3\u8f6c\u5230\u8ba4\u8bc1\u670d\u52a1\u5668\uff0c\u5e76302\u8fd4\u56de\u767b\u5f55\u8ba4\u8bc1\u9875\u9762\uff1b\r\n2\u3001\u7528\u6237\u8f93\u5165\u8d26\u6237+\u5bc6\u7801\u8fdb\u884c\u8ba4\u8bc1\uff0c\u8ba4\u8bc1\u670d\u52a1\u5668\u8ba4\u8bc1\u901a\u8fc7\u8fd4\u56decode\u7ed9\u5e94\u7528\u7cfb\u7edf\uff1b\r\n3\u3001\u5e94\u7528\u7cfb\u7edf\u643a\u5e26code\u5411\u8ba4\u8bc1\u670d\u52a1\u5668\u6362\u53d6\u8bbf\u95ee\u4ee4\u724c\uff0c\u8ba4\u8bc1\u670d\u52a1\u5668\u9a8c\u8bc1Client ID\uff0ccode\u7b49\u4fe1\u606f\uff0c\u7ed9\u5e94\u7528\u7cfb\u7edf\u53d1\u9001\u8bbf\u95ee\u4ee4\u724c\uff1b\r\n4\u3001\u5e94\u7528\u7cfb\u7edf\u643a\u5e26\u8bbf\u95ee\u4ee4\u724c\u67e5\u8be2\u7528\u6237\u767b\u5f55\u4fe1\u606f\uff0c\u8ba4\u8bc1\u670d\u52a1\u5668\u8fd4\u56de\u7528\u6237\u4fe1\u606f\uff0c\u5982\u7528\u6237\u540d\uff1b\r\n5\u3001\u5e94\u7528\u7cfb\u7edf\u9a8c\u8bc1\u7528\u6237\u540d\u6b63\u786e\uff0c\u521b\u5efa\u4f1a\u8bdd\uff0c\u5e76\u8df3\u8f6c\u5230redirect url\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F.png",width:"50%"}),"\n",(0,a.jsx)(e.h6,{id:"implicit\u7b80\u5316\u6a21\u5f0f",children:"Implicit\uff08\u7b80\u5316\u6a21\u5f0f\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"\u7701\u7565\u6389\u4e86\u9881\u53d1\u6388\u6743\u7801\uff08Authorization Code\uff09\u7ed9\u5ba2\u6237\u7aef\u7684\u8fc7\u7a0b\uff0c\u76f4\u63a5\u8fd4\u56de\u8bbf\u95ee\u4ee4\u724c\u548c\u53ef\u9009\u7684\u5237\u65b0\u4ee4\u724c\u3002\u5176\u9002\u7528\u4e8e\u6ca1\u6709Server\u670d\u52a1\u5668\u6765\u63a5\u53d7\u5904\u7406Authorization Code\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u3002\u9002\u7528\u4e8e\u516c\u5f00\u7684\u6d4f\u89c8\u5668\u5355\u9875\u5e94\u7528\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/%E7%AE%80%E5%8C%96%E6%A8%A1%E5%BC%8F.png",width:"50%"}),"\n",(0,a.jsx)(e.h6,{id:"\u5bc6\u7801\u6a21\u5f0f",children:"\u5bc6\u7801\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"\u8fd9\u79cd\u6a21\u5f0f\u518d\u4e00\u6b65\u7b80\u5316\uff0c\u548cAuthorzation Code\u7c7b\u578b\u4e0b\u91cd\u8981\u7684\u533a\u5206\u5c31\u662f\u7701\u7565\u4e86Authorization Request\u548cAuthorization Response\u3002\u800c\u662fClient\u76f4\u63a5\u4f7f\u7528Resource owner\u63d0\u4f9b\u7684username\u548cpassword\u6765\u76f4\u63a5\u8bf7\u6c42access_token\uff08\u76f4\u63a5\u53d1\u8d77Access Token Request\u7136\u540e\u8fd4\u56deAccess Token Response\u4fe1\u606f\uff09\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e00\u822c\u9002\u7528\u4e8eResource server\u9ad8\u5ea6\u4fe1\u4efb\u7b2c\u4e09\u65b9Client\u7684\u60c5\u51b5\u4e0b \n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F.png",width:"50%"}),"\n",(0,a.jsx)(e.h6,{id:"client-credentials\u5ba2\u6237\u7aef\u6a21\u5f0f",children:"Client Credentials\uff08\u5ba2\u6237\u7aef\u6a21\u5f0f\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"Client\u76f4\u63a5\u4ee5\u81ea\u5df1\u7684\u540d\u4e49\u800c\u4e0d\u662fResource owner\u7684\u540d\u4e49\u53bb\u8981\u6c42\u8bbf\u95eeResource server\u7684\u4e00\u4e9b\u53d7\u4fdd\u62a4\u8d44\u6e90 \r\n\u9002\u7528\u4e8e\u670d\u52a1\u5668\u95f4\u901a\u4fe1\u573a\u666f\uff0c\u76f4\u63a5\u6839\u636eclient\u7684ID\u548c\u5bc6\u94a5\u5373\u53ef\u83b7\u53d6token\uff0c\u65e0\u9700\u7528\u6237\u53c2\u4e0e\r\n\u8fd9\u79cd\u6a21\u5f0f\u6bd4\u8f83\u5408\u9002\u6d88\u8d39api\u7684\u540e\u7aef\u670d\u52a1\uff0c\u6bd4\u5982\u62c9\u53d6\u4e00\u7ec4\u7528\u6237\u4fe1\u606f\u7b49\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%BC%8F.png",width:"50%"}),"\n",(0,a.jsx)(e.h6,{id:"\u5237\u65b0\u4ee4\u724c",children:"\u5237\u65b0\u4ee4\u724c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"\u4ee5\u4fbf\u5728\u8bbf\u95ee\u4ee4\u724c\u8fc7\u671f\u5931\u6548\u7684\u65f6\u5019\u53ef\u4ee5\u7531\u5ba2\u6237\u7aef\u81ea\u52a8\u83b7\u53d6\u65b0\u7684\u8bbf\u95ee\u4ee4\u724c\uff0c\u800c\u4e0d\u662f\u8ba9\u7528\u6237\u518d\u6b21\u767b\u5f55\u6388\u6743\n"})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C.png",width:"50%"}),"\n",(0,a.jsx)(e.h5,{id:"\u5165\u95e8\u4f7f\u7528",children:"\u5165\u95e8\u4f7f\u7528"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-oauth2</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u52a0\u8f7d\u7528\u6237\u4fe1\u606f\r\n/**\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Service\r\npublic class UserService implements UserDetailsService {\r\n    private List<User> userList;\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @PostConstruct\r\n    public void initData() {\r\n        String password = passwordEncoder.encode("123456");\r\n        userList = new ArrayList<>();\r\n        userList.add(new User("macro", password, AuthorityUtils.commaSeparatedStringToAuthorityList("admin")));\r\n        userList.add(new User("andy", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));\r\n        userList.add(new User("mark", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));\r\n    }\r\n\r\n    @Override\r\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\r\n        List<User> findUserList = userList.stream().filter(user -> user.getUsername().equals(username)).collect(Collectors.toList());\r\n        if (!CollectionUtils.isEmpty(findUserList)) {\r\n            return findUserList.get(0);\r\n        } else {\r\n            throw new UsernameNotFoundException("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u5e76\u5f00\u542f\u8ba4\u8bc1\r\n/**\r\n * \u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    /**\r\n     * \u4f7f\u7528\u5bc6\u7801\u6a21\u5f0f\u9700\u8981\u914d\u7f6e\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService);\r\n    }\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                //\u914d\u7f6eclient_id\r\n                .withClient("admin")\r\n                //\u914d\u7f6eclient_secret\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                //\u914d\u7f6e\u8bbf\u95eetoken\u7684\u6709\u6548\u671f\r\n                .accessTokenValiditySeconds(3600)\r\n                //\u914d\u7f6e\u5237\u65b0token\u7684\u6709\u6548\u671f\r\n                .refreshTokenValiditySeconds(864000)\r\n                //\u914d\u7f6eredirect_uri\uff0c\u7528\u4e8e\u6388\u6743\u6210\u529f\u540e\u8df3\u8f6c\r\n                .redirectUris("http://www.baidu.com")\r\n                //\u914d\u7f6e\u7533\u8bf7\u7684\u6743\u9650\u8303\u56f4\r\n                .scopes("all")\r\n                //\u914d\u7f6egrant_type\uff0c\u8868\u793a\u6388\u6743\u7c7b\u578b\r\n                .authorizedGrantTypes("authorization_code","password");\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u5e76\u5f00\u542f\r\n/**\r\n * \u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableResourceServer\r\npublic class ResourceServerConfig extends ResourceServerConfigurerAdapter {\r\n\r\n    @Override\r\n    public void configure(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests()\r\n                .anyRequest()\r\n                .authenticated()\r\n                .and()\r\n                .requestMatchers()\r\n            \t//\u914d\u7f6e\u9700\u8981\u4fdd\u62a4\u7684\u8d44\u6e90\u8def\u5f84\r\n                .antMatchers("/user/**");\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//security\u914d\u7f6e\uff0c\u5141\u8bb8\u8ba4\u8bc1\u76f8\u5173\u8def\u5f84\u7684\u8bbf\u95ee\u53ca\u8868\u5355\u767b\u5f55\uff0c\u5e76\u5f00\u542f\r\n/**\r\n * SpringSecurity\u914d\u7f6e\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\n@EnableWebSecurity\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n    @Bean\r\n    public PasswordEncoder passwordEncoder() {\r\n        return new BCryptPasswordEncoder();\r\n    }\r\n\r\n    @Bean\r\n    @Override\r\n    public AuthenticationManager authenticationManagerBean() throws Exception {\r\n        return super.authenticationManagerBean();\r\n    }\r\n\r\n    @Override\r\n    public void configure(HttpSecurity http) throws Exception {\r\n        http.csrf()\r\n                .disable()\r\n                .authorizeRequests()\r\n                .antMatchers("/oauth/**", "/login/**", "/logout/**")\r\n                .permitAll()\r\n                .anyRequest()\r\n                .authenticated()\r\n                .and()\r\n                .formLogin()\r\n                .permitAll();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u6d4b\u8bd5\u63a5\u53e3\r\n@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @GetMapping("/getCurrentUser")\r\n    public Object getCurrentUser(Authentication authentication) {\r\n        return authentication.getPrincipal();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u6388\u6743\u7801\u767b\u5f55\r\n1\u3001\u8fdb\u884c\u767b\u5f55\u6388\u6743\r\nhttp://localhost:9401/oauth/authorize?response_type=code&client_id=admin&redirect_uri=http://www.baidu.com&scope=all&state=normal\r\n2\u3001\u8fdb\u884c\u6388\u6743\u64cd\u4f5c\r\n\u9009\u62e9Approve\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a\u6388\u6743\u7801code\r\n3\u3001\u83b7\u53d6\u8bbf\u95ee\u4ee4\u724c\r\nhttp://localhost:9401/oauth/token\r\nAuthorization\uff1aBasic Auth  input username and password\r\nFormdata: \r\ncode:\u6388\u6743\u7801\r\ngrant_type:authorization_code\r\nclient_id:admin\r\nredirect_uri:http://www.baidu.com\r\nscope:all\r\n\r\n-- \u5bc6\u7801\u6a21\u5f0f\u767b\u5f55\r\n1\u3001\u4f7f\u7528\u5bc6\u7801\u8bf7\u6c42\u8be5\u5730\u5740\u83b7\u53d6\u8bbf\u95ee\u4ee4\u724c\r\nhttp://localhost:9401/oauth/token\r\nAuthorization\uff1aBasic Auth  input username and password\r\nFormdata: \r\ngrant_type:password\r\nscope:all\r\nusername:macro\r\npassword:123456\r\n\r\n-- \u6d4b\u8bd5\u63a5\u53e3\r\nhttp://localhost:9401/user/getCurrentUser\r\nAuthorization\uff1abearer \u8bbf\u95ee\u4ee4\u724c\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5b58\u50a8\u4ee4\u724c",children:"\u5b58\u50a8\u4ee4\u724c"}),"\n",(0,a.jsx)(e.h6,{id:"\u4f7f\u7528redis\u5b58\u50a8\u4ee4\u724c",children:"\u4f7f\u7528Redis\u5b58\u50a8\u4ee4\u724c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-data-redis</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u4f7f\u7528redis\u5b58\u50a8token\u7684\u914d\u7f6e\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\npublic class RedisTokenStoreConfig {\r\n\r\n    @Autowired\r\n    private RedisConnectionFactory redisConnectionFactory;\r\n\r\n    @Bean\r\n    public TokenStore redisTokenStore (){\r\n        return new RedisTokenStore(redisConnectionFactory);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u8ba4\u8bc1\u914d\u7f6e\u6307\u5b9a\u5b58\u50a8\u7b56\u7565\u4e3aredis\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    @Autowired\r\n    @Qualifier("redisTokenStore")\r\n    private TokenStore tokenStore;\r\n\r\n    /**\r\n     * \u4f7f\u7528\u5bc6\u7801\u6a21\u5f0f\u9700\u8981\u914d\u7f6e\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore);//\u914d\u7f6e\u4ee4\u724c\u5b58\u50a8\u7b56\u7565\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u6d4b\u8bd5\r\n\u4f7f\u7528password\u65b9\u5f0f\u83b7\u53d6\u4ee4\u724c\uff0c\u8bbf\u95eehttp://localhost:9401/oauth/token\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u4f7f\u7528jwt\u5b58\u50a8\u4ee4\u724c",children:"\u4f7f\u7528jwt\u5b58\u50a8\u4ee4\u724c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u4f7f\u7528Jwt\u5b58\u50a8token\u7684\u914d\u7f6e\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\npublic class JwtTokenStoreConfig {\r\n\r\n    @Bean\r\n    public TokenStore jwtTokenStore() {\r\n        return new JwtTokenStore(jwtAccessTokenConverter());\r\n    }\r\n\r\n    @Bean\r\n    public JwtAccessTokenConverter jwtAccessTokenConverter() {\r\n        JwtAccessTokenConverter accessTokenConverter = new JwtAccessTokenConverter();\r\n        accessTokenConverter.setSigningKey("test_key");//\u914d\u7f6eJWT\u4f7f\u7528\u7684\u79d8\u94a5\r\n        return accessTokenConverter;\r\n    }\r\n}\r\n\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'//\u8ba4\u8bc1\u914d\u7f6e\u6307\u5b9a\u5b58\u50a8\u7b56\u7565\u4e3ajwt\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    @Autowired\r\n    @Qualifier("jwtTokenStore")\r\n    private TokenStore tokenStore;\r\n    \r\n    @Autowired\r\n    private JwtAccessTokenConverter jwtAccessTokenConverter;\r\n\r\n    /**\r\n     * \u4f7f\u7528\u5bc6\u7801\u6a21\u5f0f\u9700\u8981\u914d\u7f6e\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore)//\u914d\u7f6e\u4ee4\u724c\u5b58\u50a8\u7b56\u7565\r\n                .accessTokenConverter(jwtAccessTokenConverter);\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u6269\u5c55jwt\u5b58\u50a8\u5185\u5bb9",children:"\u6269\u5c55jwt\u5b58\u50a8\u5185\u5bb9"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * Jwt\u5185\u5bb9\u589e\u5f3a\u5668\r\n * Created by macro on 2019/10/8.\r\n */\r\npublic class JwtTokenEnhancer implements TokenEnhancer {\r\n    @Override\r\n    public OAuth2AccessToken enhance(OAuth2AccessToken accessToken, OAuth2Authentication authentication) {\r\n        //\u6269\u5c55\u5b58\u50a8\u7684\u4fe1\u606f\r\n        Map<String, Object> info = new HashMap<>();\r\n        info.put("enhance", "enhance info");\r\n        ((DefaultOAuth2AccessToken) accessToken).setAdditionalInformation(info);\r\n        return accessToken;\r\n    }\r\n}\r\n\r\n@Bean\r\npublic JwtTokenEnhancer jwtTokenEnhancer() {\r\n    return new JwtTokenEnhancer();\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private JwtTokenEnhancer jwtTokenEnhancer;\r\n    /**\r\n     * \u4f7f\u7528\u5bc6\u7801\u6a21\u5f0f\u9700\u8981\u914d\u7f6e\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        TokenEnhancerChain enhancerChain = new TokenEnhancerChain();\r\n        List<TokenEnhancer> delegates = new ArrayList<>();\r\n        delegates.add(jwtTokenEnhancer); //\u914d\u7f6eJWT\u7684\u5185\u5bb9\u589e\u5f3a\u5668\r\n        delegates.add(jwtAccessTokenConverter);\r\n        enhancerChain.setTokenEnhancers(delegates);\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore) //\u914d\u7f6e\u4ee4\u724c\u5b58\u50a8\u7b56\u7565\r\n                .accessTokenConverter(jwtAccessTokenConverter)\r\n                .tokenEnhancer(enhancerChain);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h6,{id:"\u89e3\u6790jwt",children:"\u89e3\u6790jwt"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>io.jsonwebtoken</groupId>\r\n    <artifactId>jjwt</artifactId>\r\n    <version>0.9.0</version>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @GetMapping("/getCurrentUser")\r\n    public Object getCurrentUser(Authentication authentication, HttpServletRequest request) {\r\n        String header = request.getHeader("Authorization");\r\n        String token = StrUtil.subAfter(header, "bearer ", false);\r\n        return Jwts.parser()\r\n                .setSigningKey("test_key".getBytes(StandardCharsets.UTF_8))\r\n                .parseClaimsJws(token)\r\n                .getBody();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u5237\u65b0\u4ee4\u724c-1",children:"\u5237\u65b0\u4ee4\u724c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                .withClient("admin")\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                .accessTokenValiditySeconds(3600)\r\n                .refreshTokenValiditySeconds(864000)\r\n                .redirectUris("http://www.baidu.com")\r\n                .autoApprove(true) //\u81ea\u52a8\u6388\u6743\u914d\u7f6e\r\n                .scopes("all")\r\n                .authorizedGrantTypes("authorization_code","password","refresh_token"); //\u6dfb\u52a0\u6388\u6743\u6a21\u5f0f\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u7528\u5237\u65b0\u4ee4\u724c\u6a21\u5f0f\u6765\u83b7\u53d6\u65b0\u7684\u4ee4\u724c\r\n\u643a\u5e26\u53c2\u6570grant_type=refresh_token & refresh_token={}\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5355\u70b9\u767b\u5f55",children:"\u5355\u70b9\u767b\u5f55"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:"-- \u5355\u70b9\u767b\u5f55\uff08Single Sign On\uff09\u6307\u7684\u662f\u5f53\u6709\u591a\u4e2a\u7cfb\u7edf\u9700\u8981\u767b\u5f55\u65f6\uff0c\u7528\u6237\u53ea\u9700\u767b\u5f55\u4e00\u4e2a\u7cfb\u7edf\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6\u9700\u8981\u767b\u5f55\u7684\u7cfb\u7edf\u800c\u65e0\u9700\u767b\u5f55\r\n\r\n-- \u5f53\u6211\u4eec\u5728oauth2-jwt-server\u670d\u52a1\u4e0a\u767b\u5f55\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95eeoauth2-client\u9700\u8981\u767b\u5f55\u7684\u63a5\u53e3\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-oauth2</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-security</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.jsonwebtoken</groupId>\r\n    <artifactId>jjwt</artifactId>\r\n    <version>0.9.0</version>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 9501\r\n  servlet:\r\n    session:\r\n      cookie:\r\n        name: OAUTH2-CLIENT-SESSIONID #\u9632\u6b62Cookie\u51b2\u7a81\uff0c\u51b2\u7a81\u4f1a\u5bfc\u81f4\u767b\u5f55\u9a8c\u8bc1\u4e0d\u901a\u8fc7\r\noauth2-server-url: http://localhost:9401\r\nspring:\r\n  application:\r\n    name: oauth2-client\r\nsecurity:\r\n  oauth2: #\u4e0eoauth2-server\u5bf9\u5e94\u7684\u914d\u7f6e\r\n    client:\r\n      client-id: admin\r\n      client-secret: admin123456\r\n      user-authorization-uri: ${oauth2-server-url}/oauth/authorize\r\n      access-token-uri: ${oauth2-server-url}/oauth/token\r\n    resource:\r\n      jwt:\r\n        key-uri: ${oauth2-server-url}/oauth/token_key\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@EnableOAuth2Sso\r\n@SpringBootApplication\r\npublic class Oauth2ClientApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(Oauth2ClientApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                .withClient("admin")\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                .accessTokenValiditySeconds(3600)\r\n                .refreshTokenValiditySeconds(864000)\r\n            \t//\u5355\u70b9\u767b\u5f55\u65f6\u914d\u7f6e\r\n                .redirectUris("http://localhost:9501/login") \r\n            \t//\u81ea\u52a8\u6388\u6743\u914d\u7f6e\r\n            \t.autoApprove(true) \r\n                .scopes("all")\r\n                .authorizedGrantTypes("authorization_code","password","refresh_token");\r\n    }\r\n    @Override\r\n    public void configure(AuthorizationServerSecurityConfigurer security) {\r\n        // \u83b7\u53d6\u5bc6\u94a5\u9700\u8981\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4f7f\u7528\u5355\u70b9\u767b\u5f55\u65f6\u5fc5\u987b\u914d\u7f6e\r\n        security.tokenKeyAccess("isAuthenticated()"); \r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h6,{id:"\u6743\u9650\u8ba4\u8bc1",children:"\u6743\u9650\u8ba4\u8bc1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u5728\u63a5\u53e3\u4e0a\u914d\u7f6e\u6743\u9650\u65f6\u4f7f\u7528\r\n * Created by macro on 2019/10/11.\r\n */\r\n@Configuration\r\n@EnableGlobalMethodSecurity(prePostEnabled = true)\r\n@Order(101)\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n}\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * Created by macro on 2019/9/30.\r\n */\r\n@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @PreAuthorize("hasAuthority(\'admin\')")\r\n    @GetMapping("/auth/admin")\r\n    public Object adminAuth() {\r\n        return "Has admin auth!";\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"cloud-admin",children:"cloud-admin"}),"\n",(0,a.jsx)(e.h5,{id:"\u670d\u52a1\u7aef-3",children:"\u670d\u52a1\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>de.codecentric</groupId>\r\n    <artifactId>spring-boot-admin-starter-server</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  application:\r\n    name: admin-server\r\nserver:\r\n  port: 9301\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"@EnableAdminServer\r\n@SpringBootApplication\r\npublic class AdminServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(AdminServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h5,{id:"\u5ba2\u6237\u7aef-4",children:"\u5ba2\u6237\u7aef"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>de.codecentric</groupId>\r\n    <artifactId>spring-boot-admin-starter-client</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  application:\r\n    name: admin-client\r\n  boot:\r\n    admin:\r\n      client:\r\n        url: http://localhost:9301 #\u914d\u7f6eadmin-server\u5730\u5740\r\nserver:\r\n  port: 9305\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: '*'\r\n  endpoint:\r\n    health:\r\n      show-details: always\r\nlogging:\r\n  file: admin-client.log #\u6dfb\u52a0\u5f00\u542fadmin\u7684\u65e5\u5fd7\u76d1\u63a7\n"})}),"\n",(0,a.jsx)(e.h3,{id:"skywalking\u94fe\u8def\u8ffd\u8e2a",children:"SkyWalking\u94fe\u8def\u8ffd\u8e2a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sql",children:'-- \u90e8\u7f72\u5b66\u4e60\u5730\u5740\r\nhttps://www.iocoder.cn/SkyWalking/install/\r\n-- \u4e1a\u52a1\u673a\u5236\r\nSpringCloud\uff1a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u670d\u52a1\uff0c\u542f\u52a8\u65f6\u914d\u7f6e\u4ee3\u7406\u5373\u53ef\uff1b\r\nAgent\uff1a\u4ee5\u63a2\u9488\u7684\u65b9\u5f0f\u8fdb\u884c\u8bf7\u6c42\u94fe\u8def\u7684\u6570\u636e\u91c7\u96c6\uff0c\u5e76\u5411\u7ba1\u7406\u670d\u52a1\u4e0a\u62a5\uff1b\r\nOAP-Service\uff1a\u63a5\u6536\u6570\u636e\uff0c\u5b8c\u6210\u6570\u636e\u7684\u5b58\u50a8\u548c\u5c55\u793a\uff1b\r\nStorage\uff1a\u6570\u636e\u7684\u5b58\u50a8\u5c42\uff0c\u652f\u6301ElasticSearch\u3001Mysql\u3001H2\u591a\u79cd\u65b9\u5f0f\uff1b\r\nUI\u754c\u9762\uff1a\u6570\u636e\u7684\u53ef\u89c6\u5316\u5c55\u793a\u754c\u9762\uff1b\r\n-- \u5de5\u4f5c\u6d41\u7a0b\r\nspringboot\u542f\u52a8\uff0c\u914d\u7f6eagent\u5730\u5740\uff0c\u5e76\u8bbe\u7f6eagent\u8fde\u63a5\u7684OAP\u5730\u5740\uff0cOAP\u914d\u7f6e\u5b58\u50a8\u5730\u5740(\u5982elastic)\r\n\u670d\u52a1\u901a\u8fc7\u63a2\u9488\u7684\u65b9\u5f0f\u63a5\u5165\u6570\u636e\u91c7\u96c6\u7684\u529f\u80fd\uff0c\u4e4b\u540e\u8bf7\u6c42\u94fe\u8def\u7684\u76f8\u5173\u5904\u7406\u884c\u4e3a\u4f1a\u4e0a\u62a5\u5230OAP\u670d\u52a1\u4e2d\uff0c\u8fdb\u884c\u6570\u636e\u7684\u805a\u5408\u7ba1\u7406\u548c\u5206\u6790\uff0c\u5e76\u5b58\u50a8\u5728\u6301\u4e45\u5c42\uff0c\u7136\u540e\u53ef\u4ee5\u901a\u8fc7UI\u754c\u9762\u8fdb\u884c\u53ef\u89c6\u5316\u5448\u73b0\r\n\r\n-- \u5b89\u88c5\u90e8\u7f72\r\nskywalking\u5728\u4e4b\u524d\u7684\u65e7\u7248\u672c\u4e2d\uff0capm\u4e0eagent\u662f\u5728\u4e00\u4e2a\u5305\u4e2d\u7684\uff0c\u57289.0\u7684\u7248\u672c\u4e2d\u662f\u9700\u8981\u5206\u5f00\u4e0b\u8f7d\u7684\uff1bagent\u5305\u4e0b\u8f7d\u89e3\u538b\u4e4b\u540e\uff0c\u4e5f\u5c06\u5176\u653e\u5230apm\u5305\u4e0b\u9762\u7ef4\u62a4\r\n-- \u914d\u7f6e\u5b58\u50a8\u65b9\u5f0f\r\nconfig/application.yml\r\nstorage:\r\n  selector: ${SW_STORAGE:elasticsearch}\r\n  elasticsearch:\r\n    namespace: ${SW_NAMESPACE:""}\r\n    clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:175.178.164.134:9200}\r\n-- \u542f\u52a8\r\nWindows \u76f4\u63a5\u70b9\u51fbbin/startup.bat\r\n-- \u6d89\u53ca\u7f51\u5173\r\n\u5c06optional-plugins\u76ee\u5f55\u4e0b\u9762\u7684apm-spring-cloud-gateway-3.x-plugin-8.12.0.jar \u548capm-spring-webflux-5.x-plugin-8.12.0.jar\u4e24\u4e2a\u5305\u62f7\u8d1d\u5230plugins\u76ee\u5f55\u4e0b\u9762\u53bb\r\n-- \u670d\u52a1\u6dfb\u52a0\u914d\u7f6e\r\n\u5728\u670d\u52a1\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0agent\u914d\u7f6e\uff0c\u5982\u679c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u901a\u5e38\u4f1a\u7edf\u4e00\u5728\u811a\u672c\u4e2d\u8bbe\u7f6e\uff0c\u7531\u4e8e\u5728\u672c\u5730\u73af\u5883\u6f14\u793a\uff0c\u57fa\u4e8eIDEA\u5de5\u5177\u8fdb\u884c\u7ba1\u7406\r\n-javaagent:D:\\hayes\\software-0329\\apache-skywalking-apm-bin\\agent\\skywalking-agent.jar\r\n-Dskywalking.agent.service_name=hmh-cloud-gateway\r\n-Dskywalking.collector.backend_service=127.0.0.1:11800\n'})}),"\n",(0,a.jsx)("img",{src:"https://hayes-typora.oss-cn-shenzhen.aliyuncs.com/skywalking.png",width:"50%"})]})}function u(r={}){const{wrapper:e}={...(0,i.R)(),...r.components};return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(d,{...r})}):d(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>s,x:()=>l});var a=n(6540);const i={},t=a.createContext(i);function s(r){const e=a.useContext(t);return a.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:s(r.components),a.createElement(t.Provider,{value:e},r.children)}}}]);