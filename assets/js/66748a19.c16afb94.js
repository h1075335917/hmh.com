"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9049],{8444:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>v,contentTitle:()=>m,default:()=>j,frontMatter:()=>h,metadata:()=>a,toc:()=>x});let a=JSON.parse('{"id":"java/JAVA-SpringCloud-Stack","title":"JAVA-SpringCloud\u6280\u672F\u6808","description":"cloud-eureka","source":"@site/docs/java/JAVA-SpringCloud-Stack.md","sourceDirName":"java","slug":"/java/JAVA-SpringCloud-Stack","permalink":"/mhuahe.com/docs/java/JAVA-SpringCloud-Stack","draft":false,"unlisted":false,"editUrl":"https://github.dev/mhuahe/mhuahe.com/blob/master-ts/docs/java/JAVA-SpringCloud-Stack.md","tags":[],"version":"current","lastUpdatedBy":"heminhua","lastUpdatedAt":1729094642000,"frontMatter":{},"sidebar":"java","previous":{"title":"JAVA-SpringBoot\u7248\u672C","permalink":"/mhuahe.com/docs/java/JAVA-SpringBoot-Version"},"next":{"title":"JAVA-\u591A\u7EBF\u7A0B","permalink":"/mhuahe.com/docs/java/JAVA-Thread"}}');var i=n(4848),t=n(8453);let s=n.p+"assets/images/SpringCloud-gateway\u76D1\u63A7\u8BF7\u6C42-51ae483555fef3070a4c0723398b6f08.png",l=n.p+"assets/images/SpringCloud-gateway\u5DE5\u4F5C\u539F\u7406-f320f1f4ef1d119744852a8125afb8c7.png",o=n.p+"assets/images/SpringCloud-\u6388\u6743\u7801\u6A21\u5F0F-4f4f7cb41a956dfaf4a1f091acd1a51a.png",c=n.p+"assets/images/SpringCloud-\u7B80\u5316\u6A21\u5F0F-fbcda78ec5d7a3388c3ffa5c59f52543.png",d=n.p+"assets/images/SpringCloud-\u5BC6\u7801\u6A21\u5F0F-7ac61ca9add35c3d4d9571656b4c339e.png",u=n.p+"assets/images/SpringCloud-\u5BA2\u6237\u7AEF\u6A21\u5F0F-c0022086b2acd6291120177d2ade568d.png",p=n.p+"assets/images/SpringCloud-\u5237\u65B0\u4EE4\u724C-f09d9993bbd08eef329947f221dc4c6c.png",g=n.p+"assets/images/SpringCloud-SkyWalking\u94FE\u8DEF\u8FFD\u8E2A-4e7a5997824e0752b76c3446ca615372.png",h={},m="JAVA-SpringCloud\u6280\u672F\u6808",v={},x=[{value:"cloud-eureka",id:"cloud-eureka",level:4},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF",level:5},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF",level:5},{value:"\u96C6\u7FA4",id:"\u96C6\u7FA4",level:5},{value:"\u6DFB\u52A0\u8BA4\u8BC1",id:"\u6DFB\u52A0\u8BA4\u8BC1",level:5},{value:"Eureka\u7684\u5E38\u7528\u914D\u7F6E",id:"eureka\u7684\u5E38\u7528\u914D\u7F6E",level:5},{value:"cloud-ribbon",id:"cloud-ribbon",level:4},{value:"\u5BA2\u6237\u7AEF1",id:"\u5BA2\u6237\u7AEF1",level:5},{value:"ribbon\u8D1F\u8F7D\u5BA2\u6237\u7AEF",id:"ribbon\u8D1F\u8F7D\u5BA2\u6237\u7AEF",level:5},{value:"\u8D1F\u8F7D\u914D\u7F6E",id:"\u8D1F\u8F7D\u914D\u7F6E",level:6},{value:"\u8C03\u7528\u5BA2\u6237\u7AEF",id:"\u8C03\u7528\u5BA2\u6237\u7AEF",level:6},{value:"\u6F14\u793A",id:"\u6F14\u793A",level:5},{value:"ribbon\u5E38\u7528\u914D\u7F6E",id:"ribbon\u5E38\u7528\u914D\u7F6E",level:5},{value:"cloud-hystrix",id:"cloud-hystrix",level:4},{value:"\u670D\u52A1\u964D\u7EA7",id:"\u670D\u52A1\u964D\u7EA7",level:5},{value:"@HystrixCommand\u5E38\u7528\u53C2\u6570",id:"hystrixcommand\u5E38\u7528\u53C2\u6570",level:6},{value:"\u8BF7\u6C42\u7F13\u5B58",id:"\u8BF7\u6C42\u7F13\u5B58",level:5},{value:"\u76F8\u5173\u6CE8\u89E3",id:"\u76F8\u5173\u6CE8\u89E3",level:6},{value:"\u8BF7\u6C42\u5408\u5E76",id:"\u8BF7\u6C42\u5408\u5E76",level:5},{value:"@HystrixCollapser\u7684\u5E38\u7528\u5C5E\u6027",id:"hystrixcollapser\u7684\u5E38\u7528\u5C5E\u6027",level:6},{value:"Hystrix\u7684\u5E38\u7528\u914D\u7F6E",id:"hystrix\u7684\u5E38\u7528\u914D\u7F6E",level:5},{value:"\u5168\u5C40\u914D\u7F6E",id:"\u5168\u5C40\u914D\u7F6E",level:6},{value:"\u5B9E\u4F8B\u914D\u7F6E",id:"\u5B9E\u4F8B\u914D\u7F6E",level:6},{value:"cloud-feign",id:"cloud-feign",level:4},{value:"feign\u63A5\u53E3",id:"feign\u63A5\u53E3",level:5},{value:"\u65E5\u5FD7\u6253\u5370",id:"\u65E5\u5FD7\u6253\u5370",level:5},{value:"cloud-zuul",id:"cloud-zuul",level:4},{value:"\u8BF7\u6C42\u8DEF\u7531",id:"\u8BF7\u6C42\u8DEF\u7531",level:5},{value:"\u67E5\u770B\u8DEF\u7531\u4FE1\u606F",id:"\u67E5\u770B\u8DEF\u7531\u4FE1\u606F",level:5},{value:"\u8FC7\u6EE4\u5668",id:"\u8FC7\u6EE4\u5668",level:5},{value:"cloud-config",id:"cloud-config",level:4},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF-1",level:5},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF-1",level:5},{value:"\u5237\u65B0\u914D\u7F6E",id:"\u5237\u65B0\u914D\u7F6E",level:5},{value:"\u5B89\u5168\u8BA4\u8BC1",id:"\u5B89\u5168\u8BA4\u8BC1",level:5},{value:"\u96C6\u7FA4\u642D\u5EFA",id:"\u96C6\u7FA4\u642D\u5EFA",level:5},{value:"cloud-bus",id:"cloud-bus",level:4},{value:"\u52A8\u6001\u5237\u65B0\u914D\u7F6E",id:"\u52A8\u6001\u5237\u65B0\u914D\u7F6E",level:5},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF-2",level:6},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF-2",level:6},{value:"\u6F14\u793A",id:"\u6F14\u793A-1",level:6},{value:"\u914D\u5408WebHooks\u4F7F\u7528",id:"\u914D\u5408webhooks\u4F7F\u7528",level:6},{value:"cloud-sleuth",id:"cloud-sleuth",level:4},{value:"zipkin\u65E5\u5FD7",id:"zipkin\u65E5\u5FD7",level:5},{value:"Elasticsearch\u5B58\u50A8\u65E5\u5FD7",id:"elasticsearch\u5B58\u50A8\u65E5\u5FD7",level:5},{value:"cloud-consul",id:"cloud-consul",level:4},{value:"\u6CE8\u518C\u4E2D\u5FC3",id:"\u6CE8\u518C\u4E2D\u5FC3",level:5},{value:"\u5BA2\u6237\u7AEF\u8D1F\u8F7D",id:"\u5BA2\u6237\u7AEF\u8D1F\u8F7D",level:6},{value:"\u914D\u7F6E\u4E2D\u5FC3",id:"\u914D\u7F6E\u4E2D\u5FC3",level:5},{value:"cloud-gateway",id:"cloud-gateway",level:4},{value:"\u8FC7\u6EE4\u5668",id:"\u8FC7\u6EE4\u5668-1",level:5},{value:"\u76D1\u63A7\u8BF7\u6C42",id:"\u76D1\u63A7\u8BF7\u6C42",level:5},{value:"\u5DE5\u4F5C\u539F\u7406",id:"\u5DE5\u4F5C\u539F\u7406",level:5},{value:"cloud-nacos",id:"cloud-nacos",level:4},{value:"\u6CE8\u518C\u4E2D\u5FC3",id:"\u6CE8\u518C\u4E2D\u5FC3-1",level:5},{value:"\u914D\u7F6E\u4E2D\u5FC3",id:"\u914D\u7F6E\u4E2D\u5FC3-1",level:5},{value:"\u914D\u7F6E\u6587\u4EF6\u52A0\u8F7D\u987A\u5E8F",id:"\u914D\u7F6E\u6587\u4EF6\u52A0\u8F7D\u987A\u5E8F",level:6},{value:"cloud-sentinel",id:"cloud-sentinel",level:4},{value:"\u9650\u6D41",id:"\u9650\u6D41",level:5},{value:"\u6839\u636E\u8D44\u6E90\u540D\u79F0\u9650\u6D41",id:"\u6839\u636E\u8D44\u6E90\u540D\u79F0\u9650\u6D41",level:6},{value:"\u6839\u636EURL\u9650\u6D41",id:"\u6839\u636Eurl\u9650\u6D41",level:6},{value:"\u7194\u65AD\u529F\u80FD",id:"\u7194\u65AD\u529F\u80FD",level:5},{value:"RestTemplate\u8C03\u7528\u65B9\u5F0F",id:"resttemplate\u8C03\u7528\u65B9\u5F0F",level:6},{value:"feign\u8C03\u7528\u65B9\u5F0F",id:"feign\u8C03\u7528\u65B9\u5F0F",level:6},{value:"cloud-seata",id:"cloud-seata",level:4},{value:"\u642D\u5EFAseata\u670D\u52A1\u7AEF",id:"\u642D\u5EFAseata\u670D\u52A1\u7AEF",level:5},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF-3",level:5},{value:"cloud-oauth2",id:"cloud-oauth2",level:4},{value:"OAuth2\u76F8\u5173\u540D\u8BCD",id:"oauth2\u76F8\u5173\u540D\u8BCD",level:5},{value:"\u56DB\u79CD\u6388\u6743\u6A21\u5F0F",id:"\u56DB\u79CD\u6388\u6743\u6A21\u5F0F",level:5},{value:"Authorization Code\uFF08\u6388\u6743\u7801\u6A21\u5F0F\uFF09",id:"authorization-code\u6388\u6743\u7801\u6A21\u5F0F",level:6},{value:"Implicit\uFF08\u7B80\u5316\u6A21\u5F0F\uFF09",id:"implicit\u7B80\u5316\u6A21\u5F0F",level:6},{value:"\u5BC6\u7801\u6A21\u5F0F",id:"\u5BC6\u7801\u6A21\u5F0F",level:6},{value:"Client Credentials\uFF08\u5BA2\u6237\u7AEF\u6A21\u5F0F\uFF09",id:"client-credentials\u5BA2\u6237\u7AEF\u6A21\u5F0F",level:6},{value:"\u5237\u65B0\u4EE4\u724C",id:"\u5237\u65B0\u4EE4\u724C",level:6},{value:"\u5165\u95E8\u4F7F\u7528",id:"\u5165\u95E8\u4F7F\u7528",level:5},{value:"\u5B58\u50A8\u4EE4\u724C",id:"\u5B58\u50A8\u4EE4\u724C",level:5},{value:"\u4F7F\u7528Redis\u5B58\u50A8\u4EE4\u724C",id:"\u4F7F\u7528redis\u5B58\u50A8\u4EE4\u724C",level:6},{value:"\u4F7F\u7528jwt\u5B58\u50A8\u4EE4\u724C",id:"\u4F7F\u7528jwt\u5B58\u50A8\u4EE4\u724C",level:6},{value:"\u6269\u5C55jwt\u5B58\u50A8\u5185\u5BB9",id:"\u6269\u5C55jwt\u5B58\u50A8\u5185\u5BB9",level:6},{value:"\u89E3\u6790jwt",id:"\u89E3\u6790jwt",level:6},{value:"\u5237\u65B0\u4EE4\u724C",id:"\u5237\u65B0\u4EE4\u724C-1",level:6},{value:"\u5355\u70B9\u767B\u5F55",id:"\u5355\u70B9\u767B\u5F55",level:5},{value:"\u6743\u9650\u8BA4\u8BC1",id:"\u6743\u9650\u8BA4\u8BC1",level:6},{value:"cloud-admin",id:"cloud-admin",level:4},{value:"\u670D\u52A1\u7AEF",id:"\u670D\u52A1\u7AEF-3",level:5},{value:"\u5BA2\u6237\u7AEF",id:"\u5BA2\u6237\u7AEF-4",level:5},{value:"SkyWalking\u94FE\u8DEF\u8FFD\u8E2A",id:"skywalking\u94FE\u8DEF\u8FFD\u8E2A",level:3}];function f(r){let e={code:"code",h1:"h1",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",p:"p",pre:"pre",...(0,t.R)(),...r.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"java-springcloud\u6280\u672F\u6808",children:"JAVA-SpringCloud\u6280\u672F\u6808"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-eureka",children:"cloud-eureka"}),"\n",(0,i.jsx)(e.h5,{id:"\u670D\u52A1\u7AEF",children:"\u670D\u52A1\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<!-- \u4F9D\u8D56 -->\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52A0\u6CE8\u89E3\r\n@EnableEurekaServer\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8001 #\u6307\u5B9A\u8FD0\u884C\u7AEF\u53E3\r\nspring:\r\n  application:\r\n    name: eureka-server #\u6307\u5B9A\u670D\u52A1\u540D\u79F0\r\neureka:\r\n  instance:\r\n    hostname: localhost #\u6307\u5B9A\u4E3B\u673A\u5730\u5740\r\n  client:\r\n    fetch-registry: false #\u6307\u5B9A\u662F\u5426\u8981\u4ECE\u6CE8\u518C\u4E2D\u5FC3\u83B7\u53D6\u670D\u52A1\uFF08\u6CE8\u518C\u4E2D\u5FC3\u4E0D\u9700\u8981\u5F00\u542F\uFF09\r\n    register-with-eureka: false #\u6307\u5B9A\u662F\u5426\u8981\u6CE8\u518C\u5230\u6CE8\u518C\u4E2D\u5FC3\uFF08\u6CE8\u518C\u4E2D\u5FC3\u4E0D\u9700\u8981\u5F00\u542F\uFF09\r\n  server:\r\n    enable-self-preservation: false #\u5173\u95ED\u4FDD\u62A4\u6A21\u5F0F\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8BBF\u95EE\r\nhttp://localhost:8001/\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5BA2\u6237\u7AEF",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52A0\u6CE8\u89E3\r\n@EnableDiscoveryClient\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8101 #\u8FD0\u884C\u7AEF\u53E3\u53F7\r\nspring:\r\n  application:\r\n    name: eureka-client #\u670D\u52A1\u540D\u79F0\r\neureka:\r\n  client:\r\n    register-with-eureka: true #\u6CE8\u518C\u5230Eureka\u7684\u6CE8\u518C\u4E2D\u5FC3\r\n    fetch-registry: true #\u83B7\u53D6\u6CE8\u518C\u5B9E\u4F8B\u5217\u8868\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/ #\u914D\u7F6E\u6CE8\u518C\u4E2D\u5FC3\u5730\u5740\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8BBF\u95EE\r\nhttp://localhost:8001/\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u96C6\u7FA4",children:"\u96C6\u7FA4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u7ED9eureka-sever\u6DFB\u52A0\u914D\u7F6E\u6587\u4EF6application-replica1.yml\u914D\u7F6E\u7B2C\u4E00\u4E2A\u6CE8\u518C\u4E2D\u5FC3\r\nserver:\r\n  port: 8002\r\nspring:\r\n  application:\r\n    name: eureka-server\r\neureka:\r\n  instance:\r\n    hostname: replica1\r\n  client:\r\n    serviceUrl:\r\n      defaultZone: http://replica2:8003/eureka/ #\u6CE8\u518C\u5230\u53E6\u4E00\u4E2AEureka\u6CE8\u518C\u4E2D\u5FC3\r\n    fetch-registry: true\r\n    register-with-eureka: true\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u7ED9eureka-sever\u6DFB\u52A0\u914D\u7F6E\u6587\u4EF6application-replica2.yml\u914D\u7F6E\u7B2C\u4E8C\u4E2A\u6CE8\u518C\u4E2D\u5FC3\r\nserver:\r\n  port: 8003\r\nspring:\r\n  application:\r\n    name: eureka-server\r\neureka:\r\n  instance:\r\n    hostname: replica2\r\n  client:\r\n    serviceUrl:\r\n      defaultZone: http://replica1:8002/eureka/ #\u6CE8\u518C\u5230\u53E6\u4E00\u4E2AEureka\u6CE8\u518C\u4E2D\u5FC3\r\n    fetch-registry: true\r\n    register-with-eureka: true\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8FD9\u91CC\u6211\u4EEC\u901A\u8FC7\u4E24\u4E2A\u6CE8\u518C\u4E2D\u5FC3\u4E92\u76F8\u6CE8\u518C\uFF0C\u642D\u5EFA\u4E86\u6CE8\u518C\u4E2D\u5FC3\u7684\u53CC\u8282\u70B9\u96C6\u7FA4\uFF0C\u7531\u4E8EdefaultZone\u4F7F\u7528\u4E86\u57DF\u540D\uFF0C\u6240\u4EE5\u8FD8\u9700\u5728\u672C\u673A\u7684host\u6587\u4EF6\u4E2D\u914D\u7F6E\u4E00\u4E0B\r\n-- \u4FEE\u6539\u672C\u5730host\u6587\u4EF6\r\n127.0.0.1 replica1\r\n127.0.0.1 replica2\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8FD0\u884CEureka\u6CE8\u518C\u4E2D\u5FC3\u96C6\u7FA4\r\n-- \u5728IDEA\u4E2D\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528\u4E0D\u540C\u7684\u914D\u7F6E\u6587\u4EF6\u6765\u542F\u52A8\u540C\u4E00\u4E2ASpringBoot\u5E94\u7528\r\n-- \u6DFB\u52A0\u4E24\u4E2A\u914D\u7F6E\uFF0C\u5206\u522B\u4EE5application-replica1.yml\u548Capplication-replica2.yml\u6765\u542F\u52A8eureka-server\r\n\u5728Active profiles \uFF1A\u914D\u7F6E replica1\u6216replica2\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u4FEE\u6539Eureka-client\uFF0C\u8BA9\u5176\u8FDE\u63A5\u5230\u96C6\u7FA4\r\n# \u6DFB\u52A0eureka-client\u7684\u914D\u7F6E\u6587\u4EF6application-replica.yml\uFF0C\u8BA9\u5176\u540C\u65F6\u6CE8\u518C\u5230\u4E24\u4E2A\u6CE8\u518C\u4E2D\u5FC3\r\nserver:\r\n  port: 8102\r\nspring:\r\n  application:\r\n    name: eureka-client\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://replica1:8002/eureka/,http://replica2:8003/eureka/ #\u540C\u65F6\u6CE8\u518C\u5230\u4E24\u4E2A\u6CE8\u518C\u4E2D\u5FC3\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u6DFB\u52A0\u8BA4\u8BC1",children:"\u6DFB\u52A0\u8BA4\u8BC1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u4E3B\u8981\u662F\u914D\u7F6E\u4E86\u767B\u5F55\u6CE8\u518C\u4E2D\u5FC3\u7684\u7528\u6237\u540D\u548C\u5BC6\u7801\r\nserver:\r\n  port: 8004\r\nspring:\r\n  application:\r\n    name: eureka-security-server\r\n  security: #\u914D\u7F6ESpringSecurity\u767B\u5F55\u7528\u6237\u540D\u548C\u5BC6\u7801\r\n    user:\r\n      name: macro\r\n      password: 123456\r\neureka:\r\n  instance:\r\n    hostname: localhost\r\n  client:\r\n    fetch-registry: false\r\n    register-with-eureka: false\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u6DFB\u52A0Java\u914D\u7F6EWebSecurityConfig\r\n// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\u6DFB\u52A0SpringSecurity\u4F9D\u8D56\u7684\u5E94\u7528\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u9700\u8981\u6DFB\u52A0CSRF token\u624D\u80FD\u8BBF\u95EE\uFF0CEureka\u5BA2\u6237\u7AEF\u6CE8\u518C\u65F6\u5E76\u4E0D\u4F1A\u6DFB\u52A0\uFF0C\u6240\u4EE5\u9700\u8981\u914D\u7F6E/eureka/**\u8DEF\u5F84\u4E0D\u9700\u8981CSRF token\r\n@EnableWebSecurity\r\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n    @Override\r\n    protected void configure(HttpSecurity http) throws Exception {\r\n        http.csrf().ignoringAntMatchers("/eureka/**");\r\n        super.configure(http);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- eureka-client\u6CE8\u518C\u5230\u6709\u767B\u5F55\u8BA4\u8BC1\u7684\u6CE8\u518C\u4E2D\u5FC3\r\n-- \u914D\u7F6E\u6587\u4EF6\u4E2D\u9700\u8981\u4FEE\u6539\u6CE8\u518C\u4E2D\u5FC3\u5730\u5740\u683C\u5F0F\r\nhttp://${username}:${password}@${hostname}:${port}/eureka/\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8103\r\nspring:\r\n  application:\r\n    name: eureka-client\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://macro:123456@localhost:8004/eureka/\n"})}),"\n",(0,i.jsx)(e.h5,{id:"eureka\u7684\u5E38\u7528\u914D\u7F6E",children:"Eureka\u7684\u5E38\u7528\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"eureka:\r\n  client: #eureka\u5BA2\u6237\u7AEF\u914D\u7F6E\r\n    register-with-eureka: true #\u662F\u5426\u5C06\u81EA\u5DF1\u6CE8\u518C\u5230eureka\u670D\u52A1\u7AEF\u4E0A\u53BB\r\n    fetch-registry: true #\u662F\u5426\u83B7\u53D6eureka\u670D\u52A1\u7AEF\u4E0A\u6CE8\u518C\u7684\u670D\u52A1\u5217\u8868\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/ # \u6307\u5B9A\u6CE8\u518C\u4E2D\u5FC3\u5730\u5740\r\n    enabled: true # \u542F\u7528eureka\u5BA2\u6237\u7AEF\r\n    registry-fetch-interval-seconds: 30 #\u5B9A\u4E49\u53BBeureka\u670D\u52A1\u7AEF\u83B7\u53D6\u670D\u52A1\u5217\u8868\u7684\u65F6\u95F4\u95F4\u9694\r\n  instance: #eureka\u5BA2\u6237\u7AEF\u5B9E\u4F8B\u914D\u7F6E\r\n    lease-renewal-interval-in-seconds: 30 #\u5B9A\u4E49\u670D\u52A1\u591A\u4E45\u53BB\u6CE8\u518C\u4E2D\u5FC3\u7EED\u7EA6\r\n    lease-expiration-duration-in-seconds: 90 #\u5B9A\u4E49\u670D\u52A1\u591A\u4E45\u4E0D\u53BB\u7EED\u7EA6\u8BA4\u4E3A\u670D\u52A1\u5931\u6548\r\n    metadata-map:\r\n      zone: jiangsu #\u6240\u5728\u533A\u57DF\r\n    hostname: localhost #\u670D\u52A1\u4E3B\u673A\u540D\u79F0\r\n    prefer-ip-address: false #\u662F\u5426\u4F18\u5148\u4F7F\u7528ip\u6765\u4F5C\u4E3A\u4E3B\u673A\u540D\r\n  server: #eureka\u670D\u52A1\u7AEF\u914D\u7F6E\r\n    enable-self-preservation: false #\u5173\u95EDeureka\u670D\u52A1\u7AEF\u7684\u4FDD\u62A4\u673A\u5236\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-ribbon",children:"cloud-ribbon"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Ribbon \u662FSpring Cloud Netflix \u5B50\u9879\u76EE\u7684\u6838\u5FC3\u7EC4\u4EF6\u4E4B\u4E00\uFF0C\u4E3B\u8981\u7ED9\u670D\u52A1\u95F4\u8C03\u7528\u53CAAPI\u7F51\u5173\u8F6C\u53D1\u63D0\u4F9B\u8D1F\u8F7D\u5747\u8861\u7684\u529F\u80FD\r\n-- \u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u5F88\u591A\u670D\u52A1\u90FD\u4F1A\u90E8\u7F72\u591A\u4E2A\uFF0C\u5176\u4ED6\u670D\u52A1\u53BB\u8C03\u7528\u8BE5\u670D\u52A1\u7684\u65F6\u5019\uFF0C\u5982\u4F55\u4FDD\u8BC1\u8D1F\u8F7D\u5747\u8861\u662F\u4E2A\u4E0D\u5F97\u4E0D\u53BB\u8003\u8651\u7684\u95EE\u9898\u3002\u8D1F\u8F7D\u5747\u8861\u53EF\u4EE5\u589E\u52A0\u7CFB\u7EDF\u7684\u53EF\u7528\u6027\u548C\u6269\u5C55\u6027\uFF0C\u5F53\u6211\u4EEC\u4F7F\u7528RestTemplate\u6765\u8C03\u7528\u5176\u4ED6\u670D\u52A1\u65F6\uFF0CRibbon\u53EF\u4EE5\u5F88\u65B9\u4FBF\u7684\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861\u529F\u80FD\r\n-- RestTemplate\u662FSpringMVC\u643A\u5E26\u7684\u5DE5\u5177\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5BA2\u6237\u7AEF1",children:"\u5BA2\u6237\u7AEF1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8201\r\nspring:\r\n  application:\r\n    name: user-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,i.jsx)(e.h5,{id:"ribbon\u8D1F\u8F7D\u5BA2\u6237\u7AEF",children:"ribbon\u8D1F\u8F7D\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8301\r\nspring:\r\n  application:\r\n    name: ribbon-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nservice-url:\r\n  user-service: http://user-service\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u8D1F\u8F7D\u914D\u7F6E",children:"\u8D1F\u8F7D\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Configuration\r\n@RibbonClient(name = "user-service")\r\npublic class RibbonConfig {\r\n\r\n    @Bean\r\n    @LoadBalanced\r\n    public RestTemplate restTemplate(){\r\n        return new RestTemplate();\r\n    }\r\n\r\n    @Bean\r\n    public IRule ribbonRule(){\r\n        return new RandomRule();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u8C03\u7528\u5BA2\u6237\u7AEF",children:"\u8C03\u7528\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("/user")\r\npublic class UserRibbonController {\r\n    @Autowired\r\n    private RestTemplate restTemplate;\r\n    @Value("${service-url.user-service}")\r\n    private String userServiceUrl;\r\n\r\n    @GetMapping("/create")\r\n    public void create() {\r\n        System.out.println(restTemplate.getForObject(userServiceUrl + "/user/create",String.class));\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u6F14\u793A",children:"\u6F14\u793A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"1. \u542F\u52A8eureka-server\u4E8E8001\u7AEF\u53E3(\u670D\u52A1\u7AEF)\r\n2. \u542F\u52A8user-service\u4E8E8201\u7AEF\u53E3\uFF08\u5BA2\u6237\u7AEF1\uFF09\r\n3. \u542F\u52A8\u53E6\u4E00\u4E2Auser-service\u4E8E8202\u7AEF\u53E3\uFF0C\u53EF\u4EE5\u901A\u8FC7Override Param\u91CD\u5199server.port\u914D\u7F6E\r\n4. \u542F\u52A8ribbon-service\uFF0C\u8C03\u7528\u63A5\u53E3\uFF0C\u4F1A\u968F\u673A\u8C03\u7528user-service\u5176\u4E2D\u4E00\u4E2A\n"})}),"\n",(0,i.jsx)(e.h5,{id:"ribbon\u5E38\u7528\u914D\u7F6E",children:"ribbon\u5E38\u7528\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Ribbon\u7684\u5E38\u7528\u914D\u7F6E\r\nribbon:\r\n  ConnectTimeout: 1000 #\u670D\u52A1\u8BF7\u6C42\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\r\n  ReadTimeout: 3000 #\u670D\u52A1\u8BF7\u6C42\u5904\u7406\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\r\n  OkToRetryOnAllOperations: true #\u5BF9\u8D85\u65F6\u8BF7\u6C42\u542F\u7528\u91CD\u8BD5\u673A\u5236\r\n  MaxAutoRetriesNextServer: 1 #\u5207\u6362\u91CD\u8BD5\u5B9E\u4F8B\u7684\u6700\u5927\u4E2A\u6570\r\n  MaxAutoRetries: 1 # \u5207\u6362\u5B9E\u4F8B\u540E\u91CD\u8BD5\u6700\u5927\u6B21\u6570\r\n  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule #\u4FEE\u6539\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\r\n\r\n-- Ribbon\u7684\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\r\ncom.netflix.loadbalancer.RandomRule\uFF1A\u4ECE\u63D0\u4F9B\u670D\u52A1\u7684\u5B9E\u4F8B\u4E2D\u4EE5\u968F\u673A\u7684\u65B9\u5F0F\uFF1B\r\ncom.netflix.loadbalancer.RoundRobinRule\uFF1A\u4EE5\u7EBF\u6027\u8F6E\u8BE2\u7684\u65B9\u5F0F\uFF0C\u5C31\u662F\u7EF4\u62A4\u4E00\u4E2A\u8BA1\u6570\u5668\uFF0C\u4ECE\u63D0\u4F9B\u670D\u52A1\u7684\u5B9E\u4F8B\u4E2D\u6309\u987A\u5E8F\u9009\u53D6\uFF0C\u7B2C\u4E00\u6B21\u9009\u7B2C\u4E00\u4E2A\uFF0C\u7B2C\u4E8C\u6B21\u9009\u7B2C\u4E8C\u4E2A\uFF0C\u4EE5\u6B64\u7C7B\u63A8\uFF0C\u5230\u6700\u540E\u4E00\u4E2A\u4EE5\u540E\u518D\u4ECE\u5934\u6765\u8FC7\uFF1B\r\ncom.netflix.loadbalancer.RetryRule\uFF1A\u5728RoundRobinRule\u7684\u57FA\u7840\u4E0A\u6DFB\u52A0\u91CD\u8BD5\u673A\u5236\uFF0C\u5373\u5728\u6307\u5B9A\u7684\u91CD\u8BD5\u65F6\u95F4\u5185\uFF0C\u53CD\u590D\u4F7F\u7528\u7EBF\u6027\u8F6E\u8BE2\u7B56\u7565\u6765\u9009\u62E9\u53EF\u7528\u5B9E\u4F8B\uFF1B\r\ncom.netflix.loadbalancer.WeightedResponseTimeRule\uFF1A\u5BF9RoundRobinRule\u7684\u6269\u5C55\uFF0C\u54CD\u5E94\u901F\u5EA6\u8D8A\u5FEB\u7684\u5B9E\u4F8B\u9009\u62E9\u6743\u91CD\u8D8A\u5927\uFF0C\u8D8A\u5BB9\u6613\u88AB\u9009\u62E9\uFF1B\r\ncom.netflix.loadbalancer.BestAvailableRule\uFF1A\u9009\u62E9\u5E76\u53D1\u8F83\u5C0F\u7684\u5B9E\u4F8B\uFF1B\r\ncom.netflix.loadbalancer.AvailabilityFilteringRule\uFF1A\u5148\u8FC7\u6EE4\u6389\u6545\u969C\u5B9E\u4F8B\uFF0C\u518D\u9009\u62E9\u5E76\u53D1\u8F83\u5C0F\u7684\u5B9E\u4F8B\uFF1B\r\ncom.netflix.loadbalancer.ZoneAwareLoadBalancer\uFF1A\u91C7\u7528\u53CC\u91CD\u8FC7\u6EE4\uFF0C\u540C\u65F6\u8FC7\u6EE4\u4E0D\u662F\u540C\u4E00\u533A\u57DF\u7684\u5B9E\u4F8B\u548C\u6545\u969C\u5B9E\u4F8B\uFF0C\u9009\u62E9\u5E76\u53D1\u8F83\u5C0F\u7684\u5B9E\u4F8B\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-hystrix",children:"cloud-hystrix"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8401\r\nspring:\r\n  application:\r\n    name: hystrix-service\r\neureka:\r\n  client:\r\n    register-with-eureka: true\r\n    fetch-registry: true\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nservice-url:\r\n  user-service: http://user-service\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@EnableCircuitBreaker\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class HystrixServiceApplication {\r\n\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(HystrixServiceApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u670D\u52A1\u964D\u7EA7",children:"\u670D\u52A1\u964D\u7EA7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6D4B\u8BD5\u6548\u679C\uFF1A\u5982\u679C\u670D\u52A1\u505C\u6B62\uFF0C\u5219\u4F1A\u8C03\u7528getDefaultUser\u65B9\u6CD5\u8FDB\u884C\u964D\u7EA7\u64CD\u4F5C\r\n */\r\n@HystrixCommand(fallbackMethod = "getDefaultUser")\r\npublic CommonResult getUser(Long id) {\r\n    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n}\r\n\r\npublic CommonResult getDefaultUser(@PathVariable Long id) {\r\n    User defaultUser = new User(-1L, "defaultUser", "123456");\r\n    return new CommonResult<>(defaultUser);\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"hystrixcommand\u5E38\u7528\u53C2\u6570",children:"@HystrixCommand\u5E38\u7528\u53C2\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"fallbackMethod\uFF1A\u6307\u5B9A\u670D\u52A1\u964D\u7EA7\u5904\u7406\u65B9\u6CD5\uFF1B\r\nignoreExceptions\uFF1A\u5FFD\u7565\u67D0\u4E9B\u5F02\u5E38\uFF0C\u4E0D\u53D1\u751F\u670D\u52A1\u964D\u7EA7\uFF1B\r\ncommandKey\uFF1A\u547D\u4EE4\u540D\u79F0\uFF0C\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u547D\u4EE4\uFF1B\r\ngroupKey\uFF1A\u5206\u7EC4\u540D\u79F0\uFF0CHystrix\u4F1A\u6839\u636E\u4E0D\u540C\u7684\u5206\u7EC4\u6765\u7EDF\u8BA1\u547D\u4EE4\u7684\u544A\u8B66\u53CA\u4EEA\u8868\u76D8\u4FE1\u606F\uFF1B\r\nthreadPoolKey\uFF1A\u7EBF\u7A0B\u6C60\u540D\u79F0\uFF0C\u7528\u4E8E\u5212\u5206\u7EBF\u7A0B\u6C60\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u8BF7\u6C42\u7F13\u5B58",children:"\u8BF7\u6C42\u7F13\u5B58"}),"\n",(0,i.jsx)(e.h6,{id:"\u76F8\u5173\u6CE8\u89E3",children:"\u76F8\u5173\u6CE8\u89E3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"@CacheResult\uFF1A\u5F00\u542F\u7F13\u5B58\uFF0C\u9ED8\u8BA4\u6240\u6709\u53C2\u6570\u4F5C\u4E3A\u7F13\u5B58\u7684key\uFF0CcacheKeyMethod\u53EF\u4EE5\u901A\u8FC7\u8FD4\u56DEString\u7C7B\u578B\u7684\u65B9\u6CD5\u6307\u5B9Akey\uFF1B\r\n@CacheKey\uFF1A\u6307\u5B9A\u7F13\u5B58\u7684key\uFF0C\u53EF\u4EE5\u6307\u5B9A\u53C2\u6570\u6216\u6307\u5B9A\u53C2\u6570\u4E2D\u7684\u5C5E\u6027\u503C\u4E3A\u7F13\u5B58key\uFF0CcacheKeyMethod\u8FD8\u53EF\u4EE5\u901A\u8FC7\u8FD4\u56DEString\u7C7B\u578B\u7684\u65B9\u6CD5\u6307\u5B9A\uFF1B\r\n@CacheRemove\uFF1A\u79FB\u9664\u7F13\u5B58\uFF0C\u9700\u8981\u6307\u5B9AcommandKey\u3002\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6D4B\u8BD5\u6548\u679C\uFF1A\u7B2C\u4E00\u6B21\u53D1\u9001\u8BF7\u6C42\u5E76\u7F13\u5B58\uFF0C\u7B2C\u4E8C\u6B21\u83B7\u53D6\u7F13\u5B58\uFF0C\u7B2C\u4E09\u6B21\u83B7\u53D6\u7F13\u5B58\r\n */\r\n@CacheResult(cacheKeyMethod = "getCacheKey")\r\n@HystrixCommand(fallbackMethod = "getDefaultUser", commandKey = "getUserCache")\r\n    public CommonResult getUserCache(Long id) {\r\n    LOGGER.info("getUserCache id:{}", id);\r\n    return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n}\r\n\r\n/**\r\n * \u4E3A\u7F13\u5B58\u751F\u6210key\r\n */\r\npublic String getCacheKey(Long id) {\r\n    return String.valueOf(id);\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6D4B\u8BD5\u6548\u679C\uFF1A\u7B2C\u4E00\u6B21\u53D1\u9001\u8BF7\u6C42\u5E76\u7F13\u5B58\uFF0C\u7B2C\u4E8C\u6B21\u79FB\u9664\u7F13\u5B58\uFF0C\u7B2C\u4E09\u6B21\u91CD\u65B0\u53D1\u9001\u8BF7\u6C42\u5E76\u7F13\u5B58\r\n * commandKey\u8981\u8DDF\u5F00\u542F\u7F13\u5B58\u7684commandKey\u5BF9\u5E94\r\n */\r\n@CacheRemove(commandKey = "getUserCache", cacheKeyMethod = "getCacheKey")\r\n@HystrixCommand\r\npublic CommonResult removeCache(Long id) {\r\n    LOGGER.info("removeCache id:{}", id);\r\n    return restTemplate.postForObject(userServiceUrl + "/user/delete/{1}", null, CommonResult.class, id);\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u5728\u7F13\u5B58\u4F7F\u7528\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u9700\u8981\u5728\u6BCF\u6B21\u4F7F\u7528\u7F13\u5B58\u7684\u8BF7\u6C42\u524D\u540E\u5BF9HystrixRequestContext\u8FDB\u884C\u521D\u59CB\u5316\u548C\u5173\u95ED\r\n * \u8FD9\u91CC\u6211\u4EEC\u901A\u8FC7\u4F7F\u7528\u8FC7\u6EE4\u5668\uFF0C\u5728\u6BCF\u4E2A\u8BF7\u6C42\u524D\u540E\u521D\u59CB\u5316\u548C\u5173\u95EDHystrixRequestContext\u6765\u89E3\u51B3\u8BE5\u95EE\u9898\r\n */\r\n@Component\r\n@WebFilter(urlPatterns = "/*",asyncSupported = true)\r\npublic class HystrixRequestContextFilter implements Filter {\r\n    @Override\r\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\r\n        HystrixRequestContext context = HystrixRequestContext.initializeContext();\r\n        try {\r\n            filterChain.doFilter(servletRequest, servletResponse);\r\n        } finally {\r\n            context.close();\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u8BF7\u6C42\u5408\u5E76",children:"\u8BF7\u6C42\u5408\u5E76"}),"\n",(0,i.jsx)(e.h6,{id:"hystrixcollapser\u7684\u5E38\u7528\u5C5E\u6027",children:"@HystrixCollapser\u7684\u5E38\u7528\u5C5E\u6027"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"batchMethod\uFF1A\u7528\u4E8E\u8BBE\u7F6E\u8BF7\u6C42\u5408\u5E76\u7684\u65B9\u6CD5\uFF1B\r\ncollapserProperties\uFF1A\u8BF7\u6C42\u5408\u5E76\u5C5E\u6027\uFF0C\u7528\u4E8E\u63A7\u5236\u5B9E\u4F8B\u5C5E\u6027\uFF0C\u6709\u5F88\u591A\uFF1B\r\ntimerDelayInMilliseconds\uFF1AcollapserProperties\u4E2D\u7684\u5C5E\u6027\uFF0C\u7528\u4E8E\u63A7\u5236\u6BCF\u9694\u591A\u5C11\u65F6\u95F4\u5408\u5E76\u4E00\u6B21\u8BF7\u6C42;\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u5BF9getUserFuture\u7684\u7684\u591A\u6B21\u8C03\u7528\u90FD\u4F1A\u8F6C\u5316\u4E3A\u5BF9getUserByIds\u7684\u5355\u6B21\u8C03\u7528\r\n * \u6D4B\u8BD5\u6548\u679C\uFF1A100\u6BEB\u79D2\u8C03\u75282\u6B21\uFF0C2\u6B21\u5408\u5E76\u6210\u4E00\u6B21\u6279\u91CF\u8BF7\u6C42\uFF08\u7C7B\u4F3CbyId \u548C byIds\uFF09\r\n * 100\u6BEB\u79D2\u540E\u8C03\u7528\u7B2C\u4E09\u6B21\uFF0C\u4E0D\u5408\u5E76\r\n */\r\n@HystrixCollapser(batchMethod = "getUserByIds",collapserProperties = {\r\n    @HystrixProperty(name = "timerDelayInMilliseconds", value = "100")\r\n})\r\npublic Future<User> getUserFuture(Long id) {\r\n    return new AsyncResult<User>(){\r\n    @Override\r\n    public User invoke() {\r\n        CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n        Map data = (Map) commonResult.getData();\r\n        User user = BeanUtil.mapToBean(data,User.class,true);\r\n        LOGGER.info("getUserById username:{}", user.getUsername());\r\n        return user;\r\n        }\r\n    };\r\n}\r\n\r\n@HystrixCommand\r\npublic List<User> getUserByIds(List<Long> ids) {\r\n    LOGGER.info("getUserByIds:{}", ids);\r\n    CommonResult commonResult = restTemplate.getForObject(userServiceUrl + "/user/getUserByIds?ids={1}", CommonResult.class, CollUtil.join(ids,","));\r\n    return (List<User>) commonResult.getData();\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"hystrix\u7684\u5E38\u7528\u914D\u7F6E",children:"Hystrix\u7684\u5E38\u7528\u914D\u7F6E"}),"\n",(0,i.jsx)(e.h6,{id:"\u5168\u5C40\u914D\u7F6E",children:"\u5168\u5C40\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"hystrix:\r\n  command: #\u7528\u4E8E\u63A7\u5236HystrixCommand\u7684\u884C\u4E3A\r\n    default:\r\n      execution:\r\n        isolation:\r\n          strategy: THREAD #\u63A7\u5236HystrixCommand\u7684\u9694\u79BB\u7B56\u7565\uFF0CTHREAD->\u7EBF\u7A0B\u6C60\u9694\u79BB\u7B56\u7565(\u9ED8\u8BA4)\uFF0CSEMAPHORE->\u4FE1\u53F7\u91CF\u9694\u79BB\u7B56\u7565\r\n          thread:\r\n            timeoutInMilliseconds: 1000 #\u914D\u7F6EHystrixCommand\u6267\u884C\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u6267\u884C\u8D85\u8FC7\u8BE5\u65F6\u95F4\u4F1A\u8FDB\u884C\u670D\u52A1\u964D\u7EA7\u5904\u7406\r\n            interruptOnTimeout: true #\u914D\u7F6EHystrixCommand\u6267\u884C\u8D85\u65F6\u7684\u65F6\u5019\u662F\u5426\u8981\u4E2D\u65AD\r\n            interruptOnCancel: true #\u914D\u7F6EHystrixCommand\u6267\u884C\u88AB\u53D6\u6D88\u7684\u65F6\u5019\u662F\u5426\u8981\u4E2D\u65AD\r\n          timeout:\r\n            enabled: true #\u914D\u7F6EHystrixCommand\u7684\u6267\u884C\u662F\u5426\u542F\u7528\u8D85\u65F6\u65F6\u95F4\r\n          semaphore:\r\n            maxConcurrentRequests: 10 #\u5F53\u4F7F\u7528\u4FE1\u53F7\u91CF\u9694\u79BB\u7B56\u7565\u65F6\uFF0C\u7528\u6765\u63A7\u5236\u5E76\u53D1\u91CF\u7684\u5927\u5C0F\uFF0C\u8D85\u8FC7\u8BE5\u5E76\u53D1\u91CF\u7684\u8BF7\u6C42\u4F1A\u88AB\u62D2\u7EDD\r\n      fallback:\r\n        enabled: true #\u7528\u4E8E\u63A7\u5236\u662F\u5426\u542F\u7528\u670D\u52A1\u964D\u7EA7\r\n      circuitBreaker: #\u7528\u4E8E\u63A7\u5236HystrixCircuitBreaker\u7684\u884C\u4E3A\r\n        enabled: true #\u7528\u4E8E\u63A7\u5236\u65AD\u8DEF\u5668\u662F\u5426\u8DDF\u8E2A\u5065\u5EB7\u72B6\u51B5\u4EE5\u53CA\u7194\u65AD\u8BF7\u6C42\r\n        requestVolumeThreshold: 20 #\u8D85\u8FC7\u8BE5\u8BF7\u6C42\u6570\u7684\u8BF7\u6C42\u4F1A\u88AB\u62D2\u7EDD\r\n        forceOpen: false #\u5F3A\u5236\u6253\u5F00\u65AD\u8DEF\u5668\uFF0C\u62D2\u7EDD\u6240\u6709\u8BF7\u6C42\r\n        forceClosed: false #\u5F3A\u5236\u5173\u95ED\u65AD\u8DEF\u5668\uFF0C\u63A5\u6536\u6240\u6709\u8BF7\u6C42\r\n      requestCache:\r\n        enabled: true #\u7528\u4E8E\u63A7\u5236\u662F\u5426\u5F00\u542F\u8BF7\u6C42\u7F13\u5B58\r\n  collapser: #\u7528\u4E8E\u63A7\u5236HystrixCollapser\u7684\u6267\u884C\u884C\u4E3A\r\n    default:\r\n      maxRequestsInBatch: 100 #\u63A7\u5236\u4E00\u6B21\u5408\u5E76\u8BF7\u6C42\u5408\u5E76\u7684\u6700\u5927\u8BF7\u6C42\u6570\r\n      timerDelayinMilliseconds: 10 #\u63A7\u5236\u591A\u5C11\u6BEB\u79D2\u5185\u7684\u8BF7\u6C42\u4F1A\u88AB\u5408\u5E76\u6210\u4E00\u4E2A\r\n      requestCache:\r\n        enabled: true #\u63A7\u5236\u5408\u5E76\u8BF7\u6C42\u662F\u5426\u5F00\u542F\u7F13\u5B58\r\n  threadpool: #\u7528\u4E8E\u63A7\u5236HystrixCommand\u6267\u884C\u6240\u5728\u7EBF\u7A0B\u6C60\u7684\u884C\u4E3A\r\n    default:\r\n      coreSize: 10 #\u7EBF\u7A0B\u6C60\u7684\u6838\u5FC3\u7EBF\u7A0B\u6570\r\n      maximumSize: 10 #\u7EBF\u7A0B\u6C60\u7684\u6700\u5927\u7EBF\u7A0B\u6570\uFF0C\u8D85\u8FC7\u8BE5\u7EBF\u7A0B\u6570\u7684\u8BF7\u6C42\u4F1A\u88AB\u62D2\u7EDD\r\n      maxQueueSize: -1 #\u7528\u4E8E\u8BBE\u7F6E\u7EBF\u7A0B\u6C60\u7684\u6700\u5927\u961F\u5217\u5927\u5C0F\uFF0C-1\u91C7\u7528SynchronousQueue\uFF0C\u5176\u4ED6\u6B63\u6570\u91C7\u7528LinkedBlockingQueue\r\n      queueSizeRejectionThreshold: 5 #\u7528\u4E8E\u8BBE\u7F6E\u7EBF\u7A0B\u6C60\u961F\u5217\u7684\u62D2\u7EDD\u9600\u503C\uFF0C\u7531\u4E8ELinkedBlockingQueue\u4E0D\u80FD\u52A8\u6001\u6539\u7248\u5927\u5C0F\uFF0C\u4F7F\u7528\u65F6\u9700\u8981\u7528\u8BE5\u53C2\u6570\u6765\u63A7\u5236\u7EBF\u7A0B\u6570\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u5B9E\u4F8B\u914D\u7F6E",children:"\u5B9E\u4F8B\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u914D\u7F6E\u6587\u4EF6\u4E2D\u76F8\u5173key\u7684\u8BF4\u660E\r\n# HystrixComandKey\u5BF9\u5E94@HystrixCommand\u4E2D\u7684commandKey\u5C5E\u6027\uFF1B\r\n# HystrixCollapserKey\u5BF9\u5E94@HystrixCollapser\u6CE8\u89E3\u4E2D\u7684collapserKey\u5C5E\u6027\uFF1B\r\n# HystrixThreadPoolKey\u5BF9\u5E94@HystrixCommand\u4E2D\u7684threadPoolKey\u5C5E\u6027\r\nhystrix:\r\n  command:\r\n    HystrixComandKey: #\u5C06default\u6362\u6210HystrixComrnandKey\r\n      execution:\r\n        isolation:\r\n          strategy: THREAD\r\n  collapser:\r\n    HystrixCollapserKey: #\u5C06default\u6362\u6210HystrixCollapserKey\r\n      maxRequestsInBatch: 100\r\n  threadpool:\r\n    HystrixThreadPoolKey: #\u5C06default\u6362\u6210HystrixThreadPoolKey\r\n      coreSize: 10\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-feign",children:"cloud-feign"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8701\r\nspring:\r\n application:\r\n  name: feign-service\r\neureka:\r\n client:\r\n  register-with-eureka: true\r\n  fetch-registry: true\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nfeign:\r\n hystrix:\r\n  enabled: true #\u5728Feign\u4E2D\u5F00\u542FHystrix\r\n compression:\r\n  request:\r\n   enabled: false #\u662F\u5426\u5BF9\u8BF7\u6C42\u8FDB\u884CGZIP\u538B\u7F29\r\n   mime-types: text/xml,application/xml,application/json #\u6307\u5B9A\u538B\u7F29\u7684\u8BF7\u6C42\u6570\u636E\u7C7B\u578B\r\n   min-request-size: 2048 #\u8D85\u8FC7\u8BE5\u5927\u5C0F\u7684\u8BF7\u6C42\u4F1A\u88AB\u538B\u7F29\r\n  response:\r\n   enabled: false #\u662F\u5426\u5BF9\u54CD\u5E94\u8FDB\u884CGZIP\u538B\u7F29\r\nlogging:\r\n level: #\u4FEE\u6539\u65E5\u5FD7\u7EA7\u522B\r\n  com.hmh.feign.feign.UserService: debug\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@EnableFeignClients\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class FeignServiceApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(FeignServiceApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h5,{id:"feign\u63A5\u53E3",children:"feign\u63A5\u53E3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//value\uFF1A\u8C03\u7528\u7684\u670D\u52A1\u3002fallback\uFF1A\u670D\u52A1\u964D\u7EA7\u5904\u7406\u7C7B\uFF08\u5B9E\u73B0UserService\uFF09\r\n@FeignClient(value = "user-service",fallback = UserFallbackService.class)\r\npublic interface UserService {\r\n    @GetMapping("/user/create")\r\n    void create();\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u65E5\u5FD7\u6253\u5370",children:"\u65E5\u5FD7\u6253\u5370"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u65E5\u5FD7\u7EA7\u522B\r\nNONE\uFF1A\u9ED8\u8BA4\u7684\uFF0C\u4E0D\u663E\u793A\u4EFB\u4F55\u65E5\u5FD7\uFF1B\r\nBASIC\uFF1A\u4EC5\u8BB0\u5F55\u8BF7\u6C42\u65B9\u6CD5\u3001URL\u3001\u54CD\u5E94\u72B6\u6001\u7801\u53CA\u6267\u884C\u65F6\u95F4\uFF1B\r\nHEADERS\uFF1A\u9664\u4E86BASIC\u4E2D\u5B9A\u4E49\u7684\u4FE1\u606F\u4E4B\u5916\uFF0C\u8FD8\u6709\u8BF7\u6C42\u548C\u54CD\u5E94\u7684\u5934\u4FE1\u606F\uFF1B\r\nFULL\uFF1A\u9664\u4E86HEADERS\u4E2D\u5B9A\u4E49\u7684\u4FE1\u606F\u4E4B\u5916\uFF0C\u8FD8\u6709\u8BF7\u6C42\u548C\u54CD\u5E94\u7684\u6B63\u6587\u53CA\u5143\u6570\u636E\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u901A\u8FC7java\u914D\u7F6E\u6765\u4F7FFeign\u6253\u5370\u6700\u8BE6\u7EC6\u7684Http\u8BF7\u6C42\u65E5\u5FD7\u4FE1\u606F\r\n */\r\n@Configuration\r\npublic class FeignConfig {\r\n    @Bean\r\n    Logger.Level feignLoggerLevel() {\r\n        return Logger.Level.FULL;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-zuul",children:"cloud-zuul"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-zuul</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8801\r\nspring:\r\n application:\r\n  name: zuul-proxy\r\neureka:\r\n client:\r\n  register-with-eureka: true\r\n  fetch-registry: true\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nzuul:\r\n prefix: /proxy #\u7ED9\u7F51\u5173\u8DEF\u7531\u6DFB\u52A0\u524D\u7F00\r\n routes: #\u7ED9\u670D\u52A1\u914D\u7F6E\u8DEF\u7531\r\n  user-service: # \u9ED8\u8BA4\u4E3A/user-service/**\r\n   path: /userService/**\r\n  feign-service: # \u9ED8\u8BA4\u4E3A/feign-service/**\r\n   path: /feignService/**\r\n# ignored-services: user-service,feign-service #\u5173\u95ED\u9ED8\u8BA4\u8DEF\u7531\u914D\u7F6E\r\n add-host-header: true #\u8BBE\u7F6E\u4E3Atrue\u91CD\u5B9A\u5411\u662F\u4F1A\u6DFB\u52A0host\u8BF7\u6C42\u5934\r\n sensitive-headers: Cookie,Set-Cookie,Authorization #\u914D\u7F6E\u8FC7\u6EE4\u654F\u611F\u7684\u8BF7\u6C42\u5934\u4FE1\u606F\uFF0C\u8BBE\u7F6E\u4E3A\u7A7A\u5C31\u4E0D\u4F1A\u8FC7\u6EE4\r\n # \u7981\u7528\u8FC7\u6EE4\u5668\r\n PreLogFilter:\r\n  pre:\r\n   disable: false\r\n\r\nmanagement:\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: 'routes'\r\n# \u670D\u52A1\u964D\u7EA7\r\nhystrix:\r\n command: #\u7528\u4E8E\u63A7\u5236HystrixCommand\u7684\u884C\u4E3A\r\n  default:\r\n   execution:\r\n    isolation:\r\n     thread:\r\n      timeoutInMilliseconds: 1000 #\u914D\u7F6EHystrixCommand\u6267\u884C\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u6267\u884C\u8D85\u8FC7\u8BE5\u65F6\u95F4\u4F1A\u8FDB\u884C\u670D\u52A1\u964D\u7EA7\u5904\u7406\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@SpringBootApplication\r\n@EnableEurekaClient\r\n@EnableZuulProxy\r\npublic class ZuulProxyApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ZuulProxyApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u8BF7\u6C42\u8DEF\u7531",children:"\u8BF7\u6C42\u8DEF\u7531"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"zuul:\r\n  routes: #\u7ED9\u670D\u52A1\u914D\u7F6E\u8DEF\u7531\r\n    user-service:\r\n      path: /userService/**\r\n    feign-service:\r\n      path: /feignService/**\r\n      \r\n\u8BBF\u95EEhttp://localhost:8801/userService/user/1\u53EF\u4EE5\u53D1\u73B0\u8BF7\u6C42\u8DEF\u7531\u5230\u4E86user-service\u4E0A\u4E86\uFF1B\r\n\r\n\u8BBF\u95EEhttp://localhost:8801/feignService/user/1\u53EF\u4EE5\u53D1\u73B0\u8BF7\u6C42\u8DEF\u7531\u5230\u4E86feign-service\u4E0A\u4E86\r\n\r\n--\u9ED8\u8BA4\u914D\u7F6E\r\n\r\n\u8BBF\u95EEhttp://localhost:8801/user-service/user/1\u540C\u6837\u53EF\u4EE5\u8DEF\u7531\u5230\u4E86user-service\u4E0A\u4E86\uFF1B\r\n\r\n\u8BBF\u95EEhttp://localhost:8801/feign-service/user/1\u540C\u6837\u53EF\u4EE5\u8DEF\u7531\u5230\u4E86feign-service\u4E0A\u4E86\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u67E5\u770B\u8DEF\u7531\u4FE1\u606F",children:"\u67E5\u770B\u8DEF\u7531\u4FE1\u606F"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"management:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'routes'\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u67E5\u770B\u7B80\u5355\u8DEF\u7531\u4FE1\u606F\r\nhttp://localhost:8801/actuator/routes\r\n-- \u67E5\u770B\u8BE6\u7EC6\u8DEF\u7531\u4FE1\u606F\r\nhttp://localhost:8801/actuator/routes/details\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u8FC7\u6EE4\u5668",children:"\u8FC7\u6EE4\u5668"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8FC7\u6EE4\u5668\u7C7B\u578B\r\npre\uFF1A\u5728\u8BF7\u6C42\u88AB\u8DEF\u7531\u5230\u76EE\u6807\u670D\u52A1\u524D\u6267\u884C\uFF0C\u6BD4\u5982\u6743\u9650\u6821\u9A8C\u3001\u6253\u5370\u65E5\u5FD7\u7B49\u529F\u80FD\uFF1B\r\nrouting\uFF1A\u5728\u8BF7\u6C42\u88AB\u8DEF\u7531\u5230\u76EE\u6807\u670D\u52A1\u65F6\u6267\u884C\uFF0C\u8FD9\u662F\u4F7F\u7528Apache HttpClient\u6216Netflix Ribbon\u6784\u5EFA\u548C\u53D1\u9001\u539F\u59CBHTTP\u8BF7\u6C42\u7684\u5730\u65B9\uFF1B\r\npost\uFF1A\u5728\u8BF7\u6C42\u88AB\u8DEF\u7531\u5230\u76EE\u6807\u670D\u52A1\u540E\u6267\u884C\uFF0C\u6BD4\u5982\u7ED9\u76EE\u6807\u670D\u52A1\u7684\u54CD\u5E94\u6DFB\u52A0\u5934\u4FE1\u606F\uFF0C\u6536\u96C6\u7EDF\u8BA1\u6570\u636E\u7B49\u529F\u80FD\uFF1B\r\nerror\uFF1A\u8BF7\u6C42\u5728\u5176\u4ED6\u9636\u6BB5\u53D1\u751F\u9519\u8BEF\u65F6\u6267\u884C\r\n\r\n\u670D\u52A1A ---> pre ---> routing ---> \u670D\u52A1B \r\n  ^                                |\r\n  |   <--- post <--- routing <---                        \n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u81EA\u5B9A\u4E49\u8FC7\u6EE4\u5668\r\n */\r\n@Component\r\npublic class PreLogFilter extends ZuulFilter {\r\n    private Logger LOGGER = LoggerFactory.getLogger(this.getClass());\r\n\r\n    /**\r\n     * \u8FC7\u6EE4\u5668\u7C7B\u578B\uFF0C\u6709pre\u3001routing\u3001post\u3001error\u56DB\u79CD\u3002\r\n     */\r\n    @Override\r\n    public String filterType() {\r\n        return "pre";\r\n    }\r\n\r\n    /**\r\n     * \u8FC7\u6EE4\u5668\u6267\u884C\u987A\u5E8F\uFF0C\u6570\u503C\u8D8A\u5C0F\u4F18\u5148\u7EA7\u8D8A\u9AD8\u3002\r\n     */\r\n    @Override\r\n    public int filterOrder() {\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u8FDB\u884C\u8FC7\u6EE4\uFF0C\u8FD4\u56DEtrue\u4F1A\u6267\u884C\u8FC7\u6EE4\u3002\r\n     */\r\n    @Override\r\n    public boolean shouldFilter() {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u81EA\u5B9A\u4E49\u7684\u8FC7\u6EE4\u5668\u903B\u8F91\uFF0C\u5F53shouldFilter()\u8FD4\u56DEtrue\u65F6\u4F1A\u6267\u884C\u3002\r\n     */\r\n    @Override\r\n    public Object run() throws ZuulException {\r\n        RequestContext requestContext = RequestContext.getCurrentContext();\r\n        HttpServletRequest request = requestContext.getRequest();\r\n        String host = request.getRemoteHost();\r\n        String method = request.getMethod();\r\n        String uri = request.getRequestURI();\r\n        LOGGER.info("Remote host:{},method:{},uri:{}", host, method, uri);\r\n        return null;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-config",children:"cloud-config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Config \u9700\u8981\u4E00\u4E2A\u5B58\u50A8\u914D\u7F6E\u4FE1\u606F\u7684Git\u4ED3\u5E93\r\n\u5982\uFF1Ahttps://gitee.com/macrozheng/springcloud-config\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u670D\u52A1\u7AEF-1",children:"\u670D\u52A1\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-config-server</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8901\r\nspring:\r\n application:\r\n  name: config-server\r\n cloud:\r\n  config:\r\n   server:\r\n    git: #\u914D\u7F6E\u5B58\u50A8\u914D\u7F6E\u4FE1\u606F\u7684Git\u4ED3\u5E93\r\n     uri: https://gitee.com/dahua_0429/cloud-config.git\r\n     username: 1075335917@qq.com\r\n     password: h2050401938\r\n     clone-on-start: true #\u5F00\u542F\u542F\u52A8\u65F6\u76F4\u63A5\u4ECEgit\u83B7\u53D6\u914D\u7F6E\r\n     search-paths: '{application}' # \u4F18\u5148\u5B50\u6587\u4EF6\u5939\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@EnableConfigServer\r\n@EnableDiscoveryClient\r\n@SpringBootApplication\r\npublic class ConfigServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ConfigServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u4FE1\u606F\u7684\u8BBF\u95EE\u683C\u5F0F\r\n-- \u83B7\u53D6\u914D\u7F6E\u4FE1\u606F\r\n/{label}/{application}-{profile}\r\n-- \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u4FE1\u606F\r\n/{label}/{application}-{profile}.yml\r\n\u5982\uFF1Ahttp://localhost:8901/master/config-dev.yml\r\n\r\napplication\uFF1A\u4EE3\u8868\u5E94\u7528\u540D\u79F0\uFF0C\u9ED8\u8BA4\u4E3A\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684spring.application.name\uFF0C\u5982\u679C\u914D\u7F6E\u4E86spring.cloud.config.name\uFF0C\u5219\u4E3A\u8BE5\u540D\u79F0\uFF1B\r\nlabel\uFF1A\u4EE3\u8868\u5206\u652F\u540D\u79F0\uFF0C\u5BF9\u5E94\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684spring.cloud.config.label\uFF1B\r\nprofile\uFF1A\u4EE3\u8868\u73AF\u5883\u540D\u79F0\uFF0C\u5BF9\u5E94\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684spring.cloud.config.profile\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5BA2\u6237\u7AEF-1",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u914D\u7F6E\u6587\u4EF6\u4E3Abootstrap.yaml\r\nserver:\r\n port: 9001\r\nspring:\r\n application:\r\n  name: config-client\r\n cloud:\r\n  config: #Config\u5BA2\u6237\u7AEF\u914D\u7F6E\r\n   profile: dev #\u542F\u7528\u914D\u7F6E\u540E\u7F00\u540D\u79F0\r\n   label: dev #\u5206\u652F\u540D\u79F0\r\n   uri: http://localhost:8901 #\u914D\u7F6E\u4E2D\u5FC3\u5730\u5740\r\n   name: config #\u914D\u7F6E\u6587\u4EF6\u540D\u79F0\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: 'refresh' # \u5237\u65B0\u914D\u7F6E\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6D4B\u8BD5\u914D\u7F6E\r\n */\r\n@RestController\r\npublic class ConfigClientController {\r\n\r\n    @Value("${config.info}")\r\n    private String configInfo;\r\n\r\n    @GetMapping("/configInfo")\r\n    public String getConfigInfo() {\r\n        return configInfo;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u5237\u65B0\u914D\u7F6E",children:"\u5237\u65B0\u914D\u7F6E"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n   <groupId>org.springframework.boot</groupId>\r\n   <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"management:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'refresh'\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6DFB\u52A0@RefreshScope\u6CE8\u89E3\u5237\u65B0\u914D\u7F6E\r\n */\r\n@RestController\r\n@RefreshScope\r\npublic class ConfigClientController {\r\n\r\n    @Value("${config.info}")\r\n    private String configInfo;\r\n\r\n    @GetMapping("/configInfo")\r\n    public String getConfigInfo() {\r\n        return configInfo;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5237\u65B0\u914D\u7F6E\u63A5\u53E3\r\nPOST http://localhost:9001/actuator/refresh\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5B89\u5168\u8BA4\u8BC1",children:"\u5B89\u5168\u8BA4\u8BC1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-config-server</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8905\r\nspring:\r\n  application:\r\n    name: config-security-server\r\n  cloud:\r\n    config:\r\n      server:\r\n        git:\r\n          uri: https://gitee.com/macrozheng/springcloud-config.git\r\n          username: macro\r\n          password: 123456\r\n          clone-on-start: true #\u5F00\u542F\u542F\u52A8\u65F6\u76F4\u63A5\u4ECEgit\u83B7\u53D6\u914D\u7F6E\r\n  security: #\u914D\u7F6E\u7528\u6237\u540D\u548C\u5BC6\u7801\r\n    user:\r\n      name: macro\r\n      password: 123456\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@SpringBootApplication\r\n@EnableConfigServer\r\npublic class ConfigSecurityServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(ConfigSecurityServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u5BA2\u6237\u7AEF\u4FEE\u6539\u914D\u7F6E\uFF0C\u6DFB\u52A0\u8BA4\u8BC1\u8D26\u53F7\u5BC6\u7801\r\nserver:\r\n  port: 9002\r\nspring:\r\n  application:\r\n    name: config-client\r\n  cloud:\r\n    config:\r\n      profile: dev #\u542F\u7528\u914D\u7F6E\u540E\u7F00\u540D\u79F0\r\n      label: dev #\u5206\u652F\u540D\u79F0\r\n      uri: http://localhost:8905 #\u914D\u7F6E\u4E2D\u5FC3\u5730\u5740\r\n      name: config #\u914D\u7F6E\u6587\u4EF6\u540D\u79F0\r\n      username: macro\r\n      password: 123456\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u96C6\u7FA4\u642D\u5EFA",children:"\u96C6\u7FA4\u642D\u5EFA"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u542F\u52A8\u591A\u4E2A\u670D\u52A1\u7AEF\uFF0C\u8FDE\u63A5\u540C\u4E00\u4E2A\u6CE8\u518C\u4E2D\u5FC3\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u5BA2\u6237\u7AEF\u914D\u7F6E\uFF1A\u6DFB\u52A0\u4E86\u4ECE\u6CE8\u518C\u4E2D\u5FC3\u83B7\u53D6\u914D\u7F6E\u4E2D\u5FC3\u5730\u5740\u7684\u914D\u7F6E\u5E76\u53BB\u9664\u4E86\u914D\u7F6E\u4E2D\u5FC3uri\u7684\u914D\u7F6E\r\nserver:\r\n port: 9003\r\nspring:\r\n application:\r\n  name: config-client\r\n cloud:\r\n  config:\r\n   profile: dev #\u542F\u7528\u73AF\u5883\u540D\u79F0\r\n   label: dev #\u5206\u652F\u540D\u79F0\r\n   name: config #\u914D\u7F6E\u6587\u4EF6\u540D\u79F0\r\n   discovery:\r\n    enabled: true\r\n    service-id: config-server\r\neureka:\r\n client:\r\n  service-url:\r\n   defaultZone: http://localhost:8001/eureka/\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-bus",children:"cloud-bus"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Bus \u4F7F\u7528\u8F7B\u91CF\u7EA7\u7684\u6D88\u606F\u4EE3\u7406\u6765\u8FDE\u63A5\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u5404\u4E2A\u670D\u52A1\uFF0C\u53EF\u4EE5\u5C06\u5176\u7528\u4E8E\u5E7F\u64AD\u72B6\u6001\u66F4\u6539\uFF08\u4F8B\u5982\u914D\u7F6E\u4E2D\u5FC3\u914D\u7F6E\u66F4\u6539\uFF09\u6216\u5176\u4ED6\u7BA1\u7406\u6307\u4EE4\r\n\r\n-- Spring Cloud Bus \u914D\u5408 Spring Cloud Config \u4F7F\u7528\u53EF\u4EE5\u5B9E\u73B0\u914D\u7F6E\u7684\u52A8\u6001\u5237\u65B0\r\n\r\n-- \u542F\u52A8rabbitMQ\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u52A8\u6001\u5237\u65B0\u914D\u7F6E",children:"\u52A8\u6001\u5237\u65B0\u914D\u7F6E"}),"\n",(0,i.jsx)(e.h6,{id:"\u670D\u52A1\u7AEF-2",children:"\u670D\u52A1\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-bus-amqp</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u4E3B\u8981\u662F\u6DFB\u52A0\u4E86RabbitMQ\u7684\u914D\u7F6E\u53CA\u66B4\u9732\u4E86\u5237\u65B0\u914D\u7F6E\u7684Actuator\u7AEF\u70B9\r\nserver:\r\n  port: 8904\r\nspring:\r\n  application:\r\n    name: config-server\r\n  cloud:\r\n    config:\r\n      server:\r\n        git:\r\n          uri: https://gitee.com/macrozheng/springcloud-config.git\r\n          username: macro\r\n          password: 123456\r\n          clone-on-start: true # \u5F00\u542F\u542F\u52A8\u65F6\u76F4\u63A5\u4ECEgit\u83B7\u53D6\u914D\u7F6E\r\n  rabbitmq: #rabbitmq\u76F8\u5173\u914D\u7F6E\r\n    host: localhost\r\n    port: 5672\r\n    username: guest\r\n    password: guest\r\neureka:\r\n  client:\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n  endpoints: #\u66B4\u9732bus\u5237\u65B0\u914D\u7F6E\u7684\u7AEF\u70B9\r\n    web:\r\n      exposure:\r\n        include: 'bus-refresh'\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u5BA2\u6237\u7AEF-2",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-bus-amqp</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 9004\r\nspring:\r\n  application:\r\n    name: config-client\r\n  cloud:\r\n    config:\r\n      profile: dev #\u542F\u7528\u73AF\u5883\u540D\u79F0\r\n      label: dev #\u5206\u652F\u540D\u79F0\r\n      name: config #\u914D\u7F6E\u6587\u4EF6\u540D\u79F0\r\n      discovery:\r\n        enabled: true\r\n        service-id: config-server\r\n  rabbitmq: #rabbitmq\u76F8\u5173\u914D\u7F6E\r\n    host: localhost\r\n    port: 5672\r\n    username: guest\r\n    password: guest\r\neureka:\r\n  client:\r\n    service-url:\r\n      defaultZone: http://localhost:8001/eureka/\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: 'refresh'\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u6F14\u793A-1",children:"\u6F14\u793A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"1. \u542F\u52A8eureka-server\r\n2. \u542F\u52A8config-server\r\n3. \u542F\u52A8\u4E24\u4E2A\u4E0D\u540C\u7AEF\u53E3\u7684config-client\r\n\r\n\u767B\u5F55RabbitMQ\u7684\u63A7\u5236\u53F0\u53EF\u4EE5\u53D1\u73B0Spring Cloud Bus\u521B\u5EFA\u4E86\u4E00\u4E2A\u53EBspringCloudBus\u7684\u4EA4\u6362\u673A\u53CA\u4E09\u4E2A\u4EE5 springCloudBus.anonymous\u5F00\u5934\u7684\u961F\u5217\r\n\r\n4. \u8C03\u7528\u6CE8\u518C\u4E2D\u5FC3\u7684\u63A5\u53E3\u5237\u65B0\u6240\u6709\u914D\u7F6E(\u4E24\u4E2A\u5BA2\u6237\u7AEF)\r\nhttp://localhost:8904/actuator/bus-refresh\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u914D\u5408webhooks\u4F7F\u7528",children:"\u914D\u5408WebHooks\u4F7F\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"WebHooks\u76F8\u5F53\u4E8E\u662F\u4E00\u4E2A\u94A9\u5B50\u51FD\u6570\uFF0C\u6211\u4EEC\u53EF\u4EE5\u914D\u7F6E\u5F53\u5411Git\u4ED3\u5E93push\u4EE3\u7801\u65F6\u89E6\u53D1\u8FD9\u4E2A\u94A9\u5B50\u51FD\u6570\uFF0C\u8FD9\u91CC\u4EE5Gitee\u4E3A\u4F8B\u6765\u4ECB\u7ECD\u4E0B\u5176\u4F7F\u7528\u65B9\u5F0F\uFF0C\u8FD9\u91CC\u5F53\u6211\u4EEC\u5411\u914D\u7F6E\u4ED3\u5E93push\u4EE3\u7801\u65F6\u5C31\u4F1A\u81EA\u52A8\u5237\u65B0\u670D\u52A1\u914D\u7F6E\u4E86\r\n\r\ngit\u7BA1\u7406 \r\n--> WebHooks \r\n--> \u586B\u5199URl\uFF1Ahttp://localhost:8904/actuator/bus-refresh \r\n--> \u52FE\u9009PUSH\u6DFB\u52A0\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-sleuth",children:"cloud-sleuth"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u9700\u8981\u94FE\u8DEF\u8FFD\u8E2A\u7684\u670D\u52A1\u90FD\u8981\u914D\u7F6E\u4E0B\u9762\u4FE1\u606F\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-zipkin</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  zipkin:\r\n    base-url: http://localhost:9411\r\n  sleuth:\r\n    sampler:\r\n      probability: 1 #\u8BBE\u7F6ESleuth\u7684\u62BD\u6837\u6536\u96C6\u6982\u73870-1\n"})}),"\n",(0,i.jsx)(e.h5,{id:"zipkin\u65E5\u5FD7",children:"zipkin\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Zipkin\u662FTwitter\u7684\u4E00\u4E2A\u5F00\u6E90\u9879\u76EE\uFF0C\u53EF\u4EE5\u7528\u6765\u83B7\u53D6\u548C\u5206\u6790Spring Cloud Sleuth \u4E2D\u4EA7\u751F\u7684\u8BF7\u6C42\u94FE\u8DEF\u8DDF\u8E2A\u65E5\u5FD7\uFF0C\u5B83\u63D0\u4F9B\u4E86Web\u754C\u9762\u6765\u5E2E\u52A9\u6211\u4EEC\u76F4\u89C2\u5730\u67E5\u770B\u8BF7\u6C42\u94FE\u8DEF\u8DDF\u8E2A\u4FE1\u606F\r\n\r\n-- \u4E0B\u8F7Dzipkin-server\r\nhttps://repo1.maven.org/maven2/io/zipkin/java/zipkin-server/2.12.9/zipkin-server-2.12.9-exec.jar\r\n\r\n-- \u8FD0\u884C\r\njava -jar zipkin-server-2.12.9-exec.jar\r\n\r\n-- Zipkin\u9875\u9762\u8BBF\u95EE\u5730\u5740\r\nhttp://localhost:9411\n"})}),"\n",(0,i.jsx)(e.h5,{id:"elasticsearch\u5B58\u50A8\u65E5\u5FD7",children:"Elasticsearch\u5B58\u50A8\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- zipkin-server\u542F\u52A8\u547D\u4EE4\r\n# STORAGE_TYPE\u5B58\u50A8\u7C7B\u578B ES_HOSTS\u8BBF\u95EE\u5730\u5740\r\njava -jar zipkin-server-2.12.9-exec.jar --STORAGE_TYPE=elasticsearch --ES_HOSTS=localhost:9200 \n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-consul",children:"cloud-consul"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Consul \u5177\u6709\u7279\u6027\uFF1A\r\n\u652F\u6301\u670D\u52A1\u6CBB\u7406\uFF1AConsul\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\r\n\u652F\u6301\u5BA2\u6237\u7AEF\u8D1F\u8D23\u5747\u8861\uFF1A\u5305\u62ECRibbon\u548CSpring Cloud LoadBalancer\r\n\u652F\u6301Zuul\uFF1A\u5F53Zuul\u4F5C\u4E3A\u7F51\u5173\u65F6\uFF0C\u53EF\u4EE5\u4ECEConsul\u4E2D\u6CE8\u518C\u548C\u53D1\u73B0\u5E94\u7528\uFF1B\r\n\u652F\u6301\u5206\u5E03\u5F0F\u914D\u7F6E\u7BA1\u7406\uFF1AConsul\u4F5C\u4E3A\u914D\u7F6E\u4E2D\u5FC3\r\n\u652F\u6301\u63A7\u5236\u603B\u7EBF\uFF1A\u53EF\u4EE5\u5728\u6574\u4E2A\u5FAE\u670D\u52A1\u7CFB\u7EDF\u4E2D\u901A\u8FC7Control Bus\u5206\u53D1\u4E8B\u4EF6\u6D88\u606F,\u52A8\u6001\u5237\u65B0\u914D\u7F6E\r\n\r\n-- \u4E0B\u8F7D\u5730\u5740\r\nhttps://www.consul.io/downloads.html\r\n-- \u67E5\u770B\u7248\u672C\u53F7\r\nconsul --version\r\n-- \u4F7F\u7528\u5F00\u53D1\u6A21\u5F0F\u542F\u52A8\r\nconsul agent -dev \r\n-- \u8BBF\u95EE\r\nhttp://localhost:8500\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u6CE8\u518C\u4E2D\u5FC3",children:"\u6CE8\u518C\u4E2D\u5FC3"}),"\n",(0,i.jsx)(e.h6,{id:"\u5BA2\u6237\u7AEF\u8D1F\u8F7D",children:"\u5BA2\u6237\u7AEF\u8D1F\u8F7D"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-discovery</artifactId>\r\n</dependency>\r\n\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\r\n<!--\u8D1F\u8F7D-->\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8308\r\nspring:\r\n application:\r\n  name: consul-ribbon-service\r\n cloud:\r\n  consul:\r\n   host: localhost\r\n   port: 8500\r\n   discovery:\r\n    service-name: ${spring.application.name}\r\nservice-url:\r\n consul-user-service: http://consul-user-service\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u914D\u7F6E\u4E2D\u5FC3",children:"\u914D\u7F6E\u4E2D\u5FC3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-consul-discovery</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# application.yaml\r\nspring:\r\n  profiles:\r\n    active: dev\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# bootstrap.yaml\r\nserver:\r\n  port: 9101\r\nspring:\r\n  application:\r\n    name: consul-config-client\r\n  cloud:\r\n    consul:\r\n      host: localhost\r\n      port: 8500\r\n      discovery:\r\n        serviceName: consul-config-client\r\n      config:\r\n        enabled: true #\u662F\u5426\u542F\u7528\u914D\u7F6E\u4E2D\u5FC3\u529F\u80FD\r\n        format: yaml #\u8BBE\u7F6E\u914D\u7F6E\u503C\u7684\u683C\u5F0F\r\n        prefix: config #\u8BBE\u7F6E\u914D\u7F6E\u6240\u5728\u76EE\u5F55\r\n        profile-separator: ':' #\u8BBE\u7F6E\u914D\u7F6E\u7684\u5206\u9694\u7B26\r\n        data-key: data #\u914D\u7F6Ekey\u7684\u540D\u5B57\uFF0C\u7531\u4E8EConsul\u662FK/V\u5B58\u50A8\uFF0C\u914D\u7F6E\u5B58\u50A8\u5728\u5BF9\u5E94K\u7684V\u4E2D\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'-- consul\u6DFB\u52A0\u914D\u7F6E\r\n-- key\r\nconfig/consul-config-client:dev/data\r\n-- value\r\nconfig:\r\n  info: "config info for dev"\n'})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-gateway",children:"cloud-gateway"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Spring Cloud Gateway \u7279\u6027\r\n\u57FA\u4E8ESpring Framework 5, Project Reactor \u548C Spring Boot 2.0 \u8FDB\u884C\u6784\u5EFA\uFF1B\r\n\u52A8\u6001\u8DEF\u7531\uFF1A\u80FD\u591F\u5339\u914D\u4EFB\u4F55\u8BF7\u6C42\u5C5E\u6027\uFF1B\r\n\u53EF\u4EE5\u5BF9\u8DEF\u7531\u6307\u5B9A Predicate\uFF08\u65AD\u8A00\uFF09\u548C Filter\uFF08\u8FC7\u6EE4\u5668\uFF09\uFF1B\r\n\u96C6\u6210Hystrix\u7684\u65AD\u8DEF\u5668\u529F\u80FD\uFF1B\r\n\u96C6\u6210 Spring Cloud \u670D\u52A1\u53D1\u73B0\u529F\u80FD\uFF1B\r\n\u6613\u4E8E\u7F16\u5199\u7684 Predicate\uFF08\u65AD\u8A00\uFF09\u548C Filter\uFF08\u8FC7\u6EE4\u5668\uFF09\uFF1B\r\n\u8BF7\u6C42\u9650\u6D41\u529F\u80FD\uFF1B\r\n\u652F\u6301\u8DEF\u5F84\u91CD\u5199;\r\n\r\nRoute\uFF08\u8DEF\u7531\uFF09\uFF1A\u8DEF\u7531\u662F\u6784\u5EFA\u7F51\u5173\u7684\u57FA\u672C\u6A21\u5757\uFF0C\u5B83\u7531ID\uFF0C\u76EE\u6807URI\uFF0C\u4E00\u7CFB\u5217\u7684\u65AD\u8A00\u548C\u8FC7\u6EE4\u5668\u7EC4\u6210\uFF0C\u5982\u679C\u65AD\u8A00\u4E3Atrue\u5219\u5339\u914D\u8BE5\u8DEF\u7531\uFF1B\r\nPredicate\uFF08\u65AD\u8A00\uFF09\uFF1A\u6307\u7684\u662FJava 8 \u7684 Function Predicate\u3002 \u8F93\u5165\u7C7B\u578B\u662FSpring\u6846\u67B6\u4E2D\u7684ServerWebExchange\u3002 \u8FD9\u4F7F\u5F00\u53D1\u4EBA\u5458\u53EF\u4EE5\u5339\u914DHTTP\u8BF7\u6C42\u4E2D\u7684\u6240\u6709\u5185\u5BB9\uFF0C\u4F8B\u5982\u8BF7\u6C42\u5934\u6216\u8BF7\u6C42\u53C2\u6570\u3002\u5982\u679C\u8BF7\u6C42\u4E0E\u65AD\u8A00\u76F8\u5339\u914D\uFF0C\u5219\u8FDB\u884C\u8DEF\u7531\uFF1B\r\nFilter\uFF08\u8FC7\u6EE4\u5668\uFF09\uFF1A\u6307\u7684\u662FSpring\u6846\u67B6\u4E2DGatewayFilter\u7684\u5B9E\u4F8B\uFF0C\u4F7F\u7528\u8FC7\u6EE4\u5668\uFF0C\u53EF\u4EE5\u5728\u8BF7\u6C42\u88AB\u8DEF\u7531\u524D\u540E\u5BF9\u8BF7\u6C42\u8FDB\u884C\u4FEE\u6539\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-gateway</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# yaml\u914D\u7F6E\r\nserver:\r\n  port: 9201\r\nservice-url:\r\n  user-service: http://localhost:8201\r\nspring:\r\n  cloud:\r\n    gateway:\r\n      routes:\r\n        - id: path_route #\u8DEF\u7531\u7684ID\r\n          uri: ${service-url.user-service}/user/{id} #\u5339\u914D\u540E\u8DEF\u7531\u5730\u5740\r\n          predicates: # \u65AD\u8A00\uFF0C\u8DEF\u5F84\u76F8\u5339\u914D\u7684\u8FDB\u884C\u8DEF\u7531\r\n            - Path=/user/{id}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * Java Bean \u914D\u7F6E\r\n */\r\n@Configuration\r\npublic class GatewayConfig {\r\n\r\n    @Bean\r\n    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {\r\n        return builder.routes()\r\n                .route("path_route2", r -> r.path("/user/getByUsername")\r\n                        .uri("http://localhost:8201/user/getByUsername"))\r\n                .build();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u8FC7\u6EE4\u5668-1",children:"\u8FC7\u6EE4\u5668"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5728\u4E00\u4E2A\u9AD8\u7684\u89D2\u5EA6\u6765\u770B\uFF0CGlobal filters\u4F1A\u88AB\u5E94\u7528\u5230\u6240\u6709\u7684\u8DEF\u7531\u4E0A\uFF0C\u800CGateway filter\u5C06\u5E94\u7528\u5230\u5355\u4E2A\u8DEF\u7531\u4E0A\u6216\u8005\u4E00\u4E2A\u5206\u7EC4\u7684\u8DEF\u7531\u4E0A\r\n\r\n-- \u5F53\u8BF7\u6C42\u8FDB\u5165\uFF08\u5E76\u4E0E\u8DEF\u7531\u5339\u914D\uFF09\u65F6\uFF0C\u7B5B\u9009Web Handler\u4F1A\u5C06GlobalFilter\u7684\u6240\u6709\u5B9E\u4F8B\u548C\u6240\u6709\u7684GatewayFilter\u8DEF\u7531\u7279\u5B9A\u5B9E\u4F8B\u6DFB\u52A0\u5230 filter chain\u3002filter\u7EC4\u5408\u7684\u6392\u5E8F\u7531org.springframework.core.Ordered\u63A5\u53E3\u51B3\u5B9A\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5B9E\u73B0getOrde()\u65B9\u6CD5\u6216\u4F7F\u7528@Order\u6CE8\u91CA\u6765\u8BBE\u7F6E\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Bean\r\n@Order(-1)\r\npublic GlobalFilter a() {\r\n    return (exchange, chain) -> {\r\n        log.info("first pre filter");\r\n        return chain.filter(exchange).then(Mono.fromRunnable(() -> {\r\n            log.info("third post filter");\r\n        }));\r\n    };\r\n}\r\n\r\n@Component\r\npublic class MyGlobalFilter implements GlobalFilter, Ordered {\r\n\r\n    @Override\r\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\r\n        return chain.filter(exchange).then(Mono.fromRunnable(() -> {\r\n            log.info("third post filter");\r\n        }));\r\n    }\r\n\r\n    @Override\r\n    public int getOrder() {\r\n        return 0;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u76D1\u63A7\u8BF7\u6C42",children:"\u76D1\u63A7\u8BF7\u6C42"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-actuator</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"management:\r\n endpoint:\r\n  gateway:\r\n   enabled: true\r\n endpoints:\r\n  web:\r\n   exposure:\r\n    include: gateway\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# /actuator/gateway/globalfilters \u68C0\u7D22\u6240\u6709global filter\r\n# /actuator/gateway/routefilters \u68C0\u7D22\u6240\u6709GatewayFilter factories\r\n# /actuator/gateway/refresh \u6E05\u7406\u8DEF\u7531\u7F13\u5B58\r\n# /actuator/gateway/routes \u68C0\u7D22\u7F51\u5173\u4E2D\u5B9A\u4E49\u7684\u8DEF\u7531\r\n# /actuator/gateway/routes/{id} \u83B7\u53D6\u5355\u4E2A\u8DEF\u7531\u7684\u4FE1\u606F\r\n# /gateway/routes/{id_route_to_create} \u521B\u5EFA\u4E00\u4E2A\u8DEF\u7531\r\n# /gateway/routes/{id_route_to_delete} \u5220\u9664\u4E00\u4E2A\u8DEF\u7531\n"})}),"\n","\n",(0,i.jsx)("img",{src:s,alt:"SpringCloud-gateway\u76D1\u63A7\u8BF7\u6C42",width:"50%"}),"\n",(0,i.jsx)(e.h5,{id:"\u5DE5\u4F5C\u539F\u7406",children:"\u5DE5\u4F5C\u539F\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"\u5BA2\u6237\u7AEF\u5411Spring Cloud Gateway\u53D1\u51FA\u8BF7\u6C42\u3002\r\n\u5982\u679CGateway Handler Mapping\u786E\u5B9A\u8BF7\u6C42\u4E0E\u8DEF\u7531\u5339\u914D\uFF0C\u5219\u5C06\u5176\u53D1\u9001\u5230Gateway Web Handler\u3002\r\n\u6B64handler\u901A\u8FC7\u7279\u5B9A\u4E8E\u8BE5\u8BF7\u6C42\u7684\u8FC7\u6EE4\u5668\u94FE\u5904\u7406\u8BF7\u6C42\u3002\r\n\u56FE\u4E2Dfilters\u88AB\u865A\u7EBF\u5212\u5206\u7684\u539F\u56E0\u662Ffilters\u53EF\u4EE5\u5728\u53D1\u9001\u4EE3\u7406\u8BF7\u6C42\u4E4B\u524D\u6216\u4E4B\u540E\u6267\u884C\u903B\u8F91\u3002\r\n\u5148\u6267\u884C\u6240\u6709\u201Cpre filter\u201D\u903B\u8F91\uFF0C\u7136\u540E\u8FDB\u884C\u8BF7\u6C42\u4EE3\u7406\u3002\r\n\u5728\u8BF7\u6C42\u4EE3\u7406\u6267\u884C\u5B8C\u540E\uFF0C\u6267\u884C\u201Cpost filter\u201D\u903B\u8F91\n"})}),"\n","\n",(0,i.jsx)("img",{src:l,alt:"SpringCloud-gateway\u5DE5\u4F5C\u539F\u7406",width:"50%"}),"\n",(0,i.jsx)(e.h4,{id:"cloud-nacos",children:"cloud-nacos"}),"\n",(0,i.jsx)(e.h5,{id:"\u6CE8\u518C\u4E2D\u5FC3-1",children:"\u6CE8\u518C\u4E2D\u5FC3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<!-- \r\n	\u5982\u679C\u8981\u4F7F\u7528Spring Cloud Alibaba \u7684\u7EC4\u4EF6\u90FD\u9700\u8981\u5728pom.xml\u4E2D\u6DFB\u52A0\u5982\u4E0B\u7684\u914D\u7F6E \r\n	nacos\u9700\u8981web\u4F9D\u8D56\r\n-->\r\n<dependencyManagement>\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>com.alibaba.cloud</groupId>\r\n            <artifactId>spring-cloud-alibaba-dependencies</artifactId>\r\n            <version>2.1.0.RELEASE</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n    </dependencies>\r\n</dependencyManagement>\r\n\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n    <version>2.1.7.RELEASE</version>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 8206\r\nspring:\r\n  application:\r\n    name: nacos-user-service\r\n  cloud:\r\n    nacos:\r\n      discovery:\r\n        server-addr: localhost:8848 #\u914D\u7F6ENacos\u5730\u5740\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: '*'\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u914D\u7F6E\u4E2D\u5FC3-1",children:"\u914D\u7F6E\u4E2D\u5FC3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# application.yaml\r\nspring:\r\n  profiles:\r\n    active: dev\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# bootstrap.yaml\r\nserver:\r\n  port: 9101\r\nspring:\r\n  application:\r\n    name: nacos-config-client\r\n  cloud:\r\n    nacos:\r\n      discovery:\r\n        server-addr: localhost:8848 #Nacos\u5730\u5740\r\n      config:\r\n        server-addr: localhost:8848 #Nacos\u5730\u5740\r\n        file-extension: yaml #\u8FD9\u91CC\u6211\u4EEC\u83B7\u53D6\u7684yaml\u683C\u5F0F\u7684\u914D\u7F6E\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u914D\u7F6E\u6587\u4EF6\u52A0\u8F7D\u987A\u5E8F",children:"\u914D\u7F6E\u6587\u4EF6\u52A0\u8F7D\u987A\u5E8F"}),"\n",(0,i.jsx)(e.p,{children:"\u4F18\u5148\u7EA7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4F18\u5148\u7EA7\r\na < b1 < b2 < c1 < c2 < d1 < d2 < e < f\r\n-- \u5404\u7EA7\u522B\u63CF\u8FF0\r\na\uFF1Aapplication.properties\r\nb1\uFF1Abootstrap.properties\r\nb2\uFF1Abootstrap-{profile}.properties \r\nc1\uFF1A\u901A\u8FC7 spring.cloud.nacos.config.shared-configs[1].data-id \u652F\u6301\u591A\u4E2A\u5171\u4EAB Data Id \u7684\u914D\u7F6E\r\nc2\uFF1A\u901A\u8FC7 spring.cloud.nacos.config.shared-configs[n].data-id \u652F\u6301\u591A\u4E2A\u5171\u4EAB Data Id \u7684\u914D\u7F6E\r\nd1\uFF1A\u901A\u8FC7 spring.cloud.nacos.config.extension-configs[0].data-id \u652F\u6301\u591A\u4E2A\u6269\u5C55 Data Id \u7684\u914D\u7F6E\r\nd2\uFF1A\u901A\u8FC7 spring.cloud.nacos.config.extension-configs[n].data-id \u652F\u6301\u591A\u4E2A\u6269\u5C55 Data Id \u7684\u914D\u7F6E\r\ne\uFF1A\u901A\u8FC7\u5185\u90E8\u76F8\u5173\u89C4\u5219(\u5E94\u7528\u540D\u3001\u5E94\u7528\u540D+ Profile )\u81EA\u52A8\u751F\u6210\u76F8\u5173\u7684 Data Id \u914D\u7F6E ,\u5982 scrm-base-service.properties\r\nf\uFF1AVM option\n"})}),"\n",(0,i.jsx)(e.p,{children:"nacos\u4E09\u7EA7\u914D\u7F6E\u4F18\u5148\u7EA7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- nacos\u4E09\u7EA7\u914D\u7F6E\u4F18\u5148\u7EA7\r\n\u4E09\u7EA7\u914D\u7F6E\u7684\u4F18\u5148\u7EA7\u5982\u4E0B\uFF1A\u4E3B\u914D\u7F6E > \u6269\u5C55\u914D\u7F6E > \u5171\u4EAB\u914D\u7F6E\r\n-- \u4E09\u7EA7\u914D\u7F6E\u63CF\u8FF0\r\n-- \u4E3B\u914D\u7F6E\uFF08\u9ED8\u8BA4${spring.application.name}.properties\uFF09\uFF08\u4E0D\u4F1A\u88AB\u540C\u540D\u5C5E\u6027\u8986\u76D6\uFF09\r\n${prefix}-${spring.profiles.active}.${file-extension}\r\n\u9996\u5148\u4F1A\u53BB\u6307\u5B9Anamespace\u548Cgroup\u4E0B\u52A0\u8F7D\u6307\u5B9AdataId(\u5E26\u540E\u7F00)\uFF0C\u5982\u679C\u52A0\u8F7D\u4E0D\u5230\uFF0C\u4F1A\u7EE7\u7EED\u52A0\u8F7DdataId(\u4E0D\u5E26\u540E\u7F00)\r\n-- \u5171\u4EAB\u914D\u7F6E\u548C\u6269\u5C55\u914D\u7F6E\u533A\u522B\r\nnacos\u5BF9\u914D\u7F6E\u7684\u9ED8\u8BA4\u7406\u5FF5(namespace\u533A\u5206\u73AF\u5883\uFF0Cgroup\u533A\u5206\u4E0D\u540C\u5E94\u7528)\r\n1.\u4E3B\u914D\u7F6E\u662F\u5E94\u7528\u4E13\u6709\u7684\u914D\u7F6E(\u56E0\u6B64\uFF0C\u4E3B\u914D\u7F6E\u5E94\u5F53\u5728dataId\u4E0A\u8981\u533A\u5206\uFF0C\u540C\u65F6\u6700\u597D\u8FD8\u8981\u6709 group \u7684\u533A\u5206)\r\n2.\u8981\u5728\u5404\u5E94\u7528\u4E4B\u95F4\u5171\u4EAB\u4E00\u4E2A\u914D\u7F6E\uFF0C\u8BF7\u4F7F\u7528\u4E0A\u9762\u7684 shared-configs\r\n3.\u5982\u679C\u8981\u5728\u7279\u5B9A\u8303\u56F4\u5185\uFF08\u6BD4\u5982\u67D0\u4E2A\u5E94\u7528\u4E0A\uFF09\u8986\u76D6\u67D0\u4E2A\u5171\u4EABdataId\u4E0A\u7684\u7279\u5B9A\u5C5E\u6027\uFF0C\u8BF7\u4F7F\u7528 extension-configs\n"})}),"\n",(0,i.jsx)(e.p,{children:"bootstrap\u548Capplication"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8BE6\u7EC6\u63CF\u8FF0(bootstrap\u548Capplication)\r\nbootstrap.yml\u7528\u4E8EApplicationContext\u5F15\u5BFC\u9636\u6BB5\u3002\u7531\u7236Spring ApplicationContext\u52A0\u8F7D\u3002\u5B9A\u4E49\u7CFB\u7EDF\u7EA7\u522B\u7684\u53C2\u6570\u914D\u7F6E\uFF0C\u8FD9\u4E9B\u53C2\u6570\u4E00\u822C\u4E0D\u4F1A\u53D8\u52A8\u3002\r\napplication.yml \u7528\u6765\u5B9A\u4E49\u5E94\u7528\u7EA7\u522B\u7684\u53C2\u6570\u914D\u7F6E\u3002\u642D\u914D spring-cloud-config \u4F7F\u7528\u65F6application.yml\u5B9A\u4E49\u7684\u53C2\u6570\u53EF\u4EE5\u5B9E\u73B0\u52A8\u6001\u66FF\u6362\u3002\r\napplication.yml \u4F1A\u8986\u76D6 bootstrap.yml \u7684\u53C2\u6570\u914D\u7F6E\u3002\r\n-- applicaiton\u52A0\u8F7D\uFF08\u9ED8\u8BA4\u4F1A\u4ECE4\u4E2A\u8DEF\u5F84\u53BB\u627Eapplication\u914D\u7F6E\uFF09\r\n\u5047\u8BBE\u5F53\u524D\u8FD0\u884C\u76EE\u5F55\u4E3A/\uFF1A /config > / > classpath:/config > classpath:/\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u81EA\u5DF1\u6D4B\u8BD5\u4F18\u5148\u7EA7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"1. nacos\u914D\u7F6E\u4E2D\u5FC3\u4E3B\u914D\u7F6E \u8986\u76D6 springboot\u52A0\u8F7D\u7684application.yaml\r\n2. application.yml \u8986\u76D6 bootstrap.yml \u7684\u53C2\u6570\u914D\u7F6E\u3002\n"})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-sentinel",children:"cloud-sentinel"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Sentinel\u7279\u6027\r\n\u7194\u65AD\u964D\u7EA7\r\n\r\n-- \u4E0B\u8F7D\u5730\u5740\r\nhttps://github.com/alibaba/Sentinel/releases\r\n\r\n-- \u542F\u52A8jar\uFF0C\u9ED8\u8BA48080\r\njava -jar sentinel-dashboard-1.6.3.jar\r\njava -Dserver.port=9999 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.6.jar\r\n\r\n-- \u8BBF\u95EE\uFF0C\u8D26\u53F7\u5BC6\u7801sentinel\r\nhttp://localhost:9000\r\n\r\n-- Sentinel\u91C7\u7528\u7684\u61D2\u52A0\u8F7D\u89C4\u5219\uFF0C\u9700\u8981\u6211\u4EEC\u5148\u8BBF\u95EE\u4E0B\u63A5\u53E3\uFF0CSentinel\u63A7\u5236\u53F0\u4E2D\u624D\u4F1A\u6709\u5BF9\u5E94\u670D\u52A1\u4FE1\u606F\r\n\u53D6\u6D88\u61D2\u52A0\u8F7D \uFF1Asentinel.eager: true\r\n\r\n-- nacos\u5B58\u50A8\u53C2\u6570\u89E3\u91CA\r\nresource\uFF1A\u8D44\u6E90\u540D\u79F0\uFF1B\r\nlimitApp\uFF1A\u6765\u6E90\u5E94\u7528\uFF1B\r\ngrade\uFF1A\u9608\u503C\u7C7B\u578B\uFF0C0\u8868\u793A\u7EBF\u7A0B\u6570\uFF0C1\u8868\u793AQPS\uFF1B\r\ncount\uFF1A\u5355\u673A\u9608\u503C\uFF1B\r\nstrategy\uFF1A\u6D41\u63A7\u6A21\u5F0F\uFF0C0\u8868\u793A\u76F4\u63A5\uFF0C1\u8868\u793A\u5173\u8054\uFF0C2\u8868\u793A\u94FE\u8DEF\uFF1B\r\ncontrolBehavior\uFF1A\u6D41\u63A7\u6548\u679C\uFF0C0\u8868\u793A\u5FEB\u901F\u5931\u8D25\uFF0C1\u8868\u793AWarm Up\uFF0C2\u8868\u793A\u6392\u961F\u7B49\u5F85\uFF1B\r\nclusterMode\uFF1A\u662F\u5426\u96C6\u7FA4;\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<!--sentinel \u9650\u6D41\u7194\u70B9\u964D\u7EA7-->\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-alibaba-sentinel-gateway</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.alibaba.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\r\n</dependency>\r\n<!-- sentinel\u96C6\u6210nacos\u4F5C\u4E3A\u6570\u636E\u6E90 -->\r\n<dependency>\r\n    <groupId>com.alibaba.csp</groupId>\r\n    <artifactId>sentinel-datasource-nacos</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n cloud:\r\n #Sentinel\u914D\u7F6E\r\n  sentinel:\r\n   transport:\r\n    dashboard: localhost:9000\r\n   # \u652F\u6301\u94FE\u8DEF\u9650\u6D41\r\n   web-context-unify: false\r\n   # Sentinel \u7F51\u5173\u6D41\u63A7\u9ED8\u8BA4\u7684\u7C92\u5EA6\u662F route \u7EF4\u5EA6\u4EE5\u53CA\u81EA\u5B9A\u4E49 API \u5206\u7EC4\u7EF4\u5EA6\uFF0C\u9ED8\u8BA4\u4E0D\u652F\u6301 URL \u7C92\u5EA6\r\n   filter:\r\n    enabled: false\r\n   # Sentinel\u63A7\u5236\u53F0\u61D2\u52A0\u8F7D-\u5F00\u542F\u9965\u997F\r\n   eager: true\r\n   datasource:\r\n    #\u6D41\u63A7\u89C4\u5219\r\n    flow: # \u6307\u5B9A\u6570\u636E\u6E90\u540D\u79F0\r\n     # \u6307\u5B9Anacos\u6570\u636E\u6E90\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      # \u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\r\n      dataId: ${spring.application.name}-flow-rules\r\n      # \u6307\u5B9A\u5206\u7EC4\r\n      groupId: SENTINEL_GROUP\r\n      # \u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u89C4\u5219\u7C7B\u578B\r\n      rule-type: flow\r\n      # \u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u6570\u636E\u683C\u5F0F\r\n      data-type: json\r\n    #\u964D\u7EA7\u89C4\u5219\r\n    degrade:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-degrade-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: degrade\r\n      data-type: json\r\n    #\u7CFB\u7EDF\u89C4\u5219\r\n    system:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-system-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: system\r\n      data-type: json\r\n    #\u6388\u6743\u89C4\u5219\r\n    authority:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-authority-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: authority\r\n      data-type: json\r\n    #\u70ED\u70B9\u53C2\u6570\r\n    param-flow:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-param-flow-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: param-flow\r\n      data-type: json\r\n    #\u7F51\u5173\u6D41\u63A7\u89C4\u5219\r\n    gw-flow:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-flow-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: gw-flow\r\n      data-type: json\r\n    #API\u6D41\u63A7\u89C4\u5219\r\n    gw-api-group:\r\n     nacos:\r\n      server-addr: ${hmh.nacos.server-addr}\r\n      dataId: ${spring.application.name}-api-rules\r\n      groupId: SENTINEL_GROUP\r\n      rule-type: gw-api-group\r\n      data-type: json\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u9650\u6D41",children:"\u9650\u6D41"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- Sentinel Starter \u9ED8\u8BA4\u4E3A\u6240\u6709\u7684 HTTP \u670D\u52A1\u63D0\u4F9B\u4E86\u9650\u6D41\u57CB\u70B9\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528@SentinelResource\u6765\u81EA\u5B9A\u4E49\u4E00\u4E9B\u9650\u6D41\u884C\u4E3A\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u9650\u6D41\u529F\u80FD\r\n * \u7528\u4E8E\u6D4B\u8BD5\u7194\u65AD\u548C\u9650\u6D41\u529F\u80FD.\r\n */\r\n@RestController\r\n@RequestMapping("/rateLimit")\r\npublic class RateLimitController {\r\n\r\n    /**\r\n     * \u6309\u8D44\u6E90\u540D\u79F0\u9650\u6D41\uFF0C\u9700\u8981\u6307\u5B9A\u9650\u6D41\u5904\u7406\u903B\u8F91\r\n     */\r\n    @GetMapping("/byResource")\r\n    @SentinelResource(value = "byResource",blockHandler = "handleException")\r\n    public CommonResult byResource() {\r\n        return new CommonResult("\u6309\u8D44\u6E90\u540D\u79F0\u9650\u6D41", 200);\r\n    }\r\n\r\n    /**\r\n     * \u6309URL\u9650\u6D41\uFF0C\u6709\u9ED8\u8BA4\u7684\u9650\u6D41\u5904\u7406\u903B\u8F91\r\n     */\r\n    @GetMapping("/byUrl")\r\n    @SentinelResource(value = "byUrl",blockHandler = "handleException")\r\n    public CommonResult byUrl() {\r\n        return new CommonResult("\u6309url\u9650\u6D41", 200);\r\n    }\r\n\r\n    public CommonResult handleException(BlockException exception){\r\n        return new CommonResult(exception.getClass().getCanonicalName(),200);\r\n    }\r\n\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u6839\u636E\u8D44\u6E90\u540D\u79F0\u9650\u6D41",children:"\u6839\u636E\u8D44\u6E90\u540D\u79F0\u9650\u6D41"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'-- \u5728Sentinel\u63A7\u5236\u53F0\u914D\u7F6E\u6D41\u63A7\u89C4\u5219\uFF0C\u6839\u636E@SentinelResource\u6CE8\u89E3\u7684value\u503C\uFF0C\u5982\uFF1A\r\n[\r\n    {\r\n        "resource": "byResource",\r\n        "limitApp": "default",\r\n        "grade": 1,\r\n        "count": 1,\r\n        "strategy": 0,\r\n        "controlBehavior": 0,\r\n        "clusterMode": false\r\n    }\r\n]\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u6839\u636Eurl\u9650\u6D41",children:"\u6839\u636EURL\u9650\u6D41"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'-- \u5728Sentinel\u63A7\u5236\u53F0\u914D\u7F6E\u6D41\u63A7\u89C4\u5219\uFF0C\u4F7F\u7528\u8BBF\u95EE\u7684URL\uFF0C\u5982\uFF1A\r\n[\r\n    {\r\n        "resource": "/rateLimit/byUrl",\r\n        "limitApp": "default",\r\n        "grade": 1,\r\n        "count": 1,\r\n        "strategy": 0,\r\n        "controlBehavior": 0,\r\n        "clusterMode": false\r\n    }\r\n]\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u7194\u65AD\u529F\u80FD",children:"\u7194\u65AD\u529F\u80FD"}),"\n",(0,i.jsx)(e.h6,{id:"resttemplate\u8C03\u7528\u65B9\u5F0F",children:"RestTemplate\u8C03\u7528\u65B9\u5F0F"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\r\n * Created by macro on 2019/8/29.\r\n */\r\n@Configuration\r\npublic class RibbonConfig {\r\n\r\n    @Bean\r\n    @SentinelRestTemplate\r\n    public RestTemplate restTemplate(){\r\n        return new RestTemplate();\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7194\u65AD\u529F\u80FD\r\n * Created by macro on 2019/11/7.\r\n */\r\n@RestController\r\n@RequestMapping("/breaker")\r\npublic class CircleBreakerController {\r\n\r\n    private Logger LOGGER = LoggerFactory.getLogger(CircleBreakerController.class);\r\n    @Autowired\r\n    private RestTemplate restTemplate;\r\n    @Value("${service-url.user-service}")\r\n    private String userServiceUrl;\r\n\r\n    @RequestMapping("/fallback/{id}")\r\n    @SentinelResource(value = "fallback",fallback = "handleFallback")\r\n    public CommonResult fallback(@PathVariable Long id) {\r\n        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n    }\r\n\r\n    //\u5FFD\u7565\u7A7A\u6307\u9488\u5F02\u5E38\r\n    @RequestMapping("/fallbackException/{id}")\r\n    @SentinelResource(value = "fallbackException",fallback = "handleFallback2", exceptionsToIgnore = {NullPointerException.class})\r\n    public CommonResult fallbackException(@PathVariable Long id) {\r\n        if (id == 1) {\r\n            throw new IndexOutOfBoundsException();\r\n        } else if (id == 2) {\r\n            throw new NullPointerException();\r\n        }\r\n        return restTemplate.getForObject(userServiceUrl + "/user/{1}", CommonResult.class, id);\r\n    }\r\n\r\n    public CommonResult handleFallback(Long id) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670D\u52A1\u964D\u7EA7\u8FD4\u56DE",200);\r\n    }\r\n\r\n    public CommonResult handleFallback2(@PathVariable Long id, Throwable e) {\r\n        LOGGER.error("handleFallback2 id:{},throwable class:{}", id, e.getClass());\r\n        User defaultUser = new User(-2L, "defaultUser2", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670D\u52A1\u964D\u7EA7\u8FD4\u56DE",200);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"feign\u8C03\u7528\u65B9\u5F0F",children:"feign\u8C03\u7528\u65B9\u5F0F"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<!-- \u5728\u542F\u52A8\u7C7B\u52A0Enable\u6CE8\u89E3-->\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"feign:\r\n  sentinel:\r\n    enabled: true #\u6253\u5F00sentinel\u5BF9feign\u7684\u652F\u6301\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * feign\u63A5\u53E3\r\n */\r\n@FeignClient(value = "nacos-user-service",fallback = UserFallbackService.class)\r\npublic interface UserService {\r\n    @PostMapping("/user/create")\r\n    CommonResult create(@RequestBody User user);\r\n\r\n    @GetMapping("/user/{id}")\r\n    CommonResult<User> getUser(@PathVariable Long id);\r\n\r\n    @GetMapping("/user/getByUsername")\r\n    CommonResult<User> getByUsername(@RequestParam String username);\r\n\r\n    @PostMapping("/user/update")\r\n    CommonResult update(@RequestBody User user);\r\n\r\n    @PostMapping("/user/delete/{id}")\r\n    CommonResult delete(@PathVariable Long id);\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u964D\u7EA7\u64CD\u4F5C\r\n */\r\n@Component\r\npublic class UserFallbackService implements UserService {\r\n    @Override\r\n    public CommonResult create(User user) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670D\u52A1\u964D\u7EA7\u8FD4\u56DE",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult<User> getUser(Long id) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670D\u52A1\u964D\u7EA7\u8FD4\u56DE",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult<User> getByUsername(String username) {\r\n        User defaultUser = new User(-1L, "defaultUser", "123456");\r\n        return new CommonResult<>(defaultUser,"\u670D\u52A1\u964D\u7EA7\u8FD4\u56DE",200);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult update(User user) {\r\n        return new CommonResult("\u8C03\u7528\u5931\u8D25\uFF0C\u670D\u52A1\u88AB\u964D\u7EA7",500);\r\n    }\r\n\r\n    @Override\r\n    public CommonResult delete(Long id) {\r\n        return new CommonResult("\u8C03\u7528\u5931\u8D25\uFF0C\u670D\u52A1\u88AB\u964D\u7EA7",500);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-seata",children:"cloud-seata"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7531\u4E8E\u5168\u5C40\u6570\u636E\u4E00\u81F4\u6027\u6CA1\u6CD5\u4FDD\u8BC1\u4EA7\u751F\u7684\u95EE\u9898\u5C31\u662F\u5206\u5E03\u5F0F\u4E8B\u52A1\u95EE\u9898\u3002\u7B80\u5355\u6765\u8BF4\uFF0C\u4E00\u6B21\u4E1A\u52A1\u64CD\u4F5C\u9700\u8981\u64CD\u4F5C\u591A\u4E2A\u6570\u636E\u6E90\u6216\u9700\u8981\u8FDB\u884C\u8FDC\u7A0B\u8C03\u7528\uFF0C\u5C31\u4F1A\u4EA7\u751F\u5206\u5E03\u5F0F\u4E8B\u52A1\u95EE\u9898\r\n\r\n-- Seata \u662F\u4E00\u6B3E\u5F00\u6E90\u7684\u5206\u5E03\u5F0F\u4E8B\u52A1\u89E3\u51B3\u65B9\u6848\uFF0C\u81F4\u529B\u4E8E\u63D0\u4F9B\u9AD8\u6027\u80FD\u548C\u7B80\u5355\u6613\u7528\u7684\u5206\u5E03\u5F0F\u4E8B\u52A1\u670D\u52A1\u3002Seata \u5C06\u4E3A\u7528\u6237\u63D0\u4F9B\u4E86 AT\u3001TCC\u3001SAGA \u548C XA \u4E8B\u52A1\u6A21\u5F0F\uFF0C\u4E3A\u7528\u6237\u6253\u9020\u4E00\u7AD9\u5F0F\u7684\u5206\u5E03\u5F0F\u89E3\u51B3\u65B9\u6848\r\n\r\n-- \u4E09\u4E2A\u7EC4\u4EF6\r\nTransaction Coordinator (TC)\uFF1A \u4E8B\u52A1\u534F\u8C03\u5668\uFF0C\u7EF4\u62A4\u5168\u5C40\u4E8B\u52A1\u7684\u8FD0\u884C\u72B6\u6001\uFF0C\u8D1F\u8D23\u534F\u8C03\u5E76\u9A71\u52A8\u5168\u5C40\u4E8B\u52A1\u7684\u63D0\u4EA4\u6216\u56DE\u6EDA\uFF1B\r\nTransaction Manager (TM)\uFF1A \u63A7\u5236\u5168\u5C40\u4E8B\u52A1\u7684\u8FB9\u754C\uFF0C\u8D1F\u8D23\u5F00\u542F\u4E00\u4E2A\u5168\u5C40\u4E8B\u52A1\uFF0C\u5E76\u6700\u7EC8\u53D1\u8D77\u5168\u5C40\u63D0\u4EA4\u6216\u5168\u5C40\u56DE\u6EDA\u7684\u51B3\u8BAE\uFF1B\r\nResource Manager (RM)\uFF1A \u63A7\u5236\u5206\u652F\u4E8B\u52A1\uFF0C\u8D1F\u8D23\u5206\u652F\u6CE8\u518C\u3001\u72B6\u6001\u6C47\u62A5\uFF0C\u5E76\u63A5\u6536\u4E8B\u52A1\u534F\u8C03\u5668\u7684\u6307\u4EE4\uFF0C\u9A71\u52A8\u5206\u652F\uFF08\u672C\u5730\uFF09\u4E8B\u52A1\u7684\u63D0\u4EA4\u548C\u56DE\u6EDA\r\n\r\n-- \u7B80\u5355\u8FC7\u7A0B\r\n1\u3001TM \u5411 TC \u7533\u8BF7\u5F00\u542F\u4E00\u4E2A\u5168\u5C40\u4E8B\u52A1\uFF0C\u5168\u5C40\u4E8B\u52A1\u521B\u5EFA\u6210\u529F\u5E76\u751F\u6210\u4E00\u4E2A\u5168\u5C40\u552F\u4E00\u7684 XID\uFF1B\r\n2\u3001XID \u5728\u5FAE\u670D\u52A1\u8C03\u7528\u94FE\u8DEF\u7684\u4E0A\u4E0B\u6587\u4E2D\u4F20\u64AD\uFF1B\r\n3\u3001RM \u5411 TC \u6CE8\u518C\u5206\u652F\u4E8B\u52A1\uFF0C\u5C06\u5176\u7EB3\u5165 XID \u5BF9\u5E94\u5168\u5C40\u4E8B\u52A1\u7684\u7BA1\u8F96\uFF1B\r\n4\u3001TM \u5411 TC \u53D1\u8D77\u9488\u5BF9 XID \u7684\u5168\u5C40\u63D0\u4EA4\u6216\u56DE\u6EDA\u51B3\u8BAE\uFF1B\r\n5\u3001TC \u8C03\u5EA6 XID \u4E0B\u7BA1\u8F96\u7684\u5168\u90E8\u5206\u652F\u4E8B\u52A1\u5B8C\u6210\u63D0\u4EA4\u6216\u56DE\u6EDA\u8BF7\u6C42\u3002\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u642D\u5EFAseata\u670D\u52A1\u7AEF",children:"\u642D\u5EFAseata\u670D\u52A1\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4E0B\u8F7D\u5730\u5740\r\nhttps://github.com/seata/seata/releases\r\n\r\n-- \u4F7F\u7528nacos\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'## file.config\r\n## transaction log store, only used in seata-server\r\nstore {\r\n  ## store mode: file\u3001db\u3001redis\r\n  mode = "db"\r\n  ## rsa decryption public key\r\n  publicKey = ""\r\n  ## database store property\r\n  db {\r\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.\r\n    datasource = "dbcp"\r\n    ## mysql/oracle/postgresql/h2/oceanbase etc.\r\n    dbType = "mysql"\r\n    driverClassName = "com.mysql.jdbc.Driver"\r\n    ## if using mysql to store the data, recommend add rewriteBatchedStatements=true in jdbc connection param\r\n    url = "jdbc:mysql://127.0.0.1:3306/seata-server?rewriteBatchedStatements=true"\r\n    user = "root"\r\n    password = "root"\r\n    minConn = 5\r\n    maxConn = 100\r\n    globalTable = "global_table"\r\n    branchTable = "branch_table"\r\n    lockTable = "lock_table"\r\n    queryLimit = 100\r\n    maxWait = 5000\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'# registry.conf\r\nregistry {\r\n  # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\r\n  type = "nacos"\r\n  nacos {\r\n    application = "seata-server"\r\n    serverAddr = "127.0.0.1:8848"\r\n    group = "DEFAULT_GROUP"\r\n    namespace = ""\r\n    cluster = "default"\r\n    username = "nacos"\r\n    password = "nacos"\r\n  }\r\n}\r\nconfig {\r\n  # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\r\n  type = "file"\r\n  file {\r\n    name = "file.conf"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(e.h5,{id:"\u5BA2\u6237\u7AEF-3",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<properties>\r\n    <java.version>1.8</java.version>\r\n    <spring-cloud-alibaba.version>2.2.7.RELEASE</spring-cloud-alibaba.version>\r\n    <springboot.version>2.2.12.RELEASE</springboot.version>\r\n    <lombok.version>1.18.8</lombok.version>\r\n    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n    <sikpTests>true</sikpTests>\r\n    <maven-source-plugin.version>3.0.1</maven-source-plugin.version>\r\n    <maven-surefire-plugin.version>2.22.1</maven-surefire-plugin.version>\r\n    <seata.version>1.4.2</seata.version>\r\n    <mybatis-plus-boot-starter.version>3.3.0</mybatis-plus-boot-starter.version>\r\n</properties>\r\n<dependencies>\r\n    <!--nacos-->\r\n    <dependency>\r\n        <groupId>com.alibaba.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\r\n    </dependency>\r\n    <!--seata-->\r\n    <dependency>\r\n        <groupId>com.alibaba.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\r\n        <version>${spring-cloud-alibaba.version}</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>io.seata</groupId>\r\n        <artifactId>seata-spring-boot-starter</artifactId>\r\n        <version>1.4.2</version>\r\n    </dependency>\r\n    <!-- mybatis -->\r\n    <dependency>\r\n        <groupId>com.baomidou</groupId>\r\n        <artifactId>mybatis-plus-boot-starter</artifactId>\r\n        <version>${mybatis-plus-boot-starter.version}</version>\r\n    </dependency>\r\n    <dependency>\r\n        <groupId>mysql</groupId>\r\n        <artifactId>mysql-connector-java</artifactId>\r\n    </dependency>\r\n    <!--feign-->\r\n    <dependency>\r\n        <groupId>org.springframework.cloud</groupId>\r\n        <artifactId>spring-cloud-starter-openfeign</artifactId>\r\n        <version>2.2.6.RELEASE</version>\r\n    </dependency>\r\n</dependencies>\r\n<dependencyManagement>\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-dependencies</artifactId>\r\n            <version>${springboot.version}</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n        <!--Spring Cloud Alibaba-->\r\n        <dependency>\r\n            <groupId>com.alibaba.cloud</groupId>\r\n            <artifactId>spring-cloud-alibaba-dependencies</artifactId>\r\n            <version>${spring-cloud-alibaba.version}</version>\r\n            <type>pom</type>\r\n            <scope>import</scope>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.projectlombok</groupId>\r\n            <artifactId>lombok</artifactId>\r\n            <version>${lombok.version}</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>mysql</groupId>\r\n            <artifactId>mysql-connector-java</artifactId>\r\n            <version>8.0.28</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.alibaba.spring</groupId>\r\n            <artifactId>spring-context-support</artifactId>\r\n            <version>1.0.11</version>\r\n        </dependency>\r\n    </dependencies>\r\n</dependencyManagement>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n port: 8182\r\nspring:\r\n application:\r\n  name: seata-account-service\r\n cloud:\r\n  nacos:\r\n   discovery:\r\n    server-addr: 127.0.0.1:8848\r\n datasource:\r\n  driverClassName: com.mysql.jdbc.Driver\r\n  password: root\r\n  url: jdbc:mysql://localhost:3306/seat-account?allowMultiQueries=true\r\n  username: root\r\nlogging:\r\n level:\r\n  io:\r\n   seata: info\r\nmybatis:\r\n mapperLocations: classpath:mapper/*.xml\r\nseata:\r\n tx-service-group: my_test_tx_group\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'-- \u6CE8\u89E3\u4F7F\u7528\r\n@GlobalTransactional(name = "fsp-create-order",rollbackFor = Exception.class)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-oauth2",children:"cloud-oauth2"}),"\n",(0,i.jsx)(e.h5,{id:"oauth2\u76F8\u5173\u540D\u8BCD",children:"OAuth2\u76F8\u5173\u540D\u8BCD"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- OAuth2\u76F8\u5173\u540D\u8BCD\u89E3\u91CA\r\nResource owner\uFF08\u8D44\u6E90\u62E5\u6709\u8005\uFF09\uFF1A\u62E5\u6709\u8BE5\u8D44\u6E90\u7684\u6700\u7EC8\u7528\u6237\uFF0C\u4ED6\u6709\u8BBF\u95EE\u8D44\u6E90\u7684\u8D26\u53F7\u5BC6\u7801\uFF1B\r\nResource server\uFF08\u8D44\u6E90\u670D\u52A1\u5668\uFF09\uFF1A\u670D\u52A1\u63D0\u4F9B\u5546\u5B58\u653E\u7528\u6237\u751F\u6210\u7684\u8D44\u6E90\u7684\u670D\u52A1\u5668\u3002\u4E0E\u8BA4\u8BC1\u670D\u52A1\u5668\u662F\u4E0D\u540C\u7684\u903B\u8F91\u8282\u70B9\uFF0C\u4F46\u662F\u5728\u7269\u7406\u4E0A\uFF0C\u53CC\u65B9\u662F\u53EF\u4EE5\u5728\u4E00\u8D77\u7684\u3002\u62E5\u6709\u53D7\u4FDD\u62A4\u8D44\u6E90\u7684\u670D\u52A1\u5668\uFF0C\u5982\u679C\u8BF7\u6C42\u5305\u542B\u6B63\u786E\u7684\u8BBF\u95EE\u4EE4\u724C\uFF0C\u53EF\u4EE5\u8BBF\u95EE\u8D44\u6E90\uFF1B\r\nClient\uFF08\u5BA2\u6237\u7AEF\uFF09\uFF1A\u8BBF\u95EE\u8D44\u6E90\u7684\u5BA2\u6237\u7AEF\uFF0C\u4F1A\u4F7F\u7528\u8BBF\u95EE\u4EE4\u724C\u53BB\u83B7\u53D6\u8D44\u6E90\u670D\u52A1\u5668\u7684\u8D44\u6E90\uFF0C\u53EF\u4EE5\u662F\u6D4F\u89C8\u5668\u3001\u79FB\u52A8\u8BBE\u5907\u6216\u8005\u670D\u52A1\u5668\uFF1B\r\nAuthorization server\uFF08\u8BA4\u8BC1\u670D\u52A1\u5668\uFF09\uFF1A\u670D\u52A1\u63D0\u4F9B\u5546\u4E13\u95E8\u7528\u6765\u5904\u7406\u8BA4\u8BC1\u7684\u670D\u52A1\u5668\u3002\u7528\u4E8E\u8BA4\u8BC1\u7528\u6237\u7684\u670D\u52A1\u5668\uFF0C\u5982\u679C\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u901A\u8FC7\uFF0C\u53D1\u653E\u8BBF\u95EE\u8D44\u6E90\u670D\u52A1\u5668\u7684\u4EE4\u724C\u3002\r\nHttp Service\uFF1A\u670D\u52A1\u63D0\u4F9B\u5546\uFF0C\u4E5F\u5C31\u662F\u6301\u6709Resource Server\u7684\u5B58\u5728\u65B9\u3002\u53EF\u4EE5\u7406\u89E3\u4E3A\u7C7B\u4F3C\u5FAE\u4FE1\uFF0C\u9489\u9489\u8FD9\u6837\u5177\u5907\u7528\u6237\u4FE1\u606F\u7684\u670D\u52A1\u8005\u3002\r\nUser Agent\uFF1A\u7528\u6237\u4EE3\u7406\uFF0C\u4E00\u822C\u5C31\u662F\u6307\u7684\u6D4F\u89C8\u5668\u3002\r\n\u5BA2\u6237\u7AEF\u51ED\u8BC1\uFF1AClient Id\u548C\u5BC6\u7801\u7528\u4E8E\u8BA4\u8BC1\u7528\u6237\u3002\r\n\u8BBF\u95EE\u4EE4\u724C\uFF1A\u6388\u6743\u670D\u52A1\u63D0\u4F9B\u8005\u5728\u63A5\u6536\u5230\u7528\u6237\u8BF7\u6C42\u540E,\u9881\u53D1\u7684\u8BBF\u95EE\u4EE4\u724C\u3002\r\n\u5237\u65B0\u4EE4\u724C\uFF08Refresh Token\uFF09\uFF1A\u7528\u4E8E\u83B7\u53D6\u4E00\u4E2A\u65B0\u7684\u4EE4\u724C\u3002\u7531\u4E8E\u4EE4\u724C\u7684\u6709\u6548\u671F\u6BD4\u8F83\u77ED\uFF0C\u4E00\u65E6\u5931\u6548\uFF0C\u7528\u6237\u9700\u8981\u518D\u83B7\u53D6\u4EE4\u724C\u7684\u6D41\u7A0B\u662F\u6BD4\u8F83\u7E41\u7410\u7684\u3002\u4E3A\u4E86\u63D0\u5347\u7528\u6237\u4F53\u9A8C\uFF0C\u53EF\u4EE5\u4F7F\u7528reflesh_token\u6765\u83B7\u53D6\u65B0\u7684\u4EE4\u724C\u3002\r\n\r\n\r\nClient Credentials\uFF08\u5BA2\u6237\u7AEF\u6A21\u5F0F\uFF09\uFF1A\u5BA2\u6237\u7AEF\u76F4\u63A5\u901A\u8FC7\u5BA2\u6237\u7AEF\u8BA4\u8BC1\uFF08\u6BD4\u5982client_id\u548Cclient_secret\uFF09\u4ECE\u8BA4\u8BC1\u670D\u52A1\u5668\u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C\u3002\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u56DB\u79CD\u6388\u6743\u6A21\u5F0F",children:"\u56DB\u79CD\u6388\u6743\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.h6,{id:"authorization-code\u6388\u6743\u7801\u6A21\u5F0F",children:"Authorization Code\uFF08\u6388\u6743\u7801\u6A21\u5F0F\uFF09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"1\u3001\u7528\u6237\u767B\u5F55\u5E94\u7528\u7CFB\u7EDF\uFF0C\u8BF7\u6C42\u8DF3\u8F6C\u5230\u8BA4\u8BC1\u670D\u52A1\u5668\uFF0C\u5E76302\u8FD4\u56DE\u767B\u5F55\u8BA4\u8BC1\u9875\u9762\uFF1B\r\n2\u3001\u7528\u6237\u8F93\u5165\u8D26\u6237+\u5BC6\u7801\u8FDB\u884C\u8BA4\u8BC1\uFF0C\u8BA4\u8BC1\u670D\u52A1\u5668\u8BA4\u8BC1\u901A\u8FC7\u8FD4\u56DEcode\u7ED9\u5E94\u7528\u7CFB\u7EDF\uFF1B\r\n3\u3001\u5E94\u7528\u7CFB\u7EDF\u643A\u5E26code\u5411\u8BA4\u8BC1\u670D\u52A1\u5668\u6362\u53D6\u8BBF\u95EE\u4EE4\u724C\uFF0C\u8BA4\u8BC1\u670D\u52A1\u5668\u9A8C\u8BC1Client ID\uFF0Ccode\u7B49\u4FE1\u606F\uFF0C\u7ED9\u5E94\u7528\u7CFB\u7EDF\u53D1\u9001\u8BBF\u95EE\u4EE4\u724C\uFF1B\r\n4\u3001\u5E94\u7528\u7CFB\u7EDF\u643A\u5E26\u8BBF\u95EE\u4EE4\u724C\u67E5\u8BE2\u7528\u6237\u767B\u5F55\u4FE1\u606F\uFF0C\u8BA4\u8BC1\u670D\u52A1\u5668\u8FD4\u56DE\u7528\u6237\u4FE1\u606F\uFF0C\u5982\u7528\u6237\u540D\uFF1B\r\n5\u3001\u5E94\u7528\u7CFB\u7EDF\u9A8C\u8BC1\u7528\u6237\u540D\u6B63\u786E\uFF0C\u521B\u5EFA\u4F1A\u8BDD\uFF0C\u5E76\u8DF3\u8F6C\u5230redirect url\n"})}),"\n","\n",(0,i.jsx)("img",{src:o,alt:"SpringCloud-\u6388\u6743\u7801\u6A21\u5F0F",width:"50%"}),"\n",(0,i.jsx)(e.h6,{id:"implicit\u7B80\u5316\u6A21\u5F0F",children:"Implicit\uFF08\u7B80\u5316\u6A21\u5F0F\uFF09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"\u7701\u7565\u6389\u4E86\u9881\u53D1\u6388\u6743\u7801\uFF08Authorization Code\uFF09\u7ED9\u5BA2\u6237\u7AEF\u7684\u8FC7\u7A0B\uFF0C\u76F4\u63A5\u8FD4\u56DE\u8BBF\u95EE\u4EE4\u724C\u548C\u53EF\u9009\u7684\u5237\u65B0\u4EE4\u724C\u3002\u5176\u9002\u7528\u4E8E\u6CA1\u6709Server\u670D\u52A1\u5668\u6765\u63A5\u53D7\u5904\u7406Authorization Code\u7684\u7B2C\u4E09\u65B9\u5E94\u7528\u3002\u9002\u7528\u4E8E\u516C\u5F00\u7684\u6D4F\u89C8\u5668\u5355\u9875\u5E94\u7528\n"})}),"\n","\n",(0,i.jsx)("img",{src:c,alt:"SpringCloud-\u7B80\u5316\u6A21\u5F0F",width:"50%"}),"\n",(0,i.jsx)(e.h6,{id:"\u5BC6\u7801\u6A21\u5F0F",children:"\u5BC6\u7801\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"\u8FD9\u79CD\u6A21\u5F0F\u518D\u4E00\u6B65\u7B80\u5316\uFF0C\u548CAuthorzation Code\u7C7B\u578B\u4E0B\u91CD\u8981\u7684\u533A\u5206\u5C31\u662F\u7701\u7565\u4E86Authorization Request\u548CAuthorization Response\u3002\u800C\u662FClient\u76F4\u63A5\u4F7F\u7528Resource owner\u63D0\u4F9B\u7684username\u548Cpassword\u6765\u76F4\u63A5\u8BF7\u6C42access_token\uFF08\u76F4\u63A5\u53D1\u8D77Access Token Request\u7136\u540E\u8FD4\u56DEAccess Token Response\u4FE1\u606F\uFF09\u3002\u8FD9\u79CD\u6A21\u5F0F\u4E00\u822C\u9002\u7528\u4E8EResource server\u9AD8\u5EA6\u4FE1\u4EFB\u7B2C\u4E09\u65B9Client\u7684\u60C5\u51B5\u4E0B \n"})}),"\n","\n",(0,i.jsx)("img",{src:d,alt:"SpringCloud-\u5BC6\u7801\u6A21\u5F0F",width:"50%"}),"\n",(0,i.jsx)(e.h6,{id:"client-credentials\u5BA2\u6237\u7AEF\u6A21\u5F0F",children:"Client Credentials\uFF08\u5BA2\u6237\u7AEF\u6A21\u5F0F\uFF09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"Client\u76F4\u63A5\u4EE5\u81EA\u5DF1\u7684\u540D\u4E49\u800C\u4E0D\u662FResource owner\u7684\u540D\u4E49\u53BB\u8981\u6C42\u8BBF\u95EEResource server\u7684\u4E00\u4E9B\u53D7\u4FDD\u62A4\u8D44\u6E90 \r\n\u9002\u7528\u4E8E\u670D\u52A1\u5668\u95F4\u901A\u4FE1\u573A\u666F\uFF0C\u76F4\u63A5\u6839\u636Eclient\u7684ID\u548C\u5BC6\u94A5\u5373\u53EF\u83B7\u53D6token\uFF0C\u65E0\u9700\u7528\u6237\u53C2\u4E0E\r\n\u8FD9\u79CD\u6A21\u5F0F\u6BD4\u8F83\u5408\u9002\u6D88\u8D39api\u7684\u540E\u7AEF\u670D\u52A1\uFF0C\u6BD4\u5982\u62C9\u53D6\u4E00\u7EC4\u7528\u6237\u4FE1\u606F\u7B49\n"})}),"\n","\n",(0,i.jsx)("img",{src:u,alt:"SpringCloud-\u5BA2\u6237\u7AEF\u6A21\u5F0F",width:"50%"}),"\n",(0,i.jsx)(e.h6,{id:"\u5237\u65B0\u4EE4\u724C",children:"\u5237\u65B0\u4EE4\u724C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"\u4EE5\u4FBF\u5728\u8BBF\u95EE\u4EE4\u724C\u8FC7\u671F\u5931\u6548\u7684\u65F6\u5019\u53EF\u4EE5\u7531\u5BA2\u6237\u7AEF\u81EA\u52A8\u83B7\u53D6\u65B0\u7684\u8BBF\u95EE\u4EE4\u724C\uFF0C\u800C\u4E0D\u662F\u8BA9\u7528\u6237\u518D\u6B21\u767B\u5F55\u6388\u6743\n"})}),"\n","\n",(0,i.jsx)("img",{src:p,alt:"SpringCloud-\u5237\u65B0\u4EE4\u724C",width:"50%"}),"\n",(0,i.jsx)(e.h5,{id:"\u5165\u95E8\u4F7F\u7528",children:"\u5165\u95E8\u4F7F\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-oauth2</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-security</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u52A0\u8F7D\u7528\u6237\u4FE1\u606F\r\n/**\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Service\r\npublic class UserService implements UserDetailsService {\r\n    private List<User> userList;\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @PostConstruct\r\n    public void initData() {\r\n        String password = passwordEncoder.encode("123456");\r\n        userList = new ArrayList<>();\r\n        userList.add(new User("macro", password, AuthorityUtils.commaSeparatedStringToAuthorityList("admin")));\r\n        userList.add(new User("andy", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));\r\n        userList.add(new User("mark", password, AuthorityUtils.commaSeparatedStringToAuthorityList("client")));\r\n    }\r\n\r\n    @Override\r\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\r\n        List<User> findUserList = userList.stream().filter(user -> user.getUsername().equals(username)).collect(Collectors.toList());\r\n        if (!CollectionUtils.isEmpty(findUserList)) {\r\n            return findUserList.get(0);\r\n        } else {\r\n            throw new UsernameNotFoundException("\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u8BA4\u8BC1\u670D\u52A1\u5668\u914D\u7F6E\uFF0C\u5E76\u5F00\u542F\u8BA4\u8BC1\r\n/**\r\n * \u8BA4\u8BC1\u670D\u52A1\u5668\u914D\u7F6E\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    /**\r\n     * \u4F7F\u7528\u5BC6\u7801\u6A21\u5F0F\u9700\u8981\u914D\u7F6E\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService);\r\n    }\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                //\u914D\u7F6Eclient_id\r\n                .withClient("admin")\r\n                //\u914D\u7F6Eclient_secret\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                //\u914D\u7F6E\u8BBF\u95EEtoken\u7684\u6709\u6548\u671F\r\n                .accessTokenValiditySeconds(3600)\r\n                //\u914D\u7F6E\u5237\u65B0token\u7684\u6709\u6548\u671F\r\n                .refreshTokenValiditySeconds(864000)\r\n                //\u914D\u7F6Eredirect_uri\uFF0C\u7528\u4E8E\u6388\u6743\u6210\u529F\u540E\u8DF3\u8F6C\r\n                .redirectUris("http://www.baidu.com")\r\n                //\u914D\u7F6E\u7533\u8BF7\u7684\u6743\u9650\u8303\u56F4\r\n                .scopes("all")\r\n                //\u914D\u7F6Egrant_type\uFF0C\u8868\u793A\u6388\u6743\u7C7B\u578B\r\n                .authorizedGrantTypes("authorization_code","password");\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u8D44\u6E90\u670D\u52A1\u5668\u914D\u7F6E\uFF0C\u5E76\u5F00\u542F\r\n/**\r\n * \u8D44\u6E90\u670D\u52A1\u5668\u914D\u7F6E\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableResourceServer\r\npublic class ResourceServerConfig extends ResourceServerConfigurerAdapter {\r\n\r\n    @Override\r\n    public void configure(HttpSecurity http) throws Exception {\r\n        http.authorizeRequests()\r\n                .anyRequest()\r\n                .authenticated()\r\n                .and()\r\n                .requestMatchers()\r\n            	//\u914D\u7F6E\u9700\u8981\u4FDD\u62A4\u7684\u8D44\u6E90\u8DEF\u5F84\r\n                .antMatchers("/user/**");\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//security\u914D\u7F6E\uFF0C\u5141\u8BB8\u8BA4\u8BC1\u76F8\u5173\u8DEF\u5F84\u7684\u8BBF\u95EE\u53CA\u8868\u5355\u767B\u5F55\uFF0C\u5E76\u5F00\u542F\r\n/**\r\n * SpringSecurity\u914D\u7F6E\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\n@EnableWebSecurity\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n\r\n    @Bean\r\n    public PasswordEncoder passwordEncoder() {\r\n        return new BCryptPasswordEncoder();\r\n    }\r\n\r\n    @Bean\r\n    @Override\r\n    public AuthenticationManager authenticationManagerBean() throws Exception {\r\n        return super.authenticationManagerBean();\r\n    }\r\n\r\n    @Override\r\n    public void configure(HttpSecurity http) throws Exception {\r\n        http.csrf()\r\n                .disable()\r\n                .authorizeRequests()\r\n                .antMatchers("/oauth/**", "/login/**", "/logout/**")\r\n                .permitAll()\r\n                .anyRequest()\r\n                .authenticated()\r\n                .and()\r\n                .formLogin()\r\n                .permitAll();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u6D4B\u8BD5\u63A5\u53E3\r\n@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @GetMapping("/getCurrentUser")\r\n    public Object getCurrentUser(Authentication authentication) {\r\n        return authentication.getPrincipal();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u6388\u6743\u7801\u767B\u5F55\r\n1\u3001\u8FDB\u884C\u767B\u5F55\u6388\u6743\r\nhttp://localhost:9401/oauth/authorize?response_type=code&client_id=admin&redirect_uri=http://www.baidu.com&scope=all&state=normal\r\n2\u3001\u8FDB\u884C\u6388\u6743\u64CD\u4F5C\r\n\u9009\u62E9Approve\uFF0C\u4F1A\u5F97\u5230\u4E00\u4E2A\u6388\u6743\u7801code\r\n3\u3001\u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C\r\nhttp://localhost:9401/oauth/token\r\nAuthorization\uFF1ABasic Auth  input username and password\r\nFormdata: \r\ncode:\u6388\u6743\u7801\r\ngrant_type:authorization_code\r\nclient_id:admin\r\nredirect_uri:http://www.baidu.com\r\nscope:all\r\n\r\n-- \u5BC6\u7801\u6A21\u5F0F\u767B\u5F55\r\n1\u3001\u4F7F\u7528\u5BC6\u7801\u8BF7\u6C42\u8BE5\u5730\u5740\u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C\r\nhttp://localhost:9401/oauth/token\r\nAuthorization\uFF1ABasic Auth  input username and password\r\nFormdata: \r\ngrant_type:password\r\nscope:all\r\nusername:macro\r\npassword:123456\r\n\r\n-- \u6D4B\u8BD5\u63A5\u53E3\r\nhttp://localhost:9401/user/getCurrentUser\r\nAuthorization\uFF1Abearer \u8BBF\u95EE\u4EE4\u724C\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5B58\u50A8\u4EE4\u724C",children:"\u5B58\u50A8\u4EE4\u724C"}),"\n",(0,i.jsx)(e.h6,{id:"\u4F7F\u7528redis\u5B58\u50A8\u4EE4\u724C",children:"\u4F7F\u7528Redis\u5B58\u50A8\u4EE4\u724C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-data-redis</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u4F7F\u7528redis\u5B58\u50A8token\u7684\u914D\u7F6E\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\npublic class RedisTokenStoreConfig {\r\n\r\n    @Autowired\r\n    private RedisConnectionFactory redisConnectionFactory;\r\n\r\n    @Bean\r\n    public TokenStore redisTokenStore (){\r\n        return new RedisTokenStore(redisConnectionFactory);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u8BA4\u8BC1\u914D\u7F6E\u6307\u5B9A\u5B58\u50A8\u7B56\u7565\u4E3Aredis\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    @Autowired\r\n    @Qualifier("redisTokenStore")\r\n    private TokenStore tokenStore;\r\n\r\n    /**\r\n     * \u4F7F\u7528\u5BC6\u7801\u6A21\u5F0F\u9700\u8981\u914D\u7F6E\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore);//\u914D\u7F6E\u4EE4\u724C\u5B58\u50A8\u7B56\u7565\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u6D4B\u8BD5\r\n\u4F7F\u7528password\u65B9\u5F0F\u83B7\u53D6\u4EE4\u724C\uFF0C\u8BBF\u95EEhttp://localhost:9401/oauth/token\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u4F7F\u7528jwt\u5B58\u50A8\u4EE4\u724C",children:"\u4F7F\u7528jwt\u5B58\u50A8\u4EE4\u724C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u4F7F\u7528Jwt\u5B58\u50A8token\u7684\u914D\u7F6E\r\n * Created by macro on 2019/10/8.\r\n */\r\n@Configuration\r\npublic class JwtTokenStoreConfig {\r\n\r\n    @Bean\r\n    public TokenStore jwtTokenStore() {\r\n        return new JwtTokenStore(jwtAccessTokenConverter());\r\n    }\r\n\r\n    @Bean\r\n    public JwtAccessTokenConverter jwtAccessTokenConverter() {\r\n        JwtAccessTokenConverter accessTokenConverter = new JwtAccessTokenConverter();\r\n        accessTokenConverter.setSigningKey("test_key");//\u914D\u7F6EJWT\u4F7F\u7528\u7684\u79D8\u94A5\r\n        return accessTokenConverter;\r\n    }\r\n}\r\n\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'//\u8BA4\u8BC1\u914D\u7F6E\u6307\u5B9A\u5B58\u50A8\u7B56\u7565\u4E3Ajwt\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private PasswordEncoder passwordEncoder;\r\n\r\n    @Autowired\r\n    private AuthenticationManager authenticationManager;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    @Autowired\r\n    @Qualifier("jwtTokenStore")\r\n    private TokenStore tokenStore;\r\n    \r\n    @Autowired\r\n    private JwtAccessTokenConverter jwtAccessTokenConverter;\r\n\r\n    /**\r\n     * \u4F7F\u7528\u5BC6\u7801\u6A21\u5F0F\u9700\u8981\u914D\u7F6E\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore)//\u914D\u7F6E\u4EE4\u724C\u5B58\u50A8\u7B56\u7565\r\n                .accessTokenConverter(jwtAccessTokenConverter);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u6269\u5C55jwt\u5B58\u50A8\u5185\u5BB9",children:"\u6269\u5C55jwt\u5B58\u50A8\u5185\u5BB9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * Jwt\u5185\u5BB9\u589E\u5F3A\u5668\r\n * Created by macro on 2019/10/8.\r\n */\r\npublic class JwtTokenEnhancer implements TokenEnhancer {\r\n    @Override\r\n    public OAuth2AccessToken enhance(OAuth2AccessToken accessToken, OAuth2Authentication authentication) {\r\n        //\u6269\u5C55\u5B58\u50A8\u7684\u4FE1\u606F\r\n        Map<String, Object> info = new HashMap<>();\r\n        info.put("enhance", "enhance info");\r\n        ((DefaultOAuth2AccessToken) accessToken).setAdditionalInformation(info);\r\n        return accessToken;\r\n    }\r\n}\r\n\r\n@Bean\r\npublic JwtTokenEnhancer jwtTokenEnhancer() {\r\n    return new JwtTokenEnhancer();\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u8BA4\u8BC1\u670D\u52A1\u5668\u914D\u7F6E\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Autowired\r\n    private JwtTokenEnhancer jwtTokenEnhancer;\r\n    /**\r\n     * \u4F7F\u7528\u5BC6\u7801\u6A21\u5F0F\u9700\u8981\u914D\u7F6E\r\n     */\r\n    @Override\r\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\r\n        TokenEnhancerChain enhancerChain = new TokenEnhancerChain();\r\n        List<TokenEnhancer> delegates = new ArrayList<>();\r\n        delegates.add(jwtTokenEnhancer); //\u914D\u7F6EJWT\u7684\u5185\u5BB9\u589E\u5F3A\u5668\r\n        delegates.add(jwtAccessTokenConverter);\r\n        enhancerChain.setTokenEnhancers(delegates);\r\n        endpoints.authenticationManager(authenticationManager)\r\n                .userDetailsService(userService)\r\n                .tokenStore(tokenStore) //\u914D\u7F6E\u4EE4\u724C\u5B58\u50A8\u7B56\u7565\r\n                .accessTokenConverter(jwtAccessTokenConverter)\r\n                .tokenEnhancer(enhancerChain);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h6,{id:"\u89E3\u6790jwt",children:"\u89E3\u6790jwt"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>io.jsonwebtoken</groupId>\r\n    <artifactId>jjwt</artifactId>\r\n    <version>0.9.0</version>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @GetMapping("/getCurrentUser")\r\n    public Object getCurrentUser(Authentication authentication, HttpServletRequest request) {\r\n        String header = request.getHeader("Authorization");\r\n        String token = StrUtil.subAfter(header, "bearer ", false);\r\n        return Jwts.parser()\r\n                .setSigningKey("test_key".getBytes(StandardCharsets.UTF_8))\r\n                .parseClaimsJws(token)\r\n                .getBody();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u5237\u65B0\u4EE4\u724C-1",children:"\u5237\u65B0\u4EE4\u724C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u8BA4\u8BC1\u670D\u52A1\u5668\u914D\u7F6E\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                .withClient("admin")\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                .accessTokenValiditySeconds(3600)\r\n                .refreshTokenValiditySeconds(864000)\r\n                .redirectUris("http://www.baidu.com")\r\n                .autoApprove(true) //\u81EA\u52A8\u6388\u6743\u914D\u7F6E\r\n                .scopes("all")\r\n                .authorizedGrantTypes("authorization_code","password","refresh_token"); //\u6DFB\u52A0\u6388\u6743\u6A21\u5F0F\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u7528\u5237\u65B0\u4EE4\u724C\u6A21\u5F0F\u6765\u83B7\u53D6\u65B0\u7684\u4EE4\u724C\r\n\u643A\u5E26\u53C2\u6570grant_type=refresh_token & refresh_token={}\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5355\u70B9\u767B\u5F55",children:"\u5355\u70B9\u767B\u5F55"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5355\u70B9\u767B\u5F55\uFF08Single Sign On\uFF09\u6307\u7684\u662F\u5F53\u6709\u591A\u4E2A\u7CFB\u7EDF\u9700\u8981\u767B\u5F55\u65F6\uFF0C\u7528\u6237\u53EA\u9700\u767B\u5F55\u4E00\u4E2A\u7CFB\u7EDF\uFF0C\u5C31\u53EF\u4EE5\u8BBF\u95EE\u5176\u4ED6\u9700\u8981\u767B\u5F55\u7684\u7CFB\u7EDF\u800C\u65E0\u9700\u767B\u5F55\r\n\r\n-- \u5F53\u6211\u4EEC\u5728oauth2-jwt-server\u670D\u52A1\u4E0A\u767B\u5F55\u4EE5\u540E\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EEoauth2-client\u9700\u8981\u767B\u5F55\u7684\u63A5\u53E3\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-oauth2</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.cloud</groupId>\r\n    <artifactId>spring-cloud-starter-security</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>io.jsonwebtoken</groupId>\r\n    <artifactId>jjwt</artifactId>\r\n    <version>0.9.0</version>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"server:\r\n  port: 9501\r\n  servlet:\r\n    session:\r\n      cookie:\r\n        name: OAUTH2-CLIENT-SESSIONID #\u9632\u6B62Cookie\u51B2\u7A81\uFF0C\u51B2\u7A81\u4F1A\u5BFC\u81F4\u767B\u5F55\u9A8C\u8BC1\u4E0D\u901A\u8FC7\r\noauth2-server-url: http://localhost:9401\r\nspring:\r\n  application:\r\n    name: oauth2-client\r\nsecurity:\r\n  oauth2: #\u4E0Eoauth2-server\u5BF9\u5E94\u7684\u914D\u7F6E\r\n    client:\r\n      client-id: admin\r\n      client-secret: admin123456\r\n      user-authorization-uri: ${oauth2-server-url}/oauth/authorize\r\n      access-token-uri: ${oauth2-server-url}/oauth/token\r\n    resource:\r\n      jwt:\r\n        key-uri: ${oauth2-server-url}/oauth/token_key\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@EnableOAuth2Sso\r\n@SpringBootApplication\r\npublic class Oauth2ClientApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(Oauth2ClientApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u8BA4\u8BC1\u670D\u52A1\u5668\u914D\u7F6E\r\n * Created by macro on 2019/9/30.\r\n */\r\n@Configuration\r\n@EnableAuthorizationServer\r\npublic class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {\r\n    @Override\r\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\r\n        clients.inMemory()\r\n                .withClient("admin")\r\n                .secret(passwordEncoder.encode("admin123456"))\r\n                .accessTokenValiditySeconds(3600)\r\n                .refreshTokenValiditySeconds(864000)\r\n            	//\u5355\u70B9\u767B\u5F55\u65F6\u914D\u7F6E\r\n                .redirectUris("http://localhost:9501/login") \r\n            	//\u81EA\u52A8\u6388\u6743\u914D\u7F6E\r\n            	.autoApprove(true) \r\n                .scopes("all")\r\n                .authorizedGrantTypes("authorization_code","password","refresh_token");\r\n    }\r\n    @Override\r\n    public void configure(AuthorizationServerSecurityConfigurer security) {\r\n        // \u83B7\u53D6\u5BC6\u94A5\u9700\u8981\u8EAB\u4EFD\u8BA4\u8BC1\uFF0C\u4F7F\u7528\u5355\u70B9\u767B\u5F55\u65F6\u5FC5\u987B\u914D\u7F6E\r\n        security.tokenKeyAccess("isAuthenticated()"); \r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h6,{id:"\u6743\u9650\u8BA4\u8BC1",children:"\u6743\u9650\u8BA4\u8BC1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u5728\u63A5\u53E3\u4E0A\u914D\u7F6E\u6743\u9650\u65F6\u4F7F\u7528\r\n * Created by macro on 2019/10/11.\r\n */\r\n@Configuration\r\n@EnableGlobalMethodSecurity(prePostEnabled = true)\r\n@Order(101)\r\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\r\n}\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'/**\r\n * Created by macro on 2019/9/30.\r\n */\r\n@RestController\r\n@RequestMapping("/user")\r\npublic class UserController {\r\n    @PreAuthorize("hasAuthority(\'admin\')")\r\n    @GetMapping("/auth/admin")\r\n    public Object adminAuth() {\r\n        return "Has admin auth!";\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"cloud-admin",children:"cloud-admin"}),"\n",(0,i.jsx)(e.h5,{id:"\u670D\u52A1\u7AEF-3",children:"\u670D\u52A1\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>de.codecentric</groupId>\r\n    <artifactId>spring-boot-admin-starter-server</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  application:\r\n    name: admin-server\r\nserver:\r\n  port: 9301\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@EnableAdminServer\r\n@SpringBootApplication\r\npublic class AdminServerApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(AdminServerApplication.class, args);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(e.h5,{id:"\u5BA2\u6237\u7AEF-4",children:"\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-web</artifactId>\r\n</dependency>\r\n<dependency>\r\n    <groupId>de.codecentric</groupId>\r\n    <artifactId>spring-boot-admin-starter-client</artifactId>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\r\n  application:\r\n    name: admin-client\r\n  boot:\r\n    admin:\r\n      client:\r\n        url: http://localhost:9301 #\u914D\u7F6Eadmin-server\u5730\u5740\r\nserver:\r\n  port: 9305\r\nmanagement:\r\n  endpoints:\r\n    web:\r\n      exposure:\r\n        include: '*'\r\n  endpoint:\r\n    health:\r\n      show-details: always\r\nlogging:\r\n  file: admin-client.log #\u6DFB\u52A0\u5F00\u542Fadmin\u7684\u65E5\u5FD7\u76D1\u63A7\n"})}),"\n",(0,i.jsx)(e.h3,{id:"skywalking\u94FE\u8DEF\u8FFD\u8E2A",children:"SkyWalking\u94FE\u8DEF\u8FFD\u8E2A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'-- \u90E8\u7F72\u5B66\u4E60\u5730\u5740\r\nhttps://www.iocoder.cn/SkyWalking/install/\r\n-- \u4E1A\u52A1\u673A\u5236\r\nSpringCloud\uFF1A\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u670D\u52A1\uFF0C\u542F\u52A8\u65F6\u914D\u7F6E\u4EE3\u7406\u5373\u53EF\uFF1B\r\nAgent\uFF1A\u4EE5\u63A2\u9488\u7684\u65B9\u5F0F\u8FDB\u884C\u8BF7\u6C42\u94FE\u8DEF\u7684\u6570\u636E\u91C7\u96C6\uFF0C\u5E76\u5411\u7BA1\u7406\u670D\u52A1\u4E0A\u62A5\uFF1B\r\nOAP-Service\uFF1A\u63A5\u6536\u6570\u636E\uFF0C\u5B8C\u6210\u6570\u636E\u7684\u5B58\u50A8\u548C\u5C55\u793A\uFF1B\r\nStorage\uFF1A\u6570\u636E\u7684\u5B58\u50A8\u5C42\uFF0C\u652F\u6301ElasticSearch\u3001Mysql\u3001H2\u591A\u79CD\u65B9\u5F0F\uFF1B\r\nUI\u754C\u9762\uFF1A\u6570\u636E\u7684\u53EF\u89C6\u5316\u5C55\u793A\u754C\u9762\uFF1B\r\n-- \u5DE5\u4F5C\u6D41\u7A0B\r\nspringboot\u542F\u52A8\uFF0C\u914D\u7F6Eagent\u5730\u5740\uFF0C\u5E76\u8BBE\u7F6Eagent\u8FDE\u63A5\u7684OAP\u5730\u5740\uFF0COAP\u914D\u7F6E\u5B58\u50A8\u5730\u5740(\u5982elastic)\r\n\u670D\u52A1\u901A\u8FC7\u63A2\u9488\u7684\u65B9\u5F0F\u63A5\u5165\u6570\u636E\u91C7\u96C6\u7684\u529F\u80FD\uFF0C\u4E4B\u540E\u8BF7\u6C42\u94FE\u8DEF\u7684\u76F8\u5173\u5904\u7406\u884C\u4E3A\u4F1A\u4E0A\u62A5\u5230OAP\u670D\u52A1\u4E2D\uFF0C\u8FDB\u884C\u6570\u636E\u7684\u805A\u5408\u7BA1\u7406\u548C\u5206\u6790\uFF0C\u5E76\u5B58\u50A8\u5728\u6301\u4E45\u5C42\uFF0C\u7136\u540E\u53EF\u4EE5\u901A\u8FC7UI\u754C\u9762\u8FDB\u884C\u53EF\u89C6\u5316\u5448\u73B0\r\n\r\n-- \u5B89\u88C5\u90E8\u7F72\r\nskywalking\u5728\u4E4B\u524D\u7684\u65E7\u7248\u672C\u4E2D\uFF0Capm\u4E0Eagent\u662F\u5728\u4E00\u4E2A\u5305\u4E2D\u7684\uFF0C\u57289.0\u7684\u7248\u672C\u4E2D\u662F\u9700\u8981\u5206\u5F00\u4E0B\u8F7D\u7684\uFF1Bagent\u5305\u4E0B\u8F7D\u89E3\u538B\u4E4B\u540E\uFF0C\u4E5F\u5C06\u5176\u653E\u5230apm\u5305\u4E0B\u9762\u7EF4\u62A4\r\n-- \u914D\u7F6E\u5B58\u50A8\u65B9\u5F0F\r\nconfig/application.yml\r\nstorage:\r\n  selector: ${SW_STORAGE:elasticsearch}\r\n  elasticsearch:\r\n    namespace: ${SW_NAMESPACE:""}\r\n    clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:175.178.164.134:9200}\r\n-- \u542F\u52A8\r\nWindows \u76F4\u63A5\u70B9\u51FBbin/startup.bat\r\n-- \u6D89\u53CA\u7F51\u5173\r\n\u5C06optional-plugins\u76EE\u5F55\u4E0B\u9762\u7684apm-spring-cloud-gateway-3.x-plugin-8.12.0.jar \u548Capm-spring-webflux-5.x-plugin-8.12.0.jar\u4E24\u4E2A\u5305\u62F7\u8D1D\u5230plugins\u76EE\u5F55\u4E0B\u9762\u53BB\r\n-- \u670D\u52A1\u6DFB\u52A0\u914D\u7F6E\r\n\u5728\u670D\u52A1\u542F\u52A8\u7C7B\u4E2D\u6DFB\u52A0agent\u914D\u7F6E\uFF0C\u5982\u679C\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0C\u901A\u5E38\u4F1A\u7EDF\u4E00\u5728\u811A\u672C\u4E2D\u8BBE\u7F6E\uFF0C\u7531\u4E8E\u5728\u672C\u5730\u73AF\u5883\u6F14\u793A\uFF0C\u57FA\u4E8EIDEA\u5DE5\u5177\u8FDB\u884C\u7BA1\u7406\r\n-javaagent:D:\\hayes\\software-0329\\apache-skywalking-apm-bin\\agent\\skywalking-agent.jar\r\n-Dskywalking.agent.service_name=hmh-cloud-gateway\r\n-Dskywalking.collector.backend_service=127.0.0.1:11800\n'})}),"\n","\n",(0,i.jsx)("img",{src:g,alt:"SpringCloud-SkyWalking\u94FE\u8DEF\u8FFD\u8E2A",width:"50%"})]})}function j(r={}){let{wrapper:e}={...(0,t.R)(),...r.components};return e?(0,i.jsx)(e,{...r,children:(0,i.jsx)(f,{...r})}):f(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>s,x:()=>l});var a=n(6540);let i={},t=a.createContext(i);function s(r){let e=a.useContext(t);return a.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:s(r.components),a.createElement(t.Provider,{value:e},r.children)}}}]);